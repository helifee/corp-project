package com.xinleju.cloud.oa.content.service.impl;

import com.xinleju.cloud.oa.content.dao.ContentRowAttributeDao;
import com.xinleju.cloud.oa.content.entity.ContentRowAttribute;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.xinleju.platform.base.service.impl.BaseServiceImpl;
import com.xinleju.cloud.oa.content.dao.ContentDictionaryDao;
import com.xinleju.cloud.oa.content.dao.ContentDictionaryItemDao;
import com.xinleju.cloud.oa.content.entity.ContentDictionary;
import com.xinleju.cloud.oa.content.service.ContentDictionaryService;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * @author admin
 */

@Service
public class ContentDictionaryServiceImpl extends BaseServiceImpl<String, ContentDictionary> implements ContentDictionaryService {


    @Autowired
    private ContentDictionaryDao contentDictionaryDao;
    @Autowired
    private ContentDictionaryItemDao contentDictionaryItemDao;

    @Autowired
    private ContentRowAttributeDao contentRowAttributeDao;

    @Override
    public List<Map<String, Object>> queryDictionaryTree(Map<String, Object> paramMap) {
        paramMap.put("delflag",false);
        paramMap.put("sidx","createDate");
        paramMap.put("sord","asc");

        List<ContentDictionary> list = this.contentDictionaryDao.queryList(paramMap);
        List<Map<String,Object>> resultList = new ArrayList<Map<String,Object>>();
        if (list != null && list.size() > 0) {
            for (ContentDictionary contentDictionary:list) {
                String code = contentDictionary.getCode();
                String name = contentDictionary.getName();
                String id = contentDictionary.getId();
                Boolean status = contentDictionary.getStatus();
                Boolean isSystem = contentDictionary.getIsSystem();
                String pId = "0";
                Map<String,Object> map = new HashMap<String,Object>();
                map.put("id",id);
                map.put("code",code);
                map.put("name",name);
                map.put("pId",pId);
                map.put("status",status);
                map.put("isSystem",isSystem);
                resultList.add(map);
            }
        }
        return resultList;
    }

	/* (non-Javadoc)
	 * @see com.xinleju.cloud.oa.content.service.ContentDictionaryService#deleteContentDictionary(java.lang.String)
	 */
	@Override
	public int deleteContentDictionary(String id) throws Exception {
        ContentDictionary dictionary = this.contentDictionaryDao.getObjectById(id);
        Map<String,Object> paramMap = new HashMap<String,Object>();
        paramMap.put("fieldCode",dictionary.getCode());
        List<ContentRowAttribute> list = contentRowAttributeDao.queryList(paramMap);
        if(list!=null&&list.size()>0){
            throw new Exception("当前字典已被引用，不能删除！");
            //return -1;
        }
		return  contentDictionaryDao.deletePseudoObjectById(id);
	  
	}
}
