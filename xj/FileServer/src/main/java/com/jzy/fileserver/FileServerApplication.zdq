package com.jzy.fileserver;

import java.util.List;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.scheduling.annotation.EnableScheduling;
import org.springframework.util.CollectionUtils;

import com.jzy.fileserver.domain.Printer;
import com.jzy.fileserver.printer.PrintEventMonitor;
import com.jzy.fileserver.printer.PrinterConfigration;
import com.jzy.fileserver.utils.BeanLocator;

@EnableScheduling
@SpringBootApplication
@MapperScan("com.jzy.fileserver.dao")
public class FileServerApplication {
	
	public static void main(String[] args) {
		SpringApplication.run(FileServerApplication.class, args);
		
//		new Thread(new Runnable() {
//
//			@Override
//			public void run() {
//				try {
//					new ServerBorad();
//				} catch (IOException e) {
//					e.printStackTrace();
//				}
//			}
//			
//		}).start();
		
		//启动打印机监听器
		startMonitor();
		
	}
	
	public static void startMonitor() {
		PrinterConfigration printerConfigration = (PrinterConfigration) BeanLocator.getBean(PrinterConfigration.class);
		List<Printer> printers = printerConfigration.getAddress();
		if (!CollectionUtils.isEmpty(printers)) {
			for (Printer printer : printers) {
				PrintEventMonitor monitor = (PrintEventMonitor) BeanLocator.getBean(PrintEventMonitor.class);
				monitor.setPrinter(printer);
				
				new Thread(new Runnable() {
					@Override
					public void run() {
						monitor.start0();
					}}).start();
			}
		}
	}
}
