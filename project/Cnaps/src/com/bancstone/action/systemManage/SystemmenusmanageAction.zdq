/**
 * <p>项目名称：zhiNengT<p>
 * <ul>
 * <li>1、版权所有：驰波公司</li>
 * <li>2、开发作者：史文龙</li>
 * <li>3、开发日期：2010-7-28</li>
 * <li>4、开发时间：下午02:43:54</li>
 * <li>5、文件名称：SystemmenusmanageActionS.java</li>
 * <li>6、包路径名：com.bancstone.action.systemManage</li>
 * </ul>
 */
package com.bancstone.action.systemManage;
 
import java.util.List;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.commons.lang.StringUtils;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import com.bancstone.action.BaseAction;
import com.bancstone.constants.MessageConstants;
import com.bancstone.form.systemManage.SystemmenusmanageForm;
import com.bancstone.hibernate.systemManage.Systemmenusmanage;
import com.bancstone.service.systemManage.SystemmenusmanageService;
 
/**
 * 
 * <ul>
 * <li>1、开发日期：2010-7-28</li>
 * <li>2、开发时间：上午11:09:47</li>
 * <li>3、类型名称：SystemmenusmanageAction</li>
 * <li>4、类型意图：</li>
 * </ul>
 * @author 史文龙
 *
 */

public class SystemmenusmanageAction extends BaseAction<SystemmenusmanageForm>{
	protected String responseContentType = "application/xml;charset=GBK";

	
	/**
	 * <ul>
	 * <li>1、开发作者：史文龙</li>
	 * <li>2、开发日期：2010-7-28</li>
	 * <li>3、开发时间：上午11:10:38</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：取得菜单树其中一级下的LIST集合 </li>
	 * </ul>
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception
	 */
	public ActionForward getAllOneLevelNodesByIndentifier(ActionMapping mapping,ActionForm form, HttpServletRequest request,HttpServletResponse response) throws Exception {
		SystemmenusmanageForm systemmenusmanageForm = (SystemmenusmanageForm) form;
		SystemmenusmanageService Services = (SystemmenusmanageService)this.getBean("systemmenusmanageServices");
		//this.setPageValue(systemmenusmanageForm);
		try {
			systemmenusmanageForm.setIndentifier(request.getParameter("id"));
			List<Systemmenusmanage> plist=Services.querySystemmenusmanageList(systemmenusmanageForm.getIndentifier());
			
			/*		List<Systemmenusmanage> plist=new ArrayList<Systemmenusmanage>();
		
			Systemmenusmanage syspo=new Systemmenusmanage();
			
			syspo.setIndentifier("1");
			syspo.setLinkurl("/sss.jps");
			syspo.setName("名字");
			syspo.setNum(1);
			syspo.setParentidentifier("0");
			syspo.setIsactivity("1");
			plist.add(syspo);
			
			Systemmenusmanage syspo1=new Systemmenusmanage();
			syspo1.setIndentifier("2");
			syspo1.setLinkurl("/sss11.jps");
			syspo1.setName("名字1");
			syspo1.setNum(1);
			syspo1.setParentidentifier("0");
			syspo1.setIsactivity("1");
			plist.add(syspo1);*/
			
			//this.setPageInfo(request, systemmenusmanageForm);
			//把LIST 集合转换成JOSN格式传到客户端
			//String josnstr=BeanUtil.bean2JSONString(plist);
		//	System.out.println(josnstr);
//			/response.setContentType(this.responseContentType);
			//response.getWriter().write(josnstr);
			 
			request.setAttribute("list", plist);
			return mapping.findForward("getAllOneLevelNodesByIndentifier");
			 
		} catch (Exception e) {
			e.printStackTrace();
			return toFailedPage(mapping, request,MessageConstants.SYSTEM_MENU_DETAIL_FAILED);
		}
	 


	}
	/**
	 * 
	 * <ul>
	 * <li>1、开发作者：史文龙</li>
	 * <li>2、开发日期：2010-7-29</li>
	 * <li>3、开发时间：下午02:48:56</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：这个是编辑更新节点和目录节点的数据显示页面的方法</li>
	 * </ul>
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception
	 */
	public ActionForward editNodes(ActionMapping mapping,ActionForm form, HttpServletRequest request,HttpServletResponse response) throws Exception {
		//SystemmenusmanageForm systemmenusmanageForm = (SystemmenusmanageForm) form;
		SystemmenusmanageService Services = (SystemmenusmanageService)this.getBean("systemmenusmanageServices");
		try {
			//js的URL中传过来的参数
			String idstr = request.getParameter("id");
			String parentId = request.getParameter("parentId");
			String leaf = request.getParameter("leaf");
			 String num = request.getParameter("number");
			 Systemmenusmanage obj = null;
			if(null != idstr){
				obj = Services.findSystemmenusmanageById(idstr);
			}else{
				obj = new Systemmenusmanage();
				obj.setParentidentifier(parentId);
				obj.setIsactivity(leaf);
				obj.setNum(num);
			}
			request.setAttribute("obj", obj);
			return mapping.findForward("editNodes");
 
		} catch (Exception e) {
			e.printStackTrace();
			return toFailedPage(mapping, request,MessageConstants.SYSTEM_MENU_DETAIL_FAILED);
		}
	}
	
	/**
	 * 
	 * <ul>
	 * <li>1、开发作者：史文龙</li>
	 * <li>2、开发日期：2010-7-29</li>
	 * <li>3、开发时间：下午02:47:54</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：这个方法是节点的和目录的添加修改操作  JS里发起页面</li>
	 * </ul>
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception
	 */
	public ActionForward saveNodes(ActionMapping mapping,ActionForm form, HttpServletRequest request,HttpServletResponse response) throws Exception {
		 SystemmenusmanageForm formvo = (SystemmenusmanageForm) form;
		SystemmenusmanageService Services = (SystemmenusmanageService)this.getBean("systemmenusmanageServices");
	 
		Systemmenusmanage obj = null;
		//request.setCharacterEncoding("GBK");
/*		String id = request.getParameter("id");
		String number = request.getParameter("number");
		String parentId = request.getParameter("parentId");
		String leaf = request.getParameter("leaf");
		String title = request.getParameter("title");
		String url = request.getParameter("url");
		*/
		if(!StringUtils.isEmpty(formvo.getIndentifier())){
			obj = Services.findSystemmenusmanageById(formvo.getIndentifier());
			if(obj == null)
			{
				//return this.toFailedPage(mapping, request,  MessageConstants.SYSTEM_MENU_HAVE_NO_FAILED);
				return new ActionForward("/page/systemManager/systemMenusManage/error.jsp");
			}
		}else{
			obj = new Systemmenusmanage();
			obj.setIsactivity(formvo.getIsactivity());
			obj.setParentidentifier(formvo.getParentidentifier());
		}
		obj.setNum(formvo.getNum());
		obj.setName(formvo.getName());
		obj.setLinkurl(formvo.getLinkurl()==null?"":formvo.getLinkurl());
		obj.setNamecode(formvo.getNamecode());
		obj.setCommcon(formvo.getCommcon());
		obj.setPhoneticizecode(formvo.getPhoneticizecode());
		if(!StringUtils.isEmpty(formvo.getIndentifier())){
			Services.modifySystemmenusmanage(obj);
		}else{
			Services.saveSystemmenusmanage(obj);
		}
		//request.setAttribute("message", "sdfsdf");
		//return mapping.findForward("success");
		//return this.toSuccessPage(mapping, request, MessageConstants.SYSTEM_MENU_OP_SUCCESS);
		//response.setContentType(responseContentType);
		//response.getWriter().("<script language=\"JavaScript\">");
		//response.getWriter().write( "alert(\"操作成功\");");
		//response.getWriter().write( "</script>");
		return new ActionForward("/page/systemManager/systemMenusManage/success.jsp");
		//return null;
	}
	
	/**
	 * <ul>
	 * <li>1、开发作者：易斌</li>
	 * <li>2、开发日期：Jul 11, 2011</li>
	 * <li>3、开发时间：5:19:00 PM</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：跳到系统菜单管理界面</li>
	 * </ul>
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception
	 */
	public ActionForward gotoSystemmenusmanage(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response)throws Exception{
				
				return mapping.findForward("gotoSystemmenusmanage");
	}

	
	
	
}