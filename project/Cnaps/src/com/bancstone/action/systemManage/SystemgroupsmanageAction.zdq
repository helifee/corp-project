/**
 * <p>项目名称：zhiNengT<p>
 * <ul>
 * <li>1、版权所有：驰波公司</li>
 * <li>2、开发作者：王亮</li>
 * <li>3、开发日期：Jul 26, 2010</li>
 * <li>4、开发时间：10:04:25 AM</li>
 * <li>5、文件名称：SystemgroupsmanageAction.java</li>
 * <li>6、包路径名：com.bancstone.action.systemManage</li>
 * </ul>
 */
package com.bancstone.action.systemManage;

import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.bancstone.action.BaseAction;
import com.bancstone.common.utils.BeanUtil;
import com.bancstone.common.utils.StringUtil;
import com.bancstone.constants.MessageConstants;
import com.bancstone.constants.SystemConstants;
import com.bancstone.form.systemManage.SystemgroupsmanageFormBean;
import com.bancstone.hibernate.systemManage.Systemgroupsmanage;
import com.bancstone.hibernate.systemManage.Systemrolesmanage;
import com.bancstone.hibernate.systemManage.Systemusersmanage;
import com.bancstone.service.systemManage.SystemgroupsmanageServices;
import com.bancstone.service.systemManage.SystemrolesmanageServices;
import com.bancstone.service.systemManage.SystemusersmanageServices;

/**
 * <ul>
 * <li>1、开发日期：Jul 26, 2010</li>
 * <li>2、开发时间：10:04:25 AM</li>
 * <li>3、类型名称：SystemgroupsmanageAction</li>
 * <li>4、类型意图：系统用户组管理</li>
 * </ul>
 * 
 * @author 王亮
 * 
 */
public class SystemgroupsmanageAction extends
		BaseAction<SystemgroupsmanageFormBean> {
	/**
	 * 
	 * <ul>
	 * <li>1、开发作者：王亮</li>
	 * <li>2、开发日期：Jul 28, 2010</li>
	 * <li>3、开发时间：12:56:37 PM</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：点击添加按钮跳转的页面</li>
	 * </ul>
	 * 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception
	 */
	public ActionForward addSystemGroupView(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		SystemrolesmanageServices systemrolesmanageServices = (SystemrolesmanageServices) this
				.getBean("systemrolesmanageServices");
		List<Systemrolesmanage> systemrolesmanage = null;
		try {
//			systemrolesmanage = systemrolesmanageServices
//					.querySystemRoleList(this.getUserInfo(request)
//							.getEnglishname());
			request.setAttribute("roleList", systemrolesmanage);
			request.setAttribute("user", this.getUserInfo(request));
			return mapping.findForward("addSystemGroupView");
		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;
	}

	/**
	 * 
	 * <ul>
	 * <li>1、开发作者：王亮</li>
	 * <li>2、开发日期：Jul 26, 2010</li>
	 * <li>3、开发时间：5:03:18 PM</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：添加系统用户组</li>
	 * </ul>
	 * 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception
	 */
	public ActionForward addSystemGroup(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {
		SystemgroupsmanageFormBean systemgroupsmanageForm = (SystemgroupsmanageFormBean) form;
		Systemgroupsmanage systemgroupsmanage = new Systemgroupsmanage();
		SystemgroupsmanageServices systemgroupsmanageServices = (SystemgroupsmanageServices) this
				.getBean("systemgroupsmanageServices");
		SystemrolesmanageServices systemrolesmanageServices = (SystemrolesmanageServices) this
				.getBean("systemrolesmanageServices");
		BeanUtil.copyProperties2Object(systemgroupsmanage,
				systemgroupsmanageForm);
		try {
			if ("".equals(StringUtil.nullToString(systemgroupsmanageForm
					.getEnglishname()))) {
//				systemgroupsmanage.setEnglishname(this.getUserInfo(request)
//						.getEnglishname());// 设置用户类别
			}
//			systemgroupsmanage.setSystemrolesmanage(systemrolesmanageServices
//					.findSystemRoleByIndentifier(systemgroupsmanageForm
//							.getRoleindentifier()));
			systemgroupsmanageServices.saveSystemGroup(systemgroupsmanage);
			// 添加成功
			return toReceiptPage(
					mapping,
					request,
					true,
					"sucess",
					"/systemManage/systemGroupManageAction.do?method=querySystemGroup",
					MessageConstants.SYSTEM_GROUP_ADD_SUCCESS);
			// return this.querySystemGroup(mapping, form, request, response);
		} catch (Exception e) {
			e.printStackTrace();
			return toFailedPage(mapping, request,
					MessageConstants.SYSTEM_GROUP_ADD_FAILED);
		}
	}

	/**
	 * 
	 * <ul>
	 * <li>1、开发作者：王亮</li>
	 * <li>2、开发日期：Jul 26, 2010</li>
	 * <li>3、开发时间：5:10:39 PM</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：删除系统用户组</li>
	 * </ul>
	 * 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception
	 */
	public ActionForward deleteSystemGroup(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		String identifier = request.getParameter("indentifier");
		SystemgroupsmanageServices systemgroupsmanageServices = (SystemgroupsmanageServices) this
				.getBean("systemgroupsmanageServices");
		SystemusersmanageServices systemusersmanageServices = (SystemusersmanageServices) this
				.getBean("SystemusersmanageServiceImpl");
		List<Systemusersmanage> userList = null;
		try {
			userList = systemusersmanageServices.findAll();
			for (Systemusersmanage systemusersmanage : userList) {
//				if (!systemusersmanage.getSystemGroup().getTeamid().toString()
//						.equals(identifier)) {
//					continue;
//				} else {
//					return toFailedPage(mapping, request, systemusersmanage
//							.getSystemGroup().getTeamname()
//							+ " "
//							+ MessageConstants.SYSTEM_GROUP_DELETE_CHECK_FAILED);
//				}
			}
			systemgroupsmanageServices
					.deletseSystemGroup(systemgroupsmanageServices
							.findSystemGroupByIndentifier(identifier));
			return this.querySystemGroup(mapping, form, request, response);
			// return mapping.findForward("deleteSystemGroupsManage");
		} catch (Exception e) {
			e.printStackTrace();
			return toFailedPage(mapping, request,
					MessageConstants.SYSTEM_GROUP_DELETE_FAILED);
		}
	}

	/**
	 * 
	 * <ul>
	 * <li>1、开发作者：王亮</li>
	 * <li>2、开发日期：Jul 26, 2010</li>
	 * <li>3、开发时间：5:16:02 PM</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：修改系统用户组</li>
	 * </ul>
	 * 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception
	 */
	public ActionForward modifySystemGroup(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {

		SystemgroupsmanageFormBean systemgroupsmanageForm = (SystemgroupsmanageFormBean) form;
		Systemgroupsmanage systemgroupsmanage = null;
		SystemgroupsmanageServices systemgroupsmanageServices = (SystemgroupsmanageServices) this
				.getBean("systemgroupsmanageServices");
		SystemrolesmanageServices systemrolesmanageServices = (SystemrolesmanageServices) this
				.getBean("systemrolesmanageServices");
		try {
			systemgroupsmanage = systemgroupsmanageServices
					.findSystemGroupByIndentifier(systemgroupsmanageForm
							.getTeamid().toString());
//			systemgroupsmanage.setSystemrolesmanage(systemrolesmanageServices
//					.findSystemRoleByIndentifier(systemgroupsmanageForm
//							.getRoleindentifier()));
			BeanUtil.copyProperties2Object(systemgroupsmanage,
					systemgroupsmanageForm);
			if ("".equals(StringUtil.nullToString(systemgroupsmanageForm
					.getEnglishname()))) {
//				systemgroupsmanage.setEnglishname(this.getUserInfo(request)
//						.getEnglishname());// 设置用户组类别
			}
			systemgroupsmanageServices.modifySystemGroup(systemgroupsmanage);
			// 修改成功
			return toReceiptPage(
					mapping,
					request,
					true,
					"sucess",
					"/systemManage/systemGroupManageAction.do?method=querySystemGroup",
					MessageConstants.SYSTEM_GROUP_MODIFY_SUCCESS);
			// return this.querySystemGroup(mapping, form, request, response);
			// return mapping.findForward("modifySystemGroupsManage");
		} catch (Exception e) {
			e.printStackTrace();
			return toFailedPage(mapping, request,
					MessageConstants.SYSTEM_GROUP_MODIFY_FAILED);
		}
	}

	/**
	 * 
	 * <ul>
	 * <li>1、开发作者：王亮</li>
	 * <li>2、开发日期：Jul 26, 2010</li>
	 * <li>3、开发时间：5:19:00 PM</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：查询系统用户组列表</li>
	 * </ul>
	 * 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception
	 */
	@SuppressWarnings("unchecked")
	public ActionForward querySystemGroup(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		SystemgroupsmanageFormBean systemgroupsmanageForm = (SystemgroupsmanageFormBean) form;
		SystemgroupsmanageServices systemgroupsmanageServices = (SystemgroupsmanageServices) this
				.getBean("systemgroupsmanageServices");
		List<Systemgroupsmanage> systemgroupsmanageList = null;
		this.setPageValue(systemgroupsmanageForm, true);
		try {
//			systemgroupsmanageForm.setEnglishname(this.getUserInfo(request)
//					.getEnglishname());// 设置用户类别
			systemgroupsmanageList = systemgroupsmanageServices
					.querySystemGroupList(systemgroupsmanageForm);
//			for (Systemgroupsmanage systemgroupsmanage : systemgroupsmanageList) {
//				systemgroupsmanage.setNamecode(SystemConstants
//						.getRoleAndGroupLevelNameByCode(systemgroupsmanage
//								.getNamecode()));
//				systemgroupsmanage.setEnglishname(SystemConstants
//						.getUserClassNameByCode(systemgroupsmanage
//								.getEnglishname()));
//			}
			request.setAttribute("orgentity", this.getUserInfo(request)
					.getSystemorganizationsmanage());
			request.setAttribute("groupList", systemgroupsmanageList);
			request.setAttribute("user", this.getUserInfo(request));
			this.setPageInfo(request, systemgroupsmanageForm);
			return mapping.findForward("querySystemGroup");
		} catch (Exception e) {
			e.printStackTrace();
			return toFailedPage(mapping, request,
					MessageConstants.SYSTEM_GROUP_QUERY_ERROR);
		}
	}

	/**
	 * 
	 * <ul>
	 * <li>1、开发作者：王亮</li>
	 * <li>2、开发日期：Jul 26, 2010</li>
	 * <li>3、开发时间：6:55:46 PM</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：根据标识符查询需要修改的系统用户组</li>
	 * </ul>
	 * 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 */
	public ActionForward querySystemGroupByIndentifier(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) {
		String indentifier = request.getParameter("indentifier");
		SystemgroupsmanageFormBean systemgroupsmanageFormBean = null;
		List<Systemrolesmanage> systemrolesmanages = null;
		SystemgroupsmanageServices systemgroupsmanageServices = (SystemgroupsmanageServices) this
				.getBean("systemgroupsmanageServices");
		SystemrolesmanageServices systemrolesmanageServices = (SystemrolesmanageServices) this
				.getBean("systemrolesmanageServices");

		try {
			systemgroupsmanageFormBean = systemgroupsmanageServices
					.findByIndentifier(indentifier);
//			systemrolesmanages = systemrolesmanageServices
//					.querySystemRoleList(this.getUserInfo(request)
//							.getEnglishname());
			request.setAttribute("roleList", systemrolesmanages);
			request.setAttribute("entity", systemgroupsmanageFormBean);
			request.setAttribute("user", this.getUserInfo(request));
			return mapping.findForward("querySystemGroupByIndentifier");
		} catch (Exception e) {
			e.printStackTrace();
			return toFailedPage(mapping, request,
					MessageConstants.SYSTEM_GROUP_DETAIL_FAILED);
		}
	}

	/**
	 * 
	 * <ul>
	 * <li>1、开发作者：王亮</li>
	 * <li>2、开发日期：Jul 21, 2010</li>
	 * <li>3、开发时间：6:01:47 PM</li>
	 * <li>4、返回类型：ActionForward</li>
	 * <li>5、方法含义：</li>
	 * <li>6、方法说明：查看系统用户组的明细信息</li>
	 * </ul>
	 * 
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 */
	public ActionForward systemGroupDetail(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) {
		String indentifier = request.getParameter("indentifier");
		SystemgroupsmanageFormBean systemgroupsmanageFormBean = null;
		List<Systemrolesmanage> systemrolesmanages = null;
		SystemgroupsmanageServices systemgroupsmanageServices = (SystemgroupsmanageServices) this
				.getBean("systemgroupsmanageServices");
		SystemrolesmanageServices systemrolesmanageServices = (SystemrolesmanageServices) this
				.getBean("systemrolesmanageServices");
		try {
			systemgroupsmanageFormBean = systemgroupsmanageServices
					.findByIndentifier(indentifier);
			systemrolesmanages = systemrolesmanageServices
					.querySystemRoleList();
			request.setAttribute("roleList", systemrolesmanages);
			request.setAttribute("entity", systemgroupsmanageFormBean);
			return mapping.findForward("systemGroupDetail");
		} catch (Exception e) {
			e.printStackTrace();
			return toFailedPage(mapping, request,
					MessageConstants.SYSTEM_GROUP_DETAIL_FAILED);
		}
	}
}
