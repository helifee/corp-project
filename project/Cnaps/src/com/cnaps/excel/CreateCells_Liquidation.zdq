package com.cnaps.excel;

import java.util.ArrayList;
import java.util.List;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletResponse;

import org.apache.poi.hssf.usermodel.HSSFFooter;
import org.apache.poi.hssf.usermodel.HSSFPrintSetup;
import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.hssf.util.Region;

import com.cnaps.hvps.persistence.messages.ReportManagEntity;

public class CreateCells_Liquidation {
	/**
	 * 查询导出未清算的数据清单
	 * @param response
	 * @param userName
	 * @param workDate
	 * @param liquidatedMsgList
	 */
	public void createExcelForLiquidatedNot(HttpServletResponse response,
			String userName, String workDate, List liquidatedMsgList) {
		try {
			// 创建新的Excel 工作簿
			HSSFWorkbook workbook = new HSSFWorkbook();
			ReportManagEntity entity=null;
				entity=(ReportManagEntity)liquidatedMsgList.get(0);
				HSSFSheet sheet = workbook.createSheet();
				workbook.setSheetName(0,   entity.getSystemCd()+"清单",HSSFWorkbook.ENCODING_UTF_16   );
				sheet.setMargin(HSSFSheet.BottomMargin, 0.4f );// 页边距
				sheet.setMargin(HSSFSheet.RightMargin,( double ) 0.3 );
				sheet.setMargin(HSSFSheet.LeftMargin, ( double ) 0.3);
				sheet.setMargin(HSSFSheet.TopMargin,0.4f  );
				sheet.setHorizontallyCenter(true);//设置打印页面为水平居中
				sheet.getPrintSetup().setHeaderMargin(( double ) 0.2);
				sheet.getPrintSetup().setFooterMargin(( double ) 0.2);
				HSSFFooter footer = sheet.getFooter();
				footer.setCenter(HSSFFooter.page() + " / "
						+ HSSFFooter.numPages());
				sheet.getPrintSetup().setLandscape(false); // true：横向
				sheet.getPrintSetup().setPaperSize(HSSFPrintSetup.A4_PAPERSIZE); //纸张
				
				sheet.addMergedRegion(new Region(0, (short) 0, 1, (short) 10));//合并第二行所有单元格
				
				/**
				 * 设置列的宽度
				 */
				sheet.setColumnWidth((short) 0, (short) 1800);
				sheet.setColumnWidth((short) 1, (short) 5000);
				sheet.setColumnWidth((short) 2, (short) 5000);
				sheet.setColumnWidth((short) 3, (short) 4000);
				sheet.setColumnWidth((short) 4, (short) 4000);
				sheet.setColumnWidth((short) 5, (short) 4000);
				sheet.setColumnWidth((short) 6, (short) 3000);
				sheet.setColumnWidth((short) 7, (short) 5000);
				sheet.setColumnWidth((short) 8, (short) 5000);
				sheet.setColumnWidth((short) 9, (short) 5000);
				sheet.setColumnWidth((short) 10, (short) 3000);
				
				/**
				 * 第二行
				 */
				HSSFRow row1 = sheet.createRow(0);
				CommonCellStyle.getCell_NoBoder(workbook, row1, 800, 0, 16, 0, entity.getSystemCd()+"清单");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 1, 13, 1, "");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 2, 13, 0, "");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 3, 13, 1, "");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 4, 13, 1, "");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 5, 13, 1, "");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 6, 13, 1, "");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 7, 13, 1, "");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 8, 13, 1, "");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 9, 13, 1, "");
				CommonCellStyle.getCell_NoBoder(workbook, row1, 0, 10, 13, 1, "");
				
				/**
				 * 第三行 标题
				 */
				HSSFRow row2 = sheet.createRow(2);
				row2.setHeight((short) 350);
				CommonCellStyle.getCell(workbook, row2, 0, 0, 13, 0, "序号");
				CommonCellStyle.getCell(workbook, row2, 0, 1, 13, 0, "报文标识号");
				CommonCellStyle.getCell(workbook, row2, 0, 2, 13, 0, "支付交易组号");
				CommonCellStyle.getCell(workbook, row2, 0, 3, 13, 0, "接收行行号");
				CommonCellStyle.getCell(workbook, row2, 0, 4, 13, 0, "发起行行号");
				CommonCellStyle.getCell(workbook, row2, 0, 5, 13, 0, "系统编号");
				CommonCellStyle.getCell(workbook, row2, 0, 6, 13, 0, "来往标识");
				CommonCellStyle.getCell(workbook, row2, 0, 7, 13, 0, "金额");
				CommonCellStyle.getCell(workbook, row2, 0, 8, 13, 0, "收款人账号");
				CommonCellStyle.getCell(workbook, row2, 0, 9, 13, 0, "付款人账号");
				CommonCellStyle.getCell(workbook, row2, 0, 10, 13, 0, "业务状态");
				/**
				 * 第四行 内容
				 */
				HSSFRow row3=null;
				int code_num=3;
				int totalNum=0;
				ReportManagEntity df=null;
				if(liquidatedMsgList!=null){
					for(int k=0;k<liquidatedMsgList.size();k++){
						df=(ReportManagEntity)liquidatedMsgList.get(k);
						row3 = sheet.createRow(code_num);
						code_num++;
						totalNum++;
						CommonCellStyle.getCell(workbook, row3, 0, 0, 13, 1, (code_num-3)+"");
						CommonCellStyle.getCell(workbook, row3, 0, 1, 13, 1,  df.getMsgId());
						CommonCellStyle.getCell(workbook, row3, 0, 2, 13, 1,  df.getPmtGrpId());
						CommonCellStyle.getCell(workbook, row3, 0, 3, 13, 1,  df.getInstdPty());
						CommonCellStyle.getCell(workbook, row3, 0, 4, 13, 1,  df.getInstgPty());
						CommonCellStyle.getCell(workbook, row3, 0, 5, 13, 1,  df.getSystemCd());
						CommonCellStyle.getCell(workbook, row3, 0, 6, 13, 1,  df.getDirection());
						CommonCellStyle.getCell(workbook, row3, 0, 7, 13, 1,  df.getAmount());
						CommonCellStyle.getCell(workbook, row3, 0, 8, 13, 1,  df.getDbtrAcct());
						CommonCellStyle.getCell(workbook, row3, 0, 9, 13, 1,  df.getCdtrAcct());
						CommonCellStyle.getCell(workbook, row3, 0, 10, 13, 1,  df.getPrcSts());
					}
				}
			response.reset();
			response.setContentType("application/vnd.ms-excel;charset=GBK");
			response.setHeader("Content-Disposition", "attachment;filename=\"" +
					new String((entity.getSystemCd()+"清单.xls").getBytes(),"iso-8859-1")+"\"");
			ServletOutputStream out = response.getOutputStream();
			workbook.write(out);
			out.flush();
			out.close();
		} catch (Exception e) {
			System.out.println("已运行 xlCreate() : " + e);
			e.printStackTrace();
			
		}
	}
	/**
	 * 导出EXCEL方法
	 * @param response
	 * @param userName
	 * @param workDate
	 * @param dateList 内容
	 * @param headerName 标题
	 * @param fileName 文件名
	 */
	@SuppressWarnings("unchecked")
	public void createExcel(HttpServletResponse response,
			String userName, String workDate, List dateList,String[] headerName,String fileName) {
		try {
			// 创建新的Excel 工作簿
			HSSFWorkbook workbook = new HSSFWorkbook();
			  HSSFSheet sheet = workbook.createSheet();
			  workbook.setSheetName(0,   fileName,HSSFWorkbook.ENCODING_UTF_16   );
			  sheet.setMargin(HSSFSheet.BottomMargin, 0.4f );// 页边距
			  sheet.setMargin(HSSFSheet.RightMargin,( double ) 0.3 );
				sheet.setMargin(HSSFSheet.LeftMargin, ( double ) 0.3);
				sheet.setMargin(HSSFSheet.TopMargin,0.4f  );
				sheet.setHorizontallyCenter(true);//设置打印页面为水平居中
				sheet.getPrintSetup().setHeaderMargin(( double ) 0.2);
				sheet.getPrintSetup().setFooterMargin(( double ) 0.2);
				HSSFFooter footer = sheet.getFooter();
				footer.setCenter(HSSFFooter.page() + " / "+ HSSFFooter.numPages());
				sheet.getPrintSetup().setLandscape(false); // true：横向
				sheet.getPrintSetup().setPaperSize(HSSFPrintSetup.A4_PAPERSIZE); //纸张
			  sheet.addMergedRegion(new Region(0, (short) 0, 1, (short) (headerName.length-1)));//合并第二行所有单元格
			  /**
			   * 设置列的宽度--标题头列宽
			   */
			  sheet.setColumnWidth((short) 0, (short) 1800);
			  for(int headerWidth=1;headerWidth<headerName.length;headerWidth++){
				  sheet.setColumnWidth((short) headerWidth, (short) 5000);
			  }
			  /**
			   * 文件名称
			   */
			  HSSFRow row1 = sheet.createRow(0);
			  CommonCellStyle.getCell_NoBoder(workbook, row1, 800, 0, 16, 0, fileName);
			  for(int conWid=1;conWid<headerName.length;conWid++){
				 CommonCellStyle.getCell_NoBoder(workbook, row1, 0, conWid, 13, 1, "");
			  }
			  /**
			   * 第三行 标题
			   */
			  HSSFRow row2 = sheet.createRow(2);
			  row2.setHeight((short) 350);
			  for(int a=0;a<headerName.length;a++){
				  CommonCellStyle.getCell(workbook, row2, 0, a, 13, 0, headerName[a].toString());
			  }
			  /**
			   * 第四行 内容
			   */
			  HSSFRow row3=null;
			  int code_num=3;
			  int totalNum=0;
			  Object obj[] = null;
			  if(dateList!=null){
				  for(int k=0;k<dateList.size();k++){
					  obj = (Object[]) dateList.get(k);
					  row3 = sheet.createRow(code_num);
						  code_num++;
						  totalNum++;
						  //msgid,pmtgrpid,InstdPty,instgpty,systemcd, direction,amount,dbtracct,cdtracct,Id,status
					  for(int aa=0;aa<headerName.length-1;aa++){
						  CommonCellStyle.getCell(workbook, row3, 0, 0, 13, 1, (code_num-3)+"");
						  CommonCellStyle.getCell(workbook, row3, 0, aa+1, 13, 1,  obj[aa]==null?"":obj[aa].toString());
					  }
	              }
			  }
			    response.reset();
				response.setContentType("application/vnd.ms-excel;charset=GBK");
	            response.setHeader("Content-Disposition", "attachment;filename=\"" +
	            		new String((fileName+".xls").getBytes(),"iso-8859-1")+"\"");
				ServletOutputStream out = response.getOutputStream();
			workbook.write(out);
			out.flush();
			out.close();
		} catch (Exception e) {
			System.out.println("已运行 xlCreate() : " + e);
			e.printStackTrace();

		}
	}
}
