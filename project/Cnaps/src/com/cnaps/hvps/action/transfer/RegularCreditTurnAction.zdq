/**
 * 
 */
package com.cnaps.hvps.action.transfer;


import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.bancstone.action.BaseAction;
import com.bancstone.common.exception.PicpMessageException;
import com.cnaps.coreservices.CommonXMLEntity;
import com.cnaps.coreservices.TransCodeEntity;
import com.cnaps.coreservices.TransServices;
import com.cnaps.hvps.form.transfer.RegularCreditTurnForm;

/**
 * @包名   com.cnaps.hvps.action.transfer
 * @文件名 RegularCreditTurn.java
 * @作者   zcx
 * @创建日期 Jun 10, 2011
 * @版本 V 1.0
 * 定期贷记转账，总账交易方式
 */
public class RegularCreditTurnAction extends BaseAction {
	public ActionForward sendCredit(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {

		RegularCreditTurnForm pvpform = (RegularCreditTurnForm) form;
	
		
		pvpform.setPmtGrpId(pvpform.getPo().getPaymentGroupNum());
		// 报文头
		String transactionid = TransCodeEntity.SEND_BEPS_RegularCreditTurnAction_sendCredit;// 功能代码
		commSetToXML(pvpform, request, transactionid);
		String reslutmessage = "";
		try {
			TransServices transServices = (TransServices) this
					.getBean("transServices");

			CommonXMLEntity commonXMLEntity = transServices
					.transProcess(
							pvpform,
							TransCodeEntity.SEND_BEPS_RegularCreditTurnAction_sendCredit,
							"transaction", "");//

			if (!commonXMLEntity.getProcessCode().equals("000000")) {
				throw new PicpMessageException("错误码："
						+ commonXMLEntity.getProcessCode() + "错误信息："
						+ commonXMLEntity.getProcessDes());
			} else {
				reslutmessage = "处理成功码：" + commonXMLEntity.getProcessCode()
				+ "定期贷记业务录入成功！";
			}
			
			return toAthorizationSuccessPage(mapping, request, reslutmessage
					+ "支付交易组号为：" + pvpform.getPo().getPaymentGroupNum());
		} catch (Exception e) {

			e.printStackTrace();
			return toFailedPage(mapping, request, e.getMessage());
		}

	}

	public ActionForward selectpaymentGroupNum(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {

		return toAthorizationSuccessPage(mapping, request, " 支付交易组号为：");
	}
}
