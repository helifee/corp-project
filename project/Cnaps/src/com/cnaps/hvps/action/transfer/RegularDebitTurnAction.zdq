/**
 * 
 */
package com.cnaps.hvps.action.transfer;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.bancstone.action.BaseAction;
import com.bancstone.common.exception.PicpMessageException;
import com.cnaps.coreservices.CommonXMLEntity;
import com.cnaps.coreservices.TransCodeEntity;
import com.cnaps.coreservices.TransServices;
import com.cnaps.hvps.form.transfer.RegularDebitForm;

/**
 * @包名 com.cnaps.hvps.action.transfer
 * @文件名 RegularDebitTurnAction.java
 * @作者 zcx
 * @创建日期 Jul 27, 2011
 * @版本 V 1.0 定期借记转账总账签发
 */
public class RegularDebitTurnAction extends BaseAction {
	/**
	 * 定期借记 明细建立 录入、删除、修改 定期借记-总账 定期借记-转账 录入
	 * 
	 */
	public ActionForward sendturn(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		RegularDebitForm voform = (RegularDebitForm) form;
		//报文头设置
		String transactionid = TransCodeEntity.RegularDebitAction_sendMsgcreatedetails_turn;//功能代码
		commSetToXML(voform,request,transactionid);
		voform.setPmtGrpId(voform.getPo().getPmtgrpid());// 支付交易组号
		try {

		
			TransServices transServices = (TransServices) this
					.getBean("transServices");
			CommonXMLEntity commonXMLEntity = transServices
					.transProcess(
							voform,
							voform.getTransactionId(),
							"transaction",
							"");
			if (!commonXMLEntity.getProcessCode().equals("000000")) {
				throw new PicpMessageException("错误码：["
						+ commonXMLEntity.getProcessCode() + "] 错误信息：["
						+ commonXMLEntity.getProcessDes() + "]");
			}

			return toSuccessPage(mapping, request, "定期借记业务签发成功;支付交易组号为:"+voform.getPo().getPmtgrpid());

		} catch (Exception e) {

			e.printStackTrace();
			return toFailedPage(mapping, request, e.getMessage());
		}
	}
}
