/**
 * 
 */
package com.cnaps.hvps.action.cashier;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.bancstone.action.BaseAction;
import com.bancstone.common.exception.PicpMessageException;
import com.cnaps.coreservices.CommonXMLEntity;
import com.cnaps.coreservices.TransCodeEntity;
import com.cnaps.coreservices.TransServices;
import com.cnaps.hvps.form.cashier.BianYaForm;
import com.cnaps.hvps.form.transfer.PersonCrashSpanBankExchangeForm;

/**
 * @包名   com.cnaps.hvps.action.cashier
 * @文件名 BianYaAction.java
 * @作者   zcx
 * @创建日期 Nov 7, 2011
 * @版本 V 1.0
 */
public class BianYaAction extends BaseAction{//本票编押  走的表结构和实时借记的表结构一样
	
	public ActionForward sendMessage(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		
		BianYaForm voform = (BianYaForm)form;
		
		try{
		String transactionid = TransCodeEntity.SEND_BEPS_CASHIER_bianya;//功能代码
		commSetToXML(voform,request,transactionid);
		//处理组装报文，发送解析
		TransServices transServices = (TransServices) this.getBean("transServices");
		CommonXMLEntity commonXMLEntity = null;
			commonXMLEntity = transServices.transProcess(voform, TransCodeEntity.SEND_BEPS_CASHIER_bianya,
					"transaction",TransCodeEntity.SEND_BEPS_CASHIER_bianya);
		 
		// 发送交易报文 并解析得到回应的信息
		String reslutmessage = "";// 处理信息
		System.out.println(commonXMLEntity.getProcessCode());
		if (!commonXMLEntity.getProcessCode().equals("000000")) {
			throw new PicpMessageException("错误码："
					+ commonXMLEntity.getProcessCode() + "错误信息："
					+ commonXMLEntity.getProcessDes());
		} else {
			reslutmessage = "处理成功码：" + commonXMLEntity.getProcessCode()
					+ "银行本票编押务成功！";
		}

		return toSuccessPage(mapping, request, reslutmessage,voform.getPmtGrpId(),"","");


	} catch (Exception e) {
		e.printStackTrace();
		return toFailedPage(mapping, request, e.getMessage());
	}
		
	}
}
