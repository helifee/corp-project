package com.cnaps.hvps.dao;

import com.bancstone.common.dao.impl.GenericHibernateDaoSupportImpl;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.util.List;
import org.hibernate.Session;
import org.hibernate.SessionFactory;

import com.cnaps.coreservices.CommonXMLEntity;
import com.cnaps.hvps.form.info.FileActionForm;
import com.cnaps.hvps.persistence.info.CcmsDrctPtyInfo;

public class AddfileDao extends GenericHibernateDaoSupportImpl {

	
	
	
	public boolean addfile(CommonXMLEntity commonXMLEntity,int param){
		boolean result = false;
		List<CcmsDrctPtyInfo> list = commonXMLEntity.getResults();
		System.out.print("================="+list.size());

		
		for (int i = 0; i < list.size(); i++) {
			CcmsDrctPtyInfo obj = list.get(i);
			String sql = buildSql(obj,param);
			result = addCommonData(sql);
		}
		return result;
	}
    public boolean addCommonData(String sql) {
		boolean result = false;
		Connection conn = null;
		PreparedStatement pst = null;
		Session ses = this.getHibernateTemplate().getSessionFactory().openSession();
		
		try {
			conn = ses.connection();
			conn.setAutoCommit(false);
			pst = conn.prepareStatement(sql);
			pst.executeUpdate();
			 result= true;
			conn.commit();

		} catch (SQLException e) {
			try {
				conn.rollback();
			} catch (SQLException e1) {
				e1.printStackTrace();
			}

			e.printStackTrace();
		}finally{
			try {
				pst.close();
				conn.close();
			} catch (SQLException e) {
				e.printStackTrace();
			}

			this.releaseSession(ses);
		}
		
		return result;
	}
	
	
	public String buildSql(CcmsDrctPtyInfo obj,int param){
		String sql =  "";
		switch (param) {  
		case 301:
			// 公共参数数据文件 系统参数表ccmsSysParaInfo 301(导入查询)
			String cmondatatp = obj.getVartype();
			String cmondatacd = obj.getVarcode();
			String cmondatanm = obj.getVarname();
			String cmondataval = obj.getVarvalue();
			String altstyle = obj.getAltstyle();

			sql = "Insert Into ccmsSysParaInfo(id,cmondatatp,cmondatacd,cmondatanm,cmondataval,altstyle)Values(SEQ_CCMSSYSPARAINFO.Nextval,'"
					+ cmondatatp
					+ "','"
					+ cmondatacd
					+ "','"
					+ cmondatanm
					+ "','" + cmondataval + "','" + altstyle + "')";
			break;
		case 401:
			// 行名行号文件 行名行号表CcmsPartyInfo 401（导入查询）
			String BankCode = obj.getBankcode();
			String PARTICIPANTNAME = obj.getBankname();
			String PARTICIPANTSHORTNAME = obj.getBankaliasname();
			String PARTICIPANTTYPE = obj.getBankcatalog();
			String BANKCATEGORYCODE=obj.getBanktype();
			String CHARGEBANKCODE=obj.getPbccode();
			String NODECODE = obj.getCcpc();
			String DIRECTBANKCODE =obj.getDreccode();
			String LglPrsn=obj.getAgentsettbank();
			String HIGERPARTICIPANT=obj.getSuprlist();
			String BEARBANKCODE=obj.getSbstitnbk();
			String SIGN=obj.getSyscode();
		    String address = obj.getAddr();
			String POSTCODE=obj.getPostcode();
			String telephone = obj.getTel();
			String email = obj.getEmail();
			String effectivedt = obj.getEffectdate() ;
			String expdt = obj.getExpdate();
		
			String citycode = obj.getSyscode();

			

	
			sql = "Insert Into CcmsPartyInfo(id,BankCode,PARTICIPANTNAME,PARTICIPANTSHORTNAME,PARTICIPANTTYPE,BANKCATEGORYCODE,CHARGEBANKCODE,NODECODE,DIRECTBANKCODE,LglPrsn,HIGERPARTICIPANT,BEARBANKCODE,citycode,SIGN,address,POSTCODE,telephone,email,effectivedt,expdt) Values(SEQ_CCMSPARTYINFO.Nextval,'"
					+ BankCode

					+ "','"
					+ PARTICIPANTNAME
					+ "','"
					+ PARTICIPANTSHORTNAME
					+ "','"
					+ PARTICIPANTTYPE
					+ "','"
					+ BANKCATEGORYCODE
					+ "','"
					+ CHARGEBANKCODE
					+ "','"
					+ NODECODE
					+ "','"
					+ DIRECTBANKCODE
					+ "','"
					+ LglPrsn
					+ "','"
					+ HIGERPARTICIPANT
					+ "','"
					+ BEARBANKCODE
					+ "','"
					+ citycode
					+ "','"
					+ SIGN
					+ "','"
					+ address
					+ "','"
					+ POSTCODE
					+ "','"
					+ telephone+"','"+ email+ "','"+ effectivedt+ "','"+ expdt+ "')";
			
			break;
		case 40301:
			// 基础数据文件1 行别信息表 banktypeinfo 403（导入查询）
			String banktypecode = obj.getCatgno();
			String banktypename = obj.getClsname();
			int typecode = Integer.valueOf(obj.getClscode());
			String typename = obj.getCatgname();

			sql = "Insert Into banktypeinfo(id,banktypecode,banktypename,typecode,typename) Values(SEQ_BANKTYPEINFO.Nextval,'"+ banktypecode+ "','"+ banktypename+ "',"+ typecode + ",'" + typename + "')";
			
			break;
		case 40302:
			//基础数据文件2 CCPC数据信息  CCPCInfo（导入 查询）
			     String NodeCode=obj.getNodecode();
				 String NodeName=obj.getNodename();
				 String CityCode=obj.getCitycode();
				
			      sql="insert into CCPCInfo(id,NodeCode,NodeName,CityCode) values(SEQ_CCPCINFO.Nextval,'"+NodeCode+"','"+NodeName+"','"+CityCode+"')";
			      //System.out.print(sql);
		break;
		case 40303:
			////基础数据文件3 城市代码查询信息  CityInfo（导入  查询）
			    String CitCode = obj.getCitycode();
				String CityName =obj.getCityname();
				String Nodeode =obj.getNodecode();

               
			sql="insert into CityInfo(id,CityCode,CityName,NodeCode) values(SEQ_CITYINFO.Nextval,'"+CitCode+"','"+CityName+"','"+Nodeode+"')";
			//System.out.print(sql);
			break;
		case 417:
			// 业务权限信息文件 业务权限信息表AuthorityInfo 417（导入查询）
			String SystemCd = obj.getSyscode();
			String SndBkCtgy = obj.getSendbank();
			String RcvBkCtgy = obj.getRecvbank();
			String MsgTpCd = obj.getMsgno();
			String PmtTp = obj.getMsgtype();
			String AthrtySgnCd = obj.getFlag();
			int AthrtyWght = Integer.valueOf(obj.getLevelnum());
			sql = "Insert Into AuthorityInfo(id,SystemCd,SndBkCtgy,RcvBkCtgy,MsgTpCd,PmtTp,AthrtySgnCd,AthrtyWght) Values(SEQ_AUTHORITYINFO.Nextval,'"+SystemCd+ "','"+SndBkCtgy+"','"+RcvBkCtgy+"','"+MsgTpCd+"','"+PmtTp+"','"+AthrtySgnCd+"'," + AthrtyWght + ")";
			break;
		case 407:
			//CIS代理关系文件 CISAgentInfo 407（导入数据过多不能实现，查询实现了）
			String NcisBkCd = obj.getBankname();
			String BepsAgencyBkCd = obj.getBankcode();
			sql = "Insert Into CISAgentInfo(id,NcisBkCd,BepsAgencyBkCd) Values(SEQ_AUTHORITYINFO.Nextval,'"+NcisBkCd+ "','" + BepsAgencyBkCd + "')";
			break;
		case 306:
//				业务金额上限参数文件  CCMSAmtLimitInfo 306（导入，查询）
			String SstemCd =obj.getSyscode();
			String INSTGPTY=obj.getSendbank();
			String INSTDPTY=obj.getRecvbank();
			String MgTpCd=obj.getMsgtype();
			String PtTp=obj.getBiztype();
			int ChckLvl=Integer.valueOf(obj.getChklevel());
			sql = "insert into CCMSAmtLimitInfo(id,SystemCd,INSTGPTY,INSTDPTY,MsgTpCd,PmtTp,ChckLvl) values(SEQ_CCMSAMTLIMITINFO.Nextval,'"+SstemCd+"','"+INSTGPTY+"','"+INSTDPTY+"','"+MgTpCd+"','"+PtTp+"',"+ChckLvl+")";
				break;
		case 307:
			//报文编号与业务种类对照关系 CCMSMSGANDMSGTP 307（导入 查询）
			  String SYSCODE=obj.getSyscode();//SYSCODE  系统号
			  String MSGTP=obj.getMsgtype();  //MSGTYPE 报文编号
			  String PMTTP=obj.getBiztype();  //BIZTYPE 业务类型
			  String PMTKD=obj.getBizdtltypepurpose(); //BIZDTLTYPEPURPOSE 业务种类
			 sql="insert into CCMSMSGANDMSGTP(id,SYSCODE,MSGTP,PMTTP,PMTKD) values(SEQ_CCMSMSGANDMSGTP.Nextval,'"+SYSCODE+"','"+MSGTP+"','"+PMTTP+"','"+PMTKD+"')";
			break;
		case 411:
			//节点运行状态文件   ccmsNodeInfo  411（导入 查询）
			 String SYCODE=obj.getSyscode();//SYSCODE  系统号
			String ncd=obj.getNodecode();//节点代码 
			String NODESTATUS=obj.getNodestat();//节点状态
			sql="insert into ccmsNodeInfo(id,SYSCODE,NodeCode,NodeStatus) values(SEQ_CCMSNODEINFO.Nextval,'"+SYCODE+"','"+ncd+"','"+NODESTATUS+"')";
			break;
		case 423:
			//参与者运行状态文件 CCMSPARTYSTATUSINFO (423)(导入 查询) 
			String SYSTEMCODE=obj.getSyscode(); //系统号SYSCODE
			String BANKCODE=obj.getBankcode();//参与机构行号 BANKCODE
			String RUNSTAT=obj.getRunstat();//参与机构运行状态 RUNSTAT
			String NODCODE=obj.getCcpc();//所属CCPC
			sql="insert into CCMSPARTYSTATUSINFO(id,SYSTEMCODE,BANKCODE,RUNSTAT,NODECODE) values(SEQ_CCMSPARTYSTATUSINFO.Nextval,'"+SYSTEMCODE+"','"+BANKCODE+"','"+RUNSTAT+"','"+NODCODE+"')";
			break;
		case 414:
			//参与者数字证书绑定信息文件 CCMSDigitalSignInfo 414（导入 查询）
			String InstgPty=obj.getBankcode();//参与者机构行号
			String CertDN = obj.getCertdn();//证书DN
			String CertSN = obj.getCertsn();//证书SN
			String CertBeginDate= obj.getCerteffdate();//证书有效起始日期
			String CertEndDate = obj.getCertinvdate(); //证书有效结束日期
			String CertMsgBody  = obj.getCertbody();//数字证书
			sql="insert into CCMSDigitalSignInfo(id,InstgPty,CertDN,CertSN,CertBeginDate,CertEndDate,CertMsgBody) values(SEQ_CCMSDIGITALSIGNINFO.Nextval,'"
				+InstgPty+"','"+CertDN+"','"+CertSN+"','"+CertBeginDate+"','"+CertEndDate+"','"+CertMsgBody+"')";
			//System.out.print(sql);
		default:
			break;
		}
		return sql;
	}
}