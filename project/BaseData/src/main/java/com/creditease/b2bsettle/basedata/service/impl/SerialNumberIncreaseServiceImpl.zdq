/**  
* @Title: SerialNumberIncreaseServiceImpl.java
* @Package com.creditease.b2bsettle.basedata.service.impl
* @Description: TODO
* @author zhanghaiyang6 
* @date 2015年6月15日 下午6:32:19
* @version V1.0  
*/ 
package com.creditease.b2bsettle.basedata.service.impl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.creditease.b2bsettle.basedata.model.SerialNumber;
import com.creditease.b2bsettle.basedata.repository.SerialNumberRepository;
import com.creditease.b2bsettle.basedata.service.SerialNumberIncreaseService;

/**
 * @ClassName: SerialNumberIncreaseServiceImpl
 * @Description: 实现序列增长的具体服务
 * @author zhanghaiyang6
 * @date 2015年6月15日 下午6:32:19
 *
 */
@Service
public class SerialNumberIncreaseServiceImpl implements SerialNumberIncreaseService{
	
	    private final String innerEidSerialNo = "I_EID_SERIAL";
	    
	    private final String outterEidSerialNo = "O_EID_SERIAL";
	      
	    @Autowired  
	    private SerialNumberRepository serialNumberRepository;

		/**
		 * 
		* @Title: generateInnerEsEnterpriseId
		* @Description: 获取内部企业编码
		* @param @return    
		* @return int   
		* @throws
		 */
		@Override
		public synchronized int generateInnerEsEnterpriseId() {
			return getCurrentSerialNumberByCode(innerEidSerialNo);
		}

		/**
		 * 
		* @Title: generateOutterEsEnterpriseId
		* @Description: 获取外部企业编码
		* @param @return    
		* @return int   
		* @throws
		 */ 
		@Override
		public synchronized int generateOutterEsEnterpriseId() {
			return getCurrentSerialNumberByCode(outterEidSerialNo);
		} 
	    
	   /**
	    * 
	   * @Title: getCurrentSerialNumberByCode
	   * @Description: 获取当前序列号
	   * @param @param serialCode
	   * @param @return    
	   * @return SerialNumber   
	   * @throws
	    */
        private int getCurrentSerialNumberByCode(String serialCode){
        	int currentValue = -1;
        	if(innerEidSerialNo.equals(serialCode)){
    			SerialNumber currentSerialNumer =serialNumberRepository.findBySerialCode(innerEidSerialNo);
    			
    			currentValue = currentSerialNumer.getSerialNumber();
    			int increaseBy = currentSerialNumer.getIncreaseBy();
    			
    			currentValue = currentValue + increaseBy;
    			
    			serialNumberRepository.modifySerialNumber(innerEidSerialNo, currentValue);
        	}else{
    			SerialNumber currentSerialNumer =serialNumberRepository.findBySerialCode(outterEidSerialNo);
    			
    			currentValue = currentSerialNumer.getSerialNumber();
    			int increaseBy = currentSerialNumer.getIncreaseBy();
    			
    			currentValue = currentValue + increaseBy;
    			
    			serialNumberRepository.modifySerialNumber(outterEidSerialNo, currentValue);
        	}
			return currentValue;
        }

}
