/**  
* @Title: EnEnterpriseInfoAuthorityServiceImpl.java
* @Package com.creditease.b2bsettle.basedata.service.impl
* @Description: TODO
* @author zhanghaiyang6 
* @date 2015年6月18日 下午1:46:12
* @version V1.0  
*/ 
package com.creditease.b2bsettle.basedata.service.impl;

import org.jadira.usertype.spi.utils.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.creditease.b2bsettle.basedata.dto.QueryEsEnterpriseAuthorityByEIdRequest;
import com.creditease.b2bsettle.basedata.dto.QueryEsEnterpriseAuthorityByEIdResponse;
import com.creditease.b2bsettle.basedata.model.EsEproductInfo;
import com.creditease.b2bsettle.basedata.repository.EsEproductInfoRepository;
import com.creditease.b2bsettle.basedata.service.EnEnterpriseInfoAuthorityService;
import com.creditease.b2bsettle.basedata.util.TimeUtil;

/**
 * @ClassName: EnEnterpriseInfoAuthorityServiceImpl
 * @Description: 查询企业产品权限的对外接口服务
 * @author zhanghaiyang6
 * @date 2015年6月18日 下午1:46:12
 *
 */
@Service
public class EnEnterpriseInfoAuthorityServiceImpl implements EnEnterpriseInfoAuthorityService {

	/**
	 * 对“企业产品权限表”进行操作
	 */
	@Autowired
	private EsEproductInfoRepository esEproductInfoRepository;
	
	/**
	 * 响应码：1-有权限
	 */
	private static final String RESPONSE_SUCCESS = "1";
	
	/**
	 * 响应码：2-无权限
	 */
	private static final String RESPONSE_FAIL = "2";
	
	
	/**
	 * 
	* @Title: queryEnEnterpriseInfoAuthorityByEId
	* @Description: 根据企业ID查询企业产品权限
	* @param @param request
	* @param @return    
	* @return QueryEsEnterpriseAuthorityByEIdResponse   
	* @throws
	 */
	@Override
	public QueryEsEnterpriseAuthorityByEIdResponse queryEnEnterpriseInfoAuthorityByEId(QueryEsEnterpriseAuthorityByEIdRequest request) {
	
		QueryEsEnterpriseAuthorityByEIdResponse response = new QueryEsEnterpriseAuthorityByEIdResponse();
		
		response.setSendTime(TimeUtil.getCurrentTime(TimeUtil.Format_YYYYMMDDHHMMSS));
		
		/**
		 * 校验报文传入的参数必填项有没有为空的
		 */
		if(null==request||StringUtils.isEmpty(request.geteId())||StringUtils.isEmpty(request.getProductId())||StringUtils.isEmpty(request.getMerchId())||StringUtils.isEmpty(request.getSendTime())){
			response.setRetCode(RESPONSE_FAIL);
			response.setRetMessage("接口错误：传入参数有空值");
		}else{
			/**
			 * 获取查询条件
			 */
			String queryEid = request.geteId();
			String queryProductId = request.getProductId();
			
			/**
			 * 查询数据库中是否有企业类型信息
			 */
			EsEproductInfo queryEsEproductInfo = esEproductInfoRepository.findByEIdAndProductTp(queryEid, queryProductId);
			
			response.seteId(queryEid);
			response.setProductId(queryProductId);
			/**
			 * 根据查询结果组装返回报文
			 */
			if(null!=queryEsEproductInfo){
				response.setRetCode(RESPONSE_SUCCESS);
			}else{
				response.setRetCode(RESPONSE_FAIL);
				response.setRetMessage("产品权限不存在");
			}
		}
		
		return response;
	}

}
