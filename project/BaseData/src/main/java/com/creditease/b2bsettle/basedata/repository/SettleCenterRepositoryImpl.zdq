package com.creditease.b2bsettle.basedata.repository;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

import com.creditease.b2bsettle.basedata.model.SettleCenter;

public class SettleCenterRepositoryImpl {

	@PersistenceContext
	private EntityManager entityManager;
	
	@SuppressWarnings("unchecked")
	public List<SettleCenter> findBy(List<String> corpIdList) {
		StringBuffer buf = new StringBuffer();
		for(int i = 0; i<corpIdList.size(); i++) {
			buf.append("?").append(i+1).append(",");
		}
		buf.deleteCharAt(buf.length() - 1);
		String jpql = "select center from SettleCenter center, SettleCorp sc "
				+ "where center.id = sc.settleId and sc.corpNo in ("+ buf + ") and center.deleted = 0";
		Query query = entityManager.createQuery(jpql);
		for(int i = 0; i<corpIdList.size(); i++) {
			query.setParameter(i+1, corpIdList.get(i));
		}
		return query.getResultList();
	}

}
