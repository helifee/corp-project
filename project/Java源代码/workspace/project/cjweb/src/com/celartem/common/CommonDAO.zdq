package com.celartem.common;

import java.sql.CallableStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import javax.annotation.Resource;

import org.springframework.dao.DataAccessException;
import org.springframework.jdbc.core.CallableStatementCallback;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

@Repository
public class CommonDAO {

	@Resource
	private JdbcTemplate jdbcTemplate;
	
	/**
	 * 获得部门列表
	 * @return
	 */
	@SuppressWarnings(value = { "unchecked" })
	public List<Department> getDepartment(){
		List<Department> departmentList = (List<Department>) jdbcTemplate.execute("call sp_getdtpinfo(?)",
				new CallableStatementCallback() {
					public Object doInCallableStatement(CallableStatement cs)
							throws SQLException, DataAccessException {
						cs.registerOutParameter(1,
								oracle.jdbc.driver.OracleTypes.CURSOR);
						cs.execute();
						ResultSet rs = (ResultSet) cs.getObject(1);
						List<Department> result = null;
						if (rs != null) {
							result = new ArrayList<Department>();
							while (rs.next()) {
								Department depart = new Department();
								depart.setId(rs.getInt("id"));
								depart.setName(rs.getString("name"));
								result.add(depart);
							}
						}
						rs.close();
						return result; // 返回类型决定execute返回类型
					}
				});
		return departmentList;
	}

}
