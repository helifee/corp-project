package dict.query.web;

import java.io.IOException;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.osgi.framework.BundleContext;
import org.osgi.framework.ServiceReference;

import dictquery.QueryService;

/**
 * 字典查询响应Servlet
 * 
 * @author helifee
 */
public class DictQueryServlet extends HttpServlet {

	private static final long serialVersionUID = -8880777894930752496L;
	
	private BundleContext context = null;
	
	public DictQueryServlet(BundleContext context) {
		this.context = context;
	}

	public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException {
		doGet(request, response);
	}
	
	public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
		
		//取得参数
		String param = request.getParameter("word");
		ServletOutputStream output = response.getOutputStream();
		
		//取得服务
		QueryService queryService = null;
		ServiceReference reference = context.getServiceReference(QueryService.class.getName());
		if(null != reference) {
			queryService = (QueryService) context.getService(reference);
		}
		
		if(null == queryService) {
			output.println("No available dictquery service");
			output.close();
			return;
		}
		
		output.println("Result is " + queryService.queryWorld(param));
	}
}
