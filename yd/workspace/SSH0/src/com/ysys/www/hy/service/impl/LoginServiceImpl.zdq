/*
 * Copyright (c) 2009-2010 by DaLian YuDong Computer System CO.,LTD
 * All rights reserved.
 *      Project: SSH
 *    SubSystem: 会议室管理子系统
 */

package com.ysys.www.hy.service.impl;

import java.util.List;

import com.ysys.www.hy.dao.LoginDao;
import com.ysys.www.hy.dao.condition.Tempinfo;
import com.ysys.www.hy.service.LoginService;
import com.ysys.www.hy.service.common.CommonConstants;
import com.ysys.www.hy.service.common.SessionManager;
import com.ysys.www.hy.service.common.UserInfo;

/**
 * @see com.ysys.www.hy.service.LoginService
 */
public class LoginServiceImpl implements LoginService {
	private LoginDao loginDaoImpl;

	public void setLoginDao(LoginDao loginDaoImpl) {
		this.loginDaoImpl = loginDaoImpl;
	}

	 /**
	 * {@inheritDoc}
	 */
	@Override
	public UserInfo login(String userid, String password) {

		// 初期化、检查
		SessionManager session = new SessionManager();

		if (null == password) {
			return null;
		}
		if (null == userid) {
			return null;
		} else {
			userid = CommonConstants.YD + userid;
		}
		// 检索是否存在对应的用户
		List<Tempinfo> users = loginDaoImpl.login(userid);
		// 用户不存在的情况
		if (users.size() < 1) {
			return null;
		}
		// 检查密码是否匹配
		if (password.equals((users.get(0)).getEmpPasswd())) {
			// 登录成功的情况，向Session中存入对应的信息
			UserInfo loginuser = new UserInfo();
			loginuser.setUserID(users.get(0).getId());
			loginuser.setUserName(users.get(0).getEmpName());
			loginuser.setJobId(users.get(0).getEmpJobid());
			session.set(CommonConstants.USERINFO, loginuser);
			return loginuser;
		}
		return null;
	}

}
