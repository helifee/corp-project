/*
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: SOOHAI
 *    SubSystem: 海景楼盘网
 */
package com.soohai.www.service.impl;

/**
 * 用户登录
 * @author 远东)zhaodong
 * @version 1.00 2009/09/22
 */

import java.util.List;

import com.soohai.www.dao.LoginDao;
import com.soohai.www.dao.condition.UserResult;
import com.soohai.www.service.LoginService;
import com.soohai.www.service.common.CommonConstants;
import com.soohai.www.service.common.SessionManager;
import com.soohai.www.service.common.UserInfo;

/**
 * @see com.soohai.www.service.LoginService
 */
public class LoginServiceImpl implements LoginService {
	private LoginDao loginDao;

	public void setLoginDao(LoginDao loginDao) {
		this.loginDao = loginDao;
	}

	 /**
	 * {@inheritDoc}
	 */
	@Override
	public UserInfo login(String userid, String password) {

		//初期化、检查
		SessionManager session = new SessionManager();

		if (null == password) {
			return null;
		}
		if (null == userid) {
			return null;
		} else {
			userid = CommonConstants.YD + userid;
		}
		//检索是否存在对应的用户
		List<UserResult> users = loginDao.login(userid);
		//用户不存在的情况
		if (users.size() < 1) {
			return null;
		}
		//检查密码是否匹配
		if (password.equals(((UserResult) users.get(0)).getUserPassword())) {
			//登录成功的情况，向Session中存入对应的信息
			UserInfo loginuser = new UserInfo();
			loginuser.setUserID(users.get(0).getUserId());
			loginuser.setUserName(users.get(0).getUserName());
			loginuser.setJobId(users.get(0).getUserJobId());
			session.set(CommonConstants.USERINFO, loginuser);
			return loginuser;
		}
		return null;
	}

}
