package com.soohai.www.action;

import java.util.List;

import com.opensymphony.xwork2.ActionSupport;

import com.soohai.www.dao.condition.BuildinglistResult;
import com.soohai.www.dao.condition.District;
import com.soohai.www.service.BuildinglistService;
public class BuildinglistAction extends ActionSupport{

	/**
	 * 
	 */
	private static final long serialVersionUID = -6499245870784700385L;
    private BuildinglistService buildinglistService;
    private List<BuildinglistResult>  buildinglistResults;
   
    private int count;
    private String shiqu;  //大连市区
    private String shiwai; //大连市区以外
    private String ljsj;   //是否点击地区连接
    private String distId; //当点击地区连接时的市区id
       
	@Override
	public String execute() throws Exception {
		String queryString = " where CITYID='0411' and DISTID in ( ";
  		StringBuffer sb = new StringBuffer();	
		
  		if(ljsj == null){//点击了提交按钮
			if(shiqu != null){ //市区内
				sb = getWhereString(sb , shiqu);
			}
			if(shiwai != null){//市区外
				sb = getWhereString(sb , shiwai);
			}
		}else{ //点击了市区链接
			sb.append(" '" + distId + "' ");
		}
		
		if("".equals(sb.toString()) == false){
		    queryString = queryString + sb.toString() + " ) ";
		    buildinglistResults = buildinglistService.buildinglisSelect(queryString);
	    }else{
		    buildinglistResults = buildinglistService.buildinglisSelect("");
	    }
		
		count = buildinglistResults.size();
		
		return SUCCESS;
	}
	//获得画面条件
	private StringBuffer getWhereString(StringBuffer sb , String shiqw){
		String temp = "";
		int start = 0;
		int end = 0;
		int i = 0;
	    for(; i < shiqw.length(); i++){
			if(",".equals(shiqw.substring( i , i + 1))){
				end = i;
				temp = shiqw.substring(start, end);
				start = end + 2;
			}
	    	if(i == (shiqw.length() - 1)){
	    		temp = shiqw.substring(start);
	    	}
	    	if("".equals(temp) == false){
	    		if("".equals(sb.toString()) == false){
		    		sb.append(" , '" + temp + "' ");
		    	}else{
		    		sb.append(" '" + temp + "' ");
		    	}
	    	}
	    	temp = "";
		}	
		return sb;
		
	}

	public int getCount() {
		return count;
	}

	public void setCount(int count) {
		this.count = count;
	}

	public String getShiqu() {
		return shiqu;
	}

	public void setShiqu(String shiqu) {
		this.shiqu = shiqu;
	}

	public String getShiwai() {
		return shiwai;
	}

	public void setShiwai(String shiwai) {
		this.shiwai = shiwai;
	}

	public String getLjsj() {
		return ljsj;
	}

	public void setLjsj(String ljsj) {
		this.ljsj = ljsj;
	}

	public String getDistId() {
		return distId;
	}

	public void setDistId(String distId) {
		this.distId = distId;
	}

	public void setBuildinglistService(BuildinglistService buildinglistService) {
		this.buildinglistService = buildinglistService;
	}
	public List<BuildinglistResult> getBuildinglistResults() {
		return buildinglistResults;
	}
	public void setBuildinglistResults(List<BuildinglistResult> buildinglistResults) {
		this.buildinglistResults = buildinglistResults;
	}

}
