<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BuildedDao">
	<typeAlias alias="mcity" type="com.soohai.www.dao.condition.Mcity"/>
	<typeAlias alias="mdistrict" type="com.soohai.www.dao.condition.Mdistrict"/>
	<typeAlias alias="buildingInfo" type="com.soohai.www.dao.condition.BuildingInfo"/>
	<typeAlias alias="userresult" type="com.soohai.www.dao.condition.UserResult"/>

	<!-- 取得城市信息 --> 
	<select id="getctnm" resultClass="mcity">  
		SELECT CITYID AS cityId, CITYNAME AS cityName
		FROM M_CITY
		ORDER BY CITYID;
	</select>
	
	<!-- 取得区信息 --> 
	<select id="getdtnm" parameterClass="String" resultClass="mdistrict"> 
		SELECT S.DISTID AS distId, S.DISTNAME AS distName
		FROM M_CITY D LEFT JOIN  M_DISTRICT S ON (D.CITYID = S.CITYID )
		WHERE S.CITYID = #cityId# AND (S.FLAG IS NULL OR S.FlAG = 0) 
		ORDER BY D.CITYID, S.DISTID;
	</select>
	
	<!-- 添加楼盘信息 --> 
	<insert id="buildedadd" parameterClass="buildingInfo">
		INSERT INTO BUILDINGINFO 
			(CITYID, 
			DISTID, 
			BUILDNAME, 
			ADDRESS, 
			SURPLUS_NUMBER, 
			STARTING_PRICE, 
			EVEN_PRICE, 
			NOTICE, 
			IMAGE_PATH, 
			SALES_COMPANY, 
			DETAIL_INTRODUCTION,
			FLAG
			)
			VALUES
			(#cityId#, 
			#distId#, 
			#buildName#, 
			#address#, 
			#surplusNumber#, 
			#startingPrice#, 
			#evenPrice#, 
			'women', 
			#imagePath#, 
			#salesCompany#, 
			#detailIntro#, 
			#flag#
			);
	</insert>
	
	<!-- 楼盘信息 --> 
	<select id="builddingyl" parameterClass="userresult" resultClass="buildingInfo"> 
		SELECT 	BUILDID AS buildid,
			CITYID AS cityId, 
			DISTID AS distId, 
			BUILDNAME AS buildName,
			ADDRESS AS address,
			SURPLUS_NUMBER AS surplusNumber,
			STARTING_PRICE AS startingPrice,
			EVEN_PRICE AS evenPrice
		FROM BUILDINGINFO
		<dynamic prepend="WHERE">
			<!-- "99" 系统管理员 -->
			<isNotEqual prepend="AND" property="userName" compareValue="99">
				FLAG = 0
			</isNotEqual>
		</dynamic>
	</select>
	
	<!-- 删除楼盘信息 --> 
	<delete id="buildingdel" parameterClass="int">
		DELETE 
		FROM BUILDINGINFO
		WHERE BUILDID=#buildId#;
	</delete>
	
	<!-- 修改楼盘需要的信息 --> 
	<select id="getbuildinginfo" parameterClass="int" resultClass="buildingInfo">
		SELECT BUILDID AS buildId,
			CITYID AS cityId, 
			DISTID AS distId, 
			BUILDNAME AS buildName, 
			ADDRESS AS address, 
			SURPLUS_NUMBER AS surplusNumber, 
			STARTING_PRICE AS startingPrice, 
			EVEN_PRICE AS evenPrice,
			IMAGE_PATH AS imagePath, 
			SALES_COMPANY AS salesCompany, 
			DETAIL_INTRODUCTION AS detailIntro,
			FLAG AS flag
			FROM BUILDINGINFO 
			WHERE BUILDID = #buildId#;
	</select>
	
	<!-- 更新楼盘信息 --> 
	<update id="buildedupt" parameterClass="buildingInfo">
		UPDATE BUILDINGINFO 
		SET
			CITYID = #cityId# , 
			DISTID = #distId# , 
			BUILDNAME = #buildName# , 
			ADDRESS = #address# , 
			SURPLUS_NUMBER = #surplusNumber# , 
			STARTING_PRICE = #startingPrice# , 
			EVEN_PRICE = #evenPrice# , 
			NOTICE = 'women', 
			<isNotNull property="imagePath">
			IMAGE_PATH = #imagePath# ,
			</isNotNull>
			SALES_COMPANY = #salesCompany# , 
			DETAIL_INTRODUCTION = #detailIntro# , 
			FLAG = #flag#
		WHERE
			BUILDID = #buildId# ;
	</update>
</sqlMap>  
