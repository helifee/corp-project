package pageAction;

import java.util.ArrayList;
import java.util.List;
import com.opensymphony.xwork2.ActionSupport;
import parameter.delectPara;
import parameter.popupPara;
import parameter.updatePara;
import pojo.Pjinfo;
import pojo.Pjpginfo;
import pojo.TestKey;
import pojo.Usermst;
import services.PjService;

import com.parameter.ParaManager;

public class SuperUser02Action extends ActionSupport{
private List<Usermst> result1 = new ArrayList<Usermst>();
private List<Pjinfo> result = new ArrayList<Pjinfo>();
private List<simpleuser> simpleuser =new ArrayList<simpleuser>();
/**
 * 一般ユーザー選択テープルの初期化
 
 */
	private class simpleuser{
		
		private String username_b;
		private String userkindid_b;
		public String getUserkindid_b() {
			return userkindid_b;
		}

		public void setUserkindid_b(String userkindid_b) {
			this.userkindid_b = userkindid_b;
		}

		public String getUsername_b() {
			return username_b;
		}

		public void setUsername_b(String username_b) {
			this.username_b = username_b;
		}
		
	}

	private PjService pjService;
	private String userkindid_a;
	private String username_a;
	private String username;
	private String userid_a;
	private String projectid_a;
	//プロジェクト番号
	private String prjmei_a;
	//日文名
	private String kyakuname_a;
	//客さん名
	private String startdate_a;
	//実際開始日 
	private String enddate_a;
	//実際終了日

	private String projecteiname_a;
	//中文名
	private String biko_a;
	private String usernum_a;
	private String supuserid_a;

	private String cancelflag_a;
	private String projecttyuname_a;
	//英文名
	private String pjem_a;
	//開発環境
	private String statusflg_a;
	private String intimestp_a;
	private String pjgaiyou_a;

	private String muserid_a;
	private String ystartdate_a;
	private String uptimestp_a;
	private String yenddate_a;
	private String key_hidden;
	public void validate() {
		clearErrorsAndMessages();
	}
	
	/**
	 * 該当ユーザー所属プロジェクト詳細消息を検索する
	 
	 */
	public String xx(){
		ParaManager ParaMana=new ParaManager("delect");
		delectPara myPara = new delectPara();
		
		this.setSimpleuser(new ArrayList<simpleuser>());
		myPara=(delectPara)ParaMana.getParameter();	
		result = pjService.getPjinfo(myPara.getProjectid());
		int i=0;
		this.setProjectid_a(result.get(i).getProjectid());
		this.setKyakuname_a(result.get(i).getKyakuname());
		this.setPrjmei_a(result.get(i).getPrjmei());
		this.setStartdate_a(result.get(i).getStartdate());
		this.setEnddate_a(result.get(i).getEnddate());
		this.setBiko_a(result.get(i).getBiko());
		this.setIntimestp_a(result.get(i).getIntimestp());
		this.setCancelflag_a(result.get(i).getCancelflag());
		this.setPjem_a(result.get(i).getPjem());
		this.setPjgaiyou_a(result.get(i).getPjgaiyou());
		this.setProjecteiname_a(result.get(i).getProjecteiname());
		this.setProjecttyuname_a(result.get(i).getProjecttyuname());
		this.setStatusflg_a(result.get(i).getStatusflg());
		this.setSupuserid_a(result.get(i).getSupuserid());
		this.setUptimestp_a(result.get(i).getUptimestp());
		this.setUsernum_a(result.get(i).getUsernum());
		this.setYenddate_a(result.get(i).getYenddate());
		this.setYstartdate_a(result.get(i).getYenddate());
		List<Pjpginfo> result2 = new ArrayList<Pjpginfo>();
		List<Usermst> result1 = new ArrayList<Usermst>();	
        result1 = pjService.findbyid(result.get(i).getMuserid().toString().trim());
        String username=" ";
        
        if(result1.size()>0){
        	username=result1.get(0).getUsername();
		}
        this.setUsername_a(username);
        this.setMuserid_a(username);
        this.setUserkindid_a("プロジェクトの主管者");
		result2=pjService.findpjbyid(result.get(i).getProjectid().toString().trim());
		
		String id=" ";
		 if(result2.size()>0){
			 for (int b = 0; b < result2.size(); b++){
	System.out.println("★★★UserID★★★★"+result2.get(b).getId().getUserid());
				 id=result2.get(b).getId().getUserid();
				 simpleuser onerow =new simpleuser();
			result1 = pjService.findbyid(id.trim());
			String kid=result1.get(0).getUsername();
			if(kid.trim().equals(this.getUsername_a().trim())){
				continue ;
			}
				 onerow.setUsername_b(kid);
				 
				 onerow.setUserkindid_b("成員");
				 this.getSimpleuser().add(onerow);
			 }
		 }

		
		
		return SUCCESS;
	}
	/**
	 *  sessionに預け入れる
	 */
	public String popup(){
		popupPara sendPara=new popupPara();
		ParaManager ParaGm =new ParaManager("alter");
		ParaGm.saveParameter(sendPara);
		return  "success";
	}
	/**
	 * 基本情報更新のために、ページの管理者のプログラム番号をsessionに預け入れる
	 */
	public String update() {

		ParaManager ParaMana=new ParaManager("update");
		updatePara myPara = new updatePara();
		myPara.setProjectid(this.getProjectid_a());
		ParaMana.saveParameter(myPara);
        System.out.println("update");
        System.out.println(this.getProjectid_a());
		return LOGIN;

	}
	/**
	 * sessionの値を得って、テープルに書いて、データベースに預け入れる
	 */
	public String setvalue(){
		
		System.out.println("Super-PjAction-Start !!!");
		System.out.println(this.getUsername());
		String userid[] = this.getUsername().trim().split("@");
		System.out.println(userid.length);
		
		List<Pjpginfo> PjpginfoList=pjService.findpjbyid(this.getProjectid_a());
		List<String> useridList = new ArrayList<String>();
		if(PjpginfoList!=null){
			System.out.println("★★★PjpginfoList.size()★★★"+PjpginfoList.size());
			for(int j=0;j<PjpginfoList.size();j++){
				System.out.println("★★★★★★"+PjpginfoList.get(j).getId().getUserid());
				useridList.add(PjpginfoList.get(j).getId().getUserid().trim());
			}
			
		}
		for(int i=0;i<userid.length;i++){	
			if(useridList.contains(userid[i].trim())){
				
				System.out.println("sss");
				continue;
			
			}
			simpleuser onerow=new simpleuser();
			result1 = pjService.getbyid(userid[i].trim());
			String username = result1.get(0).getUsername().trim();
			onerow.setUsername_b(username);
			onerow.setUserkindid_b("成员");
			this.getSimpleuser().add(onerow);
			Pjpginfo pjpginfo = new  Pjpginfo();
			TestKey id = new TestKey();
			id.setUserid(userid[i].trim());
			id.setProjectid(this.getProjectid_a());
			pjpginfo.setId(id);
			pjpginfo.setCancelflag("0");
			pjpginfo.setIntimestp(" ");
			pjpginfo.setUptimestp(" ");
			pjService.savePjpginfo(pjpginfo);
		}
		return "success";
	}
	/**
	 * sessionの値を得って、テープルに書いて、データベースに預け入れる
	 */
public String setvalue1(){
	System.out.println("setvalue");
//	popupPara sendPara=new popupPara();
//	ParaManager ParaGm =new ParaManager("alter");
//	sendPara=(popupPara)ParaGm.getParameter();
	String userid= this.getUsername();
	result1 = pjService.getbyid(userid);
	System.out.println(this.getUsername());
  this.setUsername_a(result1.get(0).getUsername());
  this.setMuserid_a(result1.get(0).getUsername());
  Pjinfo pjinfo = new  Pjinfo();
   pjinfo.setMuserid(userid.trim());
   pjinfo.setProjectid(this.getProjectid_a());
   pjinfo.setPrjmei(this.getPrjmei_a());
   pjinfo.setProjecteiname(this.getProjecteiname_a());
   pjinfo.setProjecttyuname(this.getProjecttyuname_a());
   pjinfo.setYstartdate(this.getYstartdate_a());
   pjinfo.setStartdate(this.getStartdate_a());
   pjinfo.setYenddate(this.getYenddate_a());
   pjinfo.setEnddate(this.getEnddate_a());
   pjinfo.setUsernum(this.getUsernum_a());
   pjinfo.setPjgaiyou(this.getPjgaiyou_a());
   pjinfo.setKyakuname(this.getKyakuname_a());
   pjinfo.setPjem(this.getPjem_a());
   pjinfo.setStatusflg(this.getStatusflg_a());
   pjinfo.setSupuserid(this.getSupuserid_a());
   pjinfo.setBiko(this.getBiko_a());
   pjService.updatePjinfo(pjinfo);
 
		return "success";
	}
	public PjService getPjService() {
		return pjService;
	}
	public void setPjService(PjService pjService) {
		this.pjService = pjService;
	}


	public String getProjectid_a() {
		return projectid_a;
	}


	public void setProjectid_a(String projectid_a) {
		this.projectid_a = projectid_a;
	}


	public String getPrjmei_a() {
		return prjmei_a;
	}


	public void setPrjmei_a(String prjmei_a) {
		this.prjmei_a = prjmei_a;
	}


	public String getKyakuname_a() {
		return kyakuname_a;
	}


	public void setKyakuname_a(String kyakuname_a) {
		this.kyakuname_a = kyakuname_a;
	}


	public String getStartdate_a() {
		return startdate_a;
	}


	public void setStartdate_a(String startdate_a) {
		this.startdate_a = startdate_a;
	}


	public String getEnddate_a() {
		return enddate_a;
	}


	public void setEnddate_a(String enddate_a) {
		this.enddate_a = enddate_a;
	}


	public String getProjecteiname_a() {
		return projecteiname_a;
	}


	public void setProjecteiname_a(String projecteiname_a) {
		this.projecteiname_a = projecteiname_a;
	}


	public String getBiko_a() {
		return biko_a;
	}


	public void setBiko_a(String biko_a) {
		this.biko_a = biko_a;
	}


	public String getUsernum_a() {
		return usernum_a;
	}


	public void setUsernum_a(String usernum_a) {
		this.usernum_a = usernum_a;
	}


	public String getSupuserid_a() {
		return supuserid_a;
	}


	public void setSupuserid_a(String supuserid_a) {
		this.supuserid_a = supuserid_a;
	}


	public String getCancelflag_a() {
		return cancelflag_a;
	}


	public void setCancelflag_a(String cancelflag_a) {
		this.cancelflag_a = cancelflag_a;
	}


	public String getProjecttyuname_a() {
		return projecttyuname_a;
	}


	public void setProjecttyuname_a(String projecttyuname_a) {
		this.projecttyuname_a = projecttyuname_a;
	}


	public String getPjem_a() {
		return pjem_a;
	}


	public void setPjem_a(String pjem_a) {
		this.pjem_a = pjem_a;
	}


	public String getStatusflg_a() {
		return statusflg_a;
	}


	public void setStatusflg_a(String statusflg_a) {
		this.statusflg_a = statusflg_a;
	}


	public String getIntimestp_a() {
		return intimestp_a;
	}


	public void setIntimestp_a(String intimestp_a) {
		this.intimestp_a = intimestp_a;
	}


	public String getPjgaiyou_a() {
		return pjgaiyou_a;
	}


	public void setPjgaiyou_a(String pjgaiyou_a) {
		this.pjgaiyou_a = pjgaiyou_a;
	}


	public String getMuserid_a() {
		return muserid_a;
	}


	public void setMuserid_a(String muserid_a) {
		this.muserid_a = muserid_a;
	}


	public String getYstartdate_a() {
		return ystartdate_a;
	}


	public void setYstartdate_a(String ystartdate_a) {
		this.ystartdate_a = ystartdate_a;
	}


	public String getUptimestp_a() {
		return uptimestp_a;
	}


	public void setUptimestp_a(String uptimestp_a) {
		this.uptimestp_a = uptimestp_a;
	}


	public String getYenddate_a() {
		return yenddate_a;
	}


	public void setYenddate_a(String yenddate_a) {
		this.yenddate_a = yenddate_a;
	}

	public String getKey_hidden() {
		return key_hidden;
	}

	public void setKey_hidden(String key_hidden) {
		this.key_hidden = key_hidden;
	}

	public String getUserkindid_a() {
		return userkindid_a;
	}

	public void setUserkindid_a(String userkindid_a) {
		this.userkindid_a = userkindid_a;
	}

	public String getUsername_a() {
		return username_a;
	}

	public void setUsername_a(String username_a) {
		this.username_a = username_a;
	}

	public String getUserid_a() {
		return userid_a;
	}

	public void setUserid_a(String userid_a) {
		this.userid_a = userid_a;
	}

	public void setSimpleuser(List<simpleuser> simpleuser) {
		this.simpleuser = simpleuser;
	}
	
	public List<simpleuser> getSimpleuser(){
		
		return this.simpleuser;
	}


	public String getUsername() {
		return username;
	}


	public void setUsername(String username) {
		this.username = username;
	}

}
