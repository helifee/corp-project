package pageAction;

import java.util.ArrayList;
import java.util.List;
import org.apache.log4j.*;


import oracle.jdbc.driver.Message;


import pager.Pager;
import pager.PagerService;
import pojo.Pjinfo;
import pojo.Usermst;

import services.PjService;

import com.opensymphony.xwork2.ActionSupport;



public class PageAction extends ActionSupport {
	int totalRow = 0;
	int cnt = 0; //合計数
	int ss = 0;  //ページ数
	int pageSize =5;//ページの記事数
	int pageNum = 1;//最初のページ
	Logger log = Logger.getLogger(this.getClass().getName());
	List<Message> mesList = null;
	private String muserid;
	private List<List_pj> pjs;
	private PjService pjService;
	private String projectid;
	public String nd;
	private PagerService pagerService;
	private Pager pager;
	protected String currentPage;
	protected String pagerMethod;
	protected String totalRows;
	public class List_pj {
		//プロジェクト番号
		private String projectid_a;
		//日文名
		private String prjmei_a;
		//客さん名
		private String kyakuname_a;
		//実際開始日
		private String startdate_a;
		//実際終了日
		private String enddate_a;
		//英文名
		private String projecteiname_a;
		private String biko_a;
		private String usernum_a;
		//作業量
		private String supuserid_a;

		private String cancelflag_a;
		private String projecttyuname_a;
		//中文名
		private String pjem_a;
		//開発環境
		private String statusflg_a;
		private String intimestp_a;
		private String pjgaiyou_a;
		//プロジェクトの概要
		private String muserid_a;
		private String ystartdate_a;
		//予定開始日
		private String uptimestp_a;
		private String yenddate_a;

		private int radio_a;
             /*get setのメソッド*/
		public String getProjectid_a() {
			return projectid_a;
		}

		public void setProjectid_a(String projectid_a) {
			this.projectid_a = projectid_a;
		}

		public String getPrjmei_a() {
			return prjmei_a;
		}

		public void setPrjmei_a(String prjmei_a) {
			this.prjmei_a = prjmei_a;
		}

		public String getKyakuname_a() {
			return kyakuname_a;
		}

		public void setKyakuname_a(String kyakuname_a) {
			this.kyakuname_a = kyakuname_a;
		}

		public int getRadio_a() {
			return radio_a;
		}

		public void setRadio_a(int radio_a) {
			this.radio_a = radio_a;
		}

		public String getStartdate_a() {
			return startdate_a;
		}

		public void setStartdate_a(String startdate_a) {
			this.startdate_a = startdate_a;
		}

		public String getEnddate_a() {
			return enddate_a;
		}

		public void setEnddate_a(String enddate_a) {
			this.enddate_a = enddate_a;
		}

		public String getProjecteiname_a() {
			return projecteiname_a;
		}

		public void setProjecteiname_a(String projecteiname_a) {
			this.projecteiname_a = projecteiname_a;
		}

		public String getBiko_a() {
			return biko_a;
		}

		public void setBiko_a(String biko_a) {
			this.biko_a = biko_a;
		}

		public String getUsernum_a() {
			return usernum_a;
		}

		public void setUsernum_a(String usernum_a) {
			this.usernum_a = usernum_a;
		}

		public String getSupuserid_a() {
			return supuserid_a;
		}

		public void setSupuserid_a(String supuserid_a) {
			this.supuserid_a = supuserid_a;
		}

		public String getCancelflag_a() {
			return cancelflag_a;
		}

		public void setCancelflag_a(String cancelflag_a) {
			this.cancelflag_a = cancelflag_a;
		}

		public String getProjecttyuname_a() {
			return projecttyuname_a;
		}

		public void setProjecttyuname_a(String projecttyuname_a) {
			this.projecttyuname_a = projecttyuname_a;
		}

		public String getPjem_a() {
			return pjem_a;
		}

		public void setPjem_a(String pjem_a) {
			this.pjem_a = pjem_a;
		}

		public String getStatusflg_a() {
			return statusflg_a;
		}

		public void setStatusflg_a(String statusflg_a) {
			this.statusflg_a = statusflg_a;
		}

		public String getIntimestp_a() {
			return intimestp_a;
		}

		public void setIntimestp_a(String intimestp_a) {
			this.intimestp_a = intimestp_a;
		}

		public String getPjgaiyou_a() {
			return pjgaiyou_a;
		}

		public void setPjgaiyou_a(String pjgaiyou_a) {
			this.pjgaiyou_a = pjgaiyou_a;
		}

		public String getMuserid_a() {
			return muserid_a;
		}

		public void setMuserid_a(String muserid_a) {
			this.muserid_a = muserid_a;
		}

		public String getYstartdate_a() {
			return ystartdate_a;
		}

		public void setYstartdate_a(String ystartdate_a) {
			this.ystartdate_a = ystartdate_a;
		}

		public String getUptimestp_a() {
			return uptimestp_a;
		}

		public void setUptimestp_a(String uptimestp_a) {
			this.uptimestp_a = uptimestp_a;
		}

		public String getYenddate_a() {
			return yenddate_a;
		}

		public void setYenddate_a(String yenddate_a) {
			this.yenddate_a = yenddate_a;
		}
	}

	
	public void validate() {
		clearErrorsAndMessages();
	}
      /*年度によって時計の内容を検索してそしてページを分けます*/
	public String ndsearch() {
log.info("ndsearch -- **********");

		List<Pjinfo> result = null;
		List<Pjinfo> result2 = null;
		
		result = pjService.findAllByPage1(getNd(), pageNum, pageSize);
		result2=pjService.findBynd(this.getNd());
		int cnt1 = result.size();  
		cnt = result2.size();
		ss=((double)cnt/(double)pageSize)>(cnt/pageSize)?cnt/pageSize+1:cnt/pageSize;
		List<List_pj> temp = new ArrayList<List_pj>();
		for (int i = 0; i < cnt1; i++) {
			List_pj one_list = new List_pj();
			one_list.setProjectid_a(result.get(i).getProjectid());
			one_list.setKyakuname_a(result.get(i).getKyakuname());
			one_list.setPrjmei_a(result.get(i).getPrjmei());
			one_list.setStartdate_a(result.get(i).getStartdate());
			one_list.setEnddate_a(result.get(i).getEnddate());
			one_list.setBiko_a(result.get(i).getBiko());
			one_list.setIntimestp_a(result.get(i).getIntimestp());
			one_list.setCancelflag_a(result.get(i).getCancelflag());
			one_list.setMuserid_a(result.get(i).getMuserid());
			one_list.setPjem_a(result.get(i).getPjem());
			one_list.setPjgaiyou_a(result.get(i).getPjgaiyou());
			one_list.setProjecteiname_a(result.get(i).getProjecteiname());
			one_list.setProjecttyuname_a(result.get(i).getProjecttyuname());
			one_list.setStatusflg_a(result.get(i).getStatusflg());
			one_list.setSupuserid_a(result.get(i).getSupuserid());
			one_list.setUptimestp_a(result.get(i).getUptimestp());
			one_list.setUsernum_a(result.get(i).getUsernum());
			one_list.setYenddate_a(result.get(i).getYenddate());
			one_list.setYstartdate_a(result.get(i).getYenddate());
			List<Usermst> result1 = new ArrayList<Usermst>();	
            result1 = pjService.findbyid(result.get(i).getMuserid().toString().trim());
            if(result1.size()>0){
            	muserid=result1.get(0).getUsername();
			}
            System.out.println(muserid);
            one_list.setMuserid_a(muserid);
			temp.add(one_list);
		}
		this.setPjs(temp);
		System.out.println(pjs+"☆彡ss☆彡ss☆彡sspjspjspjspjspjspjspjspjs☆彡ss☆彡ss☆彡ss☆彡ss");
		return SUCCESS;
		

	}
	   /*時計の内容を検索してそしてページを分けます*/
	public String search() {
      
//		System.out.println("☆pager.getStartRow()"+pager.getStartRow());
		System.out.println("☆pager.getPageSize()"+pager.getPageSize());
		List<Pjinfo> result = null;
		
		result=pjService.findAllByPage( pager.getStartRow(), pager.getPageSize());
		totalRow=pjService.getRows();  
		pager=pjService.getPager(this.getCurrentPage(), this.getPagerMethod(), totalRow);
		this.setCurrentPage(String.valueOf(pager.getCurrentPage()));
		this.setTotalRows(String.valueOf(totalRow));
		
		System.out.println("☆彡ss"+ss);
		ss=((double)cnt/(double)pageSize)>(cnt/pageSize)?cnt/pageSize+1:cnt/pageSize;
		 int cnt1= result.size();
		List<List_pj> temp = new ArrayList<List_pj>();
		System.out.println("☆彡cnt1" + cnt1);
		for (int i = 0; i < cnt1; i++) {
			List_pj one_list = new List_pj();

			one_list.setProjectid_a(result.get(i).getProjectid());
			one_list.setKyakuname_a(result.get(i).getKyakuname());
			one_list.setPrjmei_a(result.get(i).getPrjmei());
			one_list.setStartdate_a(result.get(i).getStartdate());
			one_list.setEnddate_a(result.get(i).getEnddate());
			one_list.setBiko_a(result.get(i).getBiko());
			one_list.setIntimestp_a(result.get(i).getIntimestp());
			one_list.setCancelflag_a(result.get(i).getCancelflag());
			one_list.setPjem_a(result.get(i).getPjem());
			one_list.setPjgaiyou_a(result.get(i).getPjgaiyou());
			one_list.setProjecteiname_a(result.get(i).getProjecteiname());
			one_list.setProjecttyuname_a(result.get(i).getProjecttyuname());
			one_list.setStatusflg_a(result.get(i).getStatusflg());
			one_list.setSupuserid_a(result.get(i).getSupuserid());
			one_list.setUptimestp_a(result.get(i).getUptimestp());
			one_list.setUsernum_a(result.get(i).getUsernum());
			one_list.setYenddate_a(result.get(i).getYenddate());
			one_list.setYstartdate_a(result.get(i).getYenddate());
			List<Usermst> result1 = new ArrayList<Usermst>();
			result1 = pjService.findbyid(result.get(i).getMuserid().trim());
			if (result1.size() > 0) {
				muserid = result1.get(0).getUsername();
			}
			System.out.println(muserid);
			one_list.setMuserid_a(muserid);

			temp.add(one_list);
		}
		this.setPjs(temp);
		System.out.println(pjs+"☆彡ss☆彡ss☆彡sspjspjspjspjspjspjspjspjs☆彡ss☆彡ss☆彡ss☆彡ss");
		

		return SUCCESS;

	}

	public int getPageSize() {
		return pageSize;
	}

	public void setPageSize(int pageSize) {
		this.pageSize = pageSize;
	}

	public PjService getPjService() {
		return pjService;
	}

	public void setPjService(PjService pjService) {
		this.pjService = pjService;
	}

	public String getMuserid() {
		return muserid;
	}

	public void setMuserid(String muserid) {
		this.muserid = muserid;
	}

	public List<List_pj> getPjs() {
		return pjs;
	}

	public void setPjs(List<List_pj> pjs) {
		this.pjs = pjs;
	}

	public String getProjectid() {
		return projectid;
	}

	public void setProjectid(String projectid) {
		this.projectid = projectid;
	}

	public int getCnt() {
		return cnt;
	}

	public void setCnt(int cnt) {
		this.cnt = cnt;
	}
	public int getPageNum(){
        return pageNum;
    }

    public void setPageNum(int pageNum){
        this.pageNum = pageNum;
    }

	public int getSs() {
		return ss;
	}

	public void setSs(int ss) {
		this.ss = ss;
	}
		public String getNd() {
			return nd;
		}
		public void setNd(String nd) {
			this.nd = nd;
		}
		public int getTotalRow() {
			return totalRow;
		}
		public void setTotalRow(int totalRow) {
			this.totalRow = totalRow;
		}
		public PagerService getPagerService() {
			return pagerService;
		}
		public void setPagerService(PagerService pagerService) {
			this.pagerService = pagerService;
		}
		public Pager getPager() {
			return pager;
		}
		public void setPager(Pager pager) {
			this.pager = pager;
		}
		public String getCurrentPage() {
			return currentPage;
		}
		public void setCurrentPage(String currentPage) {
			this.currentPage = currentPage;
		}
		public String getPagerMethod() {
			return pagerMethod;
		}
		public void setPagerMethod(String pagerMethod) {
			this.pagerMethod = pagerMethod;
		}
		public String getTotalRows() {
			return totalRows;
		}
		public void setTotalRows(String totalRows) {
			this.totalRows = totalRows;
		}
}

