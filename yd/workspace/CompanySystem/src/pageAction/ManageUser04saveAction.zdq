/**
 * プログラム名：管理者担当プロジェクト基本情報更新を保存する
 *  機能概要：管理者担当プロジェクト基本情報更新を保存て、変更の値を点検する
 * 作成者：張瑜
 * 作成日：2008/9/26
 * バージョン：1.0
 * 修正履歴：
 */ 

package pageAction;
import java.util.ArrayList;
import java.util.List;
import parameter.ManageUser04Para;
import pojo.Busyomst;
import pojo.Pjinfo;
import pojo.Usermst;
import services.ManageUser04Service;

import com.opensymphony.xwork2.ActionSupport;
import com.parameter.ParaManager;

import dropdown.userlist;
import dropdown.userlist1;

public class ManageUser04saveAction extends ActionSupport {
	//プロジェクト番号
	private String projectid_d;
	//所属部門
	private String busyoidname_d;
	//日文名
	private String prjmei_d;
	//プロジェクトの主管者
	private String username_d;
	//予定開始日
	private String ystartdate_d;
	//予定終了日
	private String  yenddate_d;
	//実際開始日
	private String  startdate_d;
	//実際終了日
	private String  enddate_d;
	//開発環境
	private String pjem_d;
	//プロジェクトの概要
	private String pjgaiyou_d;
	//管理者番号
	private String muserid_d;
	//作業量
	private String usernum_d;
	//中文名
	private String projecttyuname_d;
	//英文名
	private String projecteiname_d;
	//客さん名
	private String kyakuname_d;
	//ドロップダウンボックス管理者名
	private String selectStudent;
	//ドロップダウンボックス部門名
    private String selectbusyoidname;
    //ドロップダウンボックス管理者名リスト
    private static List<userlist> liststu = new ArrayList<userlist>();
    //ドロップダウンボックス部門名リスト
    private static List<userlist1> listbusy = new ArrayList<userlist1>();

	
	public void setListstu(List<userlist> liststu){
		this.liststu=liststu;
	}
	
	public List<userlist> getListstu(){
		return this.liststu;
	}
	public  String getSelectbusyoidname() {
		return selectbusyoidname;
	}
	
	public void setSelectbusyoidname(String selectbusyoidname) {
		this.selectbusyoidname = selectbusyoidname;
	}	
	
		
    public void setListbusy(List<userlist1> listbusy){
		this.listbusy=listbusy;
	}
		
	public List<userlist1> getListbusy(){
		return this.listbusy;
	}
	public  String getSelectStudent() {
		return selectStudent;
	}
	public void setSelectStudent(String selectStudent) {
		this.selectStudent = selectStudent;
	}	
	public  String getProjectid_d() {
		return projectid_d; 
	}
	
	public void setProjectid_d(String projectid_d) { 
		this.projectid_d = projectid_d;
	}	
	
	public  String getYstartdate_d() {
		return ystartdate_d; 
	}
	
	public void setYstartdate_d(String  ystartdate_d) { 
		this.ystartdate_d = ystartdate_d;
	}	
	public  String  getYenddate_d() {
		return yenddate_d; 
	}
	
	public void setYenddate_d(String  yenddate_d) { 
		this.yenddate_d= yenddate_d;
	}
	public  String getPjem_d() {
		return pjem_d; 
	}
	
	public void setPjem_d(String pjem_d) { 
		this.pjem_d= pjem_d;
	}
	public  String getPjgaiyou_d() {
		return pjgaiyou_d; 
	}
	
	public void setPjgaiyou_d(String pjgaiyou_d) { 
		this.pjgaiyou_d= pjgaiyou_d;
	}
	
	public  String getPrjmei_d() {
		return prjmei_d; 
	}
	
	public void setPrjmei_d(String prjmei_d) { 
		this.prjmei_d= prjmei_d;
	}
	public  String getUsername_d() {
		return username_d; 
	}
	
	public void setUsername_d(String username_d) { 
		this.username_d = username_d;
	}
	public  String getKyakuname_d() {
		return kyakuname_d; 
	}
	
	public void setKyakuname_d(String kyakuname_d) { 
		this.kyakuname_d= kyakuname_d;
	}	
	public  String  getStartdate_d() {
		return startdate_d; 
	}
	
	public void setStartdate_d(String startdate_d) { 
		this.startdate_d= startdate_d;
	}	
	public  String  getEnddate_d() {
		return enddate_d; 
	}
	
	public void setEnddate_d(String  enddate_d) { 
		this.enddate_d= enddate_d;
	}	
	public  String getUsernum_d() {
		return usernum_d; 
	}
	
	public void setUsernum_d(String usernum_d) { 
		this.usernum_d= usernum_d;
	}		
	public  String getProjecttyuname_d() {
		return projecttyuname_d; 
	}
	
	public void setProjecttyuname_d(String projecttyuname_d) { 
		this.projecttyuname_d = projecttyuname_d;
	}		
	public  String getProjecteiname_d() {
		return projecteiname_d; 
	}
	
	public void setProjecteiname_d(String projecteiname_d) { 
		this.projecteiname_d= projecteiname_d;
	}	
	
	private ManageUser04Service ps;

	public void setPs(ManageUser04Service ps){
		
		this.ps=ps;
	}

	List<Usermst> result1= new ArrayList<Usermst>();	
	List<Busyomst> result2=new ArrayList<Busyomst>();
	Usermst result4= new Usermst();
	
	/**
	 * 変更の値を保存する
	 * @return
	 */
	public String save(){
		Pjinfo result=new Pjinfo();
		String value = this.getSelectStudent();
		result4=ps.getbyMid(value);
		this.setSelectbusyoidname(result4.getBusyoid());
		System.out.println("Ystartdate-------------" );
		ParaManager ParaGm =new ParaManager("ManageUser04");
		ManageUser04Para myPara = new ManageUser04Para();
	    myPara=(ManageUser04Para)ParaGm.getParameter();
		String myparam1 = myPara.getProjectid();
		setProjectid_d(myparam1);
		result.setProjectid(getProjectid_d());
		result.setKyakuname(getKyakuname_d());
		result.setPjem(getPjem_d());
		result.setPjgaiyou(getPjgaiyou_d());
		result.setEnddate(getEnddate_d());
		result.setStartdate(getStartdate_d());
		result.setYenddate(getYenddate_d());
		result.setYstartdate(getYstartdate_d());
		result.setProjecteiname(getProjecteiname_d());
		result.setProjecttyuname(getProjecttyuname_d());
		result.setEnddate(getEnddate_d());
		result.setPrjmei(getPrjmei_d());
		result.setMuserid(this.getSelectStudent());
		result.setUsernum("20");
		result.setStatusflg(" ");
		result.setCancelflag(" ");
		result.setIntimestp(" ");
		result.setUptimestp(" ");
		result.setBiko(" ");
		result.setSupuserid(" ");
		ps.saveinfo(result);
	    return "change";
	}
	/**
	 * 変更の値を点検する
	 */
	public void validate() {

		if (projectid_d.trim().length() != 8) {
			addFieldError("projectid_d", "該当Lenthは必ず 8です");
			System.out.println("Ystartdate-------------" + projectid_d);
		}
		if (pjem_d == null || pjem_d.trim().equals(""))

		{
			this.addFieldError("pjem_d", "該当項目(開発環境)は必須項目");
			System.out.println("pjem-------------" + pjem_d);
		}
		if (getPjgaiyou_d() == null || getPjgaiyou_d().trim().equals("")) {
			addFieldError("pjgaiyou_d", "該当項目(プロジェクトの概要)は必須項目");

		}
		if (prjmei_d == null || prjmei_d.trim().equals(""))

		{
			addFieldError("prjmei_d", "該当項目(日文名)は必須項目");
		}
		if (projecttyuname_d == null || projecttyuname_d.trim().equals("")) {
			addFieldError("projecttyuname_d", "該当項目(中文名)は必須項目");

		}

		if (projecteiname_d == null || projecteiname_d.trim().equals("")) {
			addFieldError("projecteiname_d", "該当項目(英文名)は必須項目");

		}
		if (kyakuname_d == null || kyakuname_d.trim().equals("")) {
			addFieldError("kyakuname_d", "該当項目(客さん名)は必須項目");

		}

		if (ystartdate_d == null || ystartdate_d.equals("")) {
			addFieldError("ystartdate_d", "該当項目(予定開始日)は必須項目");

		}
		if (yenddate_d == null || yenddate_d.equals("")) {
			addFieldError("yenddate_d", "該当項目(予定終了日)は必須項目");

		}
		if (enddate_d == null || enddate_d.equals("")) {
			addFieldError("enddate_d", "該当項目(実際終了日)は必須項目");

		}
		if (startdate_d== null || startdate_d.equals("")) {
			addFieldError("startdate_d", "該当項目(実際開始日)は必須項目");

		}

		result1=ps.getUserByUserid();
		List<userlist> aaa = new ArrayList<userlist>();
		for(int i=0;i<result1.size();i++){
    	userlist bj = new userlist();       
        bj.setId(result1.get(i).getUserid()); 	    	
        bj.setName(result1.get(i).getUsername());
        aaa.add(bj);
		}   
		//管理者リストを ドロップダウンボックスに書く
		setListstu(aaa);
    
		//Busyomstテープルで情報を検索する
		result2=ps.getBYBusyomstid();
		List<userlist1> bbb = new ArrayList<userlist1>();
		for(int i=0;i<result2.size();i++){
		userlist1 bj = new userlist1();
        bj.setId(result2.get(i).getBusyoid());   
        bj.setName(result2.get(i).getBusyoidname());
        bbb.add(bj);
		}   

		//部門リストをドロップダウンボックスに書く
		setListbusy(bbb);
		System.out.println("endddddddddddd");
	}	
	
}
