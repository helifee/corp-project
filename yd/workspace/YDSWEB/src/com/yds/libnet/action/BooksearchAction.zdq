package com.yds.libnet.action;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;

import com.yds.base.action.BasePagerAction;
import com.yds.libnet.service.BooksearchService;
import com.yds.library.bean.Bookinfo;
import com.yds.library.common.bean.Commonbooksort;
import com.yds.library.common.service.CommonbooksortService;
import com.yds.library.service.LogonService;
import com.yds.util.service.StringUtil;

/**
 * 书籍管理
 * @author zhangchi
 * @version 1.0 2010/11/29
 */
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
@Controller("booksearchAction")
public class BooksearchAction  extends BasePagerAction{
	
	private static final long serialVersionUID = -1397051695703253298L;
	private BooksearchService booksearchService;
	private CommonbooksortService commonbooksortService;
	private LogonService logonService;
	
	private List<Bookinfo> bookmanageList; // 图书详细信息
	private List<Commonbooksort> booksortlist; //图书分类
	private String isbn; // isbn号
	private String bookname; // 图书名称
	private String booksort; // 图书分类
	private String bookstate; // 图书状态
	private String userid; // 用户id
	private String allbooksNum; // 全部图书数量
	
	/**
	 * 图书信息取得
	 * @return
	 * @throws Exception
	 */
	public String mamageInfoIndex() throws Exception {
		
		// 取得图书类型LIST
		booksortlist = new ArrayList<Commonbooksort>();
		booksortlist = this.commonbooksortService.getbookclassInfo("");
		Commonbooksort commonbooksort = new Commonbooksort();
		
		// 设置带空行的LIST
		commonbooksort.setClassid("00");
		commonbooksort.setClassname("");
		booksortlist.add(0,commonbooksort);
		
		return SUCCESS;
	}
	
	/**
	 * 图书信息检索
	 * @return
	 * @throws Exception
	 */
	public String getMamageInfo() throws Exception {

		String purseIdYd = StringUtil.leftPadYd(userid);
		Bookinfo bookmanageInfo = new Bookinfo();
		bookmanageInfo.setIsbn(isbn);
		bookmanageInfo.setBookname(bookname);
		bookmanageInfo.setBooksort(booksort);
		bookmanageInfo.setLoanFlg(bookstate);
		bookmanageInfo.setPurseid(purseIdYd);
		allbooksNum = booksearchService.getbooksNum(bookmanageInfo);
		super.setPagerParamter(Long.valueOf(allbooksNum),
				"searchtable.action",12);  
		
		// 取得图书详细信息LIST
		bookmanageList = booksearchService.getbookmanageInfo(pager.getOffset().intValue(),
				pager.getPerDisplayCount().intValue(),bookmanageInfo);  
		
		// 当总页数小于第几页时
		if (pager.getTotalPagesCount() < pageNumber) {
			this.pageNumber = Integer.valueOf(pager.getTotalPagesCount().toString());
			allbooksNum = booksearchService.getbooksNum(bookmanageInfo);
			super.setPagerParamter(Long.valueOf(allbooksNum),"searchtable.action",12);
			
			// 取得图书详细信息LIST
			bookmanageList = booksearchService.getbookmanageInfo(pager.getOffset().intValue(),
					pager.getPerDisplayCount().intValue(),bookmanageInfo); 
		}
		return SUCCESS;
	}

	public BooksearchService getBooksearchService() {
		return booksearchService;
	}

	public void setBooksearchService(BooksearchService booksearchService) {
		this.booksearchService = booksearchService;
	}

	public List<Bookinfo> getBookmanageList() {
		return bookmanageList;
	}

	public void setBookmanageList(List<Bookinfo> bookmanageList) {
		this.bookmanageList = bookmanageList;
	}

	public CommonbooksortService getCommonbooksortService() {
		return commonbooksortService;
	}

	public void setCommonbooksortService(CommonbooksortService commonbooksortService) {
		this.commonbooksortService = commonbooksortService;
	}

	public List<Commonbooksort> getBooksortlist() {
		return booksortlist;
	}

	public void setBooksortlist(List<Commonbooksort> booksortlist) {
		this.booksortlist = booksortlist;
	}

	public String getIsbn() {
		return isbn;
	}

	public void setIsbn(String isbn) {
		this.isbn = isbn;
	}

	public String getBookname() {
		return bookname;
	}

	public void setBookname(String bookname) {
		this.bookname = bookname;
	}

	public String getBookstate() {
		return bookstate;
	}

	public void setBookstate(String bookstate) {
		this.bookstate = bookstate;
	}

	public String getBooksort() {
		return booksort;
	}

	public void setBooksort(String booksort) {
		this.booksort = booksort;
	}

	public int getPageNumber() {
		return pageNumber;
	}

	public void setPageNumber(int pageNumber) {
		this.pageNumber = pageNumber;
	}

	public String getUserid() {
		return userid;
	}

	public void setUserid(String userid) {
		this.userid = userid;
	}

	public String getAllbooksNum() {
		return allbooksNum;
	}

	public void setAllbooksNum(String allbooksNum) {
		this.allbooksNum = allbooksNum;
	}

	public LogonService getLogonService() {
		return logonService;
	}

	public void setLogonService(LogonService logonService) {
		this.logonService = logonService;
	}

}