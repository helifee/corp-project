/*
 * @(#)Yb0060ServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 员工管理
 */

package com.yds.employee.service.impl;

import java.util.List;

import org.springframework.stereotype.Service;

import com.yds.base.service.AbstractBaseService;
import com.yds.common.bean.EmpPos;
import com.yds.common.service.CommonConstants;
import com.yds.common.service.LogService;
import com.yds.common.service.SessionService;
import com.yds.employee.dao.Yb0060Dao;
import com.yds.employee.service.Yb0060Service;

/**
 * @see com.yds.employee.service.Yb0060Service
 */
@Service("yb0060Service")
public class Yb0060ServiceImpl extends AbstractBaseService implements
		Yb0060Service {
	private Yb0060Dao yb0060Dao;
	// ======2010/08/06 滕长龙对应系统日志 start ===========
	// 日志信息
	String logMsg = "";
	// 日志 service
	private LogService logService;
	// ======2010/08/06 滕长龙对应系统日志 end ===========

	/**
	 * {@inheritDoc}
	 * 
	 * @throws Exception
	 */
	@Override
	public List<EmpPos> getPosList(String posTypeId) throws Exception {
		EmpPos empPos = new EmpPos();
		empPos.setPosTypeId(posTypeId);

		return yb0060Dao.getPosList(posTypeId);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public EmpPos getPosInfo(String posId) {

		EmpPos empPos = new EmpPos();
		empPos.setPosId(posId);
		empPos = yb0060Dao.getPosInfo(posId);

		return empPos;
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<EmpPos> getPosSortList(String posTypeId) {

		EmpPos empPos = new EmpPos();
		empPos.setPosTypeId(posTypeId);

		return yb0060Dao.getPosSortList(empPos);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public boolean insertPosInfo(EmpPos empPos) {

		String posId = "";
		String posIdString = yb0060Dao.getMaxPosId();
		int posIdInt = Integer.parseInt(posIdString) + 1;
		posId = String.valueOf(posIdInt);
		int length = posId.length();
		if (length < 3) {
			for (int a = 0; a < 3 - length; a++) {
				posId = "0" + posId;
			}
		}
		empPos.setPosId(posId);
		empPos.setDispSeq("999");
		if (!"1".equals(empPos.getPosState())) {
			empPos.setPosState("0");
		}
		yb0060Dao.insertPosInfo(empPos);

		// ======2010/08/24 滕长龙对应系统日志 start ===========
		// 日志信息的编辑
		logMsg = "ID为" + empPos.getPosId() + "的职位信息注册成功。";
		// 日志的追加 子系统ID未定 日志级别未定
		logService.insertLogInfo(CommonConstants.LoglevelEnum.Not_Delete.toString(), CommonConstants.SubIdEnum.Sub_EMP.toString(),SessionService.getLoginUserId(), logMsg, "");
		// ======2010/08/24 滕长龙对应系统日志 end ===========

		return false;
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public boolean updatePosInfo(EmpPos empPos) {

		if (!"1".equals(empPos.getPosState())) {
			empPos.setPosState("0");
		}

		yb0060Dao.updatePosInfo(empPos);

		return true;
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public int updatePosSort(String posSort) {

		EmpPos empPos = new EmpPos();

		String[] posArr = posSort.replace(" ", "").split(",");
		int dispSeq = 0;

		for (int i = 0; i < posArr.length; i++) {
			if (!"".equals(posArr[i])) {
				dispSeq++;
				String dispSeqS = String.valueOf(dispSeq);
				int length = dispSeqS.length();
				if (length < 3) {
					for (int a = 0; a < 3 - length; a++) {
						dispSeqS = "0" + dispSeqS;
					}
				}
				empPos.setDispSeq(dispSeqS);
				empPos.setPosId(posArr[i]);
				yb0060Dao.updatePosSort(empPos);
			}
		}
		// ======2010/08/24 滕长龙对应系统日志 start ===========
		// 日志信息的编辑
		logMsg = "ID为" + empPos.getPosId() + "的职位信息修改成功。";
		// 日志的追加 子系统ID未定 日志级别未定
		logService.insertLogInfo(CommonConstants.LoglevelEnum.Not_Delete.toString(), CommonConstants.SubIdEnum.Sub_EMP.toString(),SessionService.getLoginUserId(), logMsg, "");
		// ======2010/08/24 滕长龙对应系统日志 end ===========
		return 0;
	}

	public Yb0060Dao getYb0060Dao() {
		return yb0060Dao;
	}

	public void setYb0060Dao(Yb0060Dao yb0060Dao) {
		this.yb0060Dao = yb0060Dao;
	}

	public void setLogService(LogService logService) {
		this.logService = logService;
	}

}
