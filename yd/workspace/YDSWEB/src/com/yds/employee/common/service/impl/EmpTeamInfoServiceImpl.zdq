/*
 * @(#)EmpTeamInfoServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 共通系统
 */

package com.yds.employee.common.service.impl;

import java.util.List;

import org.springframework.stereotype.Service;
import com.yds.base.service.AbstractBaseService;
import com.yds.common.bean.EmpTeamInfo;
import com.yds.common.dao.EmpTeamInfoDao;
import com.yds.common.service.EmpTeamInfoService;
import com.yds.common.service.SessionService;
import com.yds.employee.bean.Yb0070CondA;
import com.yds.employee.service.Yb0070Service;

/**
 * @see com.yds.common.service.EmpTeamInfoService
 */
@Service("empTeamInfoService")
public class EmpTeamInfoServiceImpl extends AbstractBaseService implements
	EmpTeamInfoService {

	private EmpTeamInfoDao empTeamInfoDao;
	private Yb0070Service yb0070Service;
	
	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<EmpTeamInfo> getTeamList(String userId,String... empPara){

		EmpTeamInfo empTeamInfo = new EmpTeamInfo();
		empTeamInfo.setUserId(userId);

		if (empPara.length == 1) {
			empTeamInfo.setTeamSnm(empPara[0]);
		} else if (empPara.length == 2) {
			empTeamInfo.setTeamId(empPara[0]);
			empTeamInfo.setTeamSnm(empPara[1]);
		}
		return this.getTeamList(empTeamInfo);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<EmpTeamInfo> getTeamList(EmpTeamInfo empTeamInfo) {
		List<EmpTeamInfo> empTeamInfoList = empTeamInfoDao
				.getTeamList(empTeamInfo);
		if (empTeamInfo.getTeamSnm() != null) {
			if (empTeamInfo.getTeamId() == null) {
				return addDiff("", empTeamInfo.getTeamSnm(),
						empTeamInfoList);
			} else {
				return addDiff(empTeamInfo.getTeamId(), empTeamInfo.getTeamSnm(),
						empTeamInfoList);
			}
		}
		return empTeamInfoList;
	}

	/**
	 * 追加组信息
	 * 
	 * @param teamId
	 *            组名Id
	 * @param teamSnm
	 *            组名
	 * @param empTeamInfoList
	 *            组别list
	 * @return List<EmpTeamInfo> 组别list
	 */
	public List<EmpTeamInfo> addDiff(String teamId, String teamSnm,
			List<EmpTeamInfo> empTeamInfoList) {
		EmpTeamInfo empTeamInfo = new EmpTeamInfo();
		empTeamInfo.setTeamId(teamId);
		empTeamInfo.setTeamSnm(teamSnm);
		empTeamInfoList.add(0, empTeamInfo);
		return empTeamInfoList;
	}

	/**
	 * @param empTeamInfoDao the empTeamInfoDao to set
	 */
	public void setEmpTeamInfoDao(EmpTeamInfoDao empTeamInfoDao) {
		this.empTeamInfoDao = empTeamInfoDao;
	}

	@Override
	public String insertTeam(EmpTeamInfo empTeamInfo) throws Exception {
		// 设定一些初期值
	    // 画面上只有组名和成员ID
		Yb0070CondA yb0070CondA = new Yb0070CondA();
		
		// 组名
		yb0070CondA.setTeamNm(empTeamInfo.getTeamNm());
		
		// 组略称
		yb0070CondA.setTeamSnm(empTeamInfo.getTeamNm());
		
		// 组长 设定为登录者
		yb0070CondA.setTeamLeaderId(SessionService.getLoginUserId());
		
		//组别Flg
		yb0070CondA.setTeamFlg(empTeamInfo.getTeamFlg());
		
		// 需要申请 待追加为枚举
		yb0070CondA.setJoinApplyFlg("1");
		
		yb0070CondA.setTeamUserId(empTeamInfo.getUserId());
		
		// 创建组
		return yb0070Service.insertTeamInfo(yb0070CondA);
	}

	/**
	 * @param yb0070Service the yb0070Service to set
	 */
	public void setYb0070Service(Yb0070Service yb0070Service) {
		this.yb0070Service = yb0070Service;
	}
}
