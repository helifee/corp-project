<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="yb0020Dao">
    <typeAlias alias="empInfo" type="com.yds.common.bean.EmpInfo"/>
    <typeAlias alias="empStaffOrgRelation" type="com.yds.employee.bean.EmpStaffOrgRelation"/>
    <typeAlias alias="empGrpHis" type="com.yds.employee.bean.EmpGrpHis"/>
    <typeAlias alias="empStaffPos" type="com.yds.employee.bean.EmpStaffPos"/>
    <typeAlias alias="empPosHis" type="com.yds.employee.bean.EmpPosHis"/>
    <typeAlias alias="empPosListInfo" type="com.yds.employee.bean.EmpStaffPos"/>
    <typeAlias alias="empStateInfo" type="com.yds.employee.bean.EmpStateInfo"/>
    <typeAlias alias="userResult" type="com.yds.common.bean.UserResult"/>

	<!-- 员工信息取得(ID) --> 
	<select id="getEmpInfoFromId" parameterClass="String" resultClass="empInfo"> 
		SELECT 
			T1.EMP_ID           as empId,
			T1.EMP_CPNM         as empCpnm,
			T1.EMP_CPSNM        as empCpsnm,
			T1.EMP_CNM          as empCnm,
			T1.EMP_JRNM         as empJrnm,
			T1.EMP_JKNM         as empJknm,
			T1.EMP_JNM          as empJnm,
			T1.EMP_SEX          as empSex,
			T1.EMP_DMNM         as empDmnm,
			T1.EMP_EMAIL_COMP   as empEmailComp,
			T1.EMP_EMAIL_PUB    as empEmailPub,
			T1.START_DATE       as startDate,
			T1.EMP_STATUS_ID    as empStatusId,
			T1.EMP_STATE_ID     as empState,
			T1.CHARGE_ORG_ID    as chargeOrgId,
			T1.QUIT_DATE        as endDate,
			T1.MAJOR            as major,
			T1.DEGREE           as degree,
			T1.GRADUATED        as graduated,
			T1.EMP_IMG_ID       as empImgId,
			T1.UPDATE_TIME      as updateTime
		FROM 
			EMP_INFO T1
		WHERE 
			T1.EMP_ID = #empId#
	</select>

	<!-- 员工职位取得 --> 
	<select id="getEmpPos" parameterClass="String" resultClass="empPosListInfo"> 
		SELECT 
			T1.EMP_ID           as empId,
			T1.EMP_CNM          as empName,
			T3.POS_TYPE_ID      as posType,
			T4.DIFF_NAME        as posTypeName,
			T2.POS_ID           as posId,
			T3.POS_SNAME        as posSName,
			T2.MAIN_POS_FLG     as mainPosFlg,
			T5.START_TIME	    as startTime,
			T5.END_TIME         as endTime
		FROM 
			EMP_INFO T1
			LEFT JOIN EMP_STAFF_POS T2
				ON T2.EMP_ID = T1.EMP_ID
			LEFT JOIN EMP_POS T3
				ON T3.POS_ID = T2.POS_ID
			LEFT JOIN SYS_CODE_MST T4
				ON T4.DIFF_NO = T3.POS_TYPE_ID
				AND T4.SUB_SYS = 'EMP'
				AND T4.TYPE_ID = 'POS_TYPE'
			LEFT JOIN EMP_POS_HIS T5
				ON T5.EMP_ID = T1.EMP_ID
				AND T5.POS_ID = T2.POS_ID
				AND T5.END_TIME = '9999-12-31'
		WHERE 
			T1.EMP_ID = #empId#
		ORDER BY
			T2.MAIN_POS_FLG DESC, T3.POS_TYPE_ID, T3.DISP_SEQ, T5.END_TIME
	</select>

	<!-- 添加员工职位信息 --> 
	<insert id="insertEmpStaffPos" parameterClass="empStaffPos">
		INSERT INTO EMP_STAFF_POS
		   (
		    EMP_ID, 
			POS_ID,
			MAIN_POS_FLG
		   )
		VALUES
		   (
		    #empId#, 
			#posId#,
			'1'
		   );
	</insert>

	<!-- 添加员工职位历史信息 --> 
	<insert id="insertEmpPosHis" parameterClass="empPosHis">
		INSERT INTO EMP_POS_HIS 
		   (
		    EMP_ID, 
			START_TIME,
			END_TIME,
			POS_ID,
			UPDATE_USER,
			UPDATE_TIME
		   )
		VALUES
		   (
		    #empId#, 
			NOW(),
		    #endTime#,
			#posId#,
			#updateUser#,
			NOW()
		   );
	</insert>
	
	<!-- 添加员工-组织信息 --> 
	<insert id="insertEmpStaffOrgRelation" parameterClass="empStaffOrgRelation">
		INSERT INTO EMP_STAFF_ORG_RELATION 
		   (
		    EMP_ID, 
			ORG_ID
		   )
		VALUES
		   (
		    #empId#, 
			#orgId#
		   );
	</insert>
	
	<!-- 更新员工信息 --> 
	<update id="updateEmpInfo" parameterClass="empInfo">
		UPDATE 
			EMP_INFO
		SET
			EMP_CPNM        = #empCpnm#,
			EMP_CPSNM       = #empCpsnm#,
			EMP_CNM         = #empCnm#,
			EMP_JRNM        = #empJrnm#,
			EMP_JKNM        = #empJknm#,
			EMP_JNM         = #empJnm#,
			EMP_SEX         = #empSex#,
			EMP_DMNM        = #empDmnm#,
			EMP_EMAIL_COMP  = #empEmailComp#,
			EMP_EMAIL_PUB   = #empEmailPub#,
			START_DATE      = #startDate#,
			EMP_STATUS_ID   = #empStatusId#,
			CHARGE_ORG_ID   = #chargeOrgId#,
			QUIT_DATE       = #endDate#,
			MAJOR           = #major#,
			DEGREE          = #degree#,
			GRADUATED       = #graduated#,
			EMP_IMG_ID      = #empImgId#,
			UPDATE_USER     = #updateUser#,
			UPDATE_TIME     = NOW()
		WHERE
			EMP_ID = #empId#
	</update>
	
	<!-- 更新员工职位历史信息 --> 
	<update id="updateEmpPosHis" parameterClass="empPosHis">
		UPDATE 
			EMP_POS_HIS
		SET
			END_TIME    = #endTime#,
			UPDATE_USER = #updateUser#,
			UPDATE_TIME = NOW()
		WHERE
			EMP_ID = #empId# AND
			START_TIME = #startTime# AND
			POS_ID = #posId#
	</update>

	<!-- 取得员工历史职位信息 --> 
	<select id="getEmpPosHis" parameterClass="empPosHis" resultClass="String"> 
		SELECT 
			COUNT(*)
		FROM 
			EMP_POS_HIS T1
		WHERE 
			T1.EMP_ID = #empId# AND
			T1.START_TIME = #startTime# AND
			T1.POS_ID = #posId#
	</select>
	
	<!-- 取得开始时间List --> 
	<select id="getStartTime" parameterClass="empGrpHis" resultClass="String"> 
		SELECT 
			START_TIME AS startTime
		FROM 
			EMP_GRP_HIS 
		WHERE 
			EMP_ID = #empId# AND
			ORG_ID = #orgId#
		ORDER BY START_TIME DESC
	</select>

	<!-- 取得员工历史职位-终了时间信息 --> 
	<select id="getEmpPosHisEndTime" parameterClass="empPosHis" resultClass="String"> 
		SELECT 
			T1.END_TIME as endTime
		FROM 
			EMP_POS_HIS T1
		WHERE 
			T1.EMP_ID = #empId# AND
			T1.START_TIME = #startTime# AND
			T1.POS_ID = #posId#
	</select>
		
	<!-- 员工职位信息的删除 -->
	<delete id="deleteEmpStaffPos" parameterClass="String">
		DELETE FROM
			EMP_STAFF_POS
		WHERE
			EMP_ID = #empId#
	</delete>
		
	<!-- 员工-组织信息的删除 -->
	<delete id="deleteEmpStaffOrgRelation" parameterClass="empStaffOrgRelation">
		DELETE FROM
			EMP_STAFF_ORG_RELATION
		WHERE
			EMP_ID = #empId# AND
			ORG_ID = #orgId#
	</delete>

	<!-- 取得员工主管部门信息 --> 
	<select id="getOrgId" parameterClass="String" resultClass="String"> 
		SELECT 
			T1.CHARGE_ORG_ID as orgId
		FROM 
			EMP_INFO T1
		WHERE 
			T1.EMP_ID = #empId#
	</select>
	
	<!-- 更新员工-组织历史信息 --> 
	<update id="updateEmpGrpHis" parameterClass="empGrpHis">
		UPDATE 
			EMP_GRP_HIS
		SET
			END_TIME = NOW(),
			UPDATE_USER = #updateUser#,
			UPDATE_TIME = NOW()
		WHERE
			EMP_ID = #empId# AND
			END_TIME = '9999-12-31' AND
			ORG_ID = #orgId#
	</update>
	<!-- 更新员工-组织历史信息二 --> 
	<update id="updateEmpGrpHis2" parameterClass="empGrpHis">
		UPDATE 
			EMP_GRP_HIS
		SET
			END_TIME = '9999-12-31',
			UPDATE_USER = #updateUser#,
			UPDATE_TIME = NOW()
		WHERE
			EMP_ID = #empId# AND
			ORG_ID = #orgId#
	</update>

	<!-- 添加员工-组织历史信息 --> 
	<insert id="insertEmpGrpHis" parameterClass="empGrpHis">
		INSERT INTO EMP_GRP_HIS 
		   (
		    EMP_ID, 
			START_TIME,
			END_TIME,
			ORG_ID,
			UPDATE_TIME,
			UPDATE_USER
		   )
		VALUES
		   (
		    #empId#, 
			NOW(),
			'9999-12-31',
			#orgId#,
			NOW(),
			#updateUser#
		   );
	</insert>

	<!-- 员工信息取得(域用户名) --> 
	<select id="getEmpInfoFromDmnm" parameterClass="String" resultClass="String"> 
		SELECT 
			T1.EMP_ID as empId
		FROM 
			EMP_INFO T1
		WHERE 
			T1.EMP_DMNM = #empDmnm#
	</select>

	<!-- 员工信息取得(社内信箱ID) --> 
	<select id="getEmpInfoFromEmailComp" parameterClass="String" resultClass="String"> 
		SELECT 
			T1.EMP_ID as empId
		FROM 
			EMP_INFO T1
		WHERE 
			T1.EMP_EMAIL_COMP = #empEmailComp#
	</select>

	<!-- 员工信息取得(域用户名) --> 
	<select id="getEmpInfoFromDmnmIns" parameterClass="String" resultClass="String"> 
		SELECT 
			COUNT(*)
		FROM 
			EMP_INFO T1
		WHERE 
			T1.EMP_DMNM = #empDmnm#
	</select>

	<!-- 员工信息取得(社内信箱ID) --> 
	<select id="getEmpInfoFromEmailCompIns" parameterClass="String" resultClass="String"> 
		SELECT 
			COUNT(*)
		FROM 
			EMP_INFO T1
		WHERE 
			T1.EMP_EMAIL_COMP = #empEmailComp#
	</select>

	<!-- 添加员工信息 --> 
	<insert id="insertEmpInfo" parameterClass="empInfo">
		INSERT INTO EMP_INFO 
		   (
		    EMP_ID, 
			EMP_CPNM,
			EMP_CPSNM,
			EMP_CNM, 
			EMP_JRNM,  
			EMP_JKNM,
			EMP_JNM,
			EMP_SEX,
			EMP_DMNM,
			EMP_EMAIL_COMP,
			EMP_EMAIL_PUB,
			START_DATE,
			EMP_STATUS_ID,
			EMP_STATE_ID,
			ATTENDANCE_ID,
			CHARGE_ORG_ID,
			MAJOR,
			DEGREE,
			GRADUATED,
			EMP_IMG_ID,
			UPDATE_USER,
			UPDATE_TIME
		   )
		VALUES
		   (
		    #empId#, 
			#empCpnm#,
			#empCpsnm#,
			#empCnm#,  
			#empJrnm#,
			#empJknm#,
			#empJnm#,
			#empSex#, 
			#empDmnm#,
			#empEmailComp#,
			#empEmailPub#,
			#startDate#,
			#empStatusId#,
			'01',
			'000001',
			#chargeOrgId#,
			#major#,
			#degree#,
			#graduated#,
			#empImgId#,
			#updateUser#,
			NOW()
		   );
	</insert>

	<!-- 添加员工状态信息 --> 
	<insert id="insertEmpStateInfoIns" parameterClass="empStateInfo">
		INSERT INTO EMP_STATE_INFO 
		   (
		    EMP_ID, 
			START_TIME,
			END_TIME,
			EMP_STATE,
			UPDATE_USER,
			UPDATE_TIME
		   )
		VALUES
		   (
		    #empId#, 
			NOW(),
			'9999-12-31',
			#empState#,
			#updateUser#,
			NOW()
		   );
	</insert>

	<!-- 毕业院校信息取得 --> 
	<select id="getGraduateList" parameterClass="java.util.HashMap" resultClass="String"> 
		SELECT 
			DISTINCT T1.GRADUATED as graduated
		FROM 
			EMP_INFO T1
		WHERE T1.GRADUATED != ''
	</select>

	<!-- 学历信息取得 --> 
	<select id="getMajorList" parameterClass="java.util.HashMap" resultClass="String"> 
		SELECT 
			DISTINCT T1.MAJOR as major
		FROM 
			EMP_INFO T1
		WHERE T1.MAJOR != ''
	</select>

	<!-- 职位名称取得 --> 
	<select id="getDiffName" parameterClass="String" resultClass="String"> 
		SELECT 
			DIFF_NAME as diffName
		FROM 
			SYS_CODE_MST
		WHERE 
			DIFF_NO = #diffNo#
			AND SUB_SYS='EMP'
			AND TYPE_ID='STATE'
	</select>
	
	<!-- 职位Id取得 --> 
	<select id="getPosId" parameterClass="String" resultClass="String"> 
		SELECT 
			POS_ID as posId
		FROM 
			EMP_STAFF_POS
		WHERE 
			EMP_ID=#empId# AND
			MAIN_POS_FLG ='1'
	</select>
	
	<!-- 离职日期取得 --> 
	<select id="getQuitDate" parameterClass="String" resultClass="EmpInfo"> 
		SELECT 
			QUIT_DATE as endDate,
			EMP_STATE_ID AS empState
		FROM 
			EMP_INFO
		WHERE 
			EMP_ID=#empId#
	</select>
	
	<!-- 职位类别名称取得 --> 
	<select id="getPosName" parameterClass="String" resultClass="String"> 
		SELECT 
			DIFF_NAME as posName
		FROM 
			SYS_CODE_MST
		WHERE 
			DIFF_NO = #diffNo#
			AND SUB_SYS='EMP'
			AND TYPE_ID='POS_TYPE'
	</select>
	
	<!-- 职位信息取得 --> 
	<select id="getPos" parameterClass="String" resultClass="EmpPos"> 
		SELECT 
			POS_SNAME as posSName,
			POS_TYPE_ID AS posTypeId
		FROM 
			EMP_POS
		WHERE 
			POS_ID=#posId#
	</select>

	<!-- 添加用户基本信息 --> 
	<insert id="insertComUserInfo" parameterClass="UserResult">
		INSERT INTO COM_USER
		   (
		    USER_ID, 
			PASSWORD,
			PASSWORD_VER,
			USER_STATE,
			UPDATE_TIME
		   )
		VALUES
		   (
		    #userId#, 
			#userPassword#,
			'1',
			'1',
			NOW()
		   );
	</insert>

	<!-- 员工ID校验 --> 
	<select id="getViewFromId" parameterClass="String" resultClass="empInfo"> 
		SELECT 
			T1.EMP_ID           as empId,
			T1.EMP_CPNM         as empCpnm,
			T1.EMP_CPSNM        as empCpsnm,
			T1.EMP_CNM          as empCnm,
			T1.EMP_JRNM         as empJrnm,
			T1.EMP_JKNM         as empJknm,
			T1.EMP_JNM          as empJnm,
			T1.EMP_SEX          as empSex,
			T1.EMP_DMNM         as empDmnm,
			T1.EMP_EMAIL_COMP   as empEmailComp,
			T1.EMP_EMAIL_PUB    as empEmailPub,
			T1.START_DATE       as startDate,
			T1.EMP_STATUS_ID    as empStatusId,
			T1.EMP_STATE_ID     as empState,
			T1.CHARGE_ORG_ID    as chargeOrgId,
			T1.QUIT_DATE        as endDate,
			T1.MAJOR            as major,
			T1.DEGREE           as degree,
			T1.GRADUATED        as graduated,
			T1.EMP_IMG_ID       as empImgId
		FROM 
			v_emp_list_quit T1
		WHERE 
			T1.EMP_ID = #empId#
	</select>
		
	<!-- 员工职位历史信息的删除 -->
	<delete id="deleteEmpPosHis" parameterClass="empPosHis">
		DELETE FROM
			EMP_POS_HIS
		WHERE
			EMP_ID = #empId# AND
			START_TIME = #startTime# AND
			POS_ID = #posId#
	</delete>

</sqlMap>