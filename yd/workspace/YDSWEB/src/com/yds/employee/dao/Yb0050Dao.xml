<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Yb0050Dao">
	<typeAlias alias="yb0050OrgMapInfo" type="com.yds.common.bean.OrgMapInfo"/>
	<!-- 取得组织信息 --> 
	<select id="getOrgMapInfoList" parameterClass="String" resultClass="yb0050OrgMapInfo">
		SELECT
			T1.ORG_ID    AS 'id',
			T1.ORG_NM    AS 'bufferName',
			T1.ORG_SNM   AS 'name',
			T1.ORG_LEV   AS 'orgLev',
			CONCAT('主管　',(SELECT EMP_CNM FROM EMP_INFO WHERE EMP_ID = T1.ORG_MNGER)) AS 'desc',
			T2.DISP_SEQ  AS 'dispSeq',
			T2.PRO1      AS 'pro1',
			T2.PRO2      AS 'pro2'
		FROM EMP_ORG_INFO T1
			INNER JOIN SYS_CODE_MST T2
				 ON T1.ORG_PRO_ID = T2.DIFF_NO
				 AND T2.SUB_SYS = 'EMP'
				 AND T2.TYPE_ID = 'ORG_TYPE'
				 AND T2.DEL_FLG = '0'
		WHERE 
		<isEmpty>
			<!-- 态别FLG为0（部门，公司，子公司） --> 
			T1.ORG_STATE_FLG = '0'
		</isEmpty>
		<isNotEmpty>
			<!--(T1.ORG_STATE_FLG = '0'
			 选择项目时，子项目排除  
			OR (T2.PRO1 = 'prjt' AND T2.PRO2 = '1')) AND -->
			T1.ORG_LEV LIKE CONCAT((SELECT TRIM(TRAILING '0' FROM org_lev) 
			FROM EMP_ORG_INFO WHERE ORG_ID = #orgId#),'%') 
		</isNotEmpty>
			<!-- 可见FLG为1（可见） --> 
			AND T1.ORG_VIEW_FLG = '1'
		ORDER BY T1.ORG_LEV
	</select>
	<!-- 取得下属组织的个数 --> 
	<select id="getSubCount" parameterClass="String" resultClass="Integer">
		SELECT
			count(*)
		FROM EMP_ORG_INFO T1
		WHERE 
			T1.ORG_LEV LIKE CONCAT((SELECT TRIM(TRAILING '0' FROM org_lev) 
			FROM EMP_ORG_INFO WHERE ORG_ID = #orgId#),'%') 
			<!-- 可见FLG为1（可见） --> 
			AND T1.ORG_VIEW_FLG = '1'
		ORDER BY T1.ORG_LEV
	</select>

</sqlMap> 

