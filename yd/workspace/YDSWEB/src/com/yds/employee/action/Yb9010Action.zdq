/*
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 人员管理
 */
package com.yds.employee.action;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;

import com.yds.base.action.AbstractBaseAction;
import com.yds.common.bean.ComCodeInfo;
import com.yds.common.bean.EmpInfo;
import com.yds.common.bean.EmpOrgInfo;
import com.yds.common.bean.EmpTeamInfo;
import com.yds.common.bean.TreeListInfo;
import com.yds.common.service.ComCodeInfoService;
import com.yds.common.service.EmpTeamInfoService;
import com.yds.common.service.PeoOrgInfoService;
import com.yds.common.service.PositionService;
import com.yds.common.service.SessionService;
import com.yds.employee.bean.Yb9010CondA;
import com.yds.employee.bean.Yb9010CondB;
import com.yds.employee.common.service.Yb9010Service;
import com.yds.util.service.ListConverter;

/**
 * 员工选择处理
 * 
 * @author tengchanglong
 * @version 1.00 2010/07/22
 */
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
@Controller("yb9010Action")
public class Yb9010Action extends AbstractBaseAction{
	
	private static final long serialVersionUID = -1751606036897579871L;
	
	/**员工选择service*/
	private Yb9010Service yb9010Service;
	
	/**部门项目service*/
	private PeoOrgInfoService peoOrgInfoService;
	
	/**职位service*/
	private PositionService positionService;

	/**员工一览检索条件Bean */
	private Yb9010CondA yb9010CondA;
	
	/**员工检索结果一览 */
	private List<EmpInfo> empInfoList;
	
	/** 部门信息一览 */
	private List<TreeListInfo> deptInfoList;
	
	/** 项目信息一览 */
	private List<EmpOrgInfo> proInfoList;
	
	/** 职位信息一览 */
	private List<TreeListInfo> positionList;
	
	/** 联动菜单 */
	private String selectList;
	
	/** 类别状态service */
	private ComCodeInfoService comCodeInfoService;
	
	/** 员工一览高级检索条件Bean */
	private Yb9010CondB yb9010CondB;
	
	/** 类别一览 */
	private List<ComCodeInfo> statusList;
	
	/** 状态一览 */
	private List<ComCodeInfo> stateList;
	
	/** 选择员工数 */
	private int empNum;
	
	/** 组service*/
	private EmpTeamInfoService empTeamInfoService;
	
	/** 下拉组 */
	private List<EmpTeamInfo> teamList;
	
	/** 人员选择模式 */
	private String mode;
	

	/**
	 * 主页面初期显示
	 * 
	 * @return SUCCESS
	 */
	public String initPage() throws Exception {
		
		//取得部门信息
		this.setDeptInfoList(peoOrgInfoService.getDeptCMBTree(""));
		
		//取得职位信息
		this.setPositionList(positionService.getPosTreeInfoList(""));
		
		// 取得组信息
		this.teamList= empTeamInfoService.getTeamList(SessionService.getLoginUserId(), "");

		return SUCCESS;
	}
	
	/**
	 * 主页面员工查询
	 * 
	 * @return SUCCESS
	 */
	public String findEmp() throws Exception {
		
		// 设置用户ID
		yb9010CondA.setUserId(SessionService.getLoginUserId());
		
		//取得员工一览
		this.setEmpInfoList(yb9010Service.getEmpInfoList(yb9010CondA));
		
		return SUCCESS;
	}
	
	/**
	 * 取得部门列表
	 * 
	 * @return SUCCESS
	 */
	public String findDeptIdList() throws Exception {
		
		// 取得部门列表		
		this.setDeptInfoList(peoOrgInfoService.getDeptCMBTree(""));
		// List转化
		String list =ListConverter.convert(deptInfoList,"categoryKey", "categoryValue");
		this.setSelectList(list);
		return SUCCESS;
	}
	
	/**
	 * 取得项目列表
	 * 
	 * @return SUCCESS
	 */
	public String findProIdList() throws Exception {
		
		// 取得项目列表		
		this.setProInfoList(peoOrgInfoService.getPrjtList(yb9010CondA.getDeptId(),""));
		// List转化
		String list =ListConverter.convert(proInfoList,"orgId", "orgSnm");
		this.setSelectList(list);
		return SUCCESS;
	}
	
	/**
	 * 高级查询画面的初期显示
	 * 
	 * @return SUCCESS
	 */
	public String initAdvPage() throws Exception {

		// 取得类别信息
		this.statusList = comCodeInfoService.getComCodeInfo("EMP", "STATUS");
		
		// 取得组信息
		this.teamList= empTeamInfoService.getTeamList(SessionService.getLoginUserId(), "");

		// 取得状态信息
		List<ComCodeInfo> tempStateList =  new ArrayList<ComCodeInfo>() ;
		tempStateList.addAll(comCodeInfoService.getComCodeInfo("EMP", "STATE"));
		
		if("1".equals(mode)){
			for(int i = 1;i<tempStateList.size();i++){
				if("0".equals(tempStateList.get(i).getPro2())){
					tempStateList.remove(i);
					i--;
				}
			}
			if("0".equals(tempStateList.get(0).getPro2())){
				tempStateList.remove(0);
			}			
		}

		this.stateList = tempStateList;


		return SUCCESS;

	}
	
	/**
	 * 高级查询画面取得员工一览列表
	 * 
	 * @return SUCCESS
	 */
	public String findEmpInfoResultList() throws Exception {
		
		// 设置用户ID
		yb9010CondB.setUserId(SessionService.getLoginUserId());
		
		// 取得员工列表一览
		this.empInfoList= yb9010Service.getEmpInfoListAdv(yb9010CondB);
				
		return SUCCESS;
	}
	
	/**
	 * 高级查询画面入社期间校验
	 */
	public void validatefindEmpInfoResultList() {
		
		// 开始时间与结束时间入力判断					
		if (0 < yb9010CondB.getStartYearFrom().compareTo(
				yb9010CondB.getStartYearTo())) {

			this.addFieldError("yb9010CondB.startYearFrom", propMgr.getMessage("yds.com.warning.0006"));
			this.addFieldError("yb9010CondB.startYearTo", propMgr.getMessage("yds.com.warning.0006"));
		}
		
	}
	
	/**
	 * @return the positionList
	 */
	public List<TreeListInfo> getPositionList() {
		return positionList;
	}

	/**
	 * @param positionList the positionList to set
	 */
	public void setPositionList(List<TreeListInfo> positionList) {
		this.positionList = positionList;
	}

	/**
	 * @return the deptInfoList
	 */
	public List<TreeListInfo> getDeptInfoList() {
		return deptInfoList;
	}

	/**
	 * @param deptInfoList the deptInfoList to set
	 */
	public void setDeptInfoList(List<TreeListInfo> deptInfoList) {
		this.deptInfoList = deptInfoList;
	}

	/**
	 * @param peoOrgInfoService the peoOrgInfoService to set
	 */
	public void setPeoOrgInfoService(PeoOrgInfoService peoOrgInfoService) {
		this.peoOrgInfoService = peoOrgInfoService;
	}

	/**
	 * @return the yb9010CondA
	 */
	public Yb9010CondA getYb9010CondA() {
		return yb9010CondA;
	}

	/**
	 * @param yb9010CondA the yb9010CondA to set
	 */
	public void setYb9010CondA(Yb9010CondA yb9010CondA) {
		this.yb9010CondA = yb9010CondA;
	}

	public void setEmpInfoList(List<EmpInfo> empInfoList) {
		this.empInfoList = empInfoList;
	}

	public List<EmpInfo> getEmpInfoList() {
		return empInfoList;
	}
	/**
	 * @param yb9010Service the yb9010Service to set
	 */
	public void setYb9010Service(Yb9010Service yb9010Service) {
		this.yb9010Service = yb9010Service;
	}
	
	/**
	 * @param positionService the positionService to set
	 */
	public void setPositionService(PositionService positionService) {
		this.positionService = positionService;
	}

	/**
	 * @return the proInfoList
	 */
	public List<EmpOrgInfo> getProInfoList() {
		return proInfoList;
	}

	/**
	 * @param proInfoList the proInfoList to set
	 */
	public void setProInfoList(List<EmpOrgInfo> proInfoList) {
		this.proInfoList = proInfoList;
	}

	/**
	 * @return the selectList
	 */
	public String getSelectList() {
		return selectList;
	}

	/**
	 * @param selectList the selectList to set
	 */
	public void setSelectList(String selectList) {
		this.selectList = selectList;
	}

	/**
	 * @return the yb9010CondB
	 */
	public Yb9010CondB getYb9010CondB() {
		return yb9010CondB;
	}

	/**
	 * @param yb9010CondB the yb9010CondB to set
	 */
	public void setYb9010CondB(Yb9010CondB yb9010CondB) {
		this.yb9010CondB = yb9010CondB;
	}

	/**
	 * @return the statusList
	 */
	public List<ComCodeInfo> getStatusList() {
		return statusList;
	}

	/**
	 * @param statusList the statusList to set
	 */
	public void setStatusList(List<ComCodeInfo> statusList) {
		this.statusList = statusList;
	}

	/**
	 * @return the stateList
	 */
	public List<ComCodeInfo> getStateList() {
		return stateList;
	}

	/**
	 * @param stateList the stateList to set
	 */
	public void setStateList(List<ComCodeInfo> stateList) {
		this.stateList = stateList;
	}

	/**
	 * @param comCodeInfoService the comCodeInfoService to set
	 */
	public void setComCodeInfoService(ComCodeInfoService comCodeInfoService) {
		this.comCodeInfoService = comCodeInfoService;
	}

	/**
	 * @return the empNum
	 */
	public int getEmpNum() {
		return empNum;
	}

	/**
	 * @param empNum the empNum to set
	 */
	public void setEmpNum(int empNum) {
		this.empNum = empNum;
	}



	public void setEmpTeamInfoService(EmpTeamInfoService empTeamInfoService) {
		this.empTeamInfoService = empTeamInfoService;
	}

	public List<EmpTeamInfo> getTeamList() {
		return teamList;
	}

	public void setTeamList(List<EmpTeamInfo> teamList) {
		this.teamList = teamList;
	}

	public String getMode() {
		return mode;
	}

	public void setMode(String mode) {
		this.mode = mode;
	}
	
}
