<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Yc0040Dao">
    <typeAlias alias="metDaymetInfo" type="com.yds.meet.bean.MetDaymetInfo"/>
    <typeAlias alias="yc0040CondA" type="com.yds.meet.bean.Yc0040CondA"/>    
	<!-- 用于SQL查询公用抽取语句 -->	
	<sql id="Yc0040CondASQL">    
        FROM
 			MET_DAYMET_INFO T1
		WHERE
		    T1.MET_ID   =  #metId#	   
		<isNotEmpty prepend="AND" property="startDate">			
			T1.MET_DATE >= #startDate#  
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">		
		<![CDATA[
			T1.MET_DATE <= #endDate#   
		]]>
		</isNotEmpty>
		ORDER BY T1.MET_DATE DESC,
				 T1.MET_STA_TIME DESC		
	</sql>			
	<!-- 取得会议室信息 --> 
    <select id="getMetDaymetInfoList" parameterClass="yc0040CondA" resultClass="metDaymetInfo"> 
        SELECT
			T1.MET_ID           as metId,
			T1.MET_DATE         as metDate,
			T1.MET_STA_TIME     as metStaTime,
			T1.MET_END_TIME     as metEndTime,
			T1.MET_TOPIC        as metTopic,
			T1.APPLY_USER_ID    as applyUserId,
			T1.JOIN_USER_CNT    as joinUserCnt,
			T1.PUBLIC_FLG       as publicFlg,
			(SELECT EMP_CNM  FROM  v_emp_list_quit  WHERE  EMP_ID = T1.APPLY_USER_ID)
								as applyUserNm,
			(SELECT COUNT(T2.JOIN_USER_ID) FROM MET_DAYMET_USER T2 WHERE  T1.MET_ID = T2.MET_ID
																      AND T1.MET_DATE = T2.MET_DATE
																      AND T1.MET_STA_TIME = T2.MET_STA_TIME
																	  AND T2.JOIN_USER_ID = #loginUserId#)
					         AS permitFlg					
		<include refid="Yc0040CondASQL"/>
    </select>
	
   <!-- 取得会议室信息 --> 
   <select id="getMetRoomInfo" parameterClass= "Integer"  resultClass="String"> 
        SELECT
			T2.MET_NM            as  metNm
        FROM
			MET_ROOM_INFO T2
		WHERE
		    T2.MET_ID   =  #metId#
    </select>	
    <!-- 取得会议室信息总数 --> 
    <select id="getTotalCount" parameterClass="yc0040CondA" resultClass="Long"> 
        SELECT
			COUNT(*) 
		<include refid="Yc0040CondASQL"/>
    </select>
</sqlMap>  
