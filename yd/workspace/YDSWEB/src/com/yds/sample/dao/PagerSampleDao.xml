<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="PagerSampleDao">
	<typeAlias alias="departmentInfo" type="com.yds.sample.bean.DepartmentInfo"/>
	
	<!-- 部门信息一览取得 --> 
	<select id="getPagerInfos" parameterClass="departmentInfo" resultClass="departmentInfo"> 
	<![CDATA[	
		SELECT
		  T1.DEPT_ID AS deptId,
		  T1.DEPT_NM AS deptNm,
		  T1.DEPT_SNM AS deptSnm,
		  T1.PARENT_DEPT_ID AS parentDeptId,
		  T3.DEPT_NM AS parentDeptNm,
		  T1.DEPT_DESC AS deptDesc,
		  T1.LEADER_ID AS leaderId,
		  T2.EMP_CNM AS leaderNm,
		  T1.UPDATETIME AS updateTime
		FROM SMP_DEPARTMENT T1
		  LEFT JOIN V_EMP_LIST_QUIT T2
				 ON T1.LEADER_ID=T2.EMP_ID
		  LEFT JOIN SMP_DEPARTMENT T3
				 ON T1.PARENT_DEPT_ID=T3.DEPT_ID
		WHERE T1.DEPT_ID  <= #deptId#
		  AND T1.DEPT_NM  like CONCAT('%' ,#deptNm#,'%')
		  AND T1.DEPT_SNM like CONCAT('%' ,#deptSnm#,'%')
		ORDER BY T1.DEPT_ID
	]]>
	</select>
	<!-- 部门信息总数 --> 
	<select id="getTotalCount" parameterClass="departmentInfo" resultClass="Long"> 
		<![CDATA[
			SELECT
			COUNT(*) 
			FROM SMP_DEPARTMENT T1
			  LEFT JOIN V_EMP_LIST_QUIT T2
					 ON T1.LEADER_ID=T2.EMP_ID
			  LEFT JOIN SMP_DEPARTMENT T3
					 ON T1.PARENT_DEPT_ID=T3.DEPT_ID
		WHERE T1.DEPT_ID  <= #deptId#
		  AND T1.DEPT_NM  like CONCAT('%' ,#deptNm#,'%')
		  AND T1.DEPT_SNM like CONCAT('%' ,#deptSnm#,'%')		 
		 ]]>
	</select>

	
</sqlMap>  
