/*
 * @(#)BatchSocketAccpeter.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 批处理系统
 */

package com.yds.batch.service.impl;

import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.yds.batch.service.BatchServiceCtrl;

/**
 * socket连接接收
 * 
 * @author wangduo
 * @version 1.00 2010/05/28
 */
public class BatchSocketAccpeter implements Runnable {
	
	static final Log LOG = LogFactory.getLog(BatchSocketAccpeter.class);
	
	/** 服务Socket. */
	ServerSocket serversocket;
	
	/** 批处理服务启动类. */
	BatchServiceCtrl batchServiceCtrl;

	/** 服务停止标识. */
	boolean stopFlg = false;
	
	public BatchSocketAccpeter(ServerSocket serversocket, BatchServiceCtrl batchServiceCtrl) {
		this.serversocket = serversocket;
		this.batchServiceCtrl = batchServiceCtrl;
	}

	@Override
	public void run() {

		Socket socket = null;
		
		while (!stopFlg) {

			// 监听socket连接
			try {
				socket = serversocket.accept();
			} catch (IOException e) {
				
				LOG.error("", e);
			}

			// 启动一个线程处理socket连接
			new Thread(new BatchSocketAccpetProcessor(socket, batchServiceCtrl)).start();
			
		}

	}
	
	/**
	 * 停止接收socket连接
	 */
	public void stopAccept() {
		
		stopFlg = true;
		
		if (serversocket != null) {
			
			try {
				serversocket.close();
				
			} catch (IOException e) {
				
				LOG.error("", e);
			}
		}
	}

}
