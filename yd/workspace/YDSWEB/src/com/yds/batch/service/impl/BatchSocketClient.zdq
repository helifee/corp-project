/*
 * @(#)BatchSocketClient.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 批处理系统
 */

package com.yds.batch.service.impl;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.InetAddress;
import java.net.Socket;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.yds.batch.service.BatchConstants;

/**
 * 通过socket连接通知停止批处理服务
 * 
 * @author wangduo
 * @version 1.0 2010/05/19
 */
public class BatchSocketClient {

	private static final Log LOG = LogFactory.getLog(BatchSocketClient.class);
	
	/**
	 * 通知停止批处理服务
	 */
	public void notifyShutdown(int port) {
		
		Socket socket = null;
		PrintWriter printWriter = null;
		BufferedReader reader = null;
		
		try {
			
			// 连接本地端口
			socket = new Socket(InetAddress.getLocalHost(), port);
			
			// 创建输出流
			printWriter = new PrintWriter(socket.getOutputStream());
			
			reader = new BufferedReader(new InputStreamReader(socket.getInputStream()));
			
			// 发送命令字符串
			printWriter.println(BatchConstants.SERVER_SHUTDOWN);
			printWriter.flush();
			
			LOG.info(reader.readLine());

		} catch (Throwable t) {
			LOG.error("", t);
		} finally {
			
			try {
				
				if (printWriter != null) {
					printWriter.close();
				}
				
				if (reader != null) {
					reader.close();
				}
				
				if (socket != null) {	
					socket.close();
				}
				
			} catch (IOException e) {
				LOG.error("", e);
			}
			
		}

	}

	public static void main(String[] args) {

		// 通过socket连接通知终止服务
		new BatchSocketClient().notifyShutdown(BatchConstants.SERVER_PORT);
	}
	
}
