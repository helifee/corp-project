<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BatchJobDao">
	
	<typeAlias alias="batchGroup" type="com.yds.batch.bean.BatchGroup"/>
	<typeAlias alias="batchJob" type="com.yds.batch.bean.BatchJob"/>
	
	<!-- 获取任务列表 --> 
	<select id="getGroupJobs" parameterClass="String" resultClass="batchJob"> 
		SELECT
			A.GROUP_ID AS groupId,
			A.JOB_SEQ AS jobSeq,
			A.JOB_ID AS jobId,
			B.JOB_NAME AS jobName,
			B.JOB_CLASS AS jobClass,
			B.JOB_COMMONT AS jobCommont,
			B.SYS_AFFECT_FLG AS sysAffectFlg,
			B.RETRY_FLG AS retryFlg,
			A.RETRY_CNT AS retryCnt,
			A.RETRY_INTERVAL AS retryInterval
		FROM BAT_GROUP_JOBS A, 
			BAT_JOB B
		WHERE A.GROUP_ID = #groupId#
			AND A.JOB_ID = B.JOB_ID
			<!-- 有效 --> 
			AND VALID_FLG = '1'
		ORDER BY A.JOB_SEQ
	</select>

	<!-- 插入任务执行历史 --> 
	<insert id="insertExecHis" parameterClass="batchJob">
		INSERT INTO BAT_JOB_HIS 
			(
			GROUP_ID,
			JOB_SEQ,
			GROUP_EXEC_CNT,
			JOB_ID,
			EXEC_STATUS,
			EXEC_START_DT, 
			EXEC_END_DT
			)
		VALUES
			(
			#groupId#,
			#jobSeq#,
			#groupExecCnt#, 
			#jobId#,
			#execStatus#,
			#execStartDt#,
			#execEndDt#
			);
	</insert>

</sqlMap>
