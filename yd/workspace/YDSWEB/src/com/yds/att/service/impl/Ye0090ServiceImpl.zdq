/*
 * @(#)Ye0090ServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 考勤系统
 */
package com.yds.att.service.impl;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;
import java.util.Map.Entry;

import org.springframework.stereotype.Service;

import com.yds.att.bean.AttInfoUncor;
import com.yds.att.bean.AttMonReport;
import com.yds.att.bean.Ye0090AttInfoUncor;
import com.yds.att.bean.Ye0090Overtime;
import com.yds.att.dao.Ye0090Dao;
import com.yds.att.service.Ye0090Service;
import com.yds.base.service.AbstractBaseService;


/**
 * @see com.yds.att.service.Ye0090Service
 */
@Service("ye0090Service")
public class Ye0090ServiceImpl extends AbstractBaseService implements
		Ye0090Service {
	
	private Ye0090Dao ye0090Dao;

	@Override
	public List<AttMonReport> getAttMonReport(String yearMonth) {
		String year = yearMonth.substring(0,4);
		String month = yearMonth.substring(5);
		return this.ye0090Dao.getAttMonReport(year, month);
	}

	@Override
	public List<Ye0090Overtime> getOvertimeReport(String yearMonth) {
		String year = yearMonth.substring(0,4);
		String month = yearMonth.substring(5);
		return this.ye0090Dao.getOvertimeReport(year, month);
	}
	
	@Override
	public List<Ye0090AttInfoUncor> getAttInfoUncor(String yearMonth) {
		
		yearMonth = yearMonth.substring(0, 4) + yearMonth.substring(5);
		
		List<AttInfoUncor> list = this.ye0090Dao.getAttInfoUncor(yearMonth);
		
		List<Ye0090AttInfoUncor> ret = new ArrayList<Ye0090AttInfoUncor>();

		Map<String, List<AttInfoUncor>> map = new TreeMap<String, List<AttInfoUncor>>();
		Iterator<AttInfoUncor> iter = list.iterator();
		while(iter.hasNext()) {
			AttInfoUncor info = iter.next();
			List<AttInfoUncor> tmp = map.get(info.getAttPerId());
			if(null == tmp) {
				tmp = new ArrayList<AttInfoUncor>();
				tmp.add(info);
				map.put(info.getAttPerId(), tmp);
			} else {
				tmp.add(info);
				
			}
		}
		
		Iterator<Entry<String, List<AttInfoUncor>>> it = map.entrySet().iterator();
		while(it.hasNext()) {
			Map.Entry<String, List<AttInfoUncor>> entry = it.next();
			String empId = entry.getKey();
			List<AttInfoUncor> infoList = entry.getValue();
			Ye0090AttInfoUncor ye0090AttInfoUncor = new Ye0090AttInfoUncor();
			ye0090AttInfoUncor.setAttPerId(empId);
			ye0090AttInfoUncor.setAttperName(infoList.get(0).getAttperName());
			ye0090AttInfoUncor.setAttYm(infoList.get(0).getAttYm());
			for(int i=0; i<infoList.size(); i++) {
				
				if("0".equals(infoList.get(i).getUncorType())) {
					ye0090AttInfoUncor.setCnt1(infoList.get(i).getCnt1());
				}
				if("1".equals(infoList.get(i).getUncorType())) {
					ye0090AttInfoUncor.setCnt2(infoList.get(i).getCnt1());
				} 
				if("2".equals(infoList.get(i).getUncorType())) {
					ye0090AttInfoUncor.setCnt3(infoList.get(i).getCnt1());
				} 
				if("3".equals(infoList.get(i).getUncorType())) {
					ye0090AttInfoUncor.setCnt4(infoList.get(i).getCnt1());
				}
			}
			ret.add(ye0090AttInfoUncor);
		}
		
		return ret;
	}

	public void setYe0090Dao(Ye0090Dao ye0090Dao) {
		this.ye0090Dao = ye0090Dao;
	}
}
