<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ActiveDeskDao">
	<typeAlias alias="activeDeskInfo" type="com.yds.gadget.bean.ActiveDeskInfo"/>
	<typeAlias alias="gadgetInfo" type="com.yds.gadget.bean.GadgetInfo"/>
	
	<!-- 获取用户桌面设置列表 --> 
	<select id="getActiveDeskInfoList" resultClass="activeDeskInfo" parameterClass="String">
	<![CDATA[
		SELECT
			  USER_ID          AS    USERID,
			  GADGET_ID        AS    GADGETID,
			  LOCATION_COL     AS    LOCATIONCOL,
			  LOCATION_ROW     AS    LOCATIONROW,
			  MODE_FLG         AS    MODEFLG,
			  UPDATE_TIME      AS    UPDATETIME
		FROM  COM_DESK_CONF
		WHERE USER_ID = #userId#
		ORDER BY LOCATION_ROW
	]]>
	</select>
	
	<!-- 取得组件信息 --> 
	<select id="getGadgetInfo" resultClass="gadgetInfo" parameterClass="Integer">
	<![CDATA[
		SELECT
			  GADGET_ID         AS       GADGETID,
			  GADGET_NM         AS       GADGETNM,
			  GADGET_DESC       AS       GADGETDESC,
			  GADGET_TYPE       AS       GADGETTYPE,
			  GADGET_URL        AS       GADGETURL,
			  SUB_SYS           AS       SUBSYS,
			  PRE_IMG           AS       PREIMG,
			  DEF_POS           AS       DEFPOS,
			  FOLD_FLG          AS       FOLDFLG,
			  REFRESH_FLG       AS       REFRESHFLG,
			  CLOSE_FLG         AS       CLOSEFLG,
			  AUTHOR            AS       AUTHOR,
			  VER               AS       VER,
			  CREATE_TIME       AS       CREATETIME,
			  POS_STATE         AS       POSSTATE,
			  UPDATE_TIME       AS       UPDATETIME
	      FROM
			    COM_GADGET
	     WHERE  GADGET_ID = #gedgetId#
	       AND  POS_STATE = '1'

	]]>
	</select>
	
	<!-- 更新用户桌面信息 -->
	<update id="updateDeskInfo" parameterClass="activeDeskInfo">
		UPDATE COM_DESK_CONF
		   SET 
			   MODE_FLG =#modeFlg#,
			   <isNotEqual property="locationCol" compareValue="-1">
			   LOCATION_COL =#locationCol#,
			   LOCATION_ROW =#locationRow#,
			   </isNotEqual>
			   UPDATE_TIME = NOW()
		 WHERE USER_ID   = #userId#
           AND GADGET_ID = #gadgetId#		
	</update>

	<!-- 删除用户组件-->
	<delete id="deleteGadget" parameterClass="activeDeskInfo">
		DELETE FROM COM_DESK_CONF
			  WHERE USER_ID   = #userId#
				AND GADGET_ID = #gadgetId# 
	</delete>

	<!-- 删除全部组件-->
	<delete id="deleteAll" parameterClass="String">
		DELETE FROM COM_DESK_CONF
			  WHERE USER_ID   = #userId#
	</delete>
	
	<!-- 取得默认组件列表 -->
	<select id="getDefGadget" resultClass="gadgetInfo">
	<![CDATA[
		SELECT
			  GADGET_ID         AS       GADGETID,
			  GADGET_NM         AS       GADGETNM,
			  GADGET_DESC       AS       GADGETDESC,
			  GADGET_TYPE       AS       GADGETTYPE,
			  GADGET_URL        AS       GADGETURL,
			  SUB_SYS           AS       SUBSYS,
			  PRE_IMG           AS       PREIMG,
			  DEF_POS           AS       DEFPOS,
			  FOLD_FLG          AS       FOLDFLG,
			  REFRESH_FLG       AS       REFRESHFLG,
			  CLOSE_FLG         AS       CLOSEFLG,
			  AUTHOR            AS       AUTHOR,
			  VER               AS       VER,
			  CREATE_TIME       AS       CREATETIME,
			  POS_STATE         AS       POSSTATE,
			  UPDATE_TIME       AS       UPDATETIME
	   FROM
			  COM_GADGET
	   WHERE  DEF_POS <> ''
	     AND  POS_STATE ='1'
	   ORDER  BY DEF_POS

	]]>
	</select>
</sqlMap>  
