/*
 * @(#)J030071ServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 考试教育系统
 *    SubSystem: 教育子系统
 */
package com.yds.tt.training.service.impl;

import java.util.List;

import org.springframework.stereotype.Service;

import com.yds.base.service.AbstractBaseService;
import com.yds.tt.manager.service.TtCommonUtil;
import com.yds.tt.training.bean.BookContent;
import com.yds.tt.training.bean.Bookmark;
import com.yds.tt.training.dao.J030071Dao;
import com.yds.tt.training.service.J030071Service;
import com.yds.tt.training.dao.TrainingCommonDao;;

/**
 * @see com.yds.tt.training.service.J030071Service
 */
@Service("j030071Service")
public class J030071ServiceImpl extends AbstractBaseService implements
		J030071Service {
	private J030071Dao j030071Dao;
	private TrainingCommonDao trainingCommonDao;

	public void setJ030071Dao(J030071Dao j030071Dao) {
		this.j030071Dao = j030071Dao;
	}

	public void setTrainingCommonDao(TrainingCommonDao trainingCommonDao) {
		this.trainingCommonDao = trainingCommonDao;
	}
	/**
	 * {@inheritDoc}
	 */
	@Override
	public Integer getEditNo(String bookId) {
		return j030071Dao.getEditNo(bookId);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public String getBookName(BookContent bookContent) {
		return j030071Dao.getBookName(bookContent);
	}
	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<BookContent> getMenuList(BookContent chapterContent) {
		return j030071Dao.getMenuList(chapterContent);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public BookContent getContentByChapter(BookContent chapterContent) {
		return j030071Dao.getContentByChapter(chapterContent);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public BookContent getContentByOrder(BookContent chapterContent) {
		return j030071Dao.getContentByOrder(chapterContent);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public boolean updateEditBookmark(Bookmark bookmark) {
		if(isExistBookmark(bookmark)){
			if(0 == j030071Dao.updateBookmark(bookmark)){
				return false;
			}
		}else {
			j030071Dao.insetBookmark(bookmark);
		}
		return true;
	}

	/**
	 *  书签表是否存在
	 */
	private boolean isExistBookmark(Bookmark bookmark){
		return (null != j030071Dao.getBookmark(bookmark));
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public Integer getChapterNo(String bookId, Integer editNo){
		// 章节编号取得
		Bookmark bookMark = new Bookmark();
		bookMark.setBookId(bookId);
		bookMark.setEmployeesId(TtCommonUtil.getLoginUserId());
		bookMark.setEditNo(editNo);
		Object objChapterNo = this.trainingCommonDao.getChapterNo(bookMark);
		if (null == objChapterNo) {
			//书签为空的情况下，取得教材的章节号
			Object bookChapterNo = this.trainingCommonDao.getBookChapterNo(bookMark);
			return (Integer)bookChapterNo;	
		} else {
			return (Integer)objChapterNo;				
		}
	}
}
