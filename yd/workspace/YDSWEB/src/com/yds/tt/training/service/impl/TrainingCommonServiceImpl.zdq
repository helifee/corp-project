/*
 * @(#)TrainingCommonServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 教育考试培训系统
 *    SubSystem: 教育子系统
 */

package com.yds.tt.training.service.impl;

import java.util.List;

import org.springframework.stereotype.Service;

import com.yds.base.service.AbstractBaseService;
import com.yds.common.bean.UserInfo;
import com.yds.tt.manager.service.TtCommonUtil;
import com.yds.tt.training.bean.CourseAttentionInfo;
import com.yds.tt.training.dao.TrainingCommonDao;
import com.yds.tt.training.service.TrainingCommonService;

/**
 * @see TrainingCommonService
 */
@Service("trainingCommonService")
public class TrainingCommonServiceImpl extends AbstractBaseService implements TrainingCommonService {

	private TrainingCommonDao trainingCommonDao;

	/**
	 * {@inheritDoc}
	 */	
	@Override
	public String[] getUserList(String courseId) {
		
		List<UserInfo> userInfoList =  trainingCommonDao.getUserList(courseId);
		String[] resultUserInfoList = new String[2];
		
		StringBuffer resultUserId = new StringBuffer();
		StringBuffer resultUserName = new StringBuffer();
		
		// 如果针对对象人员为空
		resultUserId.append("");
		resultUserName.append("");
		for(int i=0;i<userInfoList.size();i++){
			resultUserId.append(userInfoList.get(i).getUserId());
			resultUserName.append(userInfoList.get(i).getUserName());
			if(i != (userInfoList.size()-1)){
				resultUserId.append(",");
				resultUserName.append(",");
			}
		}
		resultUserInfoList[0]=resultUserId.toString();
		resultUserInfoList[1]=resultUserName.toString();
		
		return resultUserInfoList;
	}

	/**
	 * {@inheritDoc}
	 */
	@Override	
	public Long getBookViewPermission(String bookId) {
		
		// 教材所属课程ID一览取得
		List<String> courseIdList = trainingCommonDao.getCourseIdByBookId(bookId);

		// 从session中得到登录者
		String userId = TtCommonUtil.getLoginUserId();		
		
		CourseAttentionInfo courseAttention = null;
		Long retCnt = Long.valueOf(0);
		for (int i = 0; i < courseIdList.size(); i ++) {
			
			// 设置课程ID,员工ID
			courseAttention = new CourseAttentionInfo();
			courseAttention.setCourseId(courseIdList.get(i));
			courseAttention.setEmployeesId(userId);
			retCnt = retCnt + this.trainingCommonDao.getViewPermission(courseAttention);
		}
		return retCnt;
	}
	
	/**
	 * @param trainingCommonDao the trainingCommonDao to set
	 */
	public void setTrainingCommonDao(TrainingCommonDao trainingCommonDao) {
		this.trainingCommonDao = trainingCommonDao;
	}


	/**
	 * @return the trainingCommonDao
	 */
	public TrainingCommonDao getTrainingCommonDao() {
		return trainingCommonDao;
	}


}
