/*
 * @(#) J030121ServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 教育考试培训系统
 *    SubSystem: 教育
 */
package com.yds.tt.training.service.impl;

import java.util.List;

import org.springframework.stereotype.Service;

import com.yds.base.service.AbstractBaseService;
import com.yds.tt.manager.service.TtCommonService;
import com.yds.tt.manager.service.TtCommonUtil;
import com.yds.tt.manager.service.TtConstants;
import com.yds.tt.testing.bean.TestPaperInfo;
import com.yds.tt.training.bean.BookInfo;
import com.yds.tt.training.dao.J030121Dao;
import com.yds.tt.training.service.J030121Service;

/**
 * @see com.yds.tt.training.service.J030121Service
 */
@Service("j030121Service")
public class J030121ServiceImpl extends AbstractBaseService implements
		J030121Service {

	private J030121Dao j030121Dao;
	private TtCommonService ttCommonService;
	
	

	/**
	 * {@inheritDoc}
	 */
	@Override
	public Integer getBookInfo(String bookId, Integer editNo) {

		BookInfo bookInfo = new BookInfo();
		bookInfo.setBookId(bookId);
		bookInfo.setEditNo(editNo);
		return j030121Dao.getBookInfo(bookInfo);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<TestPaperInfo> getTestPaperInfos(String bookId) {

		return j030121Dao.getTestPaperInfos(bookId);
		
	}

	/**
	 * {@inheritDoc}
	 * 
	 * @throws Exception
	 */
	@Override
	public void insertNewTest(String bookId, Integer editNo) throws Exception {

		//取得教材分类
		BookInfo bookInfo = new BookInfo();
		bookInfo.setBookId(bookId);
		bookInfo.setEditNo(editNo);
		BookInfo bookCategory = j030121Dao.getBookCategory(bookInfo);
	    
		//取得试卷ID序列号
		String strPaperId = ttCommonService.getSequence(TtConstants.SEQID.Paper);
		
	    //更新试卷表
	    TestPaperInfo testPaperInfo = new TestPaperInfo();
	    testPaperInfo.setPaperId(strPaperId);
	    testPaperInfo.setCategory1Id(bookCategory.getCategory1Id());
	    testPaperInfo.setCategory2Id(bookCategory.getCategory2Id());
	    testPaperInfo.setCategory3Id(bookCategory.getCategory3Id());
	    testPaperInfo.setBelongId(bookId);
	    testPaperInfo.setCreateUserId(TtCommonUtil.getLoginUserId());
	    testPaperInfo.setUpdateUserId(TtCommonUtil.getLoginUserId());
	    
		this.j030121Dao.insertTestPaperInfo(testPaperInfo);
	    
	}

	/**
	 * {@inheritDoc}
	 * 
	 * @throws Exception
	 */
	@Override
	public void deleteTest(String paperId,Integer paperVersionNo) throws Exception {

		TestPaperInfo testPaperInfo = new TestPaperInfo();
		testPaperInfo.setPaperId(paperId);
		testPaperInfo.setPaperVersionNo(paperVersionNo);

		j030121Dao.deleteTest(testPaperInfo);
	}

	/**
	 * @return the j030121Dao
	 */
	public J030121Dao getJ030121Dao() {
		return j030121Dao;
	}

	/**
	 * @param dao the j030121Dao to set
	 */
	public void setJ030121Dao(J030121Dao dao) {
		j030121Dao = dao;
	}

	/**
	 * @return the ttCommonService
	 */
	public TtCommonService getTtCommonService() {
		return ttCommonService;
	}

	/**
	 * @param ttCommonService the ttCommonService to set
	 */
	public void setTtCommonService(TtCommonService ttCommonService) {
		this.ttCommonService = ttCommonService;
	}
}
