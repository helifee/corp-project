/*
 * @(#)C100021ServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 教育考试培训系统
 *    SubSystem: 共通子系统
 */
package com.yds.tt.manager.service.impl;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.stereotype.Service;

import com.yds.base.service.AbstractBaseService;
import com.yds.tt.manager.bean.KeywordInfo;
import com.yds.tt.manager.dao.C100021Dao;
import com.yds.tt.manager.service.C100021Service;

/**
 * @see com.yds.tt.manager.service.C100021Service
 */
@Service("c100021Service")
public class C100021ServiceImpl extends AbstractBaseService implements C100021Service {
    private C100021Dao c100021Dao;
    
	/**
	 * {@inheritDoc}
	 */
	@Override
	public Map<String, List<KeywordInfo>> getKeywordList(String keyStrOld, int gateGroupId) {
	    
	    // 数据库取出来的关键字
		List<KeywordInfo> ttKeyInfoList = this.c100021Dao.getTtKeyInfoList(gateGroupId);
       
	    // 分离字符串
        String[] strSplit = keyStrOld.split(" ");
	    
        // 用户输入与数据库中不同的关键字
	    List<KeywordInfo> keyInfoList = new ArrayList<KeywordInfo>();
	    
	    // 创建hash对象
        HashMap<String, String> hashMap = new HashMap<String, String>();
        
        // 分离字符串放入Map中
        for (int i = 0; i < strSplit.length; i++) {
            String temp = strSplit[i].trim();
            
            // 取出来的关键字为空
            if (!"".equals(temp)) {
            	hashMap.put(temp, temp);
            }
        }
        for (KeywordInfo keywordInfo : ttKeyInfoList) {
            String temp = keywordInfo.getKeywordName();
        	if (hashMap.get(temp) == null) {
        		
        		// 设置不选中的标识
        		keywordInfo.setFlag(0);
            }  else {
            	
            	// 设置选中的标识
            	keywordInfo.setFlag(1);
            	
            	// 去掉相同的关键字
            	hashMap.remove(temp);
            }
        }
        
        // 取出Map中的key
        Object[] keywordName = hashMap.keySet().toArray();
        
        // 按key进行排序
        Arrays.sort(keywordName);
        for (int i = 0; i < keywordName.length; i++) {
			KeywordInfo ttKeyInfo = new KeywordInfo();
			
			// 设置分类ID
			ttKeyInfo.setGateGroupId(gateGroupId);
			
			// 设置关键字名称
			ttKeyInfo.setKeywordName(hashMap.get(keywordName[i].toString()));
			keyInfoList.add(ttKeyInfo);
        }
        
        // 创建空映射
		Map<String, List<KeywordInfo>> listKeywordMap = new HashMap<String, List<KeywordInfo>>();
		
		// 数据库中的关键字
		listKeywordMap.put("ttKeyInfoList", ttKeyInfoList);
		
		// 用户输入与数据库不同的关键字
		listKeywordMap.put("keyInfoList", keyInfoList);

		return listKeywordMap;
	}

	/**
	 * {@inheritDoc}
	 */
	public List<KeywordInfo> getTtKeyInfoList(int gateGroupId) {
		return this.c100021Dao.getTtKeyInfoList(gateGroupId);
	}

	/**
	 * @param dao the c100021Dao to set
	 */
	public void setC100021Dao(C100021Dao dao) {
		c100021Dao = dao;
	}
}
