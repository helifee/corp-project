/*
 * @(#) G060010ServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 考试系统
 */
package com.yds.tt.testing.service.impl;

import java.util.Calendar;
import java.util.Date;
import java.util.List;

import org.springframework.stereotype.Service;

import com.yds.batch.service.BatchJobRun;
import com.yds.tt.manager.dao.TtCommonDao;
import com.yds.tt.testing.bean.ExamEmployeeInfo;
import com.yds.tt.testing.dao.G060010Dao;
import com.yds.tt.testing.service.G060010Service;

/**
 * @see G060010Service,BatchJobRun
 */
@Service("g060010Service")
public class G060010ServiceImpl implements G060010Service, BatchJobRun {

	G060010Dao g060010Dao;

	TtCommonDao ttCommonDao;
	
	/**
	 * {@inheritDoc}
	 */
	@Override
	public void deleteDropExamInfo() {

		Calendar cal = Calendar.getInstance();
		cal.setTime(new Date());

		// 现在时间 - 答案保留时间
		cal.add(Calendar.DATE, 0 - Integer.parseInt(ttCommonDao.getPeizhiInfo("RESULT_RESERVE_TIME")));

		// 得到授权删除用户信息列表
		List<ExamEmployeeInfo> employeeInfos = g060010Dao.getEmployeeDrop(cal.getTime());

		for (ExamEmployeeInfo employeeInfo : employeeInfos) {

			// 删除放弃的考试信息
			g060010Dao.deleteDropInfo(employeeInfo);
		}

	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public void jobRun() throws Throwable {
		deleteDropExamInfo();
	}

	/**
	 * @param dao the g060010Dao to set
	 */
	public void setG060010Dao(G060010Dao dao) {
		g060010Dao = dao;
	}

	/**
	 * @param ttCommonDao the ttCommonDao to set
	 */
	public void setTtCommonDao(TtCommonDao ttCommonDao) {
		this.ttCommonDao = ttCommonDao;
	}
	
}
