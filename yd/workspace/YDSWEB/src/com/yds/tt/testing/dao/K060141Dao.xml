<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="K060141Dao">
	<typeAlias alias="k060141CourseInfo" type="com.yds.tt.training.bean.CourseInfo"/>
	<typeAlias alias="k060141SearchInfo" type="com.yds.tt.testing.bean.K060141SearchInfo"/>
	
	<!-- 课程一览信息条件编辑 --> 
	<sql id="k060141whereSql">
		FROM tt_kecheng 141tkc
		WHERE 
		COURSE_PUBLISH_STATUS = 2
		<isNotEmpty prepend="AND" property="courseId">
			COURSE_ID LIKE CONCAT(#courseId#, '%')
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="courseName">
			COURSE_NAME LIKE CONCAT('%' ,#courseName#, '%')
		</isNotEmpty>
		<isNotEmpty  property="category1Id">
			<isNotEqual property="category1Id" compareValue="0" prepend="AND">
				CATEGORY1_ID = #category1Id#
			</isNotEqual>
		</isNotEmpty>
		<isNotEmpty property="category2Id">
			<isNotEqual property="category2Id" compareValue="0" prepend="AND" >
				CATEGORY2_ID = #category2Id#
			</isNotEqual>
		</isNotEmpty>
		<isNotEmpty  property="category3Id">
			<isNotEqual property="category3Id" compareValue="0" prepend="AND">
				CATEGORY3_ID = #category3Id#
			</isNotEqual>
		</isNotEmpty>
	</sql>
	
	<!-- 课程一览信息列表取得 --> 
	<select id="getK060141SearchInfos" parameterClass="k060141SearchInfo" resultClass="k060141CourseInfo">
		SELECT COURSE_ID AS courseId, 
		COURSE_NAME AS courseName,
		ABSTRACT AS courseAbstract,
		CONCAT(CASE CATEGORY1_ID 
			WHEN 0 THEN "" ELSE 
			(SELECT CATEGORY_NAME FROM tt_fenlei
				WHERE CATEGORY1_ID = 141tkc.CATEGORY1_ID 
				AND CATEGORY_LEVEL = 1)
			END,
		CASE CATEGORY2_ID
			WHEN 0 THEN "" ELSE CONCAT("-",
			(SELECT CATEGORY_NAME FROM tt_fenlei
				WHERE CATEGORY1_ID = 141tkc.CATEGORY1_ID 
				AND CATEGORY2_ID = 141tkc.CATEGORY2_ID 
				AND CATEGORY_LEVEL = 2))
			END ,
		CASE CATEGORY3_ID
			WHEN 0 THEN "" ELSE CONCAT("-",
			(SELECT CATEGORY_NAME FROM tt_fenlei 
				WHERE CATEGORY1_ID = 141tkc.CATEGORY1_ID 
				AND CATEGORY2_ID = 141tkc.CATEGORY2_ID 
				AND CATEGORY3_ID = 141tkc.CATEGORY3_ID 
				AND CATEGORY_LEVEL = 3))
			END) AS categoryName
		<include refid="k060141whereSql"/>
		ORDER BY CATEGORY1_ID,CATEGORY2_ID,CATEGORY3_ID
	</select>

	<!-- 课程一览信息总数取得 --> 
	<select id="getK060141TotalCount" parameterClass="k060141SearchInfo" resultClass="Long">
		SELECT COUNT(*) 
		<include refid="k060141whereSql"/>
	</select>
			
	<!-- 指定考试已有需要学习课程检索 --> 		
	<select id="getHadCourses" parameterClass="String" resultClass="String"> 
		Select
			NECESSARY_COURSE_ID as necessaryCourseId
		From tt_xuyaokecheng
			WHERE EXAMINE_ID = #examineId#
	</select>
	
	<!--添加需要学习课程-->
	<insert id="insertNecessaryCourses" parameterClass="java.util.HashMap">
		INSERT INTO tt_xuyaokecheng 
		(
			EXAMINE_ID,
			NECESSARY_COURSE_ID
		) 
		VALUES 
		(
			#examineId#,
			#necessaryCourseId#
		)	
	</insert>
</sqlMap>