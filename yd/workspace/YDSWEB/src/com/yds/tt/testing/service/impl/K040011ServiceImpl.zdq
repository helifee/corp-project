/*
 * @(#) K040011ServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 考试系统
 */
package com.yds.tt.testing.service.impl;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.stereotype.Service;

import com.yds.tt.manager.bean.TtCheckResult;
import com.yds.tt.manager.service.TtCommonService;
import com.yds.tt.manager.service.TtCommonUtil;
import com.yds.tt.manager.service.TtConstants;
import com.yds.tt.testing.bean.K040011SearchInfo;
import com.yds.tt.testing.bean.QuestionInfo;
import com.yds.tt.testing.bean.QuestionLibrary;
import com.yds.tt.testing.dao.K040011Dao;
import com.yds.tt.testing.service.K040011Service;

/**
 * @see com.yds.tt.testing.service.K040011Service
 */
@Service("k040011Service")
public class K040011ServiceImpl implements K040011Service {

	private List<QuestionInfo> qbList;
	private K040011Dao k040011Dao;
	private TtCommonService ttCommonService;

	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<QuestionLibrary> getQuestionInfos(K040011SearchInfo searchInfo,
			int offset, int perCounts) {
		// 分类下拉框用户权限的设定
		searchInfo.setCategoryInfolist(ttCommonService.getCategoryCondition(
				TtCommonUtil.getLoginUserId(), TtConstants.C24.C24_3.value(),
				searchInfo.getCategory1Id(), searchInfo.getCategory2Id(),
				searchInfo.getCategory3Id()));

		return (List<QuestionLibrary>) k040011Dao.getQuestionInfos(searchInfo,
				offset, perCounts);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public Long getTotalCount(K040011SearchInfo searchInfo) {
		// 分类下拉框用户权限的设定
		searchInfo.setCategoryInfolist(ttCommonService.getCategoryCondition(
				TtCommonUtil.getLoginUserId(), TtConstants.C24.C24_3.value(),
				searchInfo.getCategory1Id(), searchInfo.getCategory2Id(),
				searchInfo.getCategory3Id()));
		
		return k040011Dao.getTotalCount(searchInfo);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public TtCheckResult checkStartupPerm(int mode, String paperId) {
		// 画面ID
		String pageId = TtConstants.PageId.K040011.value();
		// 事件ID
		String eventId = null;
		// 题库管理
		if (TtConstants.C28.C28_1.value() == mode) {
			eventId = "K040011_1";
		// 练习选题
		} else if(TtConstants.C28.C28_2.value() == mode){
			eventId = "K040011_2";
		// 考试选题
		}else{
			eventId = "K040011_3";
		}

		// 对象区分,对象ID
		Integer typeId = null;
		List<String> objectId = new ArrayList<String>();
		if (TtConstants.C28.C28_2.value() == mode) {
			// <练习卷>
			typeId = TtConstants.C43.C43_5.value();
			objectId.add(paperId);
		} else if (TtConstants.C28.C28_3.value() == mode) {
			// <考试卷>
			typeId = TtConstants.C43.C43_4.value();
			objectId.add(paperId);
		}

		return ttCommonService.checkStartupAuthority(pageId, eventId, 0, 0, 0,
				typeId, objectId);
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<String> getKeywordList(Integer category1Id) {
		Map<String, Integer> catemap = new HashMap<String, Integer>();
		catemap.put("category1Id", category1Id);
		return k040011Dao.getKeywordList(catemap);
	}

	/**
	 * @return the qbList
	 */
	public List<QuestionInfo> getQbList() {
		return qbList;
	}

	/**
	 * @param qbList
	 *            the qbList to set
	 */
	public void setQbList(List<QuestionInfo> qbList) {
		this.qbList = qbList;
	}

	/**
	 * @return the k040011Dao
	 */
	public K040011Dao getK040011Dao() {
		return k040011Dao;
	}

	/**
	 * @param dao
	 *            the k040011Dao to set
	 */
	public void setK040011Dao(K040011Dao dao) {
		k040011Dao = dao;
	}

	/**
	 * @param ttCommonService
	 *            the ttCommonService to set
	 */
	public void setTtCommonService(TtCommonService ttCommonService) {
		this.ttCommonService = ttCommonService;
	}

}
