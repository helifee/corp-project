/*
 * @(#) K070031Action.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 教育考试培训系统
 *    SubSystem: 考试子系统
 */
package com.yds.tt.testing.action;

import java.util.List;

import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;

import com.yds.base.action.AbstractBaseAction;
import com.yds.tt.manager.bean.TtCheckResult;
import com.yds.tt.manager.service.TtCommonService;
import com.yds.tt.manager.service.TtConstants;
import com.yds.tt.testing.bean.ExamEmployeeInfo;
import com.yds.tt.testing.bean.K070031BigQuestionInfo;
import com.yds.tt.testing.bean.K070031ExamineInfo;
import com.yds.tt.testing.bean.ExamineInfo;
import com.yds.tt.testing.bean.K070031DetailListInfo;
import com.yds.tt.testing.service.K070031Service;

/**
 * 成绩明细处理
 * 
 * @author 远东)chenzhong
 * @version 1.00 2010/03/31
 */
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
@Controller("k070031Action")
public class K070031Action extends AbstractBaseAction{

	private static final long serialVersionUID = 1L;
	private K070031Service k070031Service;
	private TtCommonService ttCommonService;
	private ExamineInfo examineInfo;

	/** 头部信息. */
	private K070031ExamineInfo headInfo;
	/** 成绩明细一览信息. */
	private List<K070031DetailListInfo> detailListInfos;
	/** 接口参数（考试ID）. */
	private String examineId;
	/** 试卷数. */
	private Integer paperNum;
	/** 错误信息. */
	private String errorMessage;
	private ExamEmployeeInfo examEmployeeInfo;
	/** 得分明细信息. */
	private List<K070031BigQuestionInfo> gainPointDetailList;
	
	/**
	 * 画面的初期显示
	 * 
	 * @return SUCCESS
	 */
	@Override
	public String execute() throws Exception {
		// 接口参数校验
		if(null != ttCommonService.isParamNull(examineId)){
			errorMessage = ttCommonService.isParamNull(examineId);
			return ERROR;
		}
		
		// 画面启动检查
		TtCheckResult result= ttCommonService.checkStartupAuthority(
				TtConstants.PageId.K070031.toString(), "K070031",
				null, null);
		if (!result.getRetFlag()) {
			errorMessage = result.getRetMessage();
			if ("GTE01".equals(result.getErrLevel())) {
				// ErrLevel = "GTE01"时，返回LOGIN
				return LOGIN;		
			}
			return ERROR;	
		}
		
		this.examineInfo = k070031Service.getExamineInfo(examineId);
		this.headInfo = k070031Service.getExamineResultInfo(examineId);
		this.detailListInfos = k070031Service.getDetailListInfo(examineId);
		this.paperNum = 0;
		
		this.paperNum = this.detailListInfos.size();
		return SUCCESS;	
	}
	
	/**
	 * 取得个人大题得分明细
	 * 
	 * @return SUCCESS
	 */	
	public String gainPointDetail() {
		
		// 取得个人大题得分明细
		this.gainPointDetailList = k070031Service.getPointDetail(examEmployeeInfo);

		return SUCCESS;
	}
	/**
	 * @param service the k070031Service to set
	 */
	public void setK070031Service(K070031Service service) {
		k070031Service = service;
	}

	/**
	 * @param ttCommonService the ttCommonService to set
	 */
	public void setTtCommonService(TtCommonService ttCommonService) {
		this.ttCommonService = ttCommonService;
	}

	/**
	 * @return the headInfo
	 */
	public K070031ExamineInfo getHeadInfo() {
		return headInfo;
	}

	/**
	 * @param headInfo the headInfo to set
	 */
	public void setHeadInfo(K070031ExamineInfo headInfo) {
		this.headInfo = headInfo;
	}

	/**
	 * @return the detailListInfos
	 */
	public List<K070031DetailListInfo> getDetailListInfos() {
		return detailListInfos;
	}

	/**
	 * @param detailListInfos the detailListInfos to set
	 */
	public void setDetailListInfos(List<K070031DetailListInfo> detailListInfos) {
		this.detailListInfos = detailListInfos;
	}

	/**
	 * @return the examineId
	 */
	public String getExamineId() {
		return examineId;
	}

	/**
	 * @param examineId the examineId to set
	 */
	public void setExamineId(String examineId) {
		this.examineId = examineId;
	}

	/**
	 * @return the paperNum
	 */
	public Integer getPaperNum() {
		return paperNum;
	}

	/**
	 * @param paperNum the paperNum to set
	 */
	public void setPaperNum(Integer paperNum) {
		this.paperNum = paperNum;
	}

	/**
	 * @return the errorMessage
	 */
	public String getErrorMessage() {
		return errorMessage;
	}

	/**
	 * @param errorMessage the errorMessage to set
	 */
	public void setErrorMessage(String errorMessage) {
		this.errorMessage = errorMessage;
	}

	/**
	 * @return the examEmployeeInfo
	 */
	public ExamEmployeeInfo getExamEmployeeInfo() {
		return examEmployeeInfo;
	}

	/**
	 * @param examEmployeeInfo the examEmployeeInfo to set
	 */
	public void setExamEmployeeInfo(ExamEmployeeInfo examEmployeeInfo) {
		this.examEmployeeInfo = examEmployeeInfo;
	}

	/**
	 * @return the gainPointDetailList
	 */
	public List<K070031BigQuestionInfo> getGainPointDetailList() {
		return gainPointDetailList;
	}

	/**
	 * @param gainPointDetailList the gainPointDetailList to set
	 */
	public void setGainPointDetailList(
			List<K070031BigQuestionInfo> gainPointDetailList) {
		this.gainPointDetailList = gainPointDetailList;
	}

	/**
	 * @param examineInfo the examineInfo to set
	 */
	public void setExamineInfo(ExamineInfo examineInfo) {
		this.examineInfo = examineInfo;
	}

	/**
	 * @return the examineInfo
	 */
	public ExamineInfo getExamineInfo() {
		return examineInfo;
	}
}
