/*
 * @(#) K070021Action.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网教育考试系统
 *    SubSystem: 考试系统
 */
package com.yds.tt.testing.action;

import java.util.List;

import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;

import com.yds.base.action.AbstractBaseAction;
import com.yds.tt.manager.bean.TtCheckResult;
import com.yds.tt.manager.service.TtCommonService;
import com.yds.tt.manager.service.TtConstants;
import com.yds.tt.testing.bean.K070021ScoreListInfo;
import com.yds.tt.testing.service.K070021Service;

/**
 * 成绩一览处理
 * 
 * @author tengchanglong
 * @version 1.00 2010/03/22
 */
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
@Controller("k070021Action")
public class K070021Action extends AbstractBaseAction{

	private static final long serialVersionUID = 3593133752314901811L;
	private TtCommonService ttCommonService;
	private String errorMessage;// 错误信息
	
	// 显示成绩一览(业务逻辑)
	private K070021Service k070021Service;
	
	// 成绩信息
	private List<K070021ScoreListInfo> scoreInfoLists;
	
	// 传入接口参数
	private String examId;   
	
	/**
	 * 画面的初期显示 成绩一览取得
	 * 
	 * @return SUCCESS
	 */
	@Override
	public String execute() throws Exception {	
		
		// 权限检查
		if (!checkAuthority()) {
			return ERROR;
		}
		this.scoreInfoLists = k070021Service.getScoreListAll(examId);
		return SUCCESS;
	}
	
	/**
	 * 有效成绩一览信息
	 * 
	 * @return SUCCESS
	 */
	public String listAll() throws Exception{
		
		// 权限检查
		if (!checkAuthority()) {
			return ERROR;
		}
		this.scoreInfoLists = k070021Service.getScoreListAll(examId);
		return SUCCESS;
	}
	
	/**
	 * 全部成绩一览信息
	 * 
	 * @return SUCCESS
	 */
	public String listPart() throws Exception{
		
		// 权限检查
		if (!checkAuthority()) {
			return ERROR;
		}
		this.scoreInfoLists = k070021Service.getScoreListPart(examId);
		return SUCCESS;
	}
	
	/**
	 * 权限检查.
	 * 
	 * @return true/false
	 */
	private boolean checkAuthority(){
		
		// 权限检查
		TtCheckResult checkResult = ttCommonService.checkStartupAuthority(
				TtConstants.PageId.K070021.value(), "K070021", null, null);
		if (!checkResult.getRetFlag()) {
			setErrorMessage(checkResult.getRetMessage());
			return false;
		}
		return true;
	}

	/**
	 * @return the k070021Service
	 */
	public K070021Service getK070021Service() {
		return k070021Service;
	}

	/**
	 * @param service the k070021Service to set
	 */
	public void setK070021Service(K070021Service service) {
		k070021Service = service;
	}

	/**
	 * @return the scoreInfoLists
	 */
	public List<K070021ScoreListInfo> getScoreInfoLists() {
		return scoreInfoLists;
	}

	/**
	 * @param scoreInfoLists the scoreInfoLists to set
	 */
	public void setScoreInfoLists(List<K070021ScoreListInfo> scoreInfoLists) {
		this.scoreInfoLists = scoreInfoLists;
	}

	/**
	 * @return the examId
	 */
	public String getExamId() {
		return examId;
	}

	/**
	 * @param examId the examId to set
	 */
	public void setExamId(String examId) {
		this.examId = examId;
	}

	/**
	 * @return the ttCommonService
	 */
	public final TtCommonService getTtCommonService() {
		return ttCommonService;
	}

	/**
	 * @param ttCommonService the ttCommonService to set
	 */
	public final void setTtCommonService(TtCommonService ttCommonService) {
		this.ttCommonService = ttCommonService;
	}

	/**
	 * @return the errorMessage
	 */
	public final String getErrorMessage() {
		return errorMessage;
	}

	/**
	 * @param errorMessage the errorMessage to set
	 */
	public final void setErrorMessage(String errorMessage) {
		this.errorMessage = errorMessage;
	}
	
}
