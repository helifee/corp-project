<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="K070031Dao">
	<typeAlias alias="k070031ExamineInfo" type="com.yds.tt.testing.bean.K070031ExamineInfo"/>
	<typeAlias alias="examineInfo" type="com.yds.tt.testing.bean.ExamineInfo"/>
	<typeAlias alias="k070031BigQuestionInfo" type="com.yds.tt.testing.bean.K070031BigQuestionInfo"/>
		<!-- 成绩明细的考试信息取得 --> 
	<select id="getExamineInfo" parameterClass="String" resultClass="examineInfo"> 
		SELECT  t1.EXAMINE_ID          AS examineId,  
		        t1.EXAMINE_NAME        AS examineName,
				<!-- 分类名称：一级分类名-二级分类名-三级分类名 -->
				CONCAT
				(CASE  T1.CATEGORY1_ID 
					WHEN 0 THEN ""
					ELSE 
						(SELECT CATEGORY_NAME 
						   FROM TT_FENLEI 
						   WHERE CATEGORY1_ID =  T1.CATEGORY1_ID AND 
								CATEGORY_LEVEL = 1)
				END,
				CASE  T1.CATEGORY2_ID
					WHEN 0 THEN ""
					ELSE CONCAT("-",(SELECT CATEGORY_NAME 
								FROM TT_FENLEI
							    WHERE CATEGORY1_ID = T1.CATEGORY1_ID AND 
									 CATEGORY2_ID =  T1.CATEGORY2_ID AND
									 CATEGORY_LEVEL = 2))
				END ,
				CASE  T1.CATEGORY3_ID
					WHEN 0 THEN ""
					ELSE CONCAT("-",(SELECT CATEGORY_NAME 
								FROM TT_FENLEI
							    WHERE CATEGORY1_ID = T1.CATEGORY1_ID AND 
									 CATEGORY2_ID = T1.CATEGORY2_ID AND
									 CATEGORY3_ID = T1.CATEGORY3_ID AND
									 CATEGORY_LEVEL = 3))
				END) AS categoryName,			
		        t1.EXAMINE_TIME        AS examineTime,
				t1.EXAMINE_START_TIME  AS examineStartTime,
				t1.EXAMINE_END_TIME    AS examineEndTime,
		        t1.EXAMINE_COMMENT     AS examineComment,
		        t1.RESULTLEVEL_NUM     AS resultlevelNum,
		        t1.RESULTLEVEL1_NAME   AS resultlevel1Name,
		        t1.RESULTLEVEL2_NAME   AS resultlevel2Name,
		        t1.RESULTLEVEL3_NAME   AS resultlevel3Name,
		        t1.RESULTLEVEL4_NAME   AS resultlevel4Name,
				t1.RESULTLEVEL5_NAME   AS resultlevel5Name,
				t1.TOTAL_SCORE         AS totalScore					
		  FROM  tt_ks_xinxi             t1
		 WHERE  t1.EXAMINE_ID     =     #examineId#
	</select>
	<!-- 成绩明细的考试信息取得 --> 
	<select id="getExamineResultInfo" parameterClass="String" resultClass="k070031ExamineInfo"> 
		SELECT  t2.RESULTLEVEL1_NUM    AS resultlevel1Num,
		        t2.RESULTLEVEL2_NUM    AS resultlevel2Num,
		        t2.RESULTLEVEL3_NUM    AS resultlevel3Num,
		        t2.RESULTLEVEL4_NUM    AS resultlevel4Num,
				t2.RESULTLEVEL5_NUM    AS resultlevel5Num,	
		        t2.PASSEXAMINE_NUM     AS passExamineNum,
		        t2.NOT_PASSEXAMINE_NUM AS notPassExamineNum,
		        t2.JOINEXAMINE_NUM     AS joinExamineNum,
				t2.AVERAGE_SCORE       AS averageScore							
		  FROM  tt_ks_chengjihuizong    t2
		 WHERE  t2.EXAMINE_ID     =     #examineId#
	</select>	
	<!-- 成绩明细的个人得分信息取得 --> 
	<select id="getBigQuestionInfo" parameterClass="String" resultClass="k070031BigQuestionInfo"> 
		SELECT  t1.PAPER_ID                AS  paperId,
				t5.PAPER_TITLE             AS  paperName,
				t1.EMPLOYEES_ID            AS  employeesId,  
		        (SELECT USER_CNM FROM v_tt_user WHERE USER_ID=t1.EMPLOYEES_ID) AS employeesName,
				t1.PASSEXAMINE_FLG         AS  passexamineFlg,
				(CASE  t1.RESULTLEVEL_ID
				    WHEN  '1'  THEN  t2.RESULTLEVEL1_NAME
					WHEN  '2'  THEN  t2.RESULTLEVEL2_NAME
					WHEN  '3'  THEN  t2.RESULTLEVEL3_NAME
					WHEN  '4'  THEN  t2.RESULTLEVEL4_NAME
					WHEN  '5'  THEN  t2.RESULTLEVEL5_NAME
				END)                       AS  resultLeavelName,
		        t1.SCORE                   AS  score,
		        t3.BIGQUESTION_SERIAL_NO   AS  bigquestionSerialNo,
		        t3.BIGQUESTION_TITLE       AS  bigquestionTitle,
		        t3.BIGQUESTION_TOTAL_SCORE AS  bigquestionTotalScore,
				SUM(t4.QUESTION_POINT)     AS  bigquestionScoreSum						
		  FROM  v_tt_ks_chengji_1          v1,
				tt_ks_yuangong             t1,
				tt_ks_xinxi                t2,
				tt_sj_datixinxi            t3,
				tt_ks_dajuan               t4,
				tt_shijuan                 t5			
		 WHERE  v1.EXAMINE_ID              =   #examineId#
		   AND  t1.EXAMINE_ID              =   v1.EXAMINE_ID
		   AND  t1.EMPLOYEES_ID            =   v1.EMPLOYEES_ID
		   AND  t1.EXAMINE_JOIN_TIMES      =   v1.EXAMINE_JOIN_TIMES
		   AND  t2.EXAMINE_ID              =   t1.EXAMINE_ID
		   AND  t3.PAPER_ID                =   t1.PAPER_ID
		   AND  t3.PAPER_VERSION_NO        =   t1.PAPER_VERSION_NO
		   AND  t4.EXAMINE_ID              =   t1.EXAMINE_ID
		   AND  t4.EMPLOYEES_ID            =   t1.EMPLOYEES_ID
		   AND  t4.EXAMINE_JOIN_TIMES      =   t1.EXAMINE_JOIN_TIMES
		   AND  t4.BIGQUESTION_SERIAL_NO   =   t3.BIGQUESTION_SERIAL_NO
		   AND  t5.PAPER_ID                =   t1.PAPER_ID
		   AND  t5.PAPER_VERSION_NO        =   t1.PAPER_VERSION_NO
	  GROUP BY  paperId,
				employeesId,
				bigquestionSerialNo
	  ORDER BY  t1.PAPER_ID,
				t1.EMPLOYEES_ID,
				t3.BIGQUESTION_ORDER    ASC
	</select>

</sqlMap>  
