<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="K060101Dao">
	<typeAlias alias="examEmployeeInfo" type="com.yds.tt.testing.bean.ExamEmployeeInfo"/>
	<typeAlias alias="markTaskAssignInfo" type="com.yds.tt.testing.bean.MarkTaskAssignInfo"/>
	<typeAlias alias="paperBigQuestionInfo" type="com.yds.tt.testing.bean.PaperBigQuestionInfo"/>
	<typeAlias alias="testPaperInfo" type="com.yds.tt.testing.bean.TestPaperInfo"/>
	<typeAlias alias="k060031ExamQuestionInfo" type="com.yds.tt.testing.bean.K060031ExamQuestionInfo"/>
	<typeAlias alias="k060031SingleQuesInfo" type="com.yds.tt.testing.bean.K060031SingleQuesInfo"/>
	<typeAlias alias="answerPointInfo" type="com.yds.tt.testing.bean.AnswerPointInfo"/>
	<typeAlias alias="testEmployeeAnswerInfo" type="com.yds.tt.testing.bean.TestEmployeeAnswerInfo"/>
	<typeAlias alias="k060031SearchInfo" type="com.yds.tt.testing.bean.K060031SearchInfo"/>
	<!--取得评分任务信息-->
	<select id="getMarkTaskAssignInfo" resultClass="markTaskAssignInfo" parameterClass="markTaskAssignInfo">
		SELECT
			EXAMINE_ID AS examineId,
			EXAMINE_MARKER_ID AS examineMarkerId,
			EMPLOYEES_ID AS	employeesId,
			BIGQUESTION_SERIAL_NO AS bigQuestionSerialNo,
			MARKING_STATUS AS markingStatus,
			MARKING_EMPID AS markingEmpId
	   FROM
			TT_PINGFENRENWU
	   WHERE
			EXAMINE_ID = #examineId#
		AND EMPLOYEES_ID = #employeesId#
		AND BIGQUESTION_SERIAL_NO = #bigquestionSerialNo#
	</select>
	<!--取得待考试员工信息-->
	<select id="getExamEmployeeInfo" resultClass="examEmployeeInfo" parameterClass="examEmployeeInfo">
		SELECT
			  PAPER_ID AS paperId,
			  PAPER_VERSION_NO AS paperVersionNo,
			  PAPER_CREATE_NO AS paperCreateNo,
			  EXAMINE_JOIN_TIMES AS examineJoinTimes
		FROM  TT_KS_YUANGONG
		WHERE EXAMINE_ID = #examineId# 
		  AND EMPLOYEES_ID = #employeesId#
		ORDER BY EXAMINE_JOIN_TIMES DESC
		LIMIT  0,1			
	</select>
	<!--取得待评分试卷详细信息-->
	<select id="getTestPaperInfo" resultClass="testPaperInfo" parameterClass="examEmployeeInfo">
		SELECT 
			 PAPER_TITLE AS paperTitle,
			 PAPER_ID AS paperId,
			 PAPER_VERSION_NO AS paperVersionNo,
			 PAPER_DESCRIPTION AS paperDescription
   		FROM 
			 TT_SHIJUAN
		WHERE 
			 PAPER_ID = #paperId#
		AND  PAPER_VERSION_NO = #paperVersionNo# 
	</select>
	<!--取得试卷所有大题信息-->
	<select id="getBigQuestionInfos" resultClass="paperBigQuestionInfo" parameterClass="paperBigQuestionInfo">
		SELECT
			BIGQUESTION_SERIAL_NO AS bigquestionSerialNo,
			BIGQUESTION_ORDER AS bigquestionOrder,
			BIGQUESTION_TITLE AS bigquestionTitle,
			BIGQUESTION_DESCRIPTION AS bigquestionDescription,
			QUESTION_NUM AS questionNum,
			ATUO_MARK_FLG AS atuoMarkFlg
		FROM
			TT_SJ_DATIXINXI
		WHERE
			PAPER_ID = #paperId#
		 AND PAPER_VERSION_NO =  #paperVersionNo#
		ORDER BY BIGQUESTION_ORDER ASC		
	</select>
	<!--取得大题信息-->
	<select id="getBigQuestionInfo" resultClass="paperBigQuestionInfo" parameterClass="paperBigQuestionInfo">
		SELECT
			BIGQUESTION_SERIAL_NO AS bigquestionSerialNo,
			BIGQUESTION_ORDER AS bigquestionOrder,
			BIGQUESTION_TITLE AS bigquestionTitle,
			BIGQUESTION_DESCRIPTION AS bigquestionDescription,
			QUESTION_NUM AS questionNum,
			ATUO_MARK_FLG AS atuoMarkFlg
		FROM
			TT_SJ_DATIXINXI
		WHERE
			PAPER_ID = #paperId#
		AND PAPER_VERSION_NO =  #paperVersionNo#
		AND BIGQUESTION_SERIAL_NO = #bigquestionSerialNo#
	</select>
	<!--取得待评试卷所属的员工信息-->
	<select id="getExamEmployeeInfos" resultClass="examEmployeeInfo" parameterClass="examEmployeeInfo">
		 SELECT
				EXAMINE_ID AS examineId,
                EMPLOYEES_ID AS employeesId,
                MAX(EXAMINE_JOIN_TIMES) AS examineJoinTimes,
				PAPER_ID AS paperId,
				PAPER_VERSION_NO AS paperVersionNo
         FROM
                TT_KS_YUANGONG
         WHERE
                EXAMINE_ID = #examineId#
		  AND   EMP_EXAM_STATUS = #empExamStatus#
         GROUP BY
                EMPLOYEES_ID
         ORDER BY
                EMPLOYEES_ID ASC
		
	</select>
	<!--取得试卷小题信息-->
	<select id="getExamQuestionOfBigQuestion" resultClass="k060031ExamQuestionInfo" parameterClass="k060031SearchInfo">
		SELECT  T2.BIGQUESTION_SERIAL_NO AS bigquestionSerialNo,
				T2.QUESTION_ORDER AS questionOrder,
				T2.QUESTION_ID AS questionId,
				T2.QUESTION_SCORE AS paperQuestionScore,
				T3.QUESTION_SCORE AS questionScore,
				T3.QUESTION_VERSION_NO AS questionVersionNo,
				T3.QUESTION_NUMBER AS questionNumber,
				T3.QUESTION_CONTENT AS questionContent
		FROM tt_ks_yuangong T1
		INNER JOIN tt_ks_shijuanshiti T2
		ON T1.PAPER_ID = T2.PAPER_ID
		AND T1.PAPER_VERSION_NO = T2.PAPER_VERSION_NO
		AND T1.PAPER_CREATE_NO = T2.PAPER_CREATE_NO
		AND T2.BIGQUESTION_SERIAL_NO = #bigquestionSerialNo#
		AND T2.QUESTION_ORDER = #questionOrder#
		INNER JOIN tt_tiku T3
		ON T2.QUESTION_ID = T3.QUESTION_ID
		AND T1.PAPER_CREATE_TIME >= T3.VERSION_START_TIME
		AND T3.VERSION_END_TIME > T1.PAPER_CREATE_TIME
		WHERE T1.EMPLOYEES_ID = #employeesId#
		AND T1.EXAMINE_ID = #examineId#
		AND T1.EXAMINE_JOIN_TIMES = #examineJoinTimes#			
		ORDER BY T2.BIGQUESTION_SERIAL_NO ASC, T2.QUESTION_ORDER ASC
	</select>
	<!--取得小题标准答案信息-->
	<select id="getAnswerInfos" resultClass="k060031SingleQuesInfo" parameterClass="k060031ExamQuestionInfo">
		SELECT
			T1.QUESTION_ID AS  questionId,
			T1.QUESTION_VERSION_NO AS  questionVersionNo,
			T1.ANSWER_SCORE AS answerScore,
			T1.ANSWER_SERIAL_NO AS answerSerialNo,
			T1.ANSWER_QUES_NO AS answerQuesNo,
			T1.ANSWER_TYPE AS answerType,
			(Select DIFF_NAME 
				FROM com_code_mst 
				WHERE TYPE_ID = T1.OPTION_TYPE_ID
				AND DIFF_NO = T1.OPTION_TYPE) AS optionContent,
			T1.ANSWER_CONTENT AS standardAnswer,
			T1.OPTION_NUMBER AS optionNumber
		FROM TT_DAAN T1
		WHERE QUESTION_ID = #questionId#
		AND QUESTION_VERSION_NO = #questionVersionNo#
		GROUP BY ANSWER_SERIAL_NO
		ORDER BY ANSWER_SERIAL_NO ASC
	</select>
	<!--取得得分点信息-->
	<select id="getAnswerPointInfos" resultClass="answerPointInfo" parameterClass="answerPointInfo">
		SELECT
		      POINT_SERIAL_NO AS pointSerialNo,
			  POINT_CONTENT AS pointContent,
			  POINT_SCORE AS pointScore
		FROM  TT_DEFENDIAN
		WHERE QUESTION_ID = #questionId#
	 	  AND QUESTION_VERSION_NO = #questionVersionNo#
		  AND ANSWER_SERIAL_NO = #answerSerialNo#
		  ORDER BY POINT_SERIAL_NO
	</select>
	<!--取得考生答案信息-->
	<select id="getTestEmployeeAnswerInfos" parameterClass="k060031SearchInfo" resultClass="k060031SingleQuesInfo">
		SELECT
			T4.ANSWER_SERIAL_NO AS answerSerialNo,
			T4.ANSWER_TYPE AS answerType,
			T4.ANSWER_QUES_NO AS answerQuesNo,
			T5.ANSWER_CONTENT AS answerContent,
			T5.QUESTION_POINT AS questionPoint,
			T5.MARK_FLG AS markFlg
		FROM tt_daan T4
		LEFT JOIN tt_ks_dajuan T5
		ON T4.QUESTION_ID = T5.QUESTION_ID
		AND T4.QUESTION_VERSION_NO = T5.QUESTION_VERSION_NO
		AND T4.ANSWER_SERIAL_NO = T5.ANSWER_SERIAL_NO	
		AND T5.EXAMINE_ID = #examineId#
		AND T5.EMPLOYEES_ID = #employeesId#
		AND T5.EXAMINE_JOIN_TIMES = #examineJoinTimes#	
		AND T5.BIGQUESTION_SERIAL_NO = #bigquestionSerialNo#
		WHERE T4.QUESTION_ID = #questionId#
		AND T4.QUESTION_VERSION_NO = #questionVersionNo#
		ORDER BY T4.ANSWER_SERIAL_NO ASC
	</select>
	
	<!--取得考生考试答案信息-->
	<select id="getTestEmployeeAnswerInfo" parameterClass="testEmployeeAnswerInfo" resultClass="testEmployeeAnswerInfo">
		SELECT 
			  EMPLOYEES_ID AS  employeesId 
		FROM TT_KS_DAJUAN
		WHERE EXAMINE_ID = #examineId# 
		  AND EMPLOYEES_ID = #employeesId# 
		  AND EXAMINE_JOIN_TIMES = #examineJoinTimes# 
		  AND BIGQUESTION_SERIAL_NO = #bigquestionSerialNo# 
		  AND QUESTION_ID = #questionId# 
		  AND QUESTION_VERSION_NO = #questionVersionNo# 
		  AND ANSWER_SERIAL_NO = #answerSerialNo# 
	</select>
	<!--取得自动评分题是否评分标识-->
	<select id="getEmpAnswerInfo" parameterClass="testEmployeeAnswerInfo" resultClass="testEmployeeAnswerInfo">
		SELECT MARK_FLG AS markFlg 
		FROM 
		      TT_KS_DAJUAN
		WHERE EXAMINE_ID = #examineId#  
		  AND BIGQUESTION_SERIAL_NO = #bigquestionSerialNo#
		  AND EMPLOYEES_ID = #employeesId# 
		ORDER BY EXAMINE_JOIN_TIMES ASC 
		LIMIT 1
	</select>
</sqlMap>