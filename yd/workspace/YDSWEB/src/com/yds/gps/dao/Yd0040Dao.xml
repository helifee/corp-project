<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="yd0040Dao">
    <typeAlias alias="goodsInfo" type="com.yds.gps.bean.GpsGoodsInfo"/>
	<typeAlias alias="goodsCate" type="com.yds.gps.bean.GpsGoodsCate"/>
	
    <!-- 取得商品一览信息 --> 
	<select id="getGoodsList" parameterClass="String" resultClass="goodsInfo"> 
		SELECT 
		GOODS_CATE_ID AS goodsCateId,
		GOODS_ID AS goodsId,
		GOODS_NAME AS goodsName,
		GOODS_PRICE AS goodsPrice,
		GOODS_DESC as goodsDesc,
		DISPLAY_SEQ AS displaySeq,
		GOODS_SWITCH AS goodsSwitch,
		STORE AS store
		FROM 
		   GPS_GOODS_INFO
        WHERE 
		    GOODS_CATE_ID=#goodsCateId#		
		order by displaySeq
     </select>
	 
	 <!-- 取得排序列表一览信息 --> 
	 <select id="getGoodsSortList" parameterClass="String" resultClass="goodsInfo"> 
		SELECT 
		GOODS_ID AS goodsId,
		CONCAT('[', STORE, ']', GOODS_NAME) AS goodsName,
		DISPLAY_SEQ AS displaySeq
		FROM 
		   GPS_GOODS_INFO
        WHERE 
		    GOODS_CATE_ID=#goodsCateId#		
		order by displaySeq
     </select>
	 
	 <!-- 取得商品信息 --> 
	 <select id="getGoodsInfo" parameterClass="String" resultClass="goodsInfo"> 
		SELECT 
		GOODS_ID AS goodsId,
		GOODS_NAME AS goodsName,
		GOODS_PRICE AS goodsPrice,
		GOODS_DESC AS goodsDesc,
	    GOODS_CATE_ID AS goodsCateId,
		STORE AS store,
		GOODS_SWITCH AS goodsSwitch,
		GOODS_IMAGE  AS goodsImage
		FROM 
		   GPS_GOODS_INFO
        WHERE 
		    GOODS_ID=#goodsId#		
     </select>
	 
	 <!-- 修改职位排序 -->
	<update id="updateGoodsSort" parameterClass="goodsInfo">
		UPDATE GPS_GOODS_INFO
	    SET 	
				DISPLAY_SEQ = #displaySeq#
		WHERE
				GOODS_ID = #goodsId#
	</update>
	
	<!-- 追加商品 -->
	<insert id="insertGoodsInfo" parameterClass="goodsInfo">
		INSERT INTO GPS_GOODS_INFO
		(
		    GOODS_ID,
			GOODS_CATE_ID,
			GOODS_NAME,
			GOODS_PRICE,
			GOODS_DESC,
			DISPLAY_SEQ,
			UPDATE_USER,
			UPDATE_TIME,
			MNGR_ID,
			STORE,
			GOODS_SWITCH,
			CREATE_TIME,
			GOODS_IMAGE
			
		)
		VALUES
		(
		    #goodsId#,
			#goodsCateId#,
			#goodsName#,
			#goodsPrice#,
			#goodsDesc#,
			#displaySeq#,
			#updateUser#,
			NOW(),
			#mngrId#,
			#store#,
			#goodsSwitch#,
			NOW(),
			#goodsImage#
			
		)
	</insert>
	
	<!-- 追加分类 -->
	<insert id="insertGoodsCate" parameterClass="goodsCate">
		INSERT INTO GPS_GOODS_CATE
		(
			GOODS_CATE_ID,
			CATE_NAME,
			PUB_FLAG,
			MNGR_ID,
			CREATE_TIME
		)
		VALUES
		(
			#goodsCateId#,
			#cateName#,
			#pubFlg#,
			#mngrId#,
			NOW()
			
		)
	</insert>
	
	<!-- 修改商品信息 -->
	<update id="updateGoodsInfo" parameterClass="goodsInfo">
		UPDATE GPS_GOODS_INFO
		SET	
				GOODS_NAME=#goodsName#, 
				GOODS_PRICE=#goodsPrice#,
				GOODS_DESC=#goodsDesc#,
				STORE=#store#,
				GOODS_SWITCH=#goodsSwitch#,
				GOODS_IMAGE=#goodsImage#
		WHERE
			GOODS_ID=#goodsId#
	</update>
	
	<!-- 取得显示顺-->
	<select id="getMaxGoodsDisp" resultClass="String">
		SELECT MAX(DISPLAY_SEQ) 
		FROM GPS_GOODS_INFO
	</select>
	
	<!-- 取得商品分类名称 --> 
	<select id="getGoodsCateName" parameterClass="String" resultClass="String"> 
		SELECT 
		CATE_NAME AS cateName
		FROM 
		   GPS_GOODS_CATE
        WHERE 
		    GOODS_CATE_ID=#goodsCateId#		
     </select>
	 
	<!-- 取得店铺名称 --> 
	<select id="getStoreName" parameterClass="String" resultClass="String"> 
		SELECT 
			DISTINCT STORE as store
		FROM 
			GPS_GOODS_INFO T1
		WHERE T1.GOODS_CATE_ID = #goodsCateId#
	</select>
	<!-- 取得分类区分 --> 
	<select id="getPubFlag" parameterClass="String" resultClass="goodsCate"> 
		SELECT 
			PUB_FLAG as pubFlg,
			MNGR_ID AS mngrId
		FROM 
			GPS_GOODS_CATE
		WHERE 
			GOODS_CATE_ID = #goodsCateId#
	</select>
</sqlMap> 
