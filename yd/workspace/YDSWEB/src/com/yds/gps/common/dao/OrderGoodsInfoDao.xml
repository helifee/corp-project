<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="orderGoodsInfoDao">
    <typeAlias alias="gpsOrderInfo" type="com.yds.gps.common.bean.GpsOrderInfo"/>
    <typeAlias alias="gpsOrderGoods" type="com.yds.gps.bean.GpsOrderGoods"/>
	
	<!-- 更新订单信息表的订购数量 --> 
	<update id="updateGpsOrderInfoCnt" parameterClass="gpsOrderInfo">
		UPDATE 
			GPS_ORDER_INFO
		SET
			ORDER_CNT   = order_cnt + #orderCnt#,
			UPDATE_TIME = NOW()
		WHERE
			ORDER_ID = #orderId#
	</update>
	
	<!-- 更新订单商品表的订购数量 --> 
	<update id="updateGpsOrderGoodsCnt" parameterClass="gpsOrderGoods">
		UPDATE 
			GPS_ORDER_GOODS
		SET
			ORDER_CNT = order_cnt + #orderCnt#
		WHERE
			ORDER_ID = #orderId# AND
			GOODS_ID = #goodsId#
	</update>

	<!-- 结算方式 --> 
	<select id="getPayFlag" parameterClass="String" resultClass="String"> 
		SELECT
			T1.PAY_FLAG AS payFlag
		FROM
			GPS_ORDER_INFO T1
		WHERE 
			T1.ORDER_ID = #orderId#
	</select>
	<select id="getMngOrder" parameterClass="java.util.HashMap" resultClass="Integer">
		SELECT COUNT(T1.ORDER_ID)
		FROM GPS_ORDER_INFO T1
		WHERE T1.ORDER_ID = #orderId# 
		  AND (T1.CREATE_USER = #userId# 
		<isEqual prepend="OR" property="managerFlg" compareValue="1">
			T1.BUSS_FLAG='1'
		</isEqual>
		)
	</select>
	
	
</sqlMap>