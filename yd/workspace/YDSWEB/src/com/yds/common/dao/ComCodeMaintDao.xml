<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ComCodeMaintDao">
	<typeAlias alias="comCodeMaint" type="com.yds.common.bean.ComCodeMaint"/>
	<typeAlias alias="typeInfo" type="com.yds.common.bean.TypeInfo"/>
	<typeAlias alias="comCodeConf" type="com.yds.common.bean.ComCodeConf"/>
	<typeAlias alias="itemInfo" type="com.yds.common.bean.ItemInfo"/>

	<!-- 系统区分List取得 -->
    <select id="getDiffList" parameterClass="comCodeMaint" resultClass="comCodeMaint">
	    SELECT
			SUB_SYS AS subSys,
			TYPE_ID AS typeId,
			DIFF_NO AS diffNo,
			TYPE_NAME AS typeName,
			DIFF_NAME AS diffName,
			DIFF_SHORT_NAME AS diffShortName,
			DISP_SEQ AS dispSeq,
			DEL_FLG AS delFlg,
			PRO1 AS pro1,
			PRO2 AS pro2,
			PRO3 AS pro3,
			PRO4 AS pro4,
			PRO5 AS pro5,
			PRO6 AS pro6,
			PRO7 AS pro7,
			PRO8 AS pro8,
			REFER AS refer
	        FROM SYS_CODE_MST
		WHERE
			SUB_SYS = #subSys#
		AND
			TYPE_ID = #typeId#
		<isNotEmpty prepend="AND" property="diffNo">
			DIFF_NO = #diffNo#
		</isNotEmpty>
		ORDER BY DISP_SEQ;
    </select>

	<!-- 所有类型List取得 -->
	<select id="getTypeList" resultClass="typeInfo" parameterClass="String">
		SELECT TYPE_ID AS typeId,
			   TYPE_NAME AS typeName
		FROM SYS_CODE_MST
		WHERE
			SUB_SYS = #subSys#
		GROUP BY TYPE_ID;
	</select>

	<!-- 区分附加属性取得 -->
	<select id="getComCodeConfList" resultClass="comCodeConf" parameterClass="comCodeConf">
		SELECT
			SUB_SYS AS subSys,
			TYPE_ID AS typeId,
			PROPERTY_SEQ AS propertySeq,
			DISP_SEQ AS dispSeq,
			DISP_CAPTION AS dispCaption,
			DISP_TYPE AS dispType,
			DATA_LENGTH AS dataLength,
			OUTSIDE_FLG AS outsideFlg,
			GROUP_CONCAT(INSIDE_NAME SEPARATOR ",") AS insideName,
			GROUP_CONCAT(INSIDE_VALUE SEPARATOR ",") AS insideValue,
			OUTSIDE_NAME AS outsideName,
			OUTSIDE_VALUE AS outsideValue,
			OUTSIDE_CONDITION AS outsideCondition,
			DISP_CONDITION AS dispCondition,
			NOTNULL_FLG AS notNullFlg,
			DEFAULT_VALUE AS defaultValue,
			INPUT_DISCRIPTION AS inputDiscription,
			ERROR_MESSAGE AS errorMessage
		FROM COM_CODE_CONF
		WHERE
			SUB_SYS = #subSys#
		AND
			TYPE_ID = #typeId#
		GROUP BY PROPERTY_SEQ
		ORDER BY PROPERTY_SEQ;
	</select>

	<!-- 所有附加属性外部数据List取得 -->
	<select id="getItemInfoList" resultClass="itemInfo" parameterClass="itemInfo">
		SELECT $itemId$ AS itemId,
			   $itemName$ AS itemName
		$searchCondition$;
	</select>

	<!-- 添加区分信息 -->
	<insert id="insertDiffInfo" parameterClass="comCodeMaint">
		INSERT INTO SYS_CODE_MST
		   (
		    SUB_SYS,
			TYPE_ID,
			DIFF_NO,
			TYPE_NAME,
			DIFF_NAME,
			DIFF_SHORT_NAME,
			DISP_SEQ,
			DEL_FLG,
			EDIT_FLG,
			PRO1,
			PRO2,
			PRO3,
			PRO4,
			PRO5,
			PRO6,
			PRO7,
			PRO8,
			REFER
		   )
		VALUES
		   (
		    #subSys#,
			#typeId#,
			#diffNo#,
			#typeName#,
			#diffName#,
			#diffShortName#,
			#dispSeq#,
			#delFlg#,
			'0',
			#pro1#,
			#pro2#,
			#pro3#,
			#pro4#,
			#pro5#,
			#pro6#,
			#pro7#,
			#pro8#,
			#refer#
		   );
	</insert>

	<!-- 更新区分信息 -->
	<update id="updateDiffInfo" parameterClass="comCodeMaint">
		UPDATE SYS_CODE_MST
		   SET 	DIFF_NAME = #diffName#,
				DIFF_SHORT_NAME = #diffShortName#,
				DEL_FLG = #delFlg#,
				PRO1 = #pro1#,
				PRO2 = #pro2#,
				PRO3 = #pro3#,
				PRO4 = #pro4#,
				PRO5 = #pro5#,
				PRO6 = #pro6#,
				PRO7 = #pro7#,
				PRO8 = #pro8#,
				REFER = #refer#
		WHERE
			SUB_SYS = #subSys#
		AND TYPE_ID = #typeId#
		AND DIFF_NO = #diffNo#;
	</update>

	<!-- 系统区分ListSort取得 -->
    <select id="getDiffSortList" parameterClass="comCodeMaint" resultClass="comCodeMaint">
	    SELECT
			DIFF_NO AS diffNo,
			DIFF_NAME AS diffName
	        FROM SYS_CODE_MST
		WHERE
			SUB_SYS = #subSys#
		AND
			TYPE_ID = #typeId#
		ORDER BY DISP_SEQ;
    </select>

	<!-- 更新区分顺 -->
	<update id="updateDiffSort" parameterClass="comCodeMaint">
		UPDATE SYS_CODE_MST
		   SET 	DISP_SEQ = #dispSeq#
		WHERE
			SUB_SYS = #subSys#
		AND TYPE_ID = #typeId#
		AND DIFF_NO = #diffNo#;
	</update>
	
	<!-- 区分最大序号取得 -->
    <select id="getMaxDiffSort" parameterClass="comCodeMaint" resultClass="String">
	    SELECT
			MAX(DISP_SEQ)
	        FROM SYS_CODE_MST
		WHERE
			SUB_SYS = #subSys#
		AND
			TYPE_ID = #typeId#;
    </select>
</sqlMap>  