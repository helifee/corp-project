<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="UserPermitDao">
	
	<typeAlias alias="userPerm" type="com.yds.common.bean.UserPerm"/>
	
	<!-- 用户菜单取得 --> 
	<select id="getUserMenu" parameterClass="String" resultClass="userPerm">
		SELECT
		  T1.USER_ID AS userId,
		  T1.PERM_ID AS permitId,
		  T2.SITE_URL as siteURL,
		  T2.NAMESPACE AS nameSpace,
		  T2.ACTION_NAME AS actionName,
		  T2.IS_PERM AS isPerm,
		  T2.IS_MENU AS isMenu,
		  T2.IS_CONTROL AS isControl,
		  T2.MENU_NAME AS menuName,
		  T2.PARENT_MODULE AS parentModule,
		  T2.DISP_SEQ AS dispSeq,
		  T2.IMG_PATH AS imgPath
		FROM 
		  V_PER_USER_PERM T1,
		  PER_PERMIT T2
		WHERE
		  T1.USER_ID = #userId#
		AND
		  T1.PERM_ID = T2.PARENT_MODULE
		AND
		  T2.IS_MENU != '0'
		  ORDER BY T2.DISP_SEQ;
	</select>
	
	<!-- 用户权限取得 --> 
	<select id="getUserPerm" parameterClass="String" resultClass="userPerm">
		SELECT
		  T2.NAMESPACE AS nameSpace,
		  T2.ACTION_NAME AS actionName
		FROM
		  V_PER_USER_PERM T1,
		  PER_PERMIT T2
		WHERE
		  T1.USER_ID = #userId#
		AND
		  T1.PERM_ID = T2.PARENT_MODULE
		AND
		  T2.IS_PERM = '1'
		AND
		  (T2.SITE_URL='' OR T2.SITE_URL IS NULL);
	</select>
</sqlMap>  
