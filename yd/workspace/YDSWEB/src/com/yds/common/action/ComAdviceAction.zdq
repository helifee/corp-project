package com.yds.common.action;


import org.apache.struts2.ServletActionContext;
import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;

import com.yds.base.action.AbstractBaseAction;
import com.yds.common.bean.ComAdvice;
import com.yds.common.service.ComAdviceService;
import com.yds.common.service.SessionService;

/**
 * 意见反馈
 * 
 * @author qianguorong
 * @version 1.00 2010/08/05
 */
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
@Controller("comAdviceAction")
public class ComAdviceAction extends AbstractBaseAction {

	private static final long serialVersionUID = 1L;
	
	private ComAdvice comAdvice;
	private ComAdviceService comAdviceService;
	
	private String subSys;
	private String pageId;
	private String errorMessage;

	@Override
	public String execute() throws Exception {
		
		// 当前链接设定
		comAdvice = new ComAdvice();
		String refererUrl = ServletActionContext.getRequest().getHeader("referer");
		comAdvice.setPageLink(refererUrl);
		
		return SUCCESS;
	}
	
	/**
	 * 插入反馈信息
	 * 
	 * @return SUCCESS
	 */
	public String insertAdviceInfo() throws Exception {
		
		// 设定
		comAdvice.setAdvicer(SessionService.getLoginUserId());
		comAdvice.setIpAddress(ServletActionContext.getRequest().getRemoteAddr());
		comAdvice.setBrowser(ServletActionContext.getRequest().getHeader("User-Agent"));
		comAdvice.setSubSys(subSys);
		comAdvice.setPageId(pageId);
		
		// 插入
		comAdviceService.insertAdvice(comAdvice);
		
		// 显示操作成功消息
		errorMessage= propMgr.getMessage("com.yds.com.info.0019");
		return SUCCESS;
	}

	/**
	 * @param comAdviceService the comAdviceService to set
	 */
	public void setComAdviceService(ComAdviceService comAdviceService) {
		this.comAdviceService = comAdviceService;
	}


	/**
	 * @return the comAdviceService
	 */
	public ComAdviceService getComAdviceService() {
		return comAdviceService;
	}


	/**
	 * @param comAdvice the comAdvice to set
	 */
	public void setComAdvice(ComAdvice comAdvice) {
		this.comAdvice = comAdvice;
	}


	/**
	 * @return the comAdvice
	 */
	public ComAdvice getComAdvice() {
		return comAdvice;
	}

	/**
	 * @param pageId the pageId to set
	 */
	public void setPageId(String pageId) {
		this.pageId = pageId;
	}

	/**
	 * @return the pageId
	 */
	public String getPageId() {
		return pageId;
	}

	/**
	 * @param subSys the subSys to set
	 */
	public void setSubSys(String subSys) {
		this.subSys = subSys;
	}

	/**
	 * @return the subSys
	 */
	public String getSubSys() {
		return subSys;
	}

	/**
	 * @param errorMessage the errorMessage to set
	 */
	public void setErrorMessage(String errorMessage) {
		this.errorMessage = errorMessage;
	}

	/**
	 * @return the errorMessage
	 */
	public String getErrorMessage() {
		return errorMessage;
	}

}
