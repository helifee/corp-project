/*
 * @(#)AcionXmlElementImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 共通系统
 */

package com.yds.common.service.impl;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;

import org.dom4j.Element;

import com.yds.base.service.AbstractBaseService;
import com.yds.common.service.AcionXmlElement;

/**
 * @see AcionXmlElement
 */
public class AcionXmlElementImpl extends AbstractBaseService implements AcionXmlElement,Serializable{

	private static final long serialVersionUID = 9169215926110703019L;

	public static final String LINK_CONTETNT = "title";
	
	public static final String LINK_URL = "action";
	
	public static final String CLICKABLE = "clickable";
	
	public static final String PAGE_ID = "pageId";
	
	/** 链接显示内容. */
	private String title = "";
	
	/** 链接URL. */
	private String actionUrl = "";
	
	/** 是否可以点击. */
	private boolean clickable = true;
	
	/** XML节点. */
	private Element element = null;
	
	/** 当前Action请求的画面Id. */
	private String pageId = "";
	
	/** 父节点列表. */
	private List<AcionXmlElement> parentList = null;

	public AcionXmlElementImpl(Element element) {

		if (element.attribute(LINK_CONTETNT) != null) {
			title = element.attribute(LINK_CONTETNT).getText();
		}
		
		if (element.attribute(LINK_URL) != null) {
			actionUrl = element.attribute(LINK_URL).getText();
		}

		if (element.attribute(CLICKABLE) != null) {
			clickable = "0".equals(element.attribute(CLICKABLE).getText()) ? false : true;
		}
			
		if (element.attribute(PAGE_ID) != null) {
			pageId = element.attribute(PAGE_ID).getText();
		}
		
		this.element = element;

	}
	
	/**
	 * 得到父亲列表
	 * 
	 * @return 父亲列表
	 */
	private List<AcionXmlElement> getParentList() {
		
		if (parentList == null) {
			parentList = new ArrayList<AcionXmlElement>();
			setParentList(element);
		}
				
		return parentList;
	}
	
	/**
	 * 设置父节点列表
	 * 
	 * @param child
	 */
	private void setParentList(Element child) {

		Element parent = child.getParent();
		
		if (parent != null) {
			parentList.add(new AcionXmlElementImpl(parent));
			setParentList(parent);
		}
	}
	
	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<AcionXmlElement> getGuideList() {
		
		getParentList();
		
		List<AcionXmlElement> guideList = new ArrayList<AcionXmlElement>();
		
		for (int i = parentList.size() - 1; i >= 0; i--) {
			guideList.add(parentList.get(i));
		}
		
		this.clickable = false;
		
		guideList.add(this);
		
		return guideList;
	}
	
	/**
	 * {@inheritDoc}
	 */
	@Override
	public String getTitle() {
		return title;
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public String getActionUrl() {
		return actionUrl;
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public boolean getClickable() {
		return clickable;
	}
	
	@Override
	public String getPageId() {
		return pageId;
	}
}
