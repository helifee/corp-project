/*
 * @(#)LogServiceImpl.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 共通系统
 */

package com.yds.common.service.impl;

import org.springframework.stereotype.Service;

import com.yds.base.service.AbstractBaseService;
import com.yds.common.bean.LogInfo;
import com.yds.common.dao.LogMstDao;
import com.yds.common.service.LogService;
import com.yds.common.service.SessionConstants;
import com.yds.common.service.SessionService;

/**
 * @see LogService
 */
@Service("logService")
public class LogServiceImpl extends AbstractBaseService implements LogService {
	
	private LogMstDao logMstDao;

	/**
	 * {@inheritDoc}
	 */
	@Override
	public boolean insertLogInfo(String logLevel, String subId, String userId,
			String logMsg, String refer) {
		
		try {
			//声明Log信息Bean
			LogInfo logInfo = new LogInfo();
			
			//设置日志级别
			logInfo.setLogLevel(logLevel);
			
			//设置子系统ID,如果大于4位则取前4位
			if(null != subId) {
				if(subId.length() > 4) {
					subId = subId.substring(0, 4);					
				}
			}
			logInfo.setSubId(subId);
			
			//设置用户ID
			logInfo.setUserId(userId);
			
			//设置日志Message
			logInfo.setLogMsg(logMsg);
			
			//设置日志备注
			logInfo.setRefer(refer);
			
			//设置IP
			String ip = (String) SessionService.get(SessionConstants.IPADDR);
			logInfo.setLogIp(ip);
			
			//设置操作者
			logInfo.setOpId(SessionService.getLoginUserId());
			
			logMstDao.insertLog(logInfo);
			
		} catch(Exception e) {
			e.printStackTrace();
			return false;
		}
		
		return true;
	}
	
	/**
	 * @param logMstDao
	 *            the logMstDao to set
	 */
	public void setLogMstDao(LogMstDao logMstDao) {
		this.logMstDao = logMstDao;
	}

}
