/*
 * @(#)DateConverter.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 共通系统
 */

package com.yds.util.service;

import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;

import java.util.Date;
import java.util.Map;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.util.StrutsTypeConverter;

/**
 * 日期类型自动转换
 * 
 * @author songshu
 * @version 1.00 2010/02/23
 */
public class DateConverter extends StrutsTypeConverter {

	private static final Log LOG = LogFactory.getLog(DateConverter.class);

	// 支持转换的日期格式
	private static final DateFormat[] DATE_FORMATS = {
			new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"),
			new SimpleDateFormat("yyyy/MM/dd HH:mm:ss"),
			new SimpleDateFormat("yyyy-MM-dd"),
			new SimpleDateFormat("yyyy/MM/dd"),
			new SimpleDateFormat("yyyy.MM.dd"),
			new SimpleDateFormat("yyyy年MM月dd日"),
			new SimpleDateFormat("yyyyMMdd")};

	/**
	 * 从String->Date (JSP->JAVA) 把string型数据转换为指定对象（日期）.
	 * 
	 * @param context
	 *            the action context
	 * @param values
	 *            the String values to be converted, such as those submitted
	 *            from an HTML form
	 * @param toClass
	 *            the class to convert to
	 * @return the converted object
	 */
	@SuppressWarnings("unchecked")
	@Override
	public Object convertFromString(Map context, String[] values, Class toClass) {

		if (null == values[0] || "".equals(values[0].trim())) {
			return null;
		}

		for (DateFormat dateFormat : DATE_FORMATS) {

			try {
				// 遍历日期支持格式，进行转换
				return dateFormat.parse(values[0]);
			} catch (ParseException e) {
				continue;
			} catch (Exception e) {

				// 不明错误
				e.printStackTrace();
				return null;
			}
		}

		// 无支持格式，无法转换
		LOG.debug("无法转换的格式:" + values[0]);
		return null;
	}

	/**
	 * 从Date->String (JAVA->JSP) 将日期类型数据转换为String型数据.
	 * 
	 * @param context
	 *            the action context
	 * @param o
	 *            the object to be converted
	 * @return the converted String
	 */
	@SuppressWarnings("unchecked")
	@Override
	public String convertToString(Map context, Object o) {

		Date date = (Date) o;
		SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd");
		try {

			// date转换为String
			return formatter.format(date);
		} catch (Exception e) {

			// 不明错误
			e.printStackTrace();
			return "";
		}
	}

}
