/*
 * @(#)ExcelToSql.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 共通测试系统
 */
package com.yds.util.service;

import java.io.BufferedWriter;
import java.io.FileWriter;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.yds.base.test.ExcelSheetToTable;

/**
 * 把利用Excel文件中的数据生成Insert语句的Sql文件，便于插入到数据库中<br>
 * 
 * @author tianjian
 * 
 */
public class ExcelToSql {

	protected static final Log logger = LogFactory.getLog(ExcelToSql.class);
	
	public void printSql(String excelPath,BufferedWriter bw,boolean isDelete) throws Exception{
		ExcelSheetToTable[] excelTables = ExcelSheetToTable.getSheetTables(excelPath);
		for(ExcelSheetToTable excelTable : excelTables){
			List<String> sqlList = excelTable.get_insertSqlWithValueList();
			if(!isDelete){
				bw.write("-- ");
			}
			bw.write("DELETE FROM " + excelTable.getTableName()+"; \r\n");
			for(String sql : sqlList){
				bw.write(sql +"; \r\n");
			}
			bw.write("\r\n");
		}
	}
	/**
	 * @param args
     * 			args[0]excel文件名
	 * 			args[1]sql文件名
	 * 	        args[2]是否生成删除表的语句
	 */
	public static void main(String[] args) throws Exception{
		if(args.length < 2){
			logger.info("您提供的参数不够。参数说明如下");
			logger.info("第一个参数：excel文件名，如D:\\tables\\Department.xls");
			logger.info("第二个参数：sql文件名。如D:\\tables\\insert.sql");
			logger.info("第三个参数：删除表的语句是否注释掉,填 ture或false，默认是false");
			return;
		}
		BufferedWriter bw = null;
		try {
			ExcelToSql sql = new ExcelToSql();
			bw = new BufferedWriter(new FileWriter(args[1]));
			boolean isDelete = false;
			if(3 == args.length){
				isDelete = Boolean.parseBoolean(args[2]);
			}
			sql.printSql(args[0],bw,isDelete);
			logger.info(args[1]+"文件生成成功");
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			if (null != bw) {
				bw.close();
			}
		}
		
	}

}
