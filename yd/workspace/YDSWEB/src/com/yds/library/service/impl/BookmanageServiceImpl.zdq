/*
 * @(#)BookmanageServiceImpl.java
 * Copyright (c) 2010-2011 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东工会图书管理
 */

package com.yds.library.service.impl;

import java.util.List;

import org.springframework.stereotype.Service;

import com.yds.common.service.LoginService;
import com.yds.library.bean.Bookinfo;
import com.yds.library.dao.BookmanageDao;
import com.yds.library.service.BookmanageService;
import com.yds.library.util.Sessionadit;

/**
 * @see LoginService
 */
@Service("bookmanageService")
public class BookmanageServiceImpl implements BookmanageService {

	private BookmanageDao bookmanageDao;
	
	/**
	 * {@inheritDoc}
	 */
	@Override
	public List<Bookinfo> getbookmanageInfo(Bookinfo bookmanageInfo) {
		List<Bookinfo> bookmanageList = this.bookmanageDao.getBookmanageInfo(bookmanageInfo);
		return bookmanageList;
	}
	
	/**
	 * {@inheritDoc}
	 */
	@Override
	public String getpursename(String purseid) {
		String purseName = this.bookmanageDao.getPursename(purseid);
		return purseName;
	}
	
	public void setBookmanageDao(BookmanageDao bookmanageDao) {
		this.bookmanageDao = bookmanageDao;
	}

	/**
	 * {@inheritDoc}
	 */
	@Override
	public boolean updatebookInfo(List<Bookinfo> bookinfoUpdate,String deletenum) {
		
		Bookinfo bookinfoUpd = new Bookinfo();
		int result = 1;
		
		// 更新信息
		for (int i = 0; i < bookinfoUpdate.size(); i++) {
			bookinfoUpd = bookinfoUpdate.get(i);
			result = this.bookmanageDao.updateBookInfo(bookinfoUpd);
		}
		
		// 更新失败
		if (result < 0) {
			return false;
		}
		
		// 将信息存入session
		Sessionadit.sessionplus(Integer.valueOf(deletenum),0);
		
		return true;
	}

	@Override
	public String getloanNum(List<Bookinfo> bookinfoNum) {
		int count = 0;
		int listSize = bookinfoNum.size();
		for (int i = 0; i < listSize; i++) {
			if ("0".equals(bookinfoNum.get(i).getLoanFlg())) {
				count += 1;
			}
		}
		String loanNum = String.valueOf(count);
		return loanNum;
	}

	@Override
	public String getallbooksNum() {
		
		return this.bookmanageDao.getBookCount();
	}
	
}