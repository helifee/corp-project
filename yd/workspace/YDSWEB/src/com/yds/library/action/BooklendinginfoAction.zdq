/*
 * @(#) BooklendinginfoAction.java
 * Copyright (c) 2010-2011 大连远东计算机系统有限公司
 * All rights reserved.
 * Project: 远东公司内部网
 * SubSystem: 图书管理系统
 */
package com.yds.library.action;


import java.util.List;

import org.springframework.beans.factory.config.BeanDefinition;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Controller;
import com.yds.base.action.AbstractBaseAction;
import com.yds.common.bean.UserInfo;
import com.yds.common.service.LoginService;
import com.yds.common.service.SessionConstants;
import com.yds.library.bean.Bookinfo;
import com.yds.library.service.BooklendinginfoService;
import com.yds.library.util.LibraryPermit;
import com.yds.library.util.Sessionadit;
import com.yds.util.service.Session;

/**
 * 书籍借阅信息明细操作
 * 
 * @author liyi
 * @version 1.0 2010/12/17
 */
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
@Controller("booklendinginfoAction")
public class BooklendinginfoAction extends AbstractBaseAction {

	private static final long serialVersionUID = -1397051695703253298L;
	
	private String idInput; // 用户ID

	private String nameInput; // 用户名
	
	private List<Bookinfo> bookinfo; // 图书检索bean
	
	private Bookinfo bookinfosercth; // 图书检索bean
	
	private Bookinfo bookinfoupdate; // 更新bean
	
	private Integer overdaysnum; // 逾期件数
	
	private String mimaparam;// 前台密码

	private String mimaTF; // 密码正确与否
	
	private LoginService loginService; // 密码验证service
	
	/**
	 * @return the mimaparam
	 */
	public String getMimaparam() {
		return mimaparam;
	}

	/**
	 * @param mimaparam the mimaparam to set
	 */
	public void setMimaparam(String mimaparam) {
		this.mimaparam = mimaparam;
	}

	/**
	 * @return the mimaTF
	 */
	public String getMimaTF() {
		return mimaTF;
	}

	/**
	 * @param mimaTF the mimaTF to set
	 */
	public void setMimaTF(String mimaTF) {
		this.mimaTF = mimaTF;
	}

	/**
	 * 画面迁移 借阅信息 初始页面
	 * 
	 * @param：
	 * @return SUCCESS
	 */

	public String getlendinginfo() throws Exception {
		//权限取得
		if (LibraryPermit.hasThePermitOfAdmin()) {
			if(bookinfosercth==null){
				bookinfosercth= new Bookinfo();
			}
			this.bookinfo = booklendinginfoService.getbooklendinginfo(bookinfosercth);
			overdaysnum=booklendinginfoService.getoverdaysnum(bookinfo);
			return SUCCESS;
		} else {
			return "nopermit";
		}

	}
	
	/**
	 * 借阅信息 条件检索
	 * 
	 * @param：ISBN name flg id
	 * @return SUCCESS
	 */

	public String getlendingmxinfo() throws Exception {
		//权限取得
		if (LibraryPermit.hasThePermitOfAdmin()) {
			if(bookinfosercth==null){
				bookinfosercth= new Bookinfo();
			}
			this.bookinfo = booklendinginfoService.getbooklendinginfo(bookinfosercth);
			return SUCCESS;
		}
		else {
			return "nopermit";
		}

	}	
	/**
	 *用户密码验证
	 * 
	 * @param mima
	 * @return mimaTF=0密码错误，mimaTF=1密码正确 借书画面
	 */
	public String mmvalidate() throws Exception {
		// 取得用户session
		UserInfo loginuser = (UserInfo) Session.get(SessionConstants.USERINFO);
		String userIdaa = loginuser.getUserId();
		if (this.loginService.loginCheck(userIdaa, mimaparam, false) == null) {
			mimaTF = "0";
		} else {
			mimaTF = "1";
		}
		return SUCCESS;
	}
	/**
	 * @return the loginService
	 */
	public LoginService getLoginService() {
		return loginService;
	}

	/**
	 * @param loginService the loginService to set
	 */
	public void setLoginService(LoginService loginService) {
		this.loginService = loginService;
	}

	/**
	 *  借阅信息 归还操作
	 * 
	 * @param： bookid
	 * @return SUCCESS
	 */

	public String updateLoaninfo() throws Exception {
		//权限取得
		if (LibraryPermit.hasThePermitOfAdmin()) {
			booklendinginfoService.updatebooklendinginfo(bookinfoupdate);
			
			UserInfo loginuser = (UserInfo) Session.get(SessionConstants.USERINFO);
			
			String userid = loginuser.getUserId();
			
			if(userid.equals(bookinfoupdate.getPurseid())){
				Sessionadit.sessionplus(0, 1);
			}
			
			if(bookinfosercth==null){
				bookinfosercth= new Bookinfo();
			}
			this.bookinfo = booklendinginfoService.getbooklendinginfo(bookinfosercth);
			overdaysnum=booklendinginfoService.getoverdaysnum(bookinfo);
			return SUCCESS;
		}
		else {
			return "nopermit";
		}

	}	
	
	/**
	 * @return the idInput
	 */
	public String getIdInput() {
		return idInput;
	}

	/**
	 * @param idInput the idInput to set
	 */
	public void setIdInput(String idInput) {
		this.idInput = idInput;
	}

	/**
	 * @return the nameInput
	 */
	public String getNameInput() {
		return nameInput;
	}

	/**
	 * @param nameInput the nameInput to set
	 */
	public void setNameInput(String nameInput) {
		this.nameInput = nameInput;
	}
	
	/**
	 * @return the overdaysnum
	 */
	public Integer getOverdaysnum() {
		return overdaysnum;
	}

	/**
	 * @param overdaysnum the overdaysnum to set
	 */
	public void setOverdaysnum(Integer overdaysnum) {
		this.overdaysnum = overdaysnum;
	}

	/**
	 * @return the bookinfoupdate
	 */
	public Bookinfo getBookinfoupdate() {
		return bookinfoupdate;
	}

	/**
	 * @param bookinfoupdate the bookinfoupdate to set
	 */
	public void setBookinfoupdate(Bookinfo bookinfoupdate) {
		this.bookinfoupdate = bookinfoupdate;
	}

	/**
	 * @return the bookinfosercth
	 */
	public Bookinfo getBookinfosercth() {
		return bookinfosercth;
	}

	/**
	 * @param bookinfosercth the bookinfosercth to set
	 */
	public void setBookinfosercth(Bookinfo bookinfosercth) {
		this.bookinfosercth = bookinfosercth;
	}

	private BooklendinginfoService booklendinginfoService;
	

	/**
	 * @return the booklendinginfoService
	 */
	public BooklendinginfoService getBooklendinginfoService() {
		return booklendinginfoService;
	}

	/**
	 * @param booklendinginfoService the booklendinginfoService to set
	 */
	public void setBooklendinginfoService(
			BooklendinginfoService booklendinginfoService) {
		this.booklendinginfoService = booklendinginfoService;
	}

	/**
	 * @return the bookinfo
	 */
	public List<Bookinfo> getBookinfo() {
		return bookinfo;
	}

	/**
	 * @param bookinfo the bookinfo to set
	 */
	public void setBookinfo(List<Bookinfo> bookinfo) {
		this.bookinfo = bookinfo;
	}

	/**
	 * @return the serialversionuid
	 */
	public static long getSerialversionuid() {
		return serialVersionUID;
	}
	

	
	
}