/*
 * @(#)BatchGroupDaoImplTest.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 批处理系统
 */

package com.yds.batch.dao.impl;

import java.util.Iterator;
import java.util.List;

import javax.annotation.Resource;

import org.junit.After;
import org.junit.Before;
import org.junit.Ignore;
import org.junit.Test;

import com.yds.base.test.AbstractSpringTransTest;
import com.yds.base.test.BeanAssert;
import com.yds.batch.bean.BatchGroup;
import com.yds.batch.dao.BatchGroupDao;

/**
 * 批处理任务组（数据库访问）类测试
 * 
 * @author wangduo
 * @version 1.0 2010/05/31
 */
public class BatchGroupDaoImplTest extends AbstractSpringTransTest {

	@Resource
	BatchGroupDao batchGroupDao;
	
	/**
	 * @throws java.lang.Exception
	 */
	@Before
	public void setUp() throws Exception {
		
		deleteFromTables("bat_group","bat_group_his","bat_group_jobs","bat_job","bat_job_his");
		initCommonData(BatchGroupDaoImpl.class);
		
		// 初始化数据库
		initData("input01.xls", "result01.xls");
		
	}

	/**
	 * @throws java.lang.Exception
	 */
	@After
	public void tearDown() throws Exception {
	}

	/**
	 * Test method for {@link com.yds.batch.dao.impl.BatchGroupDaoImpl#getBatchGroups()}.
	 * @throws Exception 
	 */
	@Test
	public void testGetBatchGroups() throws Exception {
		
		// 任务组期望结果
		List<BatchGroup> expectJobGroups = getExpectList(BatchGroup.class,"expect_get");
	
		// 任务组实际结果
		List<BatchGroup> actualJobGroups = batchGroupDao.getBatchGroups();
		
		BeanAssert.assertListEquals(expectJobGroups, actualJobGroups);

		
	}

	/**
	 * Test method for {@link com.yds.batch.dao.impl.BatchGroupDaoImpl#updateExecInfo(com.yds.batch.bean.BatchGroup)}.
	 * @throws Exception 
	 */
	@Test
	@Ignore
	public void testUpdateExecInfo() throws Exception {
		
		// 任务组期望结果
		List<BatchGroup> expectJobGroups = getExpectList(BatchGroup.class,"expect_update");
	
		for (Iterator<BatchGroup> iter = expectJobGroups.iterator(); iter.hasNext();) {
			batchGroupDao.updateExecInfo(iter.next());
		}
		
		// 任务组实际结果
		List<BatchGroup> actualJobGroups = findListBeanByCondition(BatchGroup.class, "param_BAT_GROUP");
		
		BeanAssert.assertListEquals(expectJobGroups, actualJobGroups);

	}

	/**
	 * Test method for {@link com.yds.batch.dao.impl.BatchGroupDaoImpl#insertExecHis(com.yds.batch.bean.BatchGroup)}.
	 * @throws Exception 
	 */
	@Test
	@Ignore
	public void testInsertExecHis() throws Exception {

		// 任务组期望结果
		List<BatchGroup> expectJobGroups = getExpectList(BatchGroup.class,"expect_insert");
	
		for (Iterator<BatchGroup> iter = expectJobGroups.iterator(); iter.hasNext();) {
			batchGroupDao.insertExecHis(iter.next());
		}
		
		// 任务组实际结果
		List<BatchGroup> actualJobGroups = findListBeanByCondition(BatchGroup.class, "param_BAT_GROUP_HIS");
		
		BeanAssert.assertListEquals(expectJobGroups, actualJobGroups);
		
	}

	/**
	 * Test method for {@link com.yds.batch.dao.impl.BatchGroupDaoImpl#modifyStatus()}.
	 * @throws Exception 
	 */
	@Test
	public void testStatusModify() throws Exception {

		// 任务组期望结果
		List<BatchGroup> expectJobGroups = getExpectList(BatchGroup.class,"expect_modify");
	
		batchGroupDao.modifyStatus();
	
		// 任务组实际结果
		List<BatchGroup> actualJobGroups = findListBeanByCondition(BatchGroup.class, "param_BAT_GROUP");
		
		BeanAssert.assertListEquals(expectJobGroups, actualJobGroups);
		
	}

}
