/*
 * @(#)BatchJobDaoImplTest.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 批处理系统
 */

package com.yds.batch.dao.impl;

import java.util.Iterator;
import java.util.List;

import javax.annotation.Resource;

import org.junit.After;
import org.junit.Before;
import org.junit.Ignore;
import org.junit.Test;

import com.yds.base.test.AbstractSpringTransTest;
import com.yds.base.test.BeanAssert;
import com.yds.batch.bean.BatchJob;
import com.yds.batch.dao.BatchJobDao;

/**
 * 批处理任务（数据库访问）类测试
 * 
 * @author wangduo
 * @version 1.0 2010/05/31
 */
public class BatchJobDaoImplTest extends AbstractSpringTransTest {

	@Resource
	BatchJobDao batchJobDao;
	
	/**
	 * @throws java.lang.Exception
	 */
	@Before
	public void setUp() throws Exception {
		
		deleteFromTables("bat_group","bat_group_his","bat_group_jobs","bat_job","bat_job_his");
		initCommonData(BatchJobDaoImpl.class);
		
		// 初始化数据库
		initData("input01.xls", "result01.xls");
		
	}

	/**
	 * @throws java.lang.Exception
	 */
	@After
	public void tearDown() throws Exception {
	}

	/**
	 * Test method for {@link com.yds.batch.dao.impl.BatchJobDaoImpl#getGroupJobs(java.lang.String)}.
	 * @throws Exception 
	 */
	@Test
	public void testGetGroupJobs() throws Exception {

		// 任务期望结果
		List<BatchJob> expectJobs = getExpectList(BatchJob.class,"expect_get");
		
		String groupId = getParamObject(String.class, "param_get");
	
		// 任务实际结果
		List<BatchJob> actualJobs = batchJobDao.getGroupJobs(groupId);
		
		BeanAssert.assertListEquals(expectJobs, actualJobs);
		
	}

	/**
	 * Test method for {@link com.yds.batch.dao.impl.BatchJobDaoImpl#insertExecHis(com.yds.batch.bean.BatchJob)}.
	 * @throws Exception 
	 */
	@Test
	@Ignore
	public void testInsertExecHis() throws Exception {
		
		// 任务履历期望结果
		List<BatchJob> expectJobHis = getExpectList(BatchJob.class,"expect_insert");
		
		for (Iterator<BatchJob> iter = expectJobHis.iterator(); iter.hasNext();) {
			batchJobDao.insertExecHis(iter.next());
		}
	
		// 任务履历实际结果
		List<BatchJob> actualJobHis = findListBeanByCondition(BatchJob.class, "param_BAT_JOB_HIS");
		
		BeanAssert.assertListEquals(expectJobHis, actualJobHis);
		
	}

}
