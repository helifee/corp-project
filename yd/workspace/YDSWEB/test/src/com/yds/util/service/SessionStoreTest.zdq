/**
 * 
 */
package com.yds.util.service;

import static org.junit.Assert.fail;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import com.yds.base.test.AbstractSpringTransTest;
import com.yds.base.test.BeanAssert;
import com.yds.base.test.ExcelUtil;
import com.yds.common.service.SessionConstants;
import com.yds.util.bean.SessionStoreBean;

/**
 * 
 * @author wangduo
 * @version 1.00 2010/06/24
 */
public class SessionStoreTest extends AbstractSpringTransTest{

	private Map<String, Object> session;
	
	private List<SessionStoreBean> expectDatas;
	
	private SessionStoreBean firstStore;
	
	private SessionStoreBean secondStore;
	
	private String firstKey = "testSet1";
	private String firstCondition = "condition1";
	private String firstData = "data1";
	
	private String secondKey = "testSet2";
	private String secondCondition = "condition2";
	private String secondData = "data2";
	
	/**
	 * @throws java.lang.Exception
	 */
	@Before
	public void setUp() throws Exception {
		
		session = ExcelUtil.getSession();
		
		// 期望值设置
		expectDatas = new ArrayList<SessionStoreBean>();
		
		firstStore = new SessionStoreBean();
		firstStore.setKey(firstKey);
		firstStore.setCondition(firstCondition);
		
		secondStore = new SessionStoreBean();
		secondStore.setKey(secondKey);
		secondStore.setCondition(secondCondition);
		secondStore.setData(secondData);
		
		expectDatas.add(firstStore);
		expectDatas.add(secondStore);
		
		// 实际值设置
		SessionStore.setCondition(firstKey, firstCondition);

		SessionStore.setCondition(secondKey, secondCondition);
		SessionStore.setData(secondKey, firstData);
		SessionStore.setData(secondKey, secondData);
	}

	/**
	 * @throws java.lang.Exception
	 */
	@After
	public void tearDown() throws Exception {
	}

	/**
	 * Test method for {@link com.yds.util.service.SessionStore#setCondition(java.lang.String, java.lang.Object)}.
	 * @throws Exception 
	 */
	@SuppressWarnings("unchecked")
	@Test
	public void testSet() throws Exception {
	
		List<SessionStoreBean> actualDatas = (List<SessionStoreBean>) session.get(SessionConstants.STORELIST);

		BeanAssert.assertListEquals(expectDatas, actualDatas);
		
	}

	/**
	 * Test method for {@link com.yds.util.service.SessionStore#getCondition(java.lang.String)}.
	 * @throws Exception 
	 */
	@SuppressWarnings("unchecked")
	@Test
	public void testGetCondition() throws Exception {
		
		String actualFirstCondition = (String) SessionStore.getCondition(firstKey);
		
		BeanAssert.assertBeanEquals(firstCondition, actualFirstCondition);
		
		List<SessionStoreBean> actualDatas = (List<SessionStoreBean>) session.get(SessionConstants.STORELIST);
		
		expectDatas.remove(1);
		
		BeanAssert.assertListEquals(expectDatas, actualDatas);
	}
	
	/**
	 * Test method for {@link com.yds.util.service.SessionStore#getData(java.lang.String)}.
	 * @throws Exception 
	 */
	@Test
	public void testGetData() throws Exception {
		
		String actualSecondData = (String) SessionStore.getData(secondKey);
		
		BeanAssert.assertBeanEquals(secondData, actualSecondData);
		
	}

	/**
	 * Test method for {@link com.yds.util.service.SessionStore#destroy()}.
	 */
	@Test
	public void testDestroy() {
		SessionStore.destroy();
		
		if (null != session.get(SessionConstants.STORELIST)) {
			fail("数据销毁失败");
		}
	}

}
