/*
 * @(#)ComSequenceResetServiceImplTest.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 共通系统
 */
package com.yds.common.service.impl;
import static com.yds.base.test.BeanAssert.assertListLenientEquals;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.List;
import javax.annotation.Resource;
import org.junit.Before;
import org.junit.Test;
import com.yds.base.test.AbstractSpringTransTest;
import com.yds.common.bean.ComSeq;
import com.yds.common.dao.ComSequenceDao;
import com.yds.common.service.ComSequenceResetService;

/**
 * 采番重置处理BATCH（数据库操作）测试.
 * 
 * @author mengxiaoyan
 * @version 1.00 2010/08/19
 */
public class ComSequenceResetServiceImplTest extends AbstractSpringTransTest {
	@Resource
	private ComSequenceResetService comSequenceResetService;
	@Resource
	private ComSequenceDao comSequenceDao;
	/**
	 * @throws java.lang.Exception
	 */
	@Before
	public void setUp() throws Exception {
		// 删除表中数据(避免和测试数据冲突)
		this.deleteFromTables("com_seq");

		initCommonData(ComSequenceResetServiceImpl.class);
	}
	/**
	 * Test method for {@link com.yds.common.service.impl.ComSequenceResetServiceImpl#resetSequence()}.
	 */
	@Test
	public final void testResetSequenceWeekEnd() throws Exception  {
		SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");   
		try {
			//周末星期五
			comSequenceResetService.setResetDay(format.parse("2010-09-03"));			
		} catch (ParseException e) {
			e.printStackTrace();
		}
		// 初始化数据库
		initData("input01.xls", "result01.xls");
		// 调用被测试方法
		comSequenceResetService.resetSequence();
		List<ComSeq> actualInfo = comSequenceDao.getAllSequence();
		// 得到预期值
		List<ComSeq> expectInfo = getExpectList(ComSeq.class,"expect");

		// 断言检索结果和预期是否一致
		assertListLenientEquals(expectInfo, actualInfo);

	}
	

	@Test
	public final void testResetSequenceMonthEnd() throws Exception   {
		SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");   
		try {
			//月末
			comSequenceResetService.setResetDay(format.parse("2010-09-30"));		
		} catch (ParseException e) {
			e.printStackTrace();
		}
		// 初始化数据库
		initData("input02.xls", "result02.xls");
		// 调用被测试方法
		comSequenceResetService.resetSequence();
		List<ComSeq> actualInfo = comSequenceDao.getAllSequence();
		// 得到预期值
		List<ComSeq> expectInfo = getExpectList(ComSeq.class,"expect");

		// 断言检索结果和预期是否一致
		assertListLenientEquals(expectInfo, actualInfo);
	}
	

	@Test
	public final void testResetSequenceYearEnd() throws Exception  {
		SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");   
		try {
			//年末（月末）
			comSequenceResetService.setResetDay(format.parse("2010-12-31"));			
		} catch (ParseException e) {
			e.printStackTrace();
		}
		// 初始化数据库
		initData("input03.xls", "result03.xls");
		// 调用被测试方法
		comSequenceResetService.resetSequence();
		List<ComSeq> actualInfo = comSequenceDao.getAllSequence();
		// 得到预期值
		List<ComSeq> expectInfo = getExpectList(ComSeq.class,"expect");

		// 断言检索结果和预期是否一致
		assertListLenientEquals(expectInfo, actualInfo);
	}
	/**
	 * @return the comSequenceResetService
	 */
	public ComSequenceResetService getComSequenceResetService() {
		return comSequenceResetService;
	}
	/**
	 * @return the comSequenceDao
	 */
	public ComSequenceDao getComSequenceDao() {
		return comSequenceDao;
	}
	/**
	 * @param comSequenceResetService the comSequenceResetService to set
	 */
	public void setComSequenceResetService(
			ComSequenceResetService comSequenceResetService) {
		this.comSequenceResetService = comSequenceResetService;
	}
	/**
	 * @param comSequenceDao the comSequenceDao to set
	 */
	public void setComSequenceDao(ComSequenceDao comSequenceDao) {
		this.comSequenceDao = comSequenceDao;
	}
}
