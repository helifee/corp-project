/*
 * @(#) Yb0050ServiceImplTest.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东计算机社内网
 *    SubSystem: 人员管理
 */

package com.yds.employee.service.impl;

import static com.yds.base.test.BeanAssert.*;

import java.util.List;

import javax.annotation.Resource;

import org.junit.Before;
import org.junit.Test;

import com.yds.base.test.AbstractSpringTransTest;
import com.yds.common.bean.OrgMapInfo;
import com.yds.employee.service.Yb0050Service;

/**
 * 组织结构图（业务逻辑处理测试）
 * 
 * @author 远东)bixiuqing
 * @version 1.00 2010/08/03
 */
public class Yb0050ServiceImplTest extends AbstractSpringTransTest {

	/** @Resource，自动注入 */
	@Resource
	private Yb0050Service yb0050Service;

	/**
	 * @throws java.lang.Exception
	 */
	@Before
	public void setUp() throws Exception {
		// 删除表中数据(避免和测试数据冲突)
		deleteFromTables("SYS_CODE_MST", "EMP_ORG_INFO","EMP_INFO");

		initCommonData(Yb0050ServiceImpl.class, "init.xls");
	}

	/**
	 * Test method for
	 * {@link com.yds.employee.service.impl.Yb0050ServiceImpl#getOrgInfoRoot(java.lang.String[])}
	 * .
	 */
	@Test
	public void testGetOrgInfoRoot() throws Exception {

		// 初始化数据库
		initData("", "result.xls");

		// 调用被测试方法
		OrgMapInfo actualInfo = yb0050Service.getOrgInfoRoot(true);
		// 得到预期值
		OrgMapInfo expectInfo = getExpectObject(OrgMapInfo.class, "expect1");
		List<OrgMapInfo> orgMapInfos = getExpectList(OrgMapInfo.class, "expect1_1");
		expectInfo.setChilds(orgMapInfos);
		orgMapInfos = getExpectList(OrgMapInfo.class, "expect1_2");
		expectInfo.getChilds().get(2).setChilds(orgMapInfos);
		// 断言检索结果和预期是否一致
		assertBeanLenientEquals(expectInfo, actualInfo);

		// 初始化测试方法参数
		String orgInfo = getParamObject(String.class, "param2");
		// 调用被测试方法
		actualInfo = yb0050Service.getOrgInfoRoot(true, orgInfo);
		// 得到预期值
		expectInfo = getExpectObject(OrgMapInfo.class, "expect2");
		orgMapInfos = getExpectList(OrgMapInfo.class, "expect2_1");
		expectInfo.setChilds(orgMapInfos);
		orgMapInfos = getExpectList(OrgMapInfo.class, "expect2_2");
		expectInfo.getChilds().get(1).setChilds(orgMapInfos);
		orgMapInfos = getExpectList(OrgMapInfo.class, "expect2_3");
		expectInfo.getChilds().get(2).setChilds(orgMapInfos);
		orgMapInfos = getExpectList(OrgMapInfo.class, "expect2_4");
		expectInfo.getChilds().get(2).getChilds().get(1).setChilds(orgMapInfos);
		// 断言检索结果和预期是否一致
		assertBeanLenientEquals(expectInfo, actualInfo);

	}

}
