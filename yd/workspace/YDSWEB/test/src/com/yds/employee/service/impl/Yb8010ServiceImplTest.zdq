/*
 * @(#) Yb8010ServiceImplTest.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东计算机社内网
 *    SubSystem: 人员管理
 */
package com.yds.employee.service.impl;

import static com.yds.base.test.BeanAssert.assertListEquals;
import java.util.Date;
import java.util.List;
import javax.annotation.Resource;
import org.junit.Before;
import org.junit.Ignore;
import org.junit.Test;
import org.springframework.test.context.transaction.AfterTransaction;
import org.springframework.test.context.transaction.BeforeTransaction;
import com.yds.base.test.AbstractSpringTransTest;
import com.yds.base.test.ExcelUtil;
import com.yds.common.bean.EmpInfo;
import com.yds.employee.service.Yb8010Service;

/**
 * 员工状态改变（BATCH）测试
 * 新数据库相关操作
 * 
 * @author 远东)mengxiaoyan
 * @version 1.00 2010/09/02
 */
public class Yb8010ServiceImplTest extends AbstractSpringTransTest {
	
	/** @Resource，自动注入 */
	@Resource
	public Yb8010Service yb8010Service;
	Date now;		
	/**
	 * @throws java.lang.Exception
	 */
	@Before
	public void setUp() throws Exception {
		// 删除表中数据(避免和测试数据冲突)
		deleteFromTables("EMP_INFO", "EMP_STATE_INFO");

		initCommonData(Yb8010ServiceImpl.class);
	}
	
	@BeforeTransaction
	public void beforeTransaction() throws Exception {
		now = new Date();
		//设置系统日期
		ExcelUtil.setSystemTime("2010-09-13", "00:00:00");
	}
	@AfterTransaction
	public void afterTransaction() throws Exception {
		// 恢复系统日期
		ExcelUtil.recoverySystemTime(now);	
	}
	/**
	 * Test method for {@link com.yds.employee.service.impl.yb8010ServiceImpl#empInfoIntegrate()}.
	 * @throws Exception 
	 */
	@Test
	@Ignore
	public void testEmpInfoIntegrate() throws Exception {
		
		// 初始化数据库
		initData("input.xls", "result.xls");

		// 调用被测试方法
		yb8010Service.empInfoIntegrate();
		// 获得数据库数据
		List<EmpInfo> actualInfo = findListBeanByCondition(EmpInfo.class, "param_EMP_INFO");		
		// 得到预期值
		List<EmpInfo> expectInfo = getExpectList(EmpInfo.class, "expect");
		// 断言检索结果和预期是否一致
		assertListEquals(expectInfo, actualInfo);
		

	}	
}
