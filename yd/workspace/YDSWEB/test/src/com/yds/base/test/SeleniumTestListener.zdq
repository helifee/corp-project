/*
 * @(#)SeleniumTestListener.java
 * Copyright (c) 2009-2010 大连远东计算机系统有限公司
 * All rights reserved.
 *      Project: 远东公司内部网
 *    SubSystem: 共通系统
 */
package com.yds.base.test;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.junit.runner.notification.Failure;
import org.junit.runner.notification.RunListener;

import com.thoughtworks.selenium.Selenium;

/**
 * 添加测试失败时抓图功能.
 * 
 * @author tianjian
 */
public class SeleniumTestListener extends RunListener {

	/** LOG factory. */
	private static final Log LOG = LogFactory.getLog(SeleniumTestListener.class);

	/**
	 * 重载testFailure方法，添加测试失败时抓图功能.
	 */
	@Override
	public void testFailure(Failure failure) {
		CoreSeleniumTest coreSeleniumTest = new CoreSeleniumTest();
		Selenium selenium = coreSeleniumTest.getSelenium();
		String imgFilePath = coreSeleniumTest.getErrorShotPath() + failure.getDescription().getDisplayName() + ".png";
		try {
			selenium.captureScreenshot(imgFilePath);
			LOG.error("Saved screenshot to " + imgFilePath);
		} catch (Exception e) {
			LOG.error("Couldn't save screenshot to " + imgFilePath + ": " + e.getMessage());
		}
	}

}
