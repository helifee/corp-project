<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Yd0030Dao">
	<typeAlias alias="gpsGoodsInfo" type="com.yds.gps.bean.GpsGoodsInfo"/>
	<typeAlias alias="gpsGoodsCate" type="com.yds.gps.bean.GpsGoodsCate"/>
	<typeAlias alias="gpsOrderInfo" type="com.yds.gps.common.bean.GpsOrderInfo"/>
	<typeAlias alias="gpsOrderGoods" type="com.yds.gps.bean.GpsOrderGoods"/>
	<typeAlias alias="gpsAccount" type="com.yds.gps.bean.GpsAccount"/>
	<typeAlias alias="condA" type="com.yds.gps.bean.Yd0030CondA"/>
	
	<!-- 商品信息取得 --> 
	<select id="getGpsGoodsInfoList" parameterClass="condA" resultClass="gpsGoodsInfo">
		SELECT
          GOODS_ID AS goodsId,
          MNGR_ID AS mngrId,
          GOODS_CATE_ID AS goodsCateId,
		  STORE AS store,
          GOODS_NAME AS goodsName,
          GOODS_PRICE AS goodsPrice,
		  DISPLAY_SEQ AS displaySeq,
          GOODS_DESC AS goodsDesc,
          GOODS_IMAGE AS goodsImage,
		  GOODS_SWITCH AS goodsSwitch,
		  CREATE_TIME AS creatTime,
          UPDATE_TIME AS updateTime,
          UPDATE_USER AS updateUser
        FROM GPS_GOODS_INFO
		WHERE GOODS_SWITCH = '1'
		<isNotEmpty prepend="AND" property="goodsCateId">
			GOODS_CATE_ID = #goodsCateId#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="goodsId">
			GOODS_ID = #goodsId#
		</isNotEmpty>
		ORDER BY DISPLAY_SEQ;
	</select>
	
	<!-- 订单商品list --> 
	<select id="getGpsOrderGoodsList" parameterClass="String" resultClass="String">
		SELECT
			GOODS_ID AS goodsId
        FROM 
			GPS_ORDER_GOODS
		WHERE 
			ORDER_ID = #orderId#;
	</select>

	<!-- 商品分类取得 --> 
	<select id="getGpsGoodsCateList" parameterClass="gpsAccount" resultClass="gpsGoodsCate">
		SELECT
          GOODS_CATE_ID AS goodsCateId,
          CATE_NAME AS cateName,
          PUB_FLAG AS pubFlg,
		  MNGR_ID AS mngrId,
          CREATE_TIME AS creatTime
        FROM GPS_GOODS_CATE
		WHERE 0 = 0
		<isEqual property="accFlag" compareValue="1">
			<isNotEmpty prepend="AND" property="accId">
				MNGR_ID = #accId#
			</isNotEmpty>
			<isNotEmpty prepend="OR" property="accFlag">
				PUB_FLAG = '1' OR PUB_FLAG = '2'
			</isNotEmpty>
		</isEqual>
		<isEqual property="accFlag" compareValue="2">
			<isNotEmpty prepend="AND" property="accId">
				MNGR_ID = #accId#
			</isNotEmpty>
			<isNotEmpty prepend="OR" property="accFlag">
				PUB_FLAG = '1'
			</isNotEmpty>
		</isEqual>
	</select>
	
	<!-- 取得订单信息-->
	<select id="getYd0030OrderInfo" parameterClass="String" resultClass="gpsOrderInfo">
		SELECT
			 ORDER_ID AS orderId,
			 ORDER_CONTENT AS orderContent,
			 ORDER_CNT AS orderCnt,
			 SWITCH_FLAG AS switchFlag,
			 BUSS_FLAG AS bussFlag,
			 PAY_FLAG AS payFlag,
			 GOODS_CATE_ID AS goodsCateId,
			 GROUP_ID AS groupId,
			 ORDER_REMARKS AS orderRemarks,
			 CREATE_TIME AS createTime,
			 CREATE_USER AS createUser,
			 UPDATE_TIME AS updateTime,
			 UPDATE_USER AS updateUser
		FROM GPS_ORDER_INFO
		WHERE ORDER_ID = #orderId#;
	</select>
	
	<!-- 生成订单-->
	<insert id="inertGpsOrderInfo" parameterClass="gpsOrderInfo">
		INSERT INTO GPS_ORDER_INFO
			(
			 ORDER_ID,
			 ORDER_CONTENT,
			 ORDER_CNT,
			 SWITCH_FLAG,
			 BUSS_FLAG,
			 PAY_FLAG,
			 GOODS_CATE_ID,
			 GROUP_ID,
			 ORDER_REMARKS,
			 CREATE_TIME,
			 CREATE_USER,
			 UPDATE_TIME,
			 UPDATE_USER
			)
		VALUES
			(
			 #orderId#,
			 #orderContent#,
			 #orderCnt#,
			 #switchFlag#,
			 #bussFlag#,
			 #payFlag#,
			 #goodsCateId#,
			 #groupId#,
			 #orderRemarks#,
			 NOW(),
			 #createUser#,
			 NOW(),
			 #updateUser#
			);
	</insert>
	
	<!-- 生成订单商品表-->
	<insert id="inertGpsOrderGoods" parameterClass="gpsOrderGoods">
		INSERT INTO GPS_ORDER_GOODS
			(
			 ORDER_ID,
			 GOODS_ID,
			 GPS_PRICE,
			 ORDER_CNT
			)
		VALUES
			(
			 #orderId#,
			 #goodsId#,
			 #gpsPrice#,
			 #orderCnt#
			);
	</insert>

</sqlMap>  
