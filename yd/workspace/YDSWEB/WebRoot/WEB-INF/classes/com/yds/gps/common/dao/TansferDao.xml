<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TansferDao">
	
	<typeAlias alias="GpsAccount" type="com.yds.gps.bean.GpsAccount"/>
	<typeAlias alias="GpsExchangeHis" type="com.yds.gps.bean.GpsExchangeHis"/>

	<!-- 员工账户取得 --> 
	<select id="getGpsAccount" parameterClass="String" resultClass="GpsAccount">
		SELECT
          ACC_ID AS accId,
          ACC_FLAG AS accFlag,
          ACC_SUM AS accSum
        FROM GPS_ACCOUNT
		WHERE ACC_ID = #accId#;
	</select>
	
	<!-- 员工账户取得 FOR UPDATE--> 
	<select id="getGpsAccountForUpdate" parameterClass="String" resultClass="GpsAccount">
		SELECT
          ACC_ID AS accId,
          ACC_FLAG AS accFlag,
          ACC_SUM AS accSum
        FROM GPS_ACCOUNT
		WHERE ACC_ID = #accId# FOR UPDATE;
	</select>
	
	<!-- FOR UPDATE-->
	<update id="updateGpsAccountForUpdate" parameterClass="GpsAccount">
		UPDATE
			GPS_ACCOUNT
		SET
			ACC_ID = ACC_ID
		WHERE ACC_ID = #accId#;
	</update>
	
	<!-- 公司总额 --> 
	<select id="getGpsAccountSum" resultClass="Double">
		SELECT
          SUM(ACC_SUM) AS accSum
        FROM GPS_ACCOUNT;
	</select>
	
	<!-- 建立员工账户-->
	<insert id="inertGpsAccount" parameterClass="GpsAccount">
		INSERT INTO GPS_ACCOUNT
			(
			 ACC_ID,
			 ACC_FLAG,
			 ACC_SUM
			)
		VALUES
			(
			 #accId#,
			 #accFlag#,
			 #accSum#
			);
	</insert>
	
	<!-- 更新员工账户金额-->
	<update id="updateGpsAccount" parameterClass="GpsAccount">
		UPDATE
			GPS_ACCOUNT
		SET
			ACC_SUM = #accSum#
		WHERE
			ACC_ID = #accId#
	</update>
	
	<!-- 生成交易履历-->
	<insert id="inertGpsExchangeHis" parameterClass="GpsExchangeHis">
		INSERT INTO GPS_EXCHANGE_HIS
			(
			 EXCHANGE_NO,
			 ACC_ID,
			 EX_TIME,
			 ACC_FLAG,
			 EX_TYPE,
			 IO_FLAG,
			 EX_MONEY,
			 BALANCE,
			 ORDER_ID,
			 EX_REMARKS,
			 OPERATOR_ID
			)
		VALUES
			(
			 #exchangeNo#,
			 #accId#,
			 #exTime#,
			 #accFlag#,
			 #exType#,
			 #ioFlag#,
			 #exMoney#,
			 #balance#,
			 #orderId#,
			 #exRemarks#,
			 #operatorId#
			);
	</insert>
</sqlMap>  
