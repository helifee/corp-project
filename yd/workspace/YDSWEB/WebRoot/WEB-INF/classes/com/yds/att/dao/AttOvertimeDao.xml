<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="attOvertimeDao">

    <typeAlias alias="attOvertime" type="com.yds.att.bean.AttOvertime"/>

	<!-- 用于select查询公用抽取的列 -->
	<sql id="commonColumns">
	    <![CDATA[
        	YEAR as year ,
        	MONTH as month ,
        	DAY as day ,
        	EMP_ID as empId ,
        	PRJ_ID as prjId ,
        	DPM_ID as dpmId ,
        	APP_START_TIME as appStartTime ,
        	APP_END_TIME as appEndTime ,
        	OVERTIME_COMMENT as overtimeComment ,
        	BENEFIT_FLAG as benefitFlag ,
        	STATE_FLAG as stateFlag ,
        	RATIFY_ID as ratifyId ,
        	UPDATE_USER as updateUser ,
        	UPDATE_TIME as updateTime 
	    ]]>
	</sql>
	
    <insert id="insertAttOvertime" parameterClass="attOvertime">
    <![CDATA[
        INSERT INTO
        att_overtime (
        	YEAR ,
        	MONTH ,
        	DAY ,
        	EMP_ID ,
        	PRJ_ID ,
        	DPM_ID ,
        	APP_START_TIME ,
        	APP_END_TIME ,
        	OVERTIME_COMMENT ,
        	BENEFIT_FLAG ,
        	STATE_FLAG ,
        	RATIFY_ID ,
        	UPDATE_USER ,
        	UPDATE_TIME 
        ) VALUES (
        	#year# ,
        	#month# ,
        	#day# ,
        	#empId# ,
        	#prjId# ,
        	#dpmId# ,
        	#appStartTime# ,
        	#appEndTime# ,
        	#overtimeComment# ,
        	#benefitFlag# ,
        	#stateFlag# ,
        	#ratifyId# ,
        	#updateUser# ,
        	now() 
        )
    ]]>
    </insert>

    <update id="updateAttOvertime" parameterClass="attOvertime">
    <![CDATA[
        UPDATE att_overtime SET
	        PRJ_ID = #prjId# ,
	        DPM_ID = #dpmId# ,
	        APP_START_TIME = #appStartTime# ,
	        APP_END_TIME = #appEndTime# ,
	        OVERTIME_COMMENT = #overtimeComment# ,
	        BENEFIT_FLAG = #benefitFlag# ,
	        STATE_FLAG = #stateFlag# ,
	        RATIFY_ID = #ratifyId# ,
	        UPDATE_USER = #updateUser# ,
	        UPDATE_TIME = #updateTime# 
        WHERE 
	        YEAR = #year# and
	        MONTH = #month# and
	        DAY = #day# and
	        EMP_ID = #empId# 
    ]]>
    </update>

    <delete id="deleteAttOvertime" parameterClass="attOvertime">
    <![CDATA[
        delete from att_overtime where
        YEAR = #year# and
        MONTH = #month# and
        DAY = #day#

    ]]>
		<isNotEmpty prepend="AND" property="empId">
			EMP_ID = #empId#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="prjId">
			PRJ_ID = #prjId# 
		</isNotEmpty>
    </delete>
    
    <select id="getAttOvertimeByPk" parameterClass="attOvertime" resultClass="attOvertime">
	    select <include refid="commonColumns"/>
			,(SELECT EMP_CNM FROM EMP_INFO WHERE
			EMP_ID = att_overtime.EMP_ID) AS empName
	    <![CDATA[
	        from att_overtime 
	        where 
		        YEAR = #year# and
		        MONTH = #month# and
		        DAY = #day# and
		        EMP_ID = #empId# 
	    ]]>
    </select>

	<sql id="dynamicWhere">
	    <dynamic prepend="WHERE">
	       <isNotEmpty prepend="AND" property="year">
	             YEAR = #year#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="month">
	             MONTH = #month#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="day">
	             DAY = #day#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="empId">
	             EMP_ID = #empId#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="prjId">
	             PRJ_ID = #prjId#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dpmId">
	             DPM_ID = #dpmId#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="appStartTime">
	             APP_START_TIME = #appStartTime#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="appEndTime">
	             APP_END_TIME = #appEndTime#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="overtimeComment">
	             OVERTIME_COMMENT = #overtimeComment#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="benefitFlag">
	             BENEFIT_FLAG = #benefitFlag#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="stateFlag">
	             STATE_FLAG = #stateFlag#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="ratifyId">
	             RATIFY_ID = #ratifyId#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="updateUser">
	             UPDATE_USER = #updateUser#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="updateTime">
	             UPDATE_TIME = #updateTime#
	       </isNotEmpty>
	    </dynamic>	
	</sql>
	 
    <select id="getAttOvertimeCount" resultClass="long">
    <![CDATA[
        select count(*) from att_overtime
    ]]>
		<include refid="dynamicWhere"/>    
    </select>
    
    <select id="getAttOvertimeList" parameterClass="attOvertime" resultClass="attOvertime">
    	select <include refid="commonColumns"/>
			,(SELECT EMP_CNM FROM v_emp_list_quit WHERE
				EMP_ID = att_overtime.EMP_ID) AS empName
	    <![CDATA[
	        from att_overtime 
	    ]]>
		<include refid="dynamicWhere"/>
    </select>

</sqlMap>
