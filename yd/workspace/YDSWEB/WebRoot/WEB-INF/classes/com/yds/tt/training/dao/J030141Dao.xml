<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="J030141Dao">
	<typeAlias alias="bookInfo" type="com.yds.tt.training.bean.BookInfo"/>
	<!--取得教材信息-->
	<select id="getBookById" parameterClass="bookInfo" resultClass="bookInfo">
		SELECT 
			T1.MODIFY_HISTORY AS modifyHistory,
			T1.VERSION_NO AS versionNo,
			T1.UPDATE_TIME AS updateTime,
			T1.UPDATE_NO AS updateNo,
			T2.VERSION_NO AS preVersionNo,
			T2.UPDATE_NO AS preUpdateNo
		FROM TT_JIAOCAI T1,TT_JIAOCAI T2
		WHERE T1.BOOK_ID = #bookId#
		  AND T1.EDIT_NO = #editNo#
		  AND T2.BOOK_ID = #bookId#
		  AND T2.EDIT_NO = #editNo# - 1
	</select>
	<!--更新教材信息-->
	<update id="updateBookInfo" parameterClass="bookInfo">
		UPDATE TT_JIAOCAI
		SET 
			BOOK_STATUS = #bookStatus#,
			MODIFY_HISTORY = #modifyHistory#,
			VERSION_NO = #versionNo#,
			UPDATE_NO = #updateNo#,
			BOOK_NAME = #bookName#,
			KEYWORD = #keyword#,
			ABSTRACT = #bookAbstract#,
			PRE_KNOWLEDGE = #preKnowledge#,
			APPLYTO = #applyto#,
			SOURCE = #source#,
			BOOK_COVER = #bookCover#,
			APPLY_TIME = NOW(),			
			APPLY_USER_ID = #applyUserId#,
			UPDATE_TIME = NOW(),
			UPDATE_USER_ID = #updateUserId#
		WHERE BOOK_ID = #bookId#
		  AND EDIT_NO = #editNo#
	</update>
	<!-- 教材审批者ID取得 --> 
	<select id="getReviewer" resultClass="String"> 
		SELECT 	USER_ID
		FROM 	TT_QUANXIAN
		WHERE	AUTHORITY_ID = 11 AND
				RELATEDOBJECT_ID = #bookId#
	</select>
</sqlMap>