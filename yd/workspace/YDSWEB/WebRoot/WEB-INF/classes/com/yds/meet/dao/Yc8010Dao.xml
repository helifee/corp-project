<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Yc8010Dao">
    <typeAlias alias="yc8010CondA" type="com.yds.employee.bean.Yc8010CondA"/>
	<!-- 删除对应用户今后预约的每日会议 -->
	<delete id="delDaymetUserInfo" parameterClass="String">		
		DELETE  T1 ,  T2 
		FROM    met_daymet_user AS T1
		INNER   JOIN  met_daymet_Info  AS T2
			ON   T1.met_date = T2.met_date 
			AND  T1.met_sta_time = T2.met_sta_time 
			AND  T1.met_id = T2.met_id
		WHERE T2.apply_user_id= #200809#
		AND T2.met_date > NOW()
	</delete>
	<delete id="delDaymetInfo" parameterClass="String">		
		DELETE 	FROM
			met_daymet_info
		WHERE   apply_user_id=#userId# 
			AND met_date > now()
	</delete>

	<!-- 删除对应用户今后参加的每日会议 -->
	<update id="updateDaymetInfo" parameterClass="String">
		UPDATE 	
			met_daymet_info T1
		INNER JOIN 
				met_daymet_user T2 
			ON  T1.met_date = T2.met_date 
			AND T1.met_sta_time = T2.met_sta_time 
			AND T1.met_id = T2.met_id
		SET 
			T1.join_user_cnt = T1.join_user_cnt - 1
		WHERE  
			T1.join_user_cnt >= 2 
		AND
			T2.join_user_id = #userId#
		AND 
			T1.met_date > now()
	</update>
	<delete id="delDaymetUser" parameterClass="String">		
		DELETE 	FROM
			met_daymet_user
		WHERE
			apply_user_id=#userId# 
		AND 
			met_date > now()
	</delete>
	
	<!-- 删除对应用户今后预约的周期会议 -->
	<update id="updateCyclemetUserInfo1" parameterClass="String">		
		update 	
			met_cyclemet_info
		SET
			del_flg = '1',
		WHERE
			apply_user_id=#userId# 
		AND 
			met_date > now()
	</update>	
	
	<delete id="delCyclemetUser1" parameterClass="String">		
		DELETE
				T1 ,  T2 
		FROM
				met_cyclemet_user AS T1
		INNER
				JOIN  met_cyclemet_Info  AS T2
			ON
				T1.CYCLE_MET_ID = T2.CYCLE_MET_ID 
		WHERE 
				T2.apply_user_id= 'YD200809'
		AND
				T2.MET_END_DATE > NOW()
	</delete>
	
	<!-- 删除对应用户今后参加的周期会议 -->
	<update id="updateCyclemetUserInfo2" parameterClass="String">		
		UPDATE 	
			met_cyclemet_info T1
		INNER JOIN 
			met_cyclemet_user T2
		  ON
			T1.CYCLE_MET_ID = T2.CYCLE_MET_ID
		SET
			T1.join_user_cnt = T1.join_user_cnt - 1
		WHERE
			T1.join_user_cnt >= 2
		AND
			T2.JOIN_USER_ID = #userId#
		AND
			T2.UPDATETIME > NOW()
	</update>	
	<delete id="delCyclemetUser2" parameterClass="String">		
		DELETE 	FROM
			met_cyclemet_user
		WHERE   join_user_id=#userId# 
			AND met_date > now()
	</delete>
</sqlMap>