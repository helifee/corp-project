<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ye7011Dao">
    <typeAlias alias="ye7011BeanA" type="com.yds.att.bean.Ye7011BeanA"/>
    <typeAlias alias="ye7011BeanB" type="com.yds.att.bean.Ye7011BeanB"/>
    <typeAlias alias="ye7011BeanC" type="com.yds.att.bean.Ye7011BeanC"/>
	<typeAlias alias="empOrgInfo" type="com.yds.common.bean.EmpOrgInfo"/>
	
	
	<!-- 取考勤信息一览(旧DB) -->
	<select id="getOldAttInfoList" resultClass="ye7011BeanC" parameterClass="String">		
		SELECT 
			WRK_NIAN as year, 
			WRK_YUE as month, 
			WRK_RI as day, 
			WRK_EMPID as empId, 
			WRK_BEGTIME as beginTime, 
			WRK_ENDTIME as endTime, 
			WRK_GUPID 
		FROM TWRKMGRS
		WHERE CONCAT(LPAD(wrk_nian,4,'0'),LPAD(wrk_yue,2,'0'),LPAD(wrk_ri,2,'0'))>=#startDate#
		ORDER BY WRK_NIAN,WRK_YUE,WRK_RI,WRK_EMPID
	</select>
	
	<!-- 加班表中数据获取(旧DB) -->
	<select id="getOldOvertimeList" resultClass="ye7011BeanA">		
		SELECT 	
			TJB_PRJID as prjId, 
			TJB_DATE as overtimeDate, 
			TJB_MESSAGE as comment, 
			TJB_DEPTOPTION as state1, 
			TJS_EMPID as empId, 
			TJS_BTIME as beginTime, 
			TJS_ETIME as endTime, 
			TJS_DEPTOPTION as state2
		FROM 
			TJBMGRS A
		INNER JOIN TJBSCHD  B ON A.TJB_PRJID=B.TJS_PRJID AND A.TJB_DATE=B.TJS_DATE
		
		ORDER BY TJB_PRJID,TJB_DATE,TJS_EMPID
	</select>
	
	<!-- 获得漏考(考勤更正)数据(旧DB) -->
	<select id="getLeakList" resultClass="ye7011BeanB">
		<![CDATA[
		SELECT 
			LEAK_NIAN as year,
			LEAK_YUE as month,
			LEAK_RI as day,
			LEAK_EMPID as empId,
			LEAK_TYPE as type,
			LEAK_LEADID leaderId,
			LEAK_LEADIDEA as leaderIder,
			LEAK_REASON as reason,
			LEAK_BTIME as beginTime,
			LEAK_ETIME as endTime 
		FROM TLEAKMGRS,TEMPINFO 
		WHERE LEAK_LEADIDEA<>'null' 
		AND LEAK_EMPID=EMP_ID  
		AND LEAK_TYPE in ('l','ls','lx','es','ex')
		and LEAK_NIAN = '2010' 
		ORDER BY LEAK_NIAN,LEAK_YUE,LEAK_RI,LEAK_EMPID
		
		]]>
	</select>
	
	<!-- 获得考勤信息(旧DB) -->
	<select id="getWrkMgrs" resultClass="ye7011BeanC" parameterClass="ye7011BeanC">
		<![CDATA[

			SELECT
				WRK_NIAN as year, 
				WRK_YUE as month, 
				WRK_RI as day, 
				WRK_EMPID as empId, 
				WRK_FLAG as flag, 
				WRK_ORNFLAG as ornFlag, 
				WRK_TYPE as type, 
				WRK_BEGTIME as beginTime, 
				WRK_ENDTIME as endTime, 
				WRK_GUPID as leaderId
				 
			FROM 
				TWRKMGRS 
			WHERE WRK_NIAN=#year#
				AND WRK_YUE=#month#
				AND WRK_RI=#day#
				AND WRK_EMPID=#empId#
	

		
		]]>
	</select>
	
	<!-- 取得组织信息 -->
	<select id="getOrgList"  resultClass="empOrgInfo"> 
		SELECT
			a.ORG_ID AS orgId,
			a.ORG_NM AS orgNm,
			a.ORG_SNM AS orgSnm,
			a.ORG_PRO_ID AS orgProId,
			a.ORG_MNGER AS orgMnger,
			a.ORG_LEV AS orgLev,
			b.org_id AS orgDesc
		FROM EMP_ORG_INFO a 
		LEFT JOIN EMP_ORG_INFO b 
		ON TRIM(TRAILING '00000' FROM b.org_lev)=LEFT(TRIM(TRAILING '00000' FROM a.org_lev),LENGTH(TRIM(TRAILING '00000' FROM a.org_lev))-5)
	</select>
	
	<!-- 删除加班表 -->
    <delete id="deleteAttOvertime" >
        delete from att_overtime;
    </delete>
	
	<!-- 删除考勤更正表 -->
    <delete id="deleteAttCorrect" >
        delete from att_correct;
    </delete>
	
	<!-- 删除审批流程表 -->
    <delete id="deleteAttExamin" >
        delete from att_examin;
    </delete>
		

</sqlMap>  
