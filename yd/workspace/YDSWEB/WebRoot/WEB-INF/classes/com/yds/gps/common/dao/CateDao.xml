<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CateDao">
	
	<typeAlias alias="cateTreeInfo" type="com.yds.gps.common.bean.CateTreeInfo"/>	
	
	<!-- 获取职位树形分类列表 --> 
	<select id="getCateTreeInfoList"  parameterClass="java.util.HashMap" resultClass="cateTreeInfo">
	
		SELECT
		       T1.DIFF_NO	        AS diffNo,
		       T1.DIFF_SHORT_NAME	AS diffName,
		       T2.GOODS_CATE_ID	    AS goodsCateId,
		       T2.CATE_NAME	        AS cateName
		FROM  SYS_CODE_MST T1
		LEFT JOIN  GPS_GOODS_CATE T2  ON  T2.PUB_FLAG= T1.DIFF_NO 
		<isEqual prepend="AND" property="managerFlg" compareValue="1"> 
			<![CDATA[
				(T2.MNGR_ID=#userId# OR T2.PUB_FLAG<>'3')
			]]>
		</isEqual>
		<isEqual prepend="AND" property="managerFlg" compareValue="0">
			(T2.MNGR_ID=#userId# AND T2.PUB_FLAG='3')
		</isEqual>
	    WHERE  T1.TYPE_ID = 'CAT_FLAG'
			AND  T1.SUB_SYS = 'GPS'
			AND  T1.DEL_FLG = '0'	
		ORDER BY  T1.DISP_SEQ

	</select>	
</sqlMap>  
