<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="yb0040Dao">
    <typeAlias alias="empStaffPos" type="com.yds.employee.bean.EmpStaffPos"/>
    <typeAlias alias="empPos" type="com.yds.common.bean.EmpPos"/>
    <typeAlias alias="empPosHis" type="com.yds.employee.bean.EmpPosHis"/>
	<!-- 当前职位信息取得(ID) --> 
	<select id="getEmpPosNowInfo" parameterClass="String" resultClass="empStaffPos"> 
		SELECT  T1.EMP_ID         AS empId, 
			    T1.POS_ID         AS posId, 
				T1.MAIN_POS_FLG   AS mainPosFlg,
				T2.POS_SNAME      AS posSName,
				T2.POS_TYPE_ID    AS posType,
				T2.DISP_SEQ       AS dispSeq,
				(SELECT DIFF_NAME FROM SYS_CODE_MST 
				 WHERE DIFF_NO = T2.POS_TYPE_ID AND TYPE_ID = 'POS_TYPE' AND SUB_SYS = 'EMP') AS posTypeName
		  FROM  EMP_STAFF_POS     T1, 
			    EMP_POS           T2
		 WHERE  T1.EMP_ID = #empId#
		   AND  T1.POS_ID = T2.POS_ID
	  ORDER BY  T2.POS_TYPE_ID DESC, T2.DISP_SEQ DESC
	</select>
	
	<!-- 历史职位信息取得(ID) --> 
	<select id="getEmpPosAllInfo" parameterClass="String" resultClass="empStaffPos"> 
	   SELECT  T1.EMP_ID         AS empId, 
				T1.POS_ID         AS posId,
				T1.START_TIME     AS startTime,
				T1.END_TIME       AS endTime,
				T2.POS_SNAME      AS posSName,
				T2.POS_TYPE_ID    AS posType,
				T2.DISP_SEQ       AS dispSeq,
				(SELECT DIFF_NAME FROM SYS_CODE_MST 
				 WHERE DIFF_NO = T2.POS_TYPE_ID AND TYPE_ID = 'POS_TYPE' AND SUB_SYS = 'EMP') AS posTypeName
		  FROM  EMP_POS_HIS       T1, 
		    	EMP_POS           T2
		 WHERE  T1.EMP_ID = #empId#
		   AND  T1.POS_ID = T2.POS_ID
		ORDER BY T1.END_TIME DESC, T1.START_TIME DESC, T2.POS_TYPE_ID DESC, T2.DISP_SEQ DESC
	</select>
	
	<!-- 职位级别取得(ID) --> 
	<select id="getSeqInfo" resultClass="empPos"> 
		SELECT  T1.POS_ID         AS posId,
				T1.DISP_SEQ       AS dispSeq
		  FROM  EMP_POS T1
	</select>
	
	<!-- 添加员工职位信息 --> 
	<insert id="insertEmpStaffPos" parameterClass="empStaffPos">
		INSERT INTO EMP_STAFF_POS
		   (
		    EMP_ID, 
			POS_ID,
			MAIN_POS_FLG
		   )
		VALUES
		   (
		    #empId#, 
			#posId#,
			#mainPosFlg#
		   );
	</insert>
	<!-- 添加员工职位历史信息 --> 
	<insert id="insertEmpPosHis" parameterClass="empPosHis">
		INSERT INTO EMP_POS_HIS 
		   (
		    EMP_ID, 
			START_TIME,
			END_TIME,
			POS_ID,
			UPDATE_USER,
			UPDATE_TIME
		   )
		VALUES
		   (
		    #empId#, 
			NOW(),
		    #endTime#,
			#posId#,
			#updateUser#,
			NOW()
		   );
	</insert>
	
	<!-- 更新员工职位历史信息 --> 
	<update id="updateEmpPosHis" parameterClass="empPosHis">
		UPDATE 
			EMP_POS_HIS
		SET
			END_TIME    = #endTime#,
			UPDATE_USER = #updateUser#,
			UPDATE_TIME = NOW()
		WHERE
			EMP_ID = #empId# AND
			START_TIME = #startTime# AND
			POS_ID = #posId#
	</update>
	
	<!-- 取得员工历史职位信息 --> 
	<select id="getEmpPosHis" parameterClass="empPosHis" resultClass="String"> 
		SELECT 
			COUNT(*)
		FROM 
			EMP_POS_HIS T1
		WHERE 
			T1.EMP_ID = #empId# AND
			T1.START_TIME = #startTime# AND
			T1.POS_ID = #posId#
	</select>
	
	<!-- 取得员工历史职位-终了时间信息 --> 
	<select id="getEmpPosHisEndTime" parameterClass="empPosHis" resultClass="String"> 
		SELECT 
			T1.END_TIME as endTime
		FROM 
			EMP_POS_HIS T1
		WHERE 
			T1.EMP_ID = #empId# AND
			T1.START_TIME = #startTime# AND
			T1.POS_ID = #posId#
	</select>
	
	<!-- 员工职位信息的删除 -->
	<delete id="deleteEmpStaffPos" parameterClass="String">
		DELETE FROM
			EMP_STAFF_POS
		WHERE
			EMP_ID = #empId#
	</delete>
	
	<!-- 员工职位历史信息的删除 -->
	<delete id="deleteEmpPosHis" parameterClass="empPosHis">
		DELETE FROM
			EMP_POS_HIS
		WHERE
			EMP_ID = #empId# AND
			POS_ID = #posId#
	</delete>
</sqlMap>