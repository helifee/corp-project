<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="PageArrangesDao">
	
	<typeAlias alias="checkAndLockInfo" type="com.yds.common.bean.CheckAndLockInfo"/>
	
	<!-- 部门名称取得 --> 
	<select id="getAllLock" parameterClass="checkAndLockInfo" resultClass="checkAndLockInfo">
		SELECT  LOCK_ID AS lockId,
		        USER_ID AS userId,
		        LOGIN_TIME AS loginTime,
		        PAGE_NAME AS pageName,
		        STATE_FLAG AS stateFlag,
		        IP AS urlIp,
		        CURRENT_UPDATE_TIME AS updateTime,
		        PRO1 AS pro1,
		        PRO2 AS pro2,
		        PRO3 AS pro3,
		        PRO4 AS pro4,
		        PRO5 AS pro5,
		        PRO6 AS pro6,
		        PRO7 AS pro7,
		        PRO8 AS pro8      
		FROM COM_PAGE_LOCK 
		WHERE LOCK_ID = #lockId#
	</select>
		
	<delete id="deleteLock" parameterClass="checkAndLockInfo">
		DELETE 
		FROM  COM_PAGE_LOCK
		WHERE LOCK_ID=#lockId#
	</delete>
	
	<insert id="addPageLock" parameterClass="checkAndLockInfo">
 
       INSERT INTO
        COM_PAGE_LOCK (
        	 LOCK_ID,
		     USER_ID,
		     LOGIN_TIME,
		     PAGE_NAME,
		     STATE_FLAG,
		     IP,
		     CURRENT_UPDATE_TIME   	
        ) VALUES (
        	#lockId#,
        	#userId# ,
        	NOW(),
        	#pageName#,
        	'1',
        	#urlIp# ,
        	NOW()	
        )
      
    </insert>	
	
	<!-- 部门名称取得 --> 
	<select id="getCount" parameterClass="checkAndLockInfo" resultClass="Long">
		SELECT COUNT(*)
		FROM COM_PAGE_LOCK 
		WHERE LOCK_ID = #lockId# AND 
		      USER_ID = #userId# AND
		      LOGIN_TIME = #loginTime#
	</select>
	
	<!-- 部门名称取得 --> 
	<select id="getUserName" parameterClass="checkAndLockInfo" resultClass="String">
		SELECT EMP_CNM
		FROM   V_EMP_LIST_QUIT   
		WHERE  EMP_ID = #userId#
	</select>

</sqlMap>  