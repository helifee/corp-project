<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="K060091Dao">
	
	<typeAlias alias="k060091BasicInfo" type="com.yds.tt.testing.bean.K060091BasicInfo"/>
	<typeAlias alias="markTaskAssignInfo" type="com.yds.tt.testing.bean.MarkTaskAssignInfo"/>
	<typeAlias alias="examEmployeeInfo" type="com.yds.tt.testing.bean.ExamEmployeeInfo"/>
	<typeAlias alias="testPaperInfo" type="com.yds.tt.testing.bean.TestPaperInfo"/>
	<typeAlias alias="paperBigQuestionInfo" type="com.yds.tt.testing.bean.PaperBigQuestionInfo"/>
	<typeAlias alias="k060031ExamQuestionInfo" type="com.yds.tt.testing.bean.K060031ExamQuestionInfo"/>
					
	<!-- 评分任务信息检索 --> 		
	<select id="getMarkTaskAssignInfos" parameterClass="k060091BasicInfo" resultClass="markTaskAssignInfo"> 
		Select
			T1.EXAMINE_ID as examineId,
			T1.EXAMINE_MARKER_ID as examineMarkerId,
			T1.EMPLOYEES_ID as employeesId,
			T1.BIGQUESTION_SERIAL_NO as bigquestionSerialNo,
			T1.MARKING_STATUS as markingStatus,
			T1.MARKING_EMPID as markingEmpid
		From tt_pingfenrenwu T1
		WHERE T1.EXAMINE_ID = #examineId#
		<isEqual property="markTaskAsignStyle" compareValue="2">
			<isNotEmpty prepend="AND" open="(" close=")" property="bigquestionList">
				<iterate conjunction="OR" property="bigquestionList" >
						T1.BIGQUESTION_SERIAL_NO = #bigquestionList[]#
				</iterate>
			</isNotEmpty>	
		</isEqual>
	</select>

	<!-- 待评分员工考试信息检索 -->
	<select id="getExamEmpInfos" parameterClass="examEmployeeInfo" resultClass="examEmployeeInfo"> 
		Select
			T1.EMPLOYEES_ID as employeesId,
			T1.PAPER_ID as paperId,
			T1.PAPER_VERSION_NO as paperVersionNo,
			T1.PAPER_CREATE_NO as paperCreateNo,
			T1.PAPER_CREATE_TIME as paperCreateTime,
			MAX(T1.EXAMINE_JOIN_TIMES) as examineJoinTimes
		From tt_ks_yuangong T1,
		<!-- 取得最大参加次数 -->
		(SELECT T2.EXAMINE_ID, T2.EMPLOYEES_ID, MAX(T2.EXAMINE_JOIN_TIMES) AS EXAMINE_JOIN_TIMES 
			FROM tt_ks_yuangong T2 GROUP BY T2.EXAMINE_ID,T2.EMPLOYEES_ID) AS T3 
		WHERE T1.EXAMINE_ID = #examineId#
		AND T1.EXAMINE_ID = T3.EXAMINE_ID
		AND T1.EMPLOYEES_ID = T3.EMPLOYEES_ID
		AND T1.EXAMINE_JOIN_TIMES = T3.EXAMINE_JOIN_TIMES
		<isNotEmpty prepend="AND" property="employeesId"> 
			T1.EMPLOYEES_ID = #employeesId#
		</isNotEmpty>
		GROUP BY employeesId
		ORDER BY employeesId
	</select>
</sqlMap>
