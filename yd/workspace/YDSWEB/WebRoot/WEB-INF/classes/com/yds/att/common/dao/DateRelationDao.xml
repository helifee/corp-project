<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="dateRelationDao">

	<typeAlias alias="calendarGadgetInfo" type="com.yds.gadget.bean.CalendarGadgetInfo"/>
	<typeAlias alias="attInfo" type="com.yds.att.bean.AttInfo"/>
	<typeAlias alias="attEmpType" type="com.yds.att.bean.AttEmpType"/>
	<typeAlias alias="attExrestInfo" type="com.yds.att.bean.AttExrestInfo"/>
	<typeAlias alias="attRestApp" type="com.yds.att.bean.AttRestApp"/>
	<typeAlias alias="attYearRest" type="com.yds.att.bean.AttYearRest"/>
	<typeAlias alias="attMonReport" type="com.yds.att.bean.AttMonReport"/>

	<!-- 假日信息表（阳历全数据）检索 -->
	<select id="selectHolInfoAll" parameterClass="java.util.HashMap" resultClass="calendarGadgetInfo">
		<![CDATA[
		SELECT
			HOL_ID       AS    HOLID,
			HOL_NAME     AS    HOLNAME,
			HOL_DATE     AS    HOLDATE,
			HOL_TYPE     AS    HOLTYPE,
			HOL_FLG      AS    HOLFLG,
			HOL_YEAR     AS    HOLYEAR,
			CYCLE_FLG    AS    CYCLEFLG,
			CREATE_USER  AS    CREATEUSER,
			CREATE_TIME  AS    CREATETIME,
			UPDATE_TIME  AS    UPDATETIME
		FROM  com_holiday
		where HOL_FLG IN ('1', '2', '3', '5')
		AND   HOL_TYPE = '2'
		ORDER BY CASE HOL_FLG WHEN '1' THEN 1 WHEN '3' THEN 2 WHEN '2' THEN 3 WHEN '5' THEN 4 WHEN '4' THEN 5 END
		]]>
	</select>

	<!-- 假日信息表（农历全数据）检索 -->
	<select id="selectHolInfoLunarAll" parameterClass="java.util.HashMap" resultClass="calendarGadgetInfo">
		<![CDATA[
		SELECT
			HOL_ID       AS    HOLID,
			HOL_NAME     AS    HOLNAME,
			HOL_DATE     AS    HOLDATE,
			HOL_TYPE     AS    HOLTYPE,
			HOL_FLG      AS    HOLFLG,
			HOL_YEAR     AS    HOLYEAR,
			CYCLE_FLG    AS    CYCLEFLG,
			CREATE_USER  AS    CREATEUSER,
			CREATE_TIME  AS    CREATETIME,
			UPDATE_TIME  AS    UPDATETIME
		FROM  com_holiday
		where CYCLE_FLG = '0'
		AND   HOL_TYPE = '1'
		AND   HOL_FLG IN ('1', '2', '3', '5')
		]]>
	</select>

	<!-- 考勤信息表检索 -->
	<select id="selectHolInfoFromAttInfo" parameterClass="java.util.HashMap" resultClass="attInfo">
		<![CDATA[
		select
			P_START_TIME as pstarttime ,
			P_END_TIME as pendtime ,
			LUNCH_TIME_ST as lunchtimest ,
			LUNCH_TIME_END as lunchtimeend
		from att_info
		where
			EMP_ID = #empid#
		AND YEAR = #year#
		AND MONTH = #month#
		AND DAY = #day#
		]]>
	</select>

	<!-- 员工班型表检索 -->
	<select id="selectHolInfoFromAttEmpType" parameterClass="java.util.HashMap" resultClass="attEmpType">
		<![CDATA[
		select
			ATTEND_TIME as attendtime ,
			ABSENT_TIME as absenttime ,
			LUNCH_TIME_ST as lunchtimest ,
			LUNCH_TIME_END as lunchtimeend
		from att_emp_type
		where
			EMP_ID = #empid#
		AND START_DATE <= #leavedate#
		AND END_DATE >= #leavedate#
		]]>
	</select>

	<!-- 换休明细表检索 -->
	<select id="selectExrestInfoApply" parameterClass="java.util.HashMap" resultClass="attExrestInfo">
		<![CDATA[
		select
			IFNULL(SUM(CASE HAPPEN_REASON WHEN '1' THEN HAPPEN_TIME * (-1) WHEN '0' THEN HAPPEN_TIME END),0) as happentime
		from att_exrest_info
		where
			EMP_ID = #empid#
		AND CONCAT(CAL_YEAR, CAL_MONTH) IN (SELECT CONCAT(A.CAL_YEAR, A.CAL_MONTH) 
											FROM att_exrest_info A
											WHERE A.USEFUL_DATE >= #exrestdate#
											AND   A.EMP_ID = #empid#)
		]]>
	</select>

	<!-- 休假请假表检索 -->
	<select id="selectExrestTimeInfo" parameterClass="java.util.HashMap" resultClass="attRestApp">
		<![CDATA[
		select
			REST_START_DATE as reststartdate ,
			REST_END_DATE as restenddate ,
			REST_TYPE as restType
		from att_rest_app
		where
			REST_PER_ID = #empid#
		AND REST_TYPE IN ('H', 'HS', 'HX')
		AND APP_STATUS IN ('1', '2')
		]]>
	</select>

	<!-- 员工年休表检索（统计用） -->
	<select id="selectPtoValidTime" parameterClass="java.util.HashMap" resultClass="attYearRest">
		<![CDATA[
		select
			PTO_DAYS as ptodays ,
			PTO_ADD_DAYS as ptoadddays ,
			PTO_ADD_DAYS_FLG as ptoadddaysflg
		from att_year_rest
		where
			EMP_ID = #empid#
		AND PTO_YEAR = #ptoYear#
		]]>
	</select>

	<!-- 员工年休表检索（检查用） -->
	<select id="selectPtoValidTimeCheck" parameterClass="java.util.HashMap" resultClass="attYearRest">
		<![CDATA[
		select
			PTO_DAYS as ptodays ,
			PTO_ADD_DAYS as ptoadddays ,
			PTO_ADD_DAYS_FLG as ptoadddaysflg
		from att_year_rest
		where
			EMP_ID = #empid#
		AND PTO_YEAR = #ptoYear#
		AND PTO_START_DATE <= #ptoStartTime#
		AND PTO_END_DATE >= #ptoStartTime#
		AND PTO_START_DATE <= #ptoEndTime#
		AND PTO_END_DATE >= #ptoEndTime#
		]]>
	</select>

	<!-- 月次统计表检索 -->
	<select id="selectReportTime" parameterClass="java.util.HashMap" resultClass="attMonReport">
		<![CDATA[
		select
			SICK_MIN_DAY as sickminday ,
			PER_MIN_DAY as perminday ,
			BELATE_MIN_DAY as belateminday ,
			LVE_EARLY_MIN_DAY as lveearlyminday
		from att_mon_report
		where
			EMP_ID = #empid#
		AND YEAR = #year#
		AND MONTH = '00'
		]]>
	</select>

	<!-- 休假请假表检索 -->
	<select id="selectRestApp" parameterClass="java.util.HashMap" resultClass="attRestApp">
		<![CDATA[
		select
			REST_START_DATE as reststartdate ,
			REST_END_DATE as restenddate
		from att_rest_app
		where
			REST_PER_ID = #empid#
		AND REST_TYPE = 'N'
		AND APP_STATUS IN ('1', '2', '3')
		AND YEAR(REST_START_DATE) = #year#
		]]>
	</select>

</sqlMap>
