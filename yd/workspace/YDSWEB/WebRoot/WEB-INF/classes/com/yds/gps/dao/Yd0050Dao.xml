<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Yd0050Dao">
	<typeAlias alias="yd0050CondA" type="com.yds.gps.bean.Yd0050CondA"/>
	
	<!-- 用于SQL查询公用抽取语句 -->	
	<sql id="orderSearch">
		FROM
				GPS_ORDER_INFO T1
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="orderContent">
				T1.ORDER_CONTENT LIKE CONCAT('%' ,#orderContent#, '%')
			</isNotEmpty>
		    <isNotEmpty prepend="AND" property="createTime">
				 T1.CREATE_TIME >= #createTime#
		    </isNotEmpty>
		    <isNotEmpty prepend="AND" property="createTime2">
				 DATE_ADD(#createTime2#, INTERVAL 1 DAY) > T1.CREATE_TIME
		    </isNotEmpty>
			<isNotEmpty prepend="AND" property="userId">
				 T1.CREATE_USER = #userId#
		    </isNotEmpty>
		</dynamic>	
			ORDER BY
				T1.ORDER_ID DESC 
	</sql>
	
	<!-- 获取Yd0050CondA列表 --> 
	<select id="getYd0050CondAList" resultClass="yd0050CondA" parameterClass="yd0050CondA">
		SELECT 
			T1.ORDER_ID AS orderId,
			T1.ORDER_CONTENT AS orderContent,
			T1.SWITCH_FLAG AS switchFlag,
			T1.BUSS_FLAG AS bussFlag,
			T1.PAY_FLAG AS payFlag,
			T1.CREATE_TIME AS createTime,
			T1.CREATE_USER AS userId,
			(SELECT T2.EMP_CNM FROM V_EMP_LIST_QUIT T2 WHERE T2.EMP_ID = T1.CREATE_USER) AS createUser 
			FROM
				GPS_ORDER_INFO T1
			WHERE
				T1.SWITCH_FLAG = '1' AND
				7 >= DATEDIFF(NOW(),T1.CREATE_TIME)
				<isNotEmpty prepend="AND" property="orderContent">
					T1.ORDER_CONTENT LIKE CONCAT('%' ,#orderContent#, '%')
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="createTime">
					 T1.CREATE_TIME >= #createTime#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="createTime2">
					DATE_ADD(#createTime2#, INTERVAL 1 DAY) > T1.CREATE_TIME
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="userId">
					 T1.CREATE_USER = #userId#
				</isNotEmpty>
		UNION ALL
		SELECT 
			TR.ORDER_ID AS orderId,
			TR.ORDER_CONTENT AS orderContent,
			TR.SWITCH_FLAG AS switchFlag,
			TR.BUSS_FLAG AS bussFlag,
			TR.PAY_FLAG AS payFlag,
			TR.CREATE_TIME AS createTime,
			TR.CREATE_USER AS userId,
			(SELECT T3.EMP_CNM FROM V_EMP_LIST_QUIT T3 WHERE T3.EMP_ID = TR.CREATE_USER) AS createUser 
			FROM
				GPS_ORDER_INFO TR
			WHERE
				(TR.SWITCH_FLAG = '0' AND
				7 >= DATEDIFF(NOW(),TR.CREATE_TIME) OR 
				DATEDIFF(NOW(),TR.CREATE_TIME) > 7)
				<isNotEmpty prepend="AND" property="orderContent">
					TR.ORDER_CONTENT LIKE CONCAT('%' ,#orderContent#, '%')
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="createTime">
					 TR.CREATE_TIME >= #createTime#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="createTime2">
					 DATE_ADD(#createTime2#, INTERVAL 1 DAY) > TR.CREATE_TIME
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="userId">
					 TR.CREATE_USER = #userId#
				</isNotEmpty>
			ORDER BY
				switchFlag DESC,orderId DESC
	</select>

	<!-- 信息总数 --> 
	<select id="getTotalCount" parameterClass="yd0050CondA" resultClass="Long"> 
		SELECT
			COUNT(*)
			<include refid="orderSearch"/>
	</select>
</sqlMap>  
