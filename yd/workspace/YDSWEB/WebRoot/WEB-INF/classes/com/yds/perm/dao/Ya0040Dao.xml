<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Ya0040Dao">
	<typeAlias alias="PerUserPermitInfo" type="com.yds.perm.bean.PerUserPermitInfo"/>
	<typeAlias alias="Ya0040CondA" type="com.yds.perm.bean.Ya0040CondA"/>
	<typeAlias alias="PerRoleInfo" type="com.yds.perm.bean.PerRoleInfo"/>
	
	<!-- 检索用户角色信息表信息 --> 
	<select id="getPerUserPermitInfoList" parameterClass="String" resultClass="PerUserPermitInfo">	
 		SELECT 
			T1.USER_ID AS userId,
		    T1.POS_ROLE_ID AS posRoleId,
			T2.ROLE_NM AS posRoleNm,
			T1.UPDATE_USER AS operatorId,
			T1.PERMIT_STA_DATE AS permitStaDate,
			T1.PERMIT_END_DATE AS permitEndDate
		FROM 
			PER_USER_PERMIT T1
			LEFT JOIN PER_ROLE T2
			ON  T1.POS_ROLE_ID = T2.ROLE_ID
			  
		WHERE T1.USER_ID = #userId#;	
	</select>
	
	<!-- 角色信息追加 -->
	<insert id="insertPerUserPermitInfoList" parameterClass="Ya0040CondA">
		INSERT INTO PER_USER_PERMIT
		   (		  
				USER_ID,
				POS_ROLE_ID,
				PERMIT_STA_DATE,
				PERMIT_END_DATE,
				UPDATE_USER,
				UPDATE_TIME
		   )
		VALUES
		   (
		    #userId#, 
			#perRoleId#,
			#permitStartDate#,
			#permitEndDate#,
			#loginUserId#,
			#updateTime#
		   );
	</insert>
	
	<!-- 更新权限有效时间 -->
	<update id="updatePermitTime" parameterClass="Ya0040CondA">
		UPDATE PER_USER_PERMIT 
		   SET PERMIT_STA_DATE = #permitStartDate#,
               PERMIT_END_DATE = #permitEndDate#,
			   UPDATE_USER = #loginUserId#,
			   UPDATE_TIME = #updateTime#
		WHERE USER_ID = #userId#
		   AND POS_ROLE_ID = #perRoleId#;	
	</update>
	
	<!-- 删除用户选择的角色 -->
	<delete id="deletePermitData" parameterClass="Ya0040CondA">
		DELETE 
		FROM  PER_USER_PERMIT 
		WHERE USER_ID = #userId#
			AND POS_ROLE_ID = #perRoleId#
			AND PERMIT_STA_DATE = #permitStartDate#;	
	</delete>
	
	<!-- 角色信息表信息 --> 
	<select id="getUserRoleResultLst" resultClass="PerRoleInfo">	
		SELECT
			ROLE_ID AS roleId,
			ROLE_NM AS roleName,
			ROLE_DESC AS roleDescription,
			UPDATETIME AS updateTime
		 FROM
			PER_ROLE		
	</select>
</sqlMap>  
