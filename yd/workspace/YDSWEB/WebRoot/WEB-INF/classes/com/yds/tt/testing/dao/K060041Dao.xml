<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="K060041Dao">
	<typeAlias alias="testEmployeeAnswerInfo" type="com.yds.tt.testing.bean.TestEmployeeAnswerInfo"/>
	<typeAlias alias="examEmployeeInfo" type="com.yds.tt.testing.bean.ExamEmployeeInfo"/>
	
	<!--取得当前所答试题答案信息-->
	<select id="getCurrentTestEmployeeAnswerInfo" parameterClass="testEmployeeAnswerInfo" resultClass="testEmployeeAnswerInfo">
		SELECT QUESTION_ID AS questionId,
			   BIGQUESTION_SERIAL_NO AS bigquestionSerialNo,
			   QUESTION_VERSION_NO AS questionVersionNo
		 FROM  TT_KS_DAJUAN
		WHERE  EXAMINE_ID = #examineId#
		  AND  EMPLOYEES_ID = #employeesId#
		  AND  EXAMINE_JOIN_TIMES = #examineJoinTimes#
		ORDER BY ANSWER_TIME DESC
		LIMIT  0,1
	</select>
	
	<!--取得考生考试答卷信息-->
	<select id="getTestEmployeeAnswerInfo" parameterClass="testEmployeeAnswerInfo" resultClass="testEmployeeAnswerInfo">
		SELECT EXAMINE_ID AS examineId,
			   ANSWER_CONTENT AS answerContent
		FROM TT_KS_DAJUAN
		WHERE EXAMINE_ID = #examineId# 
		  AND EMPLOYEES_ID = #employeesId# 
		  AND EXAMINE_JOIN_TIMES = #examineJoinTimes# 
		  AND BIGQUESTION_SERIAL_NO = #bigquestionSerialNo# 
		  AND QUESTION_ID = #questionId# 
		  AND QUESTION_VERSION_NO = #questionVersionNo# 
		  AND ANSWER_SERIAL_NO = #answerSerialNo# 
	</select>
	
	<!--插入考生考试答卷信息-->
	<insert id="insertTestEmployeeAnswerInfo" parameterClass="testEmployeeAnswerInfo">
		INSERT INTO TT_KS_DAJUAN (	
			EXAMINE_ID,
			EMPLOYEES_ID,
			EXAMINE_JOIN_TIMES,
			BIGQUESTION_SERIAL_NO,
			QUESTION_ID,
			QUESTION_VERSION_NO,
			ANSWER_SERIAL_NO,
			ANSWER_CONTENT,
			QUESTION_FLG,
			MARK_FLG,
			ANSWER_TIME
		) VALUES (
			#examineId#,
			#employeesId#,
			#examineJoinTimes#,
			#bigquestionSerialNo#,
			#questionId#,
			#questionVersionNo#,
			#answerSerialNo#,
			#answerContent#,
			#questionFlg#,
			#markFlg#,
			NOW()
		)
	</insert>
	
	<!--更新考生考试答卷信息-->
	<update id="updateTestEmployeeAnswerInfo" parameterClass="testEmployeeAnswerInfo">
		UPDATE TT_KS_DAJUAN 
		SET 
			ANSWER_CONTENT = #answerContent#,
			ANSWER_TIME = NOW()
		WHERE EXAMINE_ID = #examineId# 
		  AND EMPLOYEES_ID = #employeesId# 
		  AND EXAMINE_JOIN_TIMES = #examineJoinTimes# 
		  AND BIGQUESTION_SERIAL_NO = #bigquestionSerialNo# 
		  AND QUESTION_ID = #questionId# 
		  AND QUESTION_VERSION_NO = #questionVersionNo# 
		  AND ANSWER_SERIAL_NO = #answerSerialNo#
	</update>
	
	<!--更新考试员工考试状态信息-->
	<update id="updateExamEmployeeInfo" parameterClass="examEmployeeInfo">
		UPDATE TT_KS_YUANGONG
		SET
			EMP_EXAM_STATUS = #empExamStatus#
		WHERE
			EXAMINE_ID = #examineId#					
		AND	EMPLOYEES_ID = #employeesId#								
		AND	EXAMINE_JOIN_TIMES = #examineJoinTimes#								
	</update>
	<!--取得考试员工考试状态信息-->
	<select id="getExamEmployeeInfo" parameterClass="examEmployeeInfo" resultClass="examEmployeeInfo">
		SELECT 
			EMP_EXAM_STATUS AS empExamStatus,
			EXAMINE_END_TIME AS examineEndTime
		FROM 
			TT_KS_YUANGONG
		WHERE
			EXAMINE_ID = #examineId#					
		AND	EMPLOYEES_ID = #employeesId#								
		AND	EXAMINE_JOIN_TIMES = #examineJoinTimes#				
	</select>
	<!--取得考试标志-->
	<select id="getExamFlg" resultClass="Integer" parameterClass="String">
		SELECT EXAMINE_FLG as examineFlg
		FROM TT_KS_XINXI
		WHERE EXAMINE_ID = #examineId#
	</select>
</sqlMap>