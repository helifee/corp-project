<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Yc0020Dao">
	<typeAlias alias="yc0020CondA" type="com.yds.meet.bean.Yc0020CondA"/>
    <typeAlias alias="metDaymetInfo" type="com.yds.meet.bean.MetDaymetInfo"/>
    
    <!-- 取得会议室信息 --> 
    <select id="getMetDaymetInfoList" parameterClass="java.util.HashMap" resultClass="metDaymetInfo"> 
        SELECT
			T3.MET_ID           as metId,
			(SELECT EMP_CNM FROM v_emp_list_quit WHERE EMP_ID = T1.APPLY_USER_ID)
								as applyUserNm,
			T1.MET_STA_TIME     as metStaTime,
			T1.MET_END_TIME     as metEndTime,
			T1.APPLY_USER_ID    as applyUserId,
			T1.JOIN_USER_CNT    as joinUserCnt,
			(SELECT COUNT(T2.JOIN_USER_ID) FROM MET_DAYMET_USER T2 
			WHERE  T1.MET_ID = T2.MET_ID
			AND    T1.MET_DATE = T2.MET_DATE
			AND    T1.MET_STA_TIME = T2.MET_STA_TIME
			AND    T2.JOIN_USER_ID = #loginUserId#)
					            as permitFlg								
			
        FROM
            MET_ROOM_INFO T3,
			MET_DAYMET_INFO T1
		WHERE
		    T3.MET_ID = T1.MET_ID	
		AND
			T3.MET_STATE = '1'
		AND
			T1.MET_DATE = #metDate#	
		
		ORDER BY T3.SORT_ID,
				 T1.MET_STA_TIME
    </select>
</sqlMap>  
