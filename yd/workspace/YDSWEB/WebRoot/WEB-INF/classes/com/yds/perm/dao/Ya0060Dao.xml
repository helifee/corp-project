<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Ya0060Dao">
	<typeAlias alias="rolePerMgrInfo" type="com.yds.perm.bean.RolePerMgrInfo"/>
	<typeAlias alias="PerRoleInfo" type="com.yds.perm.bean.PerRoleInfo"/>
	<typeAlias alias="PosInfo" type="com.yds.perm.bean.PosInfo"/>
	<typeAlias alias="User" type="com.yds.common.bean.EmpInfo"/>
	
	<!-- 职位名取得 --> 
	<select id="getPosNameList" parameterClass="String" resultClass="PosInfo">
		SELECT 
		  T1.POS_NAME AS posName
		FROM EMP_POS T1 
		  INNER JOIN EMP_STAFF_POS T2 
				ON T2.POS_ID=T1.POS_ID 
		WHERE  T2.EMP_ID=#userId# 
			  AND T1.POS_STATE='1'
	</select>
	
	<!-- 角色名取得 --> 
	<select id="getRoleNameList" parameterClass="String" resultClass="PerRoleInfo">
		SELECT 
		  T1.ROLE_NM AS roleName
		FROM PER_ROLE T1 
		  INNER JOIN PER_USER_PERMIT T2
				  ON T2.POS_ROLE_ID=T1.ROLE_ID 
		WHERE T2.USER_ID=#userId#
	</select>
	
	<!-- 用户权限一览取得 --> 
	<select id="getUserPerInfoList" parameterClass="String" 
		resultClass="rolePerMgrInfo"> 
		SELECT 
		  T1.PERMIT_ID AS permitPermitId,
		  T1.MENU_NAME AS menuName, 
		  T1.DISP_SEQ AS dispSeq, 
		  V2.PERM_ID AS checkPermitId 
		FROM PER_PERMIT T1 
			 LEFT JOIN (
				SELECT V1.PERM_ID 
				FROM V_PER_USER_PERM V1 
				WHERE V1.USER_ID=#userId#) V2 
			ON T1.PERMIT_ID=V2.PERM_ID 
		WHERE T1.IS_CONTROL='1' 
		ORDER  BY
		  T1.DISP_SEQ;
	</select>
	
	<!-- 用户名及用户ID取得 -->
	<select id="getUser" parameterClass="String" resultClass="User">
		SELECT 
		  EMP_CNM AS empCnm,
		  EMP_ID AS empId
		FROM V_EMP_LIST_QUIT
		WHERE EMP_ID = #userId#;
	</select>
</sqlMap>
