<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Insert title here</title>
		<!-- 共通css -->
		<link rel="stylesheet" type="text/css" href="../css/gray.css">
		<link rel="stylesheet" type="text/css" href="../css/manual.css">
		<link rel="stylesheet" type="text/css" href="../js/highlighter/highlighter.css">
		<!-- 共通js -->
		<script type="text/javascript" src="../js/common/prototype.js"></script>
		<script type="text/javascript" src="../js/common/util.js"></script>
		<script type="text/javascript" src="../js/common/orgMap.js"></script>
		<script type="text/javascript" src="../js/highlighter/highlighter.js"></script>
		<script type="text/javascript" src="../js/manual/common.js"></script>
	</head>
	<body class="bgclr_gray">
		<table class="mbg">
			<tr>
				<td class="mbg_lt"></td>
				<td class="mbg_t"></td>
				<td class="mbg_rt"></td>
			</tr>
			<tr>
				<td class="mbg_l"></td>
				<td class="mbg_c">
					<!-- 内容开始 -->
					<div class="container span-20 last">
						<div class="title">
							<div class="float_l"><h2>组织图</h2></div>
							<div class="float_r"><hr class="codetoggleall"/></div>
						</div>
						<div class="span-20 last">
							<div class="h2">一、 功能简介</div>
							<div class="prepend-1">
								组织结构图，支持工具图标、节点展开等功能。
								<ul>
									<li>需要引用 <b>js/common/orgMap.js</b> </li>
								</ul>
							</div>
						</div>
						<div class="span-20 last">
							<div class="h2 float_l">
								二、实例说明
							</div>
							<div class="prepend-1 span-19">
								<div class="span-18 prepend-h">
									<div class="module code">
										<div class="module_header">
											实例演示：
										</div>
										<div class="module_body span-17">
											<div class="span-16 prepend-h">
												<!-- SAMPLE START -->
												<div id="orgMapContainer"></div>
												<div class="float_l margin_top_10">
													<input type="button" value="后退" onclick="func3();" class="span-2 btn"/>
												</div>
												<script type="text/javascript">
													var nowData;
													var baseData;
													var lastData = [];
													Event.observe(window, 'load', function(){
														loadMap();
													});
													function loadMap() {
														new Ajax.Request('orgMapData.action', {
															method: 'get',
															onComplete: function(request) {
																baseData = request.responseText.evalJSON();
																nowData = baseData;
																drawMap(2);
															}
														});
													}
													
													function drawMap(level){
														createOrgMap(nowData, 'orgMapContainer', 630, 400, level);
													}
													
													function func1() {
														nowData = getNodeData();
														alert(nowData.name);
													}
													
													function func2() {
														lastData.push(nowData);
														nowData = getNodeData();
														drawMap(0);
													}
													
													function func3() {
														nowData = lastData.pop();
														if (nowData && nowData != baseData) {
															drawMap(0);
														} else {
															nowData = baseData;
															drawMap(2);
														}
													}
												</script>
												<!-- SAMPLE END -->
											</div>
										</div>
									</div>
								</div>
								<div class="prepend-1 span-18">
									<div class="h4 float_l">1. 节点结构</div>
									<div class="module code">
										<div class="module_header">
											Java：<hr class="codetoggle none"/>
										</div>
										<div class="module_body span-17">
											<pre class="brush: java">
												public class OrgMapInfo {
												
													/**
													 * 节点标识.
													 */
													private String id;
													
													/**
													 * 节点文字.
													 */
													private String name;
													
													/**
													 * 节点侧面文字.
													 */
													private String desc;
													
													/**
													 * 节点类型(影响背景色等).
													 */
													private String type;
													
													/**
													 * 浮动按钮.
													 */
													private String bar1;
													private String bar2;
													private String bar3;
													
													/**
													 * 子节点.
													 */
													private List&lt;OrgMapInfo&gt; childs;
												}
											</pre>
										</div>
									</div>
								</div>
								<div class="prepend-1 span-18">
									<div class="h4 float_l">2. 数据处理</div>
									<div class="float_l clear_both">
										将平坦数据转化为树状结构(仅供参考)。
									</div>
									<div class="module code">
										<div class="module_header">
											Java：<hr class="codetoggle none"/>
										</div>
										<div class="module_body span-17">
											<pre class="brush: java">
												private static final String BAR1 = "&lt;span class=\"img_opt opt_EditTable\" title=\"按钮1\" onclick=\"func1();\"&gt;&lt;/span&gt;";
												private static final String BAR2 = "&lt;span class=\"img_opt opt_Help\" title=\"按钮2\" onclick=\"func2();\"&gt;&lt;/span&gt;";
												private OrgMapDao orgMapDao;
											
												@Override
												public OrgMapInfo getOrgMapRoot() {
													List&lt;OrgMapInfo&gt; list = orgMapDao.getOrgMapInfoList();
													Stack&lt;OrgMapInfo&gt; stack = new Stack&lt;OrgMapInfo&gt;();
													for (OrgMapInfo node : list) {
														node.setChilds(new ArrayList&lt;OrgMapInfo&gt;());
														node.setType(trimZero(node.getType()));
														while (true) {
															if (stack.empty()) {
																stack.push(node);
																break;
															} else {
																if (node.getType().startsWith(stack.peek().getType())) {
																	stack.peek().getChilds().add(node);
																	stack.push(node);
																	break;
																} else {
																	stack.pop();
																}
															}
														}
													}
													for (OrgMapInfo node : list) {
														switch (node.getType().length()) {
															case 2:
																node.setType("1");
																break;
															case 4:
																node.setType("2");
																node.setBar1(BAR1);
																node.setBar2(BAR2);
																break;
															case 6:
																node.setType("3");
																node.setBar1(BAR1);
																node.setBar2(BAR2);
																break;
															case 8:
																node.setType("4");
																node.setBar1(BAR1);
																break;
															default:
																node.setType("0");
														}
													}
													return list.get(0);
												}
											
												public String trimZero(String key) {
													while (key.endsWith("00")) {
														key = key.substring(0, key.length() - 2);
													}
													return key;
												}
											</pre>
										</div>
									</div>
								</div>
								<div class="prepend-1 span-18">
									<div class="h4 float_l">3. 返回值处理</div>
									<div class="float_l clear_both">
										将对象转化为json字符串返回到前台。
									</div>
									<div class="module code">
										<div class="module_header">
											Action：<hr class="codetoggle none"/>
										</div>
										<div class="module_body span-17">
											<pre class="brush: java">
												private String mapJson;
												
												public String execute(){
													orgMapRoot = orgMapService.getOrgMapRoot();
													JSONObject jo = JSONObject.fromObject(orgMapRoot);
													mapJson = jo.toString();
													return SUCCESS;
												}
											</pre>
										</div>
									</div>
									<div class="module code">
										<div class="module_header">
											Struts：<hr class="codetoggle none"/>
										</div>
										<div class="module_body span-17">
											<pre class="brush: xml">
												&lt;action name="orgMapData" class="orgMapAction"&gt;
													&lt;result name="success" type="str"&gt;mapJson&lt;/result&gt;
												&lt;/action&gt;
											</pre>
										</div>
									</div>
								</div>
								<div class="prepend-1 span-18">
									<div class="h4 float_l">3. 前台代码</div>
									<div class="float_l clear_both">
										包括了简单的节点展开、返回、限制可见层数示例。
									</div>
									<div class="module code">
										<div class="module_header">
											Javascript：<hr class="codetoggle none"/>
										</div>
										<div class="module_body span-17">
											<pre class="brush: js">
													var nowData;
													var baseData;
													var lastData = [];
													Event.observe(window, 'load', function(){
														loadMap();
													});
													function loadMap() {
														new Ajax.Request('orgMapData.action', {
															method: 'get',
															onComplete: function(request) {
																baseData = request.responseText.evalJSON();
																nowData = baseData;
																
																// 限制只显示两层
																drawMap(2);
															}
														});
													}
													
													function drawMap(level){
														createOrgMap(nowData, 'orgMapContainer', 630, 400, level);
													}
													
													// 按钮1事件
													function func1() {
														nowData = getNodeData();
														alert(nowData.name);
													}
													
													// 按钮2事件
													function func2() {
														lastData.push(nowData);
														nowData = getNodeData();
														
														// 0表示显示所有层
														drawMap(0);
													}
													
													// 后退功能
													function funcReturn() {
														nowData = lastData.pop();
														if (nowData && nowData != baseData) {
															drawMap(0);
														} else {
															nowData = baseData;
															drawMap(2);
														}
													}
											</pre>
										</div>
									</div>
									<div class="module code">
										<div class="module_header">
											JSP：<hr class="codetoggle none"/>
										</div>
										<div class="module_body span-17">
											<pre class="brush: html">
												&lt;div id="orgMapContainer"&gt;&lt;/div&gt;
												&lt;div class="float_l margin_top_10"&gt;
													&lt;input type="button" value="后退" onclick="funcReturn();" class="span-2 btn"/&gt;
												&lt;/div&gt;
											</pre>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="span-20 last">
							<div class="h2">三、 方法接口</div>
							<div class="prepend-1 span-19 last">
								<div class="h3">1. 创建组织图</div>
								<div class="prepend-h span-18 h4">
									createOrgMap(data, container, width, height[, showLevel]) 创建组织图
								</div>
								<div class="prepend-h span-18">
									<ul class="font_mono">
										<li class="font_size_14"><b>data</b>:object 数据</li>
										<li class="font_size_14"><b>container</b>:object 容器</li>
										<li class="font_size_14"><b>width</b>:int 宽度</li>
										<li class="font_size_14"><b>height</b>:int 高度</li>
										<li class="font_size_14"><i>showLevel</i>:int 显示层数</li>
									</ul>
								</div>
							</div>
							<div class="prepend-1 span-19 last">
								<div class="h3">2. 取得触发节点的数据</div>
								<div class="prepend-h span-18 h4">
									getNodeData() 取得触发节点的数据，只能用在浮动按钮的点击事件中。
								</div>
							</div>
						</div>
						<div class="span-20 last">
							<div class="h2">四、 常见问题</div>
							<div class="prepend-1 span-19 last">
								<div class="h3">1. 没有</div>
							</div>
						</div>
					</div>
					<!-- 内容结束 -->
				</td>
				<td class="mbg_r"></td>
			</tr>
			<tr>
				<td class="mbg_lb"></td>
				<td class="mbg_b"></td>
				<td class="mbg_rb"></td>
			</tr>
		</table>
		<script type="text/javascript">SyntaxHighlighter.config.clipboardSwf="../js/highlighter/scripts/clipboard.swf";SyntaxHighlighter.all();</script>
	</body>
</html>
