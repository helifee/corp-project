/*
 * Copyright (c) 2009-2010 by DaLian YuDong Computer System CO.,LTD
 * All rights reserved.
 *      Project: SSH
 *    SubSystem: 会议室管理子系统
 */

package com.ysys.www.hy.dao.impl;

import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springframework.orm.hibernate3.support.HibernateDaoSupport;

import com.ysys.www.hy.dao.AffirmattendDao;
import com.ysys.www.hy.dao.condition.TabMrhycjz;

/**
 *  @see com.ysys.www.hy.dao.AffirmattendDao
 */
public class AffirmattendDaoImpl extends HibernateDaoSupport implements AffirmattendDao {
	private static final Log log = LogFactory.getLog(AffirmattendDaoImpl.class);

	 /**
	 * {@inheritDoc}
	 */
	@SuppressWarnings("unchecked")
	public List getattendinfo(String attendEmpid, String nowYMD, String nowTime) {
		log.debug("Init");
		try {
			String queryString = " select hysyl.id, hysyl.hysmc, mrhy.id.hyrq, mrhy.id.hykssj, " +
								"         mrhy.hyjssj, mrhy.hyzt, tempinfo.empName" + 
								" from TabMrhyyl mrhy, TabMrhycjz mrhycjz, TabHysyl hysyl, Tempinfo tempinfo"+
								" where mrhy.id.hyrq = mrhycjz.id.hyrq " +
								" and mrhy.id.hysid = hysyl.id" +
								" and mrhy.id.hykssj = mrhycjz.id.hykssj" + 
								" and mrhy.id.hysid = mrhycjz.id.hysid " +
								" and tempinfo.id = mrhy.yyrid" +
								" and mrhycjz.hzqr = 0" + 
								" and mrhycjz.id.cjzid = '"+ attendEmpid +"' " +
								" and ((mrhy.id.hyrq = '"+nowYMD+"' and mrhy.hyjssj >= '"+nowTime+"') " + 
									" or (mrhy.id.hyrq >'"+nowYMD+"')) "+
								" order by mrhy.id.hyrq, mrhy.id.hykssj";
			return getHibernateTemplate().find(queryString);
		} catch (RuntimeException re) {
			log.error("find all failed", re);
			throw re;
		}
	}
	
	/**
	 * {@inheritDoc}
	 */
	public void update(TabMrhycjz mrhycjz) {
		log.debug("update TabMrhycjz");
		try {
			this.getHibernateTemplate().update(mrhycjz);
		} catch (RuntimeException re) {
			log.error("update failed", re);
			throw re;
		}
	}
	
}
