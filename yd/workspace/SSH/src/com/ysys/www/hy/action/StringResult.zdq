package com.ysys.www.hy.action;

/*
 * @(#)StringResult.java
 * Copyright (c) 2009-2010 å¤§è¿è¿œä¸œè®¡ç®—æœºç³»ç»Ÿæœ‰é™å…¬å?
 * All rights reserved.
 *      Project: è¿œä¸œå…¬å¸å†…éƒ¨ç½?
 *    SubSystem: å…±é?ç³»ç»Ÿ
 */

import java.io.PrintWriter;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.dispatcher.ServletRedirectResult;

import com.opensymphony.xwork2.ActionInvocation;

/**
 * æ‰©å±•Struts2è¿”å›ç±»å‹,ç›´æ¥è¿”å›String.
 * 
 * @author zhaodong
 * @version 1.00 2010/3/5 
 */
public class StringResult extends ServletRedirectResult {

	private static final long serialVersionUID = -8308338083005951877L;
	private static final Log LOG = LogFactory
			.getLog(StringResult.class);

	public StringResult() {

		super();

	}

	public StringResult(String location) {

		super(location);

	}

	/**
	 * æ‰©å±•Struts2è¿”å›ç±»å‹ï¼Œç›´æ¥è¿”å›String.
	 */
	@Override
	public void doExecute(String finalLocation, ActionInvocation invocation)
			throws Exception {

		// å–å¾—HTTP Responseå¯¹è±¡
		HttpServletResponse response = (HttpServletResponse) invocation
				.getInvocationContext().get(HTTP_RESPONSE);

		// å–å¾—HTTP Requestå¯¹è±¡
		HttpServletRequest request = (HttpServletRequest) invocation
				.getInvocationContext().get(HTTP_REQUEST);

		// è®¾ç½®ç¼–ç ç­?
		response.setContentType("text/plain; charset=UTF-8");

		response.setHeader("Content-Disposition", "inline");

		PrintWriter writer = null;

		try {

			// å†™å…¥String
			writer = response.getWriter();

			writer.write(request.getAttribute(finalLocation).toString());

		// å¼‚å¸¸å¤„ç†
		} catch (NullPointerException e) {

			if (finalLocation.equals("")) {

				LOG.warn("AAA", e);

			} else {

				LOG.error("BBB", e);

			}

		} finally {

			// å…³é—­PrintWriter
			if (writer != null) {

				writer.flush();

				writer.close();

			}

		}

	}

}
