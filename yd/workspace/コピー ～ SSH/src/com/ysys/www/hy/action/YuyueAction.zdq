package com.ysys.www.hy.action;

import java.util.List;

import com.opensymphony.xwork2.ActionSupport;
import com.ysys.www.hy.dao.condition.TabHysyl;
import com.ysys.www.hy.service.YuyueService;
import com.ysys.www.hy.service.common.CommonConstants;
import com.ysys.www.hy.service.common.CommonMessage;
import com.ysys.www.hy.service.common.SessionManager;
import com.ysys.www.hy.service.common.UserInfo;
import com.ysys.www.hy.service.condition.YuyueInfo;

public class YuyueAction extends ActionSupport{

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private YuyueService yuyueservice;
	private YuyueInfo yuyueinfo;
	private List<TabHysyl> hysList;
	private String errormsg;
	private Boolean isMonday;
	private Boolean isTuesday;
	private Boolean isWensday;
	private Boolean isThusday;
	private Boolean isFriday;

	
	//---------------------- 初始化页面 ----------------------//
    public String execute(){
    	
    	if(null == yuyueinfo) {
    		return ERROR;
    	}
    	
    	yuyueinfo.setYuyuetype(CommonConstants.SDAY_MEETING);	//默认为当日
    	SessionManager session = new SessionManager();
    	yuyueinfo.setSqr(((UserInfo)session.get(CommonConstants.USERINFO)).getUserName());	//申请人
    	this.setHysList(yuyueservice.getHysAll());
    	return SUCCESS;
    }
    
  //------------------------ 保存数据 ----------------------//
    public String save(){
    	
    	if (yuyueservice.saveYuyueData(yuyueinfo) == false){
    		this.setErrormsg(CommonMessage.RESERVE_CRASH);
        	this.setHysList(yuyueservice.getHysAll());
    		return ERROR;		//冲突
    	}
    	return SUCCESS;			//不冲突
    }
    
    //------------------------ 预约修改Init ----------------------//
    public String init() {
    	
    	if(null == yuyueinfo) {
    		return ERROR;
    	}
    	
    	String startdate = yuyueinfo.getStartdate();
    	String hys = yuyueinfo.getHys();
    	String start_hour = yuyueinfo.getStart_hour();
    	String start_minute = yuyueinfo.getStart_minute();
    	
    	this.yuyueinfo = yuyueservice.getYuyueInfo(hys, startdate, start_hour, start_minute);
    	yuyueinfo.setYuyuetype(CommonConstants.SDAY_MEETING);	//默认为当日修改
    	
    	this.setHysList(yuyueservice.getHysAll());

    	//每周时checkbox处理
    	if(null != this.yuyueinfo.getMon()){
    		isMonday = true;
    	}
    	
    	if(null != this.yuyueinfo.getTue()){
    		isTuesday = true;
    	}
    	
    	if(null != this.yuyueinfo.getWen()){
    		isWensday = true;
    	}
    	
    	if(null != this.yuyueinfo.getThu()){
    		isThusday = true;
    	}
    	
    	if(null != this.yuyueinfo.getFri()){
    		isFriday = true;
    	}
    	
    	return SUCCESS;
    }
    
    //------------------------ modify ----------------------//
    public String modify() {
    	
    	if(yuyueservice.modifyYuyueData(yuyueinfo) == false) {
    		this.setErrormsg(CommonMessage.MODIFY_ERROR);
    		return ERROR;
    	}
    	
    	return SUCCESS;
    }

    public void setYuyueService(YuyueService yuyueservice) {
    	this.yuyueservice = yuyueservice;
    }

	public YuyueInfo getYuyueinfo() {
		return yuyueinfo;
	}

	public void setYuyueinfo(YuyueInfo yuyueinfo) {
		this.yuyueinfo = yuyueinfo;
	}

	public List<TabHysyl> getHysList() {
		return hysList;
	}

	public void setHysList(List<TabHysyl> hysList) {
		this.hysList = hysList;
	}

	public String getErrormsg() {
		return errormsg;
	}

	public void setErrormsg(String errormsg) {
		this.errormsg = errormsg;
	}

	public Boolean getIsMonday() {
		return isMonday;
	}

	public void setIsMonday(Boolean isMonday) {
		this.isMonday = isMonday;
	}

	public Boolean getIsTuesday() {
		return isTuesday;
	}

	public void setIsTuesday(Boolean isTuesday) {
		this.isTuesday = isTuesday;
	}

	public Boolean getIsWensday() {
		return isWensday;
	}

	public void setIsWensday(Boolean isWensday) {
		this.isWensday = isWensday;
	}

	public Boolean getIsThusday() {
		return isThusday;
	}

	public void setIsThusday(Boolean isThusday) {
		this.isThusday = isThusday;
	}

	public Boolean getIsFriday() {
		return isFriday;
	}

	public void setIsFriday(Boolean isFriday) {
		this.isFriday = isFriday;
	}

	@Override
	public void validate() {

		
	}
}