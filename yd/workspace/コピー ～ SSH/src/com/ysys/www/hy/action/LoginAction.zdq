package com.ysys.www.hy.action;

import com.opensymphony.xwork2.ActionSupport;
import com.ysys.www.hy.service.LoginService;
import com.ysys.www.hy.service.common.CommonConstants;
import com.ysys.www.hy.service.common.CommonMessage;
import com.ysys.www.hy.service.common.UserInfo;
import com.ysys.www.hy.service.common.SessionManager;

public class LoginAction extends ActionSupport {

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	private LoginService LoginService;
	private String userID;
	private String userName;
	private String passWord;
	private String errormsg;
	private String destUrl;

	public String logout() throws Exception{
		setDestUrl("/" + CommonConstants.PATH_HY + "/"
				+ CommonConstants.PAGE_LOGIN);
		SessionManager session = new SessionManager();
		session.destroy();
		return SUCCESS;

	}

	public String execute() throws Exception{

		setDestUrl("/" + CommonConstants.PATH_HY + "/"
				+ CommonConstants.PAGE_LOGIN);
		setErrormsg(CommonMessage.RE_LOGIN);
		return SUCCESS;

	}

	public String login() throws Exception{
		SessionManager session = new SessionManager();
		setErrormsg("");
		UserInfo user = this.LoginService.login(userID, passWord);
		if (null == user) {
			setErrormsg(CommonMessage.ERROR_USER_PASSWORD);
			return ERROR;
		}
		setUserID(user.getUserID());
		setUserName(user.getUserName());

		if (session.get(CommonConstants.REQUESTURL) == null) {
			setDestUrl("/" + CommonConstants.PATH_HY + "/"
					+ CommonConstants.PAGE_MAIN);
		} else {
			setDestUrl((String) session.get(CommonConstants.REQUESTURL));
			session.set(CommonConstants.REQUESTURL, null);
		}
		return SUCCESS;
	}


	private void getFromSession() {
		if (null == userID || "".equals(userID)) {
			SessionManager session = new SessionManager();
			if (null != ((UserInfo) session.get(CommonConstants.USERINFO))) {
				setUserID(((UserInfo) session.get(CommonConstants.USERINFO))
						.getUserID());
				setUserName(((UserInfo) session.get(CommonConstants.USERINFO))
						.getUserName());
			}
		}

	}

	public String getUserID() {
		getFromSession();
		return userID;
	}

	public void setUserID(String userID) {
		this.userID = userID;
	}

	public String getUserName() {
		getFromSession();
		return userName;
	}

	public void setUserName(String userName) {
		this.userName = userName;
	}

	public String getPassWord() {
		return passWord;
	}

	public void setPassWord(String passWord) {
		this.passWord = passWord;
	}

	public void setLoginService(LoginService loginService) {
		this.LoginService = loginService;
	}

	public String getErrormsg() {
		return errormsg;
	}

	public void setErrormsg(String errormsg) {
		this.errormsg = errormsg;
	}

	public String getDestUrl() {
		return destUrl;
	}

	public void setDestUrl(String destUrl) {
		this.destUrl = destUrl;
	}

}
