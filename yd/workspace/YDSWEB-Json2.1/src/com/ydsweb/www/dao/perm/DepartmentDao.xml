<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTDSQLMap2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="DepartmentDao">
	<typeAlias alias="departmentInfo" type="com.ydsweb.www.dao.condition.perm.DepartmentInfo"/>

	<!-- 添加部门信息 --> 
	<insert id="departmentadd" parameterClass="departmentInfo">
		INSERT INTO PER_DEPARTMENT 
			(DEPT_ID, 
			DEPT_NM,
			DEPT_SNM,
			PARENT_DEPT_ID, 
			DEPT_DESC,  
			LEADER_ID
			)
			VALUES
			(#deptId#, 
			#deptNm#,
			#deptSnm#, 
			#parentDeptId#, 
			#deptDesc#, 
			#leaderId#
			);
	</insert>
	
	<!-- 部门信息一览取得 --> 
	<select id="getdepartmentinfos" parameterClass="String" resultClass="departmentInfo"> 
		SELECT
			T1.DEPT_ID AS deptId,
			T1.DEPT_NM AS deptNm,
			T1.DEPT_SNM AS deptSnm,
			T1.PARENT_DEPT_ID AS parentDeptId,
			T3.DEPT_NM AS parentDeptNm,
			T1.DEPT_DESC AS deptDesc,
			T1.LEADER_ID AS leaderId,
			T2.USER_CNM AS leaderNm,
			T1.UPDATETIME AS updateTime
		FROM
			PER_DEPARTMENT T1
		LEFT JOIN
			(PER_USER T2,
			PER_DEPARTMENT T3)
		ON
			(T1.LEADER_ID=T2.USER_ID
		AND 
			T1.PARENT_DEPT_ID=T3.DEPT_ID)
		ORDER BY
			T1.DEPT_ID;
	</select>
	
	<!-- 删除部门信息 --> 
	<delete id="departmentdel" parameterClass="String">
		DELETE
		FROM PER_DEPARTMENT
		WHERE
			DEPT_ID=#deptId#;
	</delete>
	
	<!-- 部门名称取得 --> 
	<select id="getdeptNm" parameterClass="String" resultClass="String">
		SELECT 
			DEPT_NM AS deptNm
			FROM PER_DEPARTMENT 
		WHERE
			DEPT_ID = #deptId#;
	</select>
	
	<!-- 更新部门信息 --> 
	<update id="departmentupt" parameterClass="departmentInfo">
		UPDATE PER_DEPARTMENT 
		SET
			DEPT_ID = #deptId#, 
			DEPT_NM = #deptNm#,
			DEPT_SNM = #deptSnm#, 
			PARENT_DEPT_ID = #parentDeptId#, 
			DEPT_DESC = #deptDesc#, 
			LEADER_ID = #leaderId#
		WHERE
			DEPT_ID = #deptId#;
	</update>
	
	<!-- 部门信息取得 --> 
	<select id="getdepartmentinfo" parameterClass="String" resultClass="departmentInfo"> 
		SELECT
			T1.DEPT_ID AS deptId,
			T1.DEPT_NM AS deptNm,
			T1.DEPT_SNM AS deptSnm,
			T1.PARENT_DEPT_ID AS parentDeptId,
			T3.DEPT_NM AS parentDeptNm,
			T1.DEPT_DESC AS deptDesc,
			T1.LEADER_ID AS leaderId,
			T2.USER_CNM AS leaderNm,
			T1.UPDATETIME AS updateTime
		FROM
			PER_DEPARTMENT T1,
			PER_USER T2,
			PER_DEPARTMENT T3
		WHERE
			T1.DEPT_ID = #deptId#
		AND T1.LEADER_ID=T2.USER_ID
		AND T1.PARENT_DEPT_ID=T3.DEPT_ID;
	</select>
</sqlMap>  
