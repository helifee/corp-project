/*
 * Copyright (c) 2009-2010 by DaLian YuDong Computer System CO.,LTD
 * All rights reserved.
 *      Project: SSH
 *    SubSystem: 会议室管理子系统
 */
package com.ysys.www.hy.service.Impl;

/*
 * 
 * @author	赵)YDS
 * @version	1.0	2009/08/10
 * 
 * <PRE>
 *   ■变更履历■
 *   2009/08/10 赵)YDS 
 * </PRE>
 * */

import java.util.List;

import com.ysys.www.hy.dao.LoginDao;
import com.ysys.www.hy.dao.condition.UserResult;
import com.ysys.www.hy.service.LoginService;
import com.ysys.www.hy.service.common.CommonConstants;
import com.ysys.www.hy.service.common.SessionManager;
import com.ysys.www.hy.service.common.UserInfo;

/**
 * @see com.ysys.www.hy.service.LoginService
 */
public class LoginServiceImpl implements LoginService {
	private LoginDao loginDao;

	public void setLoginDao(LoginDao loginDao) {
		this.loginDao = loginDao;
	}

	 /**
	 * {@inheritDoc}
	 */
	@Override
	public UserInfo login(String userid, String password) {

		//初期化、检查
		SessionManager session = new SessionManager();

		if (null == password) {
			return null;
		}
		if (null == userid) {
			return null;
		} else {
			userid = CommonConstants.YD + userid;
		}
		//检索是否存在对应的用户
		List<UserResult> users = loginDao.login(userid);
		//用户不存在的情况
		if (users.size() < 1) {
			return null;
		}
		//检查密码是否匹配
		if (password.equals(((UserResult) users.get(0)).getUserPassword())) {
			//登录成功的情况，向Session中存入对应的信息
			UserInfo loginuser = new UserInfo();
			loginuser.setUserID(users.get(0).getUserId());
			loginuser.setUserName(users.get(0).getUserName());
			loginuser.setJobId(users.get(0).getUserJobId());
			session.set(CommonConstants.USERINFO, loginuser);
			return loginuser;
		}
		return null;
	}

}
