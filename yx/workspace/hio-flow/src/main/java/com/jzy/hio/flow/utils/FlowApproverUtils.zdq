package com.jzy.hio.flow.utils;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import com.jzy.hio.base.utils.SecurityUserBeanInfo;
import com.jzy.hio.feign.SysFeignService;
import com.jzy.hio.feign.dto.flow.AcDto;
import com.jzy.hio.feign.dto.flow.FlowPostDataDto;
import com.jzy.hio.flow.dto.tobedeleted.FlowAcPostDto;
import com.jzy.tools.data.JacksonUtils;
import com.jzy.tools.login.LoginUtils;

import net.minidev.json.JSONObject;


/**
 * 流程审批人工具类
 */
@Component
public class FlowApproverUtils {
	
	@Autowired
	private SysFeignService sysFeignService;
	 
	private static Logger logger = LoggerFactory.getLogger(FlowApproverUtils.class);

	public   List<FlowAcPostDto> parsePost(Map<String, Object> businessVariable, AcDto acDto) {

		List<AcDto> acDtos = new ArrayList<AcDto>();
		acDtos.add(acDto);

		return parsePost(businessVariable, acDtos);
	}

	@SuppressWarnings("unchecked")
	public   List<FlowAcPostDto> parsePost(Map<String, Object> businessVariable, List<AcDto> acDtos) {
		
//		log.info("流程发起时查询岗位信息：");
//		log.info("请求报文：businessVariable=" + businessVariable);
//		log.info("请求报文：acDtos=" + acDtos);
		// TODO zhangdaoqiang 1225
 		//postDtoServiceCustomer.getFlowPostData(userInfo, JacksonUtils.toJson(postBodyMap));
 		Map<String,Object> businesInfo=JacksonUtils.fromJson(JacksonUtils.toJson(businessVariable), HashMap.class);
 		FlowPostDataDto flowPostDataDto = new FlowPostDataDto();
 		flowPostDataDto.setBusinesInfo(businesInfo);
 		flowPostDataDto.setAcDtolist(acDtos);
 		String flowPostData = sysFeignService.getFlowPostData(flowPostDataDto);
 	//	String result = net.sf.json.JSONObject.fromObject(flowPostData).getString("result");
 		List<FlowAcPostDto> flowAcPostDtoList = JacksonUtils.fromJson(flowPostData,
				ArrayList.class, FlowAcPostDto.class);

//		log.info("响应报文：flowAcPostDtoList=" + flowAcPostDtoList);
		return flowAcPostDtoList;
	}

}
