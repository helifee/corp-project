<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>巨洲云</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <script src="common/common.css.js"></script>
</head>
<body>
<header class="container-fluid xj-form-header">
    <div class="row clearfix">
        <div class="col-md-1 col-sm-2 xj-index-logo">
            <img src="common/img/logo.png" alt="巨洲云">
        </div>
        <div class="col-md-8 col-sm-6 xj-form-title">流程模板配置-查看</div>
        <div class="col-md-3 col-sm-4 xj-form-btn">
            <button class="btn btn-sm btn-adv">关闭</button>
            <button class="btn btn-sm btn-adv">保存并新增</button>
            <button class="btn btn-sm btn-adv">保存</button>
        </div>
    </div>
</header>
<div class="container-fluid">
    <div class="row d-content" style="margin-top:60px">
        <div class="col-md-2 addBorder fullHeight">
            left
            <div class="btn-group">
                <button type="button" class="btn btn-default" id="testBtn">测试树</button>
            </div>


            <!--
            <div class="row">
                <input class="form-control" type="hidden" id="orgId" name="orgId" >
                <input class="form-control" type="hidden" id="prefixId" name="prefixId" >
                <input class="form-control" type="hidden" id="prefixName" name="prefixName" >
                组织名称：<input class="form-control orgAndPersonSelector" type="text" id="orgName" name="orgName" data-targetNameInput="orgName"
                       data-targetIdInput="orgId" data-targetPrefixIdInput="prefixId" data-targetPrefixNameInput="prefixName">
            </div>

            <div class="row">
                <input class="form-control" type="hidden" id="userId" name="userId" >
                人员名称：<input class="form-control orgAndPersonSelector" type="text" id="userName" name="userName"
                            data-selectorType="person" data-targetUserIdInput="userId" data-targetUserNameInput="userName">

            </div>
        </div>
        <div class="col-md-10 addBorder fullHeight">
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="orgName1" readonly="readonly" placeholder="选择组织机构">
                    <span class="input-group-addon single-selector" data-title="选择组织机构" data-targetname="orgName1">...</span>
                </div>
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="personName" readonly="readonly" placeholder="选择人员">
                    <span class="input-group-addon single-selector" data-selectorType="person" data-title="选择人员"
                          data-savecallback="testCallback1" data-targetname="personName">...</span>
                </div>
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="postName" readonly="readonly" placeholder="选择岗位">
                    <span class="input-group-addon single-selector" data-selectorType="post" data-title="选择岗位" data-targetname="postName">...</span>
                </div>
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="roleName" readonly="readonly" placeholder="选择角色">
                    <span class="input-group-addon single-selector" data-selectorType="role" data-title="选择角色" data-targetname="roleName">...</span>
                </div>
            </div>
            -->
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="menuName" readonly="readonly" placeholder="选择菜单">
                    <span class="input-group-addon single-selector" data-selectorType="menu" data-title="选择菜单" data-targetname="menuName">...</span>
                </div>
            </div>
            <br><br><br>


            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="id" readonly="readonly" placeholder="选择1">
                    <span class="input-group-addon singleArray-first" >...</span>
                </div>
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="select2" readonly="readonly" placeholder="选择2">
                    <span class="input-group-addon singleArray-second" >...</span>
                </div>
            </div>



            <br><br><br>


            <!--
            <div style="display: none">
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="orgName11" readonly="readonly" placeholder="选择组织机构（多选）">
                    <span class="input-group-addon multiple-selector" data-title="选择组织机构" data-targetname="orgName11">...</span>
                </div>
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="personName1" readonly="readonly" placeholder="选择人员（多选）">
                    <span class="input-group-addon multiple-selr"ecto data-selectorType="person" data-title="选择人员"
                          data-targetname="personName1" data-savecallback="testCallback">...</span>
                </div>
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="postName1" readonly="readonly" placeholder="选择岗位（多选）">
                    <span class="input-group-addon multiple-selector" data-selectorType="post" data-title="选择岗位" data-targetname="postName1">...</span>
                </div>
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="roleName1" readonly="readonly" placeholder="选择角色（多选）">
                    <span class="input-group-addon multiple-selector" data-selectorType="role" data-title="选择角色" data-targetname="roleName1">...</span>
                </div>
            </div>


            <div class="row">
                <div class="input-group">
                    <input type="text" class="form-control" id="param" readonly="readonly" placeholder="选择（多选）">
                    <span class="input-group-addon multiple-selector" data-selectorType="param" data-title="选择参数" data-targetname="roleName1">...</span>
                </div>
            </div>

            </div>
            -->
        </div>
    </div>
</div>

<!--
<div class="modal fade" id="_orgGridModal" tabindex="-1" role="dialog" aria-labelledby="orgGridModalLabel">
    <div class="modal-dialog modal-grid" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h5 class="modal-title modal-jz" id="orgGridModalLabel">选择组织机构</h5>
                <button type="button" class="btn btn-sm blue pull-right mr20">取消</button>
                <button type="button" class="btn btn-sm blue pull-right mr20">保存</button>
            </div>
            <div class="modal-body clearfix">
                <div class="col-md-3 addBorder rm-pad" >
                    <div class="modal_title">
                        <i class="fa fa-sitemap" aria-hidden="true"></i>
                        <span>组织机构</span>
                        <input type="text" class="form-control" placeholder="输入关键词..." id="_searchOrgTreeInput">
                        <button class="btn btn-sm btnMsearch rm-pad" id="_searchOrgTreeBtn">
                            <i class="fa fa-search" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div class="treeConent" id="_orgTreeContainer">
                        <ul id="_orgTree" class="ztree"></ul>
                    </div>
                </div>
                <div class="col-md-9 addBorder pull-right changeWidth rm-pad" >
                    <div class="modal_title">
                        <i class="fa fa-list" aria-hidden="true"></i>
                        <span>组织列表</span>
                    </div>
                    <div id="_orgGridContainer">
                        <table id="_orgGridList"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
-->

</body>
<script src="common/common.js"></script>
<script src="common/custom/js/form.js"></script>
<!--<script src="luo.js"></script>-->
<!--<script src="ding.js"></script>-->
<script>
    $(function () {
        $('.d-content').height($(window).height() - 60);
        $(window).resize(function () {
            $('.d-content').height($(window).height() - 60);
        });
         /**
          *  添加modal
          * */
      /*  $('.singleArray-selector').xljSingleArraySelector({
            selectorTypeArray:['org','person','post','role',''],
            /!**
             * 保存回调函数
             * @param selectDatas 已选择的数据json对象
             *!/
            saveCallback: function (treeNode) {
                //选中结果
               var singleArray = ['role'];
                //创建第二个modal
                $('.singleArray-selector').xljSingleArrayDraw({
                    selectArray: singleArray,
                    element:this
                });

            }
        });*/


        $('.singleArray-first').xljSingleArraySelector({
            selectorTypeArray:['person','post','role','busiObject'],
            targetId:'participantId2',//选择的数据的ID存储input域
            targetName:'participant2',//选择的数据的Name存储input域
            /**
             * 保存回调函数
             * @param selectDatas 已选择的数据json对象
             */
            saveCallback: function (treeNode) {
                //console.info(treeNode);
                //选中结果
                var singleArray;
                var type = treeNode.type;
                console.info("saveCallback>>> type==="+type);
                if("post"==type || "person"==type || "user"==type){
                    singleArray = ['post','person'];
                }else{
                    singleArray = ['role'];
                }
                //画第二个树
                $('.singleArray-second').xljSingleArrayDraw({
                    selectArray: singleArray,
                    selectType:singleArray[0]
                },$('.singleArray-second'));

            }
        });
        $('.singleArray-second').xljSingleArraySelector({
            selectorTypeArray:['person','post','role'],
            targetId:'replacerId2',//选择的数据的ID存储input域
            targetName:'replacer2',//选择的数据的Name存储input域

            saveCallback: function (treeNode) {
                //console.info(treeNode);
                //选中结果
                var singleArray;
                var type = treeNode.type;
            }
        });

        /*$('#testBtn').on('click',function () {
            $('#_orgGridModal').modal({show:true,backdrop:'static'});
        });



        /!**
         *
         * 初始化组织结构树
         *!/
        function initOrgTree(treeId) {
            $.ajax({
                type:'POST',
                url:'/platform-app/sys/org/root/getTree',
                dataType:'json',
                contentType:'application/json',
                data:'{}',
                success: function(json) {
                    //返回的数据节点
                    var zNodes = json.result;
                    //设置图片样式
                    recursionArray(zNodes);
                    zTreeObj = $.fn.zTree.init($("#"+treeId), {
                        view: {
                            fontCss: getFontCss
                        },
                        callback: {
                            onDblClick:function (event, treeId, treeNode) {
                                var rowData = jQuery("#_orgGridList").jqGrid('getRowData', treeNode.id);
                                if(rowData&&!rowData.id){
                                    var data = {
                                        id:treeNode.id,
                                        name:treeNode.name,
                                        type:treeNode.type,
                                        prefixName:treeNode.prefixName,
                                        status:treeNode.status,
                                        sort:treeNode.sort,
                                        rootId:treeNode.rootId,
                                        prefixId:treeNode.prefixId
                                    };
                                    jQuery("#_orgGridList").jqGrid('addRowData', treeNode.id, data);
                                }
                            }

                        }
                    }, zNodes);
                    var nodes = zTreeObj.getNodes();
                    //默认展开第一个节点
                    zTreeObj.expandNode(nodes[0], true, false, false,false);
                }
            });
        }
        initOrgTree('_orgTree');



        /!**
         * 递归设置树的图片样式
         *!/
        function recursionArray(arr) {
            //所属的分类 diy-group 目录 diy-company 集团和公司;diy-program 项目和分期;diy-department 部门;
            for(var i in arr) {
                if(arr[i].type == "zb" || arr[i].type == "company") {
                    arr[i].iconSkin = "diy-company";
                    if(arr[i].children.length > 0) {
                        recursionArray(arr[i].children);
                    }
                }else if(arr[i].type == "dept" ) {
                    arr[i].iconSkin = "diy-department";
                    if(arr[i].children.length > 0) {
                        recursionArray(arr[i].children);
                    }
                }else if(arr[i].type == "group" ) {
                    arr[i].iconSkin = "diy-program";
                    if(arr[i].children.length > 0) {
                        recursionArray(arr[i].children);
                    }
                }else if(arr[i].type == "branch" ) {
                    arr[i].iconSkin = "diy-program";
                    if(arr[i].children.length > 0) {
                        recursionArray(arr[i].children);
                    }
                }else if(arr[i].type == "cata" ) {
                    arr[i].iconSkin = "diy-group";
                    if(arr[i].children.length > 0) {
                        recursionArray(arr[i].children);
                    }
                }
            }
        };

        /!**
         *  查找树节点
         *  @param 查找节点属性
         *  @param 查找的节点属性的对应值
         *  @param 是否标记为高亮
         *!/
        function searchOrgTree(keyName,value,isHighlight) {
            var ztreeObj = $.fn.zTree.getZTreeObj("_orgTree");
            var nodes = ztreeObj.getNodesByParamFuzzy(keyName, value, null);
            $.each(nodes,function (i,node) {
                //zTree.setting.view.fontCss = {};
                if(isHighlight){
                    node.highlight = 'true';
                }else{
                    node.highlight = 'false';
                }

                ztreeObj.updateNode(node);
                ztreeObj.expandNode(node.getParentNode(), true, false, false);
            });
        }

        /!**
         * 个性化文字样式，只针对 zTree 在节点上显示的对象
         * @param treeId
         * @param treeNode
         * @returns
         *!/
        function getFontCss(treeId, treeNode) {
            return (treeNode.highlight&&treeNode.highlight=='true') ?
                    {'font-family': 'Verdana, Arial, Helvetica, AppleGothic, sans-serif','font-style':'italic', "font-weight":"bold"} :
                    {color:"#333", "font-weight":"normal",'font-style':'normal'} | (treeNode.status&&treeNode.status=='0') ?
                    {'font-family': 'Verdana, Arial, Helvetica, AppleGothic, sans-serif','font-style':'normal', 'color':'#CD0000'} :
                    {color:"#333", "font-weight":"normal",'font-style':'normal'};
        }

        /!**
         * 搜索框keyup\blur事件
         * @param searchInputObj 搜索框input的jq对象
         *!/
        function searchTreeInputEvent(searchInputObj){
            searchInputObj.bind('keyup',function (event) {
                searchOrgTree('highlight','true',false);
                if(event.keyCode==13||event.keyCode==32){
                    var inputVal = $(this).val();
                    searchOrgTree('name',$.trim(inputVal),true);
                }
            }).bind('blur',function (event) {
                var value = $(this).val();
                if(value=='') {
                    searchOrgTree('highlight','true',false);
                }

            });
        }

        searchTreeInputEvent($('#_searchOrgTreeInput'));


        /!**
         * 搜索按钮点击事件
         * @param searchBtnObj 搜索按钮jq对象
         *!/
        function searchTreeBtnEvent(searchBtnObj,searchInputObj) {
            searchBtnObj.on('click',function () {
                searchOrgTree('highlight','true',false);
                var inputVal = searchInputObj.val();
                if($.trim(inputVal)!=''){
                    searchOrgTree('name',inputVal,true);
                }

            });
        }
        searchTreeBtnEvent($('#_searchOrgTreeBtn'),$('#_searchOrgTreeInput'));

        function initOrgGridList() {
            jQuery("#_orgGridList").jqGrid({
                datatype : "local",//请求数据返回的类型。可选json,xml,txt
                /!*width:$('#_orgGridContainer').width()-2,
                height:$('#_orgGridContainer').height()-2,*!/
                colNames : [ 'ID', '名称', '类型', '全路径', '状态','排序号', '根目录ID', 'ID全路径', '父级组织ID'   ],//jqGrid的列显示名字
                colModel : [ //jqGrid每一列的配置信息。包括名字，索引，宽度,对齐方式.....
                    {name : 'id',index : 'id',width : 55,hidden:true},

                    {name : 'name',index : 'name',width : 90},
                    {name : 'type',index : 'type',width : 100},
                    {name : 'prefixName',index : 'prefixName',width : 80},
                    {name : 'status',index : 'status',width : 80},

                    {name : 'sort',index : 'sort',width : 80,hidden:true},
                    {name : 'rootId',index : 'rootId',width : 80,hidden:true},
                    {name : 'prefixId',index : 'prefixId',width : 80,hidden:true},
                    {name : 'parentId',index : 'parentId',width : 150,hidden:true}
                ],
                autoWidth:true,
                rowNum : 10,//一页显示多少条
                rowList : [ 10, 20, 30 ],//可供用户选择一页显示多少条
                sortname : 'id',//初始化的时候排序的字段
                sortorder : "desc",//排序方式,可选desc,asc
                ondblClickRow:function (rowid,iRow,iCol,e) {
                    //changeOrgGridSize();
                    $.xljUtils.confirm('blue','确定要删除改记录么？',function () {
                        $('#_orgGridList').jqGrid('delRowData',rowid);
                    },function () {

                    });
                    
                }
            });
        }
        initOrgGridList();

        /!**
         * 更改orggrid尺寸
         *
         *!/
        function changeOrgGridSize() {
            $('#_orgTreeContainer').css({
                height:'430px',
                overflow:'auto'
            });

            $('#_orgGridContainer').css({
                height:'430px',
                overflow:'hidden'
            });

            $('#_orgGridModal').on('shown.bs.modal',function () {
                $('#_orgGridModal').find('div.ui-jqgrid-view').css({'padding-top':'8px'});
                $('#_orgGridList').jqGrid().setGridHeight($('#_orgGridContainer').height()-40);
                $('#_orgGridList').jqGrid().setGridWidth($('#_orgGridContainer').width()-2);
            });

        }
        changeOrgGridSize();*/

        //var orgSelector = new OrgOrPersonSelector();
       /* var obj = $('.btn').orgOrPersonSelector({
            title:'aaaa'
        });*/
        /*var bodyLeft ;
        bodyLeft = obj._createBodyLeftContainer(bodyLeft)
        console.info(bodyLeft);*/

       /* $('#testBtn').xljSingleSelector({
            saveCallback:testCallback,
            selectorType:'person',
            treeUrl:'',
            treeParam:{}
        });*/

/*        $('#testBtn').xljMultipleSelector({
            selectorType:'role'
        });*/

    });

/*    function testCallback(data) {
        console.info(data);
    }*/
</script>
</html>
