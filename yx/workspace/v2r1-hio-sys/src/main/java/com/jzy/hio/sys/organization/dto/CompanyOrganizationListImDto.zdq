package com.jzy.hio.sys.organization.dto;

import java.util.ArrayList;
import java.util.List;

import com.jzy.hio.base.Base;
import com.jzy.hio.base.BaseConstants;
import com.jzy.hio.base.anno.TargetIM;

import lombok.Data;

/**
 * 用户的直属部门以及公司
 * 
 * @author wt.coffee
 * @date 2018年4月17日下午6:58:08
 */
@Data
@TargetIM
public class CompanyOrganizationListImDto {
	private String tendId;
	/**
	 * 是否是公司的外部联系人 1 是,0否(即正式员工)
	 */
	private String outerLinkman;
	/**
	 * 登录人在当前公司中是否被激活<br>
	 * 登录人可能是公司员工、也可能是外部联系人
	 */
	private String workStatus = "0";
	private String companyId;
	private String companyName;
	/**
	 * 当type是公司的时候 creatorId表示公司创建者的imID
	 */
	private String creatorImUserId;
	/**
	 * 当type是公司的时候 managerImUserId表示管理员角色的im userId
	 */
	private List<String> managerImUserId;
	/**
	 * 是否主企业--(组织机构列表中顶部显示)
	 */
	private String defaultFlag = "0";
	/**
	 * 加入企业的时间、用于排序
	 */
	private String joinTime;

	private List<Organization> organizationList;

	public CompanyOrganizationListImDto(String tendId, List<OrganizationDto> list) {
		this.tendId = tendId;
		this.organizationList = new ArrayList<>();
		if (list == null) {
			return;
		}
		for (OrganizationDto org : list) {
			Organization orgIm = new Organization();
			orgIm.setOrganizationId(org.getId());
			orgIm.setOrganizationName(org.getName());
			orgIm.setIsDefault(org.isDefault() ? "1" : "0");
			orgIm.setPositionName(org.getPositionName());
			// 只需要执行一次--设置公司名称
			if (companyId == null || companyName == null) {
				String prefixId = org.getPrefixId();
				String prefixName = org.getPrefixName();
				companyId = prefixId.substring(0, prefixId.indexOf("/") == -1 ? prefixId.length() : prefixId.indexOf("/"));
				companyName = prefixName.substring(0, prefixName.indexOf("/") == -1 ? prefixName.length() : prefixName.indexOf("/"));
			}
			// 处理bug hio-35
			// 如果该员工直接挂在公司下、则不需要把公司添加到部门列表中
			if (Base.isEquals(org.getType(), BaseConstants.MYSQL_ORGANIZATION_TYPE_COMPANY)) {
				continue;
			} else {
				organizationList.add(orgIm);
			}
		}
	}

	@Data
	public static class Organization {
		private String organizationId;
		private String organizationName;
		/**
		 * 1主部门 0兼职部门
		 */
		private String isDefault;
		private String positionName;
	}

	public String getTendId() {
		return tendId;
	}

	public void setTendId(String tendId) {
		this.tendId = tendId;
	}

	public String getCompanyId() {
		return companyId;
	}

	public void setCompanyId(String companyId) {
		this.companyId = companyId;
	}

	public String getCompanyName() {
		return companyName;
	}

	public void setCompanyName(String companyName) {
		this.companyName = companyName;
	}

	public List<Organization> getOrganizationList() {
		return organizationList;
	}

	public void setOrganizationList(List<Organization> organizationList) {
		this.organizationList = organizationList;
	}

	public String getDefaultFlag() {
		return defaultFlag;
	}

	public void setDefaultFlag(String defaultFlag) {
		this.defaultFlag = defaultFlag;
	}
}
