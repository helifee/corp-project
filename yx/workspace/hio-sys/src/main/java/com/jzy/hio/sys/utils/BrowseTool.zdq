package com.jzy.hio.sys.utils;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

import javax.servlet.http.HttpServletRequest;

public class BrowseTool {
	private final static String rE11="rv:11";
	private final static String IE11="msie 11.";
	private final static String IE10="msie 10.";
    private final static String IE9="msie 9.";
    private final static String IE8="msie 8.";
    private final static String IE7="msie 7.";
    private final static String IE6="msie 6.";
    private final static String MAXTHON="maxthon";
    private final static String QQ="qqbrowser";
    private final static String GREEN="greenbrowser";
    private final static String SE360="360se";
    private final static String FIREFOX="firefox";
    private final static String OPERA="opera";
    private final static String CHROME="chrome";
    private final static String SAFARI="safari";
    private final static String LBBROWSER="lbbrowser";
    private final static String UBrowser="ubrowser";
    private final static String bidubrowser="bidubrowser";
    private final static String metasr="metasr";
    private final static String OTHER="其它";
     
     
    /**
     * 判断浏览器类型
     * @param userAgent
     * @return
     */
    public static String checkBrowse(String userAgent){
    	if(regex(LBBROWSER,userAgent.toLowerCase()))return "猎豹";
    	if(regex(UBrowser,userAgent.toLowerCase()))return "UC";
    	if(regex(bidubrowser,userAgent.toLowerCase()))return "百度";
    	if(regex(metasr,userAgent.toLowerCase()))return "搜狗";
        if(regex(OPERA, userAgent.toLowerCase()))return OPERA;
        if(regex(FIREFOX, userAgent.toLowerCase()))return FIREFOX;
        if(regex(SE360, userAgent.toLowerCase()))return SE360;
        if(regex(GREEN,userAgent.toLowerCase()))return GREEN;
        if(regex(QQ,userAgent.toLowerCase()))return QQ;
        if(regex(MAXTHON, userAgent.toLowerCase()))return "遨游";
        if(regex(rE11,userAgent.toLowerCase()))return "ie 11";
        if(regex(IE11,userAgent.toLowerCase()))return "ie 11";
        if(regex(IE10,userAgent.toLowerCase()))return "ie 10";
        if(regex(IE9,userAgent.toLowerCase()))return "ie 9";
        if(regex(IE8,userAgent.toLowerCase()))return "ie 8";
        if(regex(IE7,userAgent.toLowerCase()))return "ie 7";
        if(regex(IE6,userAgent.toLowerCase()))return "ie 6";
        if(regex(CHROME, userAgent.toLowerCase()))return CHROME;
        if(regex(SAFARI, userAgent.toLowerCase()))return SAFARI;
        return OTHER;
    }
    public static boolean regex(String regex,String str){
        Pattern p =Pattern.compile(regex,Pattern.MULTILINE);
        Matcher m=p.matcher(str);
        return m.find();
    }
    
    /**
     * 取得客户端IP
     * @param request
     * @return
     */
	public static String getClientIP(HttpServletRequest request) {
		String ip = request.getHeader("x-forwarded-for");  
		if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {  
			ip = request.getHeader("HTTP_X_REAL_IP");  
		}  
		if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {  
			ip = request.getHeader("Proxy-Client-IP");  
		}  
		if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {  
			ip = request.getHeader("WL-Proxy-Client-IP");  
		}  
		if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {  
			ip = request.getHeader("HTTP_CLIENT_IP");  
		}  
		if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {  
			ip = request.getHeader("HTTP_X_FORWARDED_FOR");  
		}  
		if (ip == null || ip.length() == 0 || "unknown".equalsIgnoreCase(ip)) {  
			ip = request.getRemoteAddr();  
		}  
		return ip;  
	} 
	
	public static String getUserAgent(HttpServletRequest request) {
		return request.getHeader("User-Agent");
	}
     
}