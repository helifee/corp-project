package com.jzy.hio.oa.schedule.controller;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import com.jzy.hio.base.controller.BaseController;
import com.jzy.hio.base.utils.MessageResult;
import com.jzy.hio.base.utils.SecurityUserBeanInfo;
import com.jzy.hio.oa.schedule.entity.WorkSchedule;
import com.jzy.hio.oa.schedule.service.WorkScheduleService;
import com.jzy.tools.data.JacksonUtils;
import com.jzy.tools.login.LoginUtils;

/**
 * 任务表控制层
 *
 * @author admin
 */
@Controller
@RequestMapping("/workSchedule")
public class WorkScheduleController extends BaseController<WorkScheduleService> {

	@Autowired
	private WorkScheduleService workScheduleService;

	@RequestMapping(value = "/queryListByUser", method = { RequestMethod.POST }, consumes = "application/json")
	public @ResponseBody MessageResult queryListByUser(@RequestBody Map<String, Object> map) {
		SecurityUserBeanInfo securityUserBeanInfo = LoginUtils.getSecurityUserBeanInfo();
		map.put("taskOwnerId", securityUserBeanInfo.getSecurityUserDto().getId());
		return super.queryList(map);
	}

	/**
	 * 根据Id获取业务对象
	 *
	 * @param map
	 * @return 业务对象
	 */
	@RequestMapping(value = "/getScheduleByDate", method = { RequestMethod.POST }, consumes = "application/json")
	public @ResponseBody MessageResult getScheduleByDate(@RequestBody Map<String, Object> map) {
		MessageResult result = new MessageResult();
		try {
			SecurityUserBeanInfo securityUserBeanInfo = LoginUtils.getSecurityUserBeanInfo();
			Map<String, Object> paramMap = new HashMap<String, Object>();
			paramMap.putAll(map);
			paramMap.put("taskOwnerId", securityUserBeanInfo.getSecurityUserDto().getId());
			//
			List<WorkSchedule> list = workScheduleService.getScheduleByDate(paramMap);
			result.setResult(list, "获取对象成功!");
		} catch (Exception e) {
			// TODO Auto-generated catch block
			log.error("获取对象失败!" + e.getMessage());
			result.setError("获取对象失败!");
		}
		return result;
	}

	/**
	 * 根据Id获取业务对象
	 *
	 * @param
	 * @return 业务对象
	 */
	@RequestMapping(value = "/getScheduleDayListForMonth/{month}", method = { RequestMethod.GET }, consumes = "application/json")
	public @ResponseBody MessageResult getScheduleDaysForMonth(@PathVariable("month") String month, HttpServletRequest requert) {
		MessageResult result = new MessageResult();
		try {
			SecurityUserBeanInfo securityUserBeanInfo = LoginUtils.getSecurityUserBeanInfo();
			String userInfo = JacksonUtils.toJson(securityUserBeanInfo);
			String nowDate = requert.getParameter("_t");
			Map<String, String> map = new HashMap<String, String>();
			map.put("nowDate", nowDate);
			map.put("month", month);
			Map<Integer, Boolean> list = workScheduleService.getScheduleForMonth(map);
			result.setResult(list, "获取对象成功!");
		} catch (Exception e) {
			log.error("获取对象失败!" + e.getMessage());
			result.setError("获取对象成功!");
		}
		return result;
	}

}
