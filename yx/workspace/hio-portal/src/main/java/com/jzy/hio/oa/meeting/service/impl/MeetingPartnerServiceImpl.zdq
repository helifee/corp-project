package com.jzy.hio.oa.meeting.service.impl;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.jzy.hio.base.service.impl.BaseServiceImpl;
import com.jzy.hio.oa.meeting.dto.MeetingPartnerDto;
import com.jzy.hio.oa.meeting.dto.MeetingReplyDto;
import com.jzy.hio.oa.meeting.entity.MeetingPartner;
import com.jzy.hio.oa.meeting.mapper.MeetingPartnerDao;
import com.jzy.hio.oa.meeting.service.MeetingPartnerService;
import com.jzy.hio.oa.meeting.service.MeetingReplyService;

/**
 * @author admin
 * 
 * 
 */

@Service
public class MeetingPartnerServiceImpl extends  BaseServiceImpl<String,MeetingPartner> implements MeetingPartnerService{
	

	@Autowired
	private MeetingPartnerDao meetingPartnerDao;
	
	@Autowired
	private MeetingReplyService meetingReplyService;

	@Override
	public MeetingPartnerDto getUserInfoByMeetingId(String userInfo, Map map)
			throws Exception {
		MeetingPartnerDto meetingPartnerDto = new MeetingPartnerDto();
		MeetingPartner meetingPartner = meetingPartnerDao.queryMeetingPartnerByMeetingId(map);
		if(meetingPartner != null){
			BeanUtils.copyProperties(meetingPartner, meetingPartnerDto);
		}
		return meetingPartnerDto;
	}

	@Override
	public List<String> getUserIdentifiyByMeetingId(String userInfo, Map map)
			throws Exception {
		List<String> list = new ArrayList<String>();
		List<MeetingPartner> meetingPartnerList = meetingPartnerDao.getUserIdentifiyByMeetingId(map);
		if(meetingPartnerList.size() > 0){
			for (MeetingPartner meetingPartner : meetingPartnerList) {
				if(meetingPartner.getUserIdentifiy() != null && !"".equals(meetingPartner.getUserIdentifiy())){
					list.add(meetingPartner.getUserIdentifiy());
				}
			}
		}
		return list;
	}

	@Override
	public Map getUserIdentifiyAndIsJoinAndIsSummMeetingId(String userInfo, Map map) throws Exception {
		// TODO Auto-generated method stub
		Map<String,Object> mapResult = new HashMap<String,Object>();
		List<String> list = new ArrayList<String>();
		List<Map<String,Object>> meetingPartnerList = meetingPartnerDao.getUserIdentifiyAndIsJoinAndIsSummMeetingId(map);
		if(meetingPartnerList.size() > 0){
			for (Map<String,Object> mapUser : meetingPartnerList) {
				if(mapUser.get("userIdentifiy") != null && StringUtils.isNotBlank(mapUser.get("userIdentifiy").toString())){
					list.add(mapUser.get("userIdentifiy").toString());
				}
				if(mapUser.get("meetingSummaryId") != null && StringUtils.isNotBlank(mapUser.get("meetingSummaryId").toString())){
					if(!mapResult.containsKey(mapUser.get("meetingSummaryId").toString())){
						mapResult.put("meetingSummaryId", mapUser.get("meetingSummaryId").toString());
					}
				}
			}
		}
		mapResult.put("userIdentifiyList", list);
		MeetingReplyDto resultReploy = meetingReplyService.queryMeetingReployByNew(userInfo, map);
		mapResult.put("meetingReploy", resultReploy);
		return mapResult;
	}
	

}
