package com.jzy.hio.oa.portal.controller;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import com.jzy.hio.base.controller.BaseController;
import com.jzy.hio.base.utils.MessageResult;
import com.jzy.hio.base.utils.OpeLogInfo;
import com.jzy.hio.oa.portal.entity.PortalPage;
import com.jzy.hio.oa.portal.entity.PortalPagePermision;
import com.jzy.hio.oa.portal.service.PortalPagePermisionService;
import com.jzy.hio.oa.portal.service.PortalPageService;
import com.jzy.tools.data.JacksonUtils;

/**
 * 站点权限控制层
 *
 * @author admin
 */
@Controller
@RequestMapping("/portal/portalPagePermision")
public class PortalPagePermisionController extends BaseController<PortalPagePermisionService> {

	@Autowired
	private PortalPagePermisionService portalPagePermisionService;

	@Autowired
	private PortalPageService portalPageService;

	/**
	 * 批量保存门户权限信息
	 *
	 * @param positionMaps
	 *            门户权限map集合数组
	 * @return
	 */
	@RequestMapping(value = "/saveBatchForPortalPermission/{portalPageId}", method = RequestMethod.PUT, consumes = "application/json")
	@ResponseBody
	@OpeLogInfo(node = "门户授权", sysCode = "OA")
	public MessageResult saveBatchForPortalPermission(@PathVariable("portalPageId") String portalPageId, @RequestBody List<Map<String, Object>> positionMaps) {
		MessageResult result = new MessageResult();
		String portalName = "";
		if (positionMaps != null && positionMaps.size() > 0) {
			if (StringUtils.isNotBlank(portalPageId)) {
				PortalPage portalPage = portalPageService.getObjectById(portalPageId);
				portalName = portalPage.getPortalPageName();
			}
		}
		try {
			String mapJson = JacksonUtils.toJson(positionMaps);
			List<PortalPagePermision> list = JacksonUtils.fromJson(mapJson, ArrayList.class, PortalPagePermision.class);
			int saveResult = portalPagePermisionService.saveBatch(list, portalPageId);
			result.setResult(saveResult, "门户【" + portalName + "】”】授权成功：");

		} catch (Exception e) {
			log.error("保存对象失败!" + e.getMessage());
			result.setError("保存对象失败!");
		}
		return result;
	}

}
