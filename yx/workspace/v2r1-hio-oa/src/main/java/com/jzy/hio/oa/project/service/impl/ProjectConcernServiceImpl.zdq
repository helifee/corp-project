/**
 *
 */
package com.jzy.hio.oa.project.service.impl;

import com.jzy.hio.entity.ProjectConcern;
import com.jzy.hio.exception.HioMybatisQueryException;
import com.jzy.hio.exception.HioMybatisUpdateException;
import com.jzy.hio.oa.project.dto.ProjectConcernDto;
import com.jzy.hio.oa.project.mapper.ProjectConcernMapper;
import com.jzy.hio.oa.project.service.ProjectConcernService;
import com.jzy.hio.utils.LoginUser;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.jzy.hio.annotation.DataSource;
import com.jzy.hio.base.service.impl.BaseServiceImpl;
/**
 * 项目关注
 * @author yangning
 */
@Service("projectConcernService")
public class ProjectConcernServiceImpl extends BaseServiceImpl<ProjectConcern> implements ProjectConcernService {

	private static Logger logger = LoggerFactory.getLogger(ProjectConcernServiceImpl.class);
	@Autowired
	private ProjectConcernMapper projectConcernMapper;

	@Override
	public int changeProjectConcern(String projectId, LoginUser loginUser) throws HioMybatisUpdateException {

		int returnValue = 0;
		ProjectConcern projectConcern = new ProjectConcern();
		projectConcern.setProjectId(projectId);
		projectConcern.setConcernPersonId(loginUser.getUserId());

		int count = projectConcernMapper.queryProjectConcernByPersonIdAndProjectId(projectConcern);
		if (count == 0) {
			logger.info("***********************加关注********************" + projectConcern);
			returnValue = save(projectConcern);
		} else {
			logger.info("***********************取消关注********************" + projectConcern);
			returnValue = projectConcernMapper.changeProjectConcern(projectConcern);
		}

		return returnValue;
	}

	@Override
	public int queryProjectContentCount(ProjectConcernDto projectConcernDto) throws HioMybatisQueryException {
		return projectConcernMapper.queryProjectConcernByPersonIdAndProjectId(projectConcernDto);
	}
}
