package com.jzy.hio.platform.sentimentinfo.service;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.amqp.core.Message;
import org.springframework.amqp.rabbit.annotation.RabbitHandler;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import com.jzy.hio.base.Base;
import com.jzy.hio.entity.SentimentInfo;
import com.jzy.hio.entity.UserInfo;
import com.rabbitmq.client.Channel;

/**
 * 舆情投诉消费
 * @author 
 *
 */
@Component
public class SentimentInfoReceiver  extends Base{
	protected Logger logger = LoggerFactory.getLogger(this.getClass());
	
	@Autowired
	private SentimentInfoService sentimentInfoService;
	
	// chc edit 2018-04-19
	@RabbitListener(queues = "${queue.imSentimentInfoQueue}", containerFactory="rabbitListenerContainerFactory")
	@RabbitHandler
	public void process(Message message, Channel channel) {
		try {
			SentimentInfo sentimentInfo = json2obj(new String(message.getBody(),"utf-8"),SentimentInfo.class);
			sentimentInfoService.save(sentimentInfo);
			channel.basicAck(message.getMessageProperties().getDeliveryTag(), true);
		}catch(Exception e) {
			e.printStackTrace();
			logger.error("舆情投诉失败：{}" , e.getMessage());
		}
	}
}
