package com.jzy.hio.platform.login.mapper;

import org.apache.ibatis.annotations.Insert;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;
import org.apache.ibatis.annotations.Update;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Map;

@Component("userMapper")
//@Scope("prototype")
public interface UserMapper {
	@Select("SELECT * FROM `pt_sys_org_user` u WHERE u.`login_name`='admin' ")
    List<Map> queryUser(Map p);


    @Select("SELECT * FROM `im_user_info` u WHERE u.`mobile`=#{mobile} and u.`state`=#{state} ")
    Map<String,String> queryUserinfoByMobile(@Param("mobile") String mobile,@Param("state") Integer state);

    @Select("SELECT * FROM `im_tend_user` u WHERE u.`uid`=#{userid} ")
    Map<String,String> queryTendinfo(@Param("userid") String userid);



    @Update(" update im_user_info set password=#{password} where mobile=#{mobile} ")
    int  updatePassword(Map p);
    /**
     *
     * 数据源信息
     * @return
     */
    @Select("select t.id  as tendId ,d.code as tendCode,d.id  as databaseId, d.account as userName,d.password as password,d.url as url,d.driver_name as driverName from sys_tend_database d  left join sys_tend_user t on t.database_id=d.id\n" +
            "    where (d.url is not null and d.url !='') and   (d.password is not null and d.password !='') and  (d.account is not null and d.account !='') and  (d.driver_name is not null and d.driver_name !='')")
    public List<Map> getTendDataSourceVoList();


    /**
     *
     * 获取租户信息
     * @param map
     * @return
     */
    @Select("select t.id  as tendId ,d.code as tendCode,t.due_time dueTime,t.state status  from sys_tend_user t,sys_tend_database  d where t.database_id=d.id and t.delflag!=1 and t.state=1 and t.second_level_domain=#{domain,jdbcType=VARCHAR} and 1=1  limit 1")
    public Map<String,Object> queryTendDemainInfo(Map map);

    @Insert("INSERT INTO im_user_info(id,password,mobile,state,delflag,HuanXin_password,sex,create_date) VALUES(#{id}, #{password}, #{mobile}, #{state},#{delflag},#{hxPassword},#{sex},#{create_date})")
    int addImUser(Map user);
    
    /**
     * 用户注册时如果数据库已有禁用的账号，把该账号激活
     * @param p
     * @return
     */
    @Update(" update im_user_info set state=#{state},delflag=#{delflag},password=#{password},HuanXin_password=#{hxPassword} where id=#{id} ")
    int  updateImUser(Map p);

    @Select("SELECT * FROM  afs_test  ")
    List<Map> demo010();
    @Insert("insert into test values('1','1')")
    List<Map> demo011();

    @Select("SELECT * FROM  afs_test  ")
    List<Map> demo012();
    @Select("SELECT * FROM  test  ")
    List<Map> demo013();

    @Select("/*!mycat:dataNode = hio_tend014 */SELECT * FROM  afs_test  ")
    List<Map> demo014();
    @Select("/*!mycat:dataNode = hio_tend015 */SELECT * FROM  afs_test  ")
    List<Map> demo015();
}
