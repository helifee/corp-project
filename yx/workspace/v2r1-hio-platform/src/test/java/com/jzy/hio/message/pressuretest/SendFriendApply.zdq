package com.jzy.hio.message.pressuretest;/**
 * Created by wufei on 2018/7/6.
 */

import net.sf.json.JSONArray;
import net.sf.json.JSONObject;
import org.apache.http.Consts;
import org.apache.http.HttpEntity;
import org.apache.http.client.config.AuthSchemes;
import org.apache.http.client.config.CookieSpecs;
import org.apache.http.client.config.RequestConfig;
import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.client.protocol.HttpClientContext;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClientBuilder;
import org.apache.http.util.EntityUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.Arrays;

/**
 * 邀请好友
 * @author wufei
 * @create 2018-07-06 10:54
 **/
public class SendFriendApply {
    private static final Logger logger = LoggerFactory.getLogger(SendFriendApply.class);

    private static RequestConfig requestConfig = RequestConfig.custom().setConnectTimeout(120000).setSocketTimeout(60000).setConnectionRequestTimeout(60000)
            .setCookieSpec(CookieSpecs.STANDARD_STRICT).setExpectContinueEnabled(true).setTargetPreferredAuthSchemes(Arrays.asList(AuthSchemes.NTLM, AuthSchemes.DIGEST))
            .setProxyPreferredAuthSchemes(Arrays.asList(AuthSchemes.BASIC)).build();
    private static HttpClientContext context = HttpClientContext.create();
    CloseableHttpClient httpClient = HttpClientBuilder.create().setDefaultRequestConfig(requestConfig).build();
    HttpPost send = new HttpPost("http://59.110.146.137:9999/platform-app/platform/friendInfo/sendFriendApply");
    //Bearer b475c69a-bfd7-4664-90e7-e292031e4cf6
    public  void run(String token,String userMobile,String tendId) {
        try {
            //带授权token，json参数
            JSONObject jsonParam = new JSONObject();
            jsonParam.put("sendId",String.valueOf("6642ccc3b5264f4e93a607f4bcaefafb"));
            JSONArray jsonArray = new JSONArray();
            JSONObject jsonObject = new JSONObject();
            jsonObject.put("userMobile", userMobile);
            jsonObject.put("userId", "");
            jsonObject.put("userName", userMobile);

            jsonArray.add(jsonObject);
            System.out.println(jsonArray);
            jsonParam.element("users",jsonArray);

            jsonParam.put("type",2);
            jsonParam.put("tendId",tendId);
            jsonParam.put("deptId","1001");
            jsonParam.put("tendName","巨洲云++");

            StringEntity entity = new StringEntity(jsonParam.toString(), "utf-8");//解决中文乱码问题
            entity.setContentEncoding("UTF-8");
            entity.setContentType("application/json");
            send.setHeader("User-Agent", "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:50.0) Gecko/20100101 Firefox/50.0");
            send.setHeader("Authorization","Bearer "+token);
            send.setEntity(entity);

            CloseableHttpResponse response = httpClient.execute(send, context);
            HttpEntity httpEntity = response.getEntity();
            String body = "";
            if (httpEntity != null) {
                body = EntityUtils.toString(httpEntity, Consts.UTF_8);
                logger.info(body);
            }

        } catch (Exception e) {

        }
    }

    public static void main(String[] args) {
//        //带授权token，json参数
//        JSONObject jsonParam = new JSONObject();
//        jsonParam.put("sendId",String.valueOf("13000000001"));
//        JSONArray jsonArray = new JSONArray();
//        JSONObject jsonObject = new JSONObject();
//        jsonObject.put("userMobile", "16311111133");
//        jsonObject.put("userId", "");
//        jsonObject.put("userName", "1133");
//
//        jsonArray.add(jsonObject);
//        System.out.println(jsonArray);
//        jsonParam.element("users",jsonArray);
//
//        jsonParam.put("type",2);
//        jsonParam.put("tendId","hio_tend1");
//        jsonParam.put("tendName","巨洲云++");
//        jsonParam.put("deptId","1001");
//        System.out.println( jsonParam.toString());

        SendFriendApply sendFriendApply = new SendFriendApply();
        sendFriendApply.run("233939ac-7cc1-40aa-b78f-de5181c6e964","13000000001","hio_tend3");
    }
}
