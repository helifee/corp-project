package com.xpath.test;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.xpath.XPath;
import javax.xml.xpath.XPathConstants;
import javax.xml.xpath.XPathExpression;
import javax.xml.xpath.XPathFactory;

import org.w3c.dom.Document;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

public class XPathTest {

	public static void main(String[] args) throws Exception {

		//DOM
		DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
		documentBuilderFactory.setNamespaceAware(true);	// important
		DocumentBuilder domBuilder = documentBuilderFactory.newDocumentBuilder();
		Document document = domBuilder.parse("books.xml");
		
		//½âÎö
		XPathFactory xPathFactory = XPathFactory.newInstance();
		XPath xpath = xPathFactory.newXPath();
		xpath.setNamespaceContext(new PersonalNamespaceContext());
		
		String expr = "//pre:book[pre:author='Neal Stephenson']/pre:title/text()";
		XPathExpression expression = xpath.compile(expr);
		Object result = expression.evaluate(document, XPathConstants.NODESET);
		NodeList nodes = (NodeList) result;
		for(int i=0; i<nodes.getLength(); i++) {
			System.out.println(nodes.item(i).getNodeValue());
		}
		
//		Object count = xpath.compile("count(//book)").evaluate(document, XPathConstants.NUMBER);
//		System.out.println(count);
//		
//		Object flg = xpath.compile("count(//book[@author='Neal Stephenson']) > 10").evaluate(document, XPathConstants.BOOLEAN);
//		System.out.println(flg);
//		
//		Object node = xpath.compile("//book[author='Neal Stephenson']/title/text()").evaluate(document, XPathConstants.NODE);
//		System.out.println(((Node)node).getNodeValue());
	}

}
