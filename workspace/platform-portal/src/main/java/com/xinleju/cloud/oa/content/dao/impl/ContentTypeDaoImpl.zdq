package com.xinleju.cloud.oa.content.dao.impl;


import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.xinleju.cloud.oa.content.util.SqlStatementUtil;
import com.xinleju.platform.base.utils.Page;
import org.apache.ibatis.session.SqlSession;
import org.springframework.stereotype.Repository;

import com.xinleju.platform.base.dao.impl.BaseDaoImpl;
import com.xinleju.cloud.oa.content.dao.ContentTypeDao;
import com.xinleju.cloud.oa.content.dto.ContentChildTreeData;
import com.xinleju.cloud.oa.content.dto.ContentTypeTreeData;
import com.xinleju.cloud.oa.content.entity.ContentType;

/**
 * @author admin
 */

@Repository
public class ContentTypeDaoImpl extends BaseDaoImpl<String, ContentType> implements ContentTypeDao {

    private Class entityClass;  //实体类

    public ContentTypeDaoImpl() {
        super();
    }

    /**
     * 查询知识管理大类总数
     *
     * @return
     */
    public int getCountFolders() {
        //调用mybatis映射SQL语句，通过BaseDao获取Factory
        int countFloder = getSqlSession().selectOne("com.xinleju.cloud.oa.content.entity.ContentType.countFolders");
        //返回当前页数
        return countFloder;
    }

    @Override
    public List<ContentTypeTreeData> getContentTypeTree() {
        // TODO Auto-generated method stub
        List<ContentTypeTreeData> listTree = getSqlSession().selectList("com.xinleju.cloud.oa.content.entity.ContentType.queryContentTypeList");
        return listTree;
    }

    @Override
    public Map<String, Object> queryTotalFileSize(ContentType contentType) {
        //调用mybatis映射SQL语句，通过BaseDao获取Factory
        Map<String, Object> totalFileSize = getSqlSession().selectOne("com.xinleju.cloud.oa.content.entity.ContentType.queryTotalFileSize", contentType);
        //返回当前页数
        return totalFileSize;
    }

    @Override
    public List<Map<String, Object>> getContentTypePage(Map map) {
        // TODO Auto-generated method stub
        return getSqlSession().selectList("com.xinleju.cloud.oa.content.entity.ContentType.getContentTypePage", map);
    }

    @Override
    public Integer getContentTypeCount(Map map) {
        // TODO Auto-generated method stub
        return getSqlSession().selectOne("com.xinleju.cloud.oa.content.entity.ContentType.getContentTypeCount", map);
    }

    @Override
    public Page queryObjectsByPage(Map map) {
        map.put("delflag", false);
        Page page = new Page();
        page.setLimit((Integer) map.get("limit"));
        page.setStart((Integer) map.get("start"));

        //设置总条数查询条件
        Map countMap = new HashMap(map.size());
        countMap.putAll(map);

        //查询数据
        SqlSession sqlSession = this.getSqlSession();
        String pageSqlStatment = SqlStatementUtil.getPageSqlStatment(map, ContentType.class);
        List<ContentType> list = sqlSession.selectList(ContentType.class.getName() + ".queryObjectsByPage", pageSqlStatment);
        page.setList(list);

        //查询总数
        String pageCountSqlStatment = SqlStatementUtil.getPageCountSqlStatment(countMap, ContentType.class);
        Integer count = sqlSession.selectOne(ContentType.class.getName() + ".queryObjectsCountByPage", pageCountSqlStatment);
        page.setTotal(count);
        return page;
    }

}
