var path;$(function(){var curWwwPath=window.document.location.href;var pathName=window.document.location.pathname;var pos=curWwwPath.indexOf(pathName);var localhostPaht=curWwwPath.substring(0,pos);var projectName=pathName.substring(0,pathName.substr(1).indexOf("/")+1);path=localhostPaht+projectName});mui.init();var startPosition1=0;var startPosition2=0;var startPosition3=0;var startPosition4=0;var count1=0;var count2=0;var count3=0;var count4=0;$(function(){changeMenu();getToDoData(startPosition1,false,0);getToDoData(startPosition2,false,1);getToDoData(startPosition3,false,2);getToDoData(startPosition4,false,3);queryAndShowToDoSum()});$.getUrlParam=function(C){var B=new RegExp("(^|&)"+C+"=([^&]*)(&|$)");var A=decodeURI(window.location.search).substr(1).match(B);if(A!=null){return unescape(A[2])}return null};function changeMenu(){var A=$.getUrlParam("menu");if(A){mui("#slider").slider().gotoItem(A)}}function queryAndShowToDoSum(){var queryUrlText="/platform-app/flow/sysNoticeMsg/queryTwoSumData";$.ajax({type:"POST",url:queryUrlText,data:JSON.stringify({}),contentType:"application/json",dataType:"JSON",success:function(returnData){if(returnData.success){var itemData=returnData.result[0];if(itemData&&itemData.toDoSum){$("#toDoSum").text(itemData.toDoSum);$("#toDoSum").show()}else{$("#toDoSum").text("");$("#toDoSum").hide()}}else{$("#toDoSum").text("");$("#toDoSum").hide()}}})}function getToDoData(startPosition,isClearUl,index){var queryUrlText;var paramData={start:startPosition,limit:25};queryUrlText="/platform-app/mobile/approve/pageQueryByParamMap";if(index==0){paramData.dataType="TO_DO"}else{if(index==1){paramData.dataType="TO_READ"}else{if(index==2){paramData.dataType="HAVE_DONE"}else{if(index==3){paramData.dataType="MY_START"}}}}var str;$.ajax({type:"POST",url:queryUrlText,data:JSON.stringify(paramData),contentType:"application/json",dataType:"JSON",success:function(msg){var result=msg.result;var dataList=result.list;if(dataList&&dataList.length>0){var ul;if(index==0){ul=$("#tab_1");count1=result.total}else{if(index==1){ul=$("#tab_2");count2=result.total}else{if(index==2){ul=$("#tab_3");count3=result.total}else{if(index==3){ul=$("#tab_4");count4=result.total}}}}if(isClearUl){ul.empty()}ul.append(showListFragment(dataList,index))}}})}var showListFragment=function(dataList,index){var fragment=document.createDocumentFragment();var li;for(var idx=0;idx<dataList.length;idx++){var dataItem=dataList[idx];var remainTimeMillis;var dealTime;var intHours;var remainTimeStr;var sendDate=dataItem.sendDate;if(sendDate){var str=sendDate.replace(/-/g,"/");var date=new Date(str);dealTime=date.getTime()}remainTimeMillis=new Date().getTime()-dealTime;if(remainTimeMillis>0){intHours=remainTimeMillis/(1000*60*60);intHours=intHours|0}if(intHours>0){remainTimeStr="停留"+intHours+"小时"}li=$("<li></li>");li.addClass("mui-table-view-cell");li.attr("id",dataItem.id+"_"+index);li.attr("data-urlText",dataItem.mobibleUrl);var str;if(index==0||index==1){str="<h4 class='mui-ellipsis-2' style='word-break: break-all;word-wrap: break-word;font-weight: normal'>"+dataItem.title+"</h4>";if(remainTimeStr!=undefined){str+="<h5><i class='mui-icon iconfont icon-shijian'></i>"+remainTimeStr+"</h5>"}}else{str="<h4 class='mui-ellipsis-2' style='word-break: break-all;word-wrap: break-word;font-weight: normal'>"+dataItem.title+"</h4>"}$(li).html(str);$(fragment).append(li)}return fragment};mui(".mui-table-view").on("tap",".mui-table-view-cell",function(){var idText=$(this).attr("id");var urlText=$(this).attr("data-urlText");var params=idText.split("_");setTimeout(function(){if(urlText&&urlText.indexOf("?msgId=")<1){urlText=urlText+"?msgId="+params[0]+"&users=[]&isback=N&opCode=NA&tabIdx="+params[1]}if(urlText&&urlText.indexOf("http")==0){window.location.href=urlText}else{window.location.href=path+"/"+urlText}},1000)});(function($){var deceleration=mui.os.ios?0.003:0.0009;$(".mui-scroll-wrapper").scroll({bounce:false,indicators:true,deceleration:deceleration});$.ready(function(){$.each(document.querySelectorAll(".mui-slider-group .mui-scroll"),function(index,pullRefreshEl){$(pullRefreshEl).pullToRefresh({down:{callback:function(){if(index==0){startPosition1=0}else{if(index==1){startPosition2=0}else{if(index==2){startPosition3=0}else{if(index==3){startPosition4=0}}}}var self=this;self.refresh(true);setTimeout(function(){if(index==0){getToDoData(startPosition1,true,index)}else{if(index==1){getToDoData(startPosition2,true,index)}else{if(index==2){getToDoData(startPosition3,true,index)}else{if(index==3){getToDoData(startPosition4,true,index)}}}}self.endPullDownToRefresh()},1000)}},up:{callback:function(){var self=this;if(index==0){startPosition1+=25;if(startPosition1>count1){self.endPullUpToRefresh(true);return}}else{if(index==1){startPosition2+=25;if(startPosition2>count2){self.endPullUpToRefresh(true);return}}else{if(index==2){startPosition3+=25;if(startPosition3>count3){self.endPullUpToRefresh(true);return}}else{if(index==3){startPosition4+=25;if(startPosition4>count4){self.endPullUpToRefresh(true);return}}}}}setTimeout(function(){if(index==0){getToDoData(startPosition1,false,index)}else{if(index==1){getToDoData(startPosition2,false,index)}else{if(index==2){getToDoData(startPosition3,false,index)}else{if(index==3){getToDoData(startPosition4,false,index)
}}}}self.endPullUpToRefresh(false)},1000)}}})})})})(mui);document.addEventListener("WeixinJSBridgeReady",function onBridgeReady(){WeixinJSBridge.call("hideOptionMenu");WeixinJSBridge.call("hideToolbar")});