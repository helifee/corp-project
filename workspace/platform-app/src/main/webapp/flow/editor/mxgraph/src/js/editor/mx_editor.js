function mxDefaultKeyHandler(B){if(B!=null){this.editor=B;this.handler=new mxKeyHandler(B.graph);var A=this.handler.escape;this.handler.escape=function(C){A.apply(this,arguments);B.hideProperties();B.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",C))}}}mxDefaultKeyHandler.prototype.editor=null;mxDefaultKeyHandler.prototype.handler=null;mxDefaultKeyHandler.prototype.bindAction=function(C,A,D){var B=mxUtils.bind(this,function(){this.editor.execute(A)});if(D){this.handler.bindControlKey(C,B)}else{this.handler.bindKey(C,B)}};mxDefaultKeyHandler.prototype.destroy=function(){this.handler.destroy();this.handler=null};function mxDefaultPopupMenu(A){this.config=A}mxDefaultPopupMenu.prototype.imageBasePath=null;mxDefaultPopupMenu.prototype.config=null;mxDefaultPopupMenu.prototype.createMenu=function(E,F,C,A){if(this.config!=null){var D=this.createConditions(E,C,A);var B=this.config.firstChild;this.addItems(E,F,C,A,D,B,null)}};mxDefaultPopupMenu.prototype.addItems=function(editor,menu,cell,evt,conditions,item,parent){var addSeparator=false;while(item!=null){if(item.nodeName=="add"){var condition=item.getAttribute("if");if(condition==null||conditions[condition]){var as=item.getAttribute("as");as=mxResources.get(as)||as;var funct=mxUtils.eval(mxUtils.getTextContent(item));var action=item.getAttribute("action");var icon=item.getAttribute("icon");var iconCls=item.getAttribute("iconCls");var enabledCond=item.getAttribute("enabled-if");var enabled=enabledCond==null||conditions[enabledCond];if(addSeparator){menu.addSeparator(parent);addSeparator=false}if(icon!=null&&this.imageBasePath){icon=this.imageBasePath+icon}var row=this.addAction(menu,editor,as,icon,funct,action,cell,parent,iconCls,enabled);this.addItems(editor,menu,cell,evt,conditions,item.firstChild,row)}}else{if(item.nodeName=="separator"){addSeparator=true}}item=item.nextSibling}};mxDefaultPopupMenu.prototype.addAction=function(F,A,H,E,J,I,K,C,G,B){var D=function(L){if(typeof(J)=="function"){J.call(A,A,K,L)}if(I!=null){A.execute(I,K,L)}};return F.addItem(H,E,D,C,G,B)};mxDefaultPopupMenu.prototype.createConditions=function(editor,cell,evt){var model=editor.graph.getModel();var childCount=model.getChildCount(cell);var conditions=[];conditions["nocell"]=cell==null;conditions["ncells"]=editor.graph.getSelectionCount()>1;conditions["notRoot"]=model.getRoot()!=model.getParent(editor.graph.getDefaultParent());conditions["cell"]=cell!=null;var isCell=cell!=null&&editor.graph.getSelectionCount()==1;conditions["nonEmpty"]=isCell&&childCount>0;conditions["expandable"]=isCell&&editor.graph.isCellFoldable(cell,false);conditions["collapsable"]=isCell&&editor.graph.isCellFoldable(cell,true);conditions["validRoot"]=isCell&&editor.graph.isValidRoot(cell);conditions["emptyValidRoot"]=conditions["validRoot"]&&childCount==0;conditions["swimlane"]=isCell&&editor.graph.isSwimlane(cell);var condNodes=this.config.getElementsByTagName("condition");for(var i=0;i<condNodes.length;i++){var funct=mxUtils.eval(mxUtils.getTextContent(condNodes[i]));var name=condNodes[i].getAttribute("name");if(name!=null&&typeof(funct)=="function"){conditions[name]=funct(editor,cell,evt)}}return conditions};function mxDefaultToolbar(A,B){this.editor=B;if(A!=null&&B!=null){this.init(A)}}mxDefaultToolbar.prototype.editor=null;mxDefaultToolbar.prototype.toolbar=null;mxDefaultToolbar.prototype.resetHandler=null;mxDefaultToolbar.prototype.spacing=4;mxDefaultToolbar.prototype.connectOnDrop=false;mxDefaultToolbar.prototype.init=function(A){if(A!=null){this.toolbar=new mxToolbar(A);this.toolbar.addListener(mxEvent.SELECT,mxUtils.bind(this,function(B,C){var D=C.getProperty("function");if(D!=null){this.editor.insertFunction=mxUtils.bind(this,function(){D.apply(this,arguments);this.toolbar.resetMode()})}else{this.editor.insertFunction=null}}));this.resetHandler=mxUtils.bind(this,function(){if(this.toolbar!=null){this.toolbar.resetMode(true)}});this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler);this.editor.addListener(mxEvent.ESCAPE,this.resetHandler)}};mxDefaultToolbar.prototype.addItem=function(C,D,A,B){var E=mxUtils.bind(this,function(){if(A!=null&&A.length>0){this.editor.execute(A)}});return this.toolbar.addItem(C,D,E,B)};mxDefaultToolbar.prototype.addSeparator=function(A){A=A||mxClient.imageBasePath+"/separator.gif";this.toolbar.addSeparator(A)};mxDefaultToolbar.prototype.addCombo=function(){return this.toolbar.addCombo()};mxDefaultToolbar.prototype.addActionCombo=function(A){return this.toolbar.addActionCombo(A)};mxDefaultToolbar.prototype.addActionOption=function(D,B,A){var C=mxUtils.bind(this,function(){this.editor.execute(A)});this.addOption(D,B,C)};mxDefaultToolbar.prototype.addOption=function(C,A,B){return this.toolbar.addOption(C,A,B)};mxDefaultToolbar.prototype.addMode=function(D,E,B,A,C){var F=mxUtils.bind(this,function(){this.editor.setMode(B);if(C!=null){C(this.editor)}});return this.toolbar.addSwitchMode(D,E,F,A)};mxDefaultToolbar.prototype.addPrototype=function(H,F,E,I,G,C){var D=mxUtils.bind(this,function(){if(typeof(E)=="function"){return E()}else{if(E!=null){return this.editor.graph.cloneCells([E])[0]}}return null});var A=mxUtils.bind(this,function(K,L){if(typeof(G)=="function"){G(this.editor,D(),K,L)}else{this.drop(D(),K,L)}this.toolbar.resetMode();mxEvent.consume(K)});var B=this.toolbar.addMode(H,F,A,I,null,C);var J=function(K,M,L){A(M,L)};this.installDropHandler(B,J);return B};mxDefaultToolbar.prototype.drop=function(A,D,C){var B=this.editor.graph;var E=B.getModel();if(C==null||E.isEdge(C)||!this.connectOnDrop||!B.isCellConnectable(C)){while(C!=null&&!B.isValidDropTarget(C,[A],D)){C=E.getParent(C)}this.insert(A,D,C)}else{this.connect(A,D,C)}};mxDefaultToolbar.prototype.insert=function(B,E,D){var C=this.editor.graph;if(C.canImportCell(B)){var F=mxEvent.getClientX(E);var G=mxEvent.getClientY(E);var A=mxUtils.convertPoint(C.container,F,G);if(C.isSplitEnabled()&&C.isSplitTarget(D,[B],E)){return C.splitEdge(D,[B],null,A.x,A.y)}else{return this.editor.addVertex(D,B,A.x,A.y)}}return null};mxDefaultToolbar.prototype.connect=function(G,B,H){var C=this.editor.graph;var K=C.getModel();if(H!=null&&C.isCellConnectable(G)&&C.isEdgeValid(null,H,G)){var F=null;K.beginUpdate();try{var J=K.getGeometry(H);var D=K.getGeometry(G).clone();D.x=J.x+(J.width-D.width)/2;D.y=J.y+(J.height-D.height)/2;var E=this.spacing*C.gridSize;var I=K.getDirectedEdgeCount(H,true)*20;if(this.editor.horizontalFlow){D.x+=(D.width+J.width)/2+E+I}else{D.y+=(D.height+J.height)/2+E+I}G.setGeometry(D);var L=K.getParent(H);C.addCell(G,L);C.constrainChild(G);F=this.editor.createEdge(H,G);if(K.getGeometry(F)==null){var A=new mxGeometry();A.relative=true;K.setGeometry(F,A)}C.addEdge(F,L,H,G)}finally{K.endUpdate()}C.setSelectionCells([G,F]);C.scrollCellToVisible(G)}};mxDefaultToolbar.prototype.installDropHandler=function(D,B){var A=document.createElement("img");A.setAttribute("src",D.getAttribute("src"));var C=mxUtils.bind(this,function(E){A.style.width=(2*D.offsetWidth)+"px";A.style.height=(2*D.offsetHeight)+"px";mxUtils.makeDraggable(D,this.editor.graph,B,A);mxEvent.removeListener(A,"load",C)});if(mxClient.IS_IE){C()}else{mxEvent.addListener(A,"load",C)}};mxDefaultToolbar.prototype.destroy=function(){if(this.resetHandler!=null){this.editor.graph.removeListener("dblclick",this.resetHandler);this.editor.removeListener("escape",this.resetHandler);this.resetHandler=null}if(this.toolbar!=null){this.toolbar.destroy();this.toolbar=null}};function mxEditor(A){this.actions=[];this.addActions();if(document.body!=null){this.cycleAttributeValues=[];this.popupHandler=new mxDefaultPopupMenu();this.undoManager=new mxUndoManager();this.graph=this.createGraph();this.toolbar=this.createToolbar();this.keyHandler=new mxDefaultKeyHandler(this);this.configure(A);this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName;if(this.onInit!=null){this.onInit()}if(mxClient.IS_IE){mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}}}if(mxLoadResources){mxResources.add(mxClient.basePath+"/resources/editor")}mxEditor.prototype=new mxEventSource();mxEditor.prototype.constructor=mxEditor;mxEditor.prototype.askZoomResource=(mxClient.language!="none")?"askZoom":"";mxEditor.prototype.lastSavedResource=(mxClient.language!="none")?"lastSaved":"";mxEditor.prototype.currentFileResource=(mxClient.language!="none")?"currentFile":"";mxEditor.prototype.propertiesResource=(mxClient.language!="none")?"properties":"";mxEditor.prototype.tasksResource=(mxClient.language!="none")?"tasks":"";mxEditor.prototype.helpResource=(mxClient.language!="none")?"help":"";mxEditor.prototype.outlineResource=(mxClient.language!="none")?"outline":"";mxEditor.prototype.outline=null;mxEditor.prototype.graph=null;mxEditor.prototype.graphRenderHint=null;mxEditor.prototype.toolbar=null;mxEditor.prototype.status=null;mxEditor.prototype.popupHandler=null;mxEditor.prototype.undoManager=null;mxEditor.prototype.keyHandler=null;mxEditor.prototype.actions=null;mxEditor.prototype.dblClickAction="edit";mxEditor.prototype.swimlaneRequired=false;mxEditor.prototype.disableContextMenu=true;mxEditor.prototype.insertFunction=null;mxEditor.prototype.forcedInserting=false;mxEditor.prototype.templates=null;mxEditor.prototype.defaultEdge=null;mxEditor.prototype.defaultEdgeStyle=null;mxEditor.prototype.defaultGroup=null;mxEditor.prototype.groupBorderSize=null;mxEditor.prototype.filename=null;mxEditor.prototype.linefeed="&#xa;";mxEditor.prototype.postParameterName="xml";mxEditor.prototype.escapePostData=true;mxEditor.prototype.urlPost=null;mxEditor.prototype.urlImage=null;mxEditor.prototype.horizontalFlow=false;mxEditor.prototype.layoutDiagram=false;mxEditor.prototype.swimlaneSpacing=0;mxEditor.prototype.maintainSwimlanes=false;mxEditor.prototype.layoutSwimlanes=false;mxEditor.prototype.cycleAttributeValues=null;mxEditor.prototype.cycleAttributeIndex=0;mxEditor.prototype.cycleAttributeName="fillColor";mxEditor.prototype.tasks=null;mxEditor.prototype.tasksWindowImage=null;mxEditor.prototype.tasksTop=20;mxEditor.prototype.help=null;mxEditor.prototype.helpWindowImage=null;mxEditor.prototype.urlHelp=null;mxEditor.prototype.helpWidth=300;mxEditor.prototype.helpHeight=260;mxEditor.prototype.propertiesWidth=240;mxEditor.prototype.propertiesHeight=null;mxEditor.prototype.movePropertiesDialog=false;mxEditor.prototype.validating=false;mxEditor.prototype.modified=false;mxEditor.prototype.isModified=function(){return this.modified};mxEditor.prototype.setModified=function(A){this.modified=A};mxEditor.prototype.addActions=function(){this.addAction("save",function(A){A.save()});this.addAction("print",function(B){var A=new mxPrintPreview(B.graph,1);A.open()});this.addAction("show",function(A){mxUtils.show(A.graph,null,10,10)});this.addAction("exportImage",function(D){var A=D.getUrlImage();if(A==null||mxClient.IS_LOCAL){D.execute("show")}else{var B=mxUtils.getViewXml(D.graph,1);var C=mxUtils.getXml(B,"\n");mxUtils.submit(A,D.postParameterName+"="+encodeURIComponent(C),document,"_blank")}});this.addAction("refresh",function(A){A.graph.refresh()});this.addAction("cut",function(A){if(A.graph.isEnabled()){mxClipboard.cut(A.graph)}});this.addAction("copy",function(A){if(A.graph.isEnabled()){mxClipboard.copy(A.graph)}});this.addAction("paste",function(A){if(A.graph.isEnabled()){mxClipboard.paste(A.graph)}});this.addAction("delete",function(A){if(A.graph.isEnabled()){A.graph.removeCells()}});this.addAction("group",function(A){if(A.graph.isEnabled()){A.graph.setSelectionCell(A.groupCells())}});this.addAction("ungroup",function(A){if(A.graph.isEnabled()){A.graph.setSelectionCells(A.graph.ungroupCells())}});this.addAction("removeFromParent",function(A){if(A.graph.isEnabled()){A.graph.removeCellsFromParent()}});this.addAction("undo",function(A){if(A.graph.isEnabled()){A.undo()}});this.addAction("redo",function(A){if(A.graph.isEnabled()){A.redo()}});this.addAction("zoomIn",function(A){A.graph.zoomIn()});this.addAction("zoomOut",function(A){A.graph.zoomOut()});this.addAction("actualSize",function(A){A.graph.zoomActual()});this.addAction("fit",function(A){A.graph.fit()});this.addAction("showProperties",function(B,A){B.showProperties(A)});this.addAction("selectAll",function(A){if(A.graph.isEnabled()){A.graph.selectAll()}});this.addAction("selectNone",function(A){if(A.graph.isEnabled()){A.graph.clearSelection()}});this.addAction("selectVertices",function(A){if(A.graph.isEnabled()){A.graph.selectVertices()}});this.addAction("selectEdges",function(A){if(A.graph.isEnabled()){A.graph.selectEdges()}});this.addAction("edit",function(B,A){if(B.graph.isEnabled()&&B.graph.isCellEditable(A)){B.graph.startEditingAtCell(A)}});this.addAction("toBack",function(B,A){if(B.graph.isEnabled()){B.graph.orderCells(true)}});this.addAction("toFront",function(B,A){if(B.graph.isEnabled()){B.graph.orderCells(false)}});this.addAction("enterGroup",function(B,A){B.graph.enterGroup(A)});this.addAction("exitGroup",function(A){A.graph.exitGroup()});this.addAction("home",function(A){A.graph.home()});this.addAction("selectPrevious",function(A){if(A.graph.isEnabled()){A.graph.selectPreviousCell()}});this.addAction("selectNext",function(A){if(A.graph.isEnabled()){A.graph.selectNextCell()}});this.addAction("selectParent",function(A){if(A.graph.isEnabled()){A.graph.selectParentCell()}});this.addAction("selectChild",function(A){if(A.graph.isEnabled()){A.graph.selectChildCell()}});this.addAction("collapse",function(A){if(A.graph.isEnabled()){A.graph.foldCells(true)}});this.addAction("collapseAll",function(B){if(B.graph.isEnabled()){var A=B.graph.getChildVertices();B.graph.foldCells(true,false,A)}});this.addAction("expand",function(A){if(A.graph.isEnabled()){A.graph.foldCells(false)}});this.addAction("expandAll",function(B){if(B.graph.isEnabled()){var A=B.graph.getChildVertices();B.graph.foldCells(false,false,A)}});this.addAction("bold",function(A){if(A.graph.isEnabled()){A.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD)}});this.addAction("italic",function(A){if(A.graph.isEnabled()){A.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC)}});this.addAction("underline",function(A){if(A.graph.isEnabled()){A.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE)}});this.addAction("alignCellsLeft",function(A){if(A.graph.isEnabled()){A.graph.alignCells(mxConstants.ALIGN_LEFT)}});this.addAction("alignCellsCenter",function(A){if(A.graph.isEnabled()){A.graph.alignCells(mxConstants.ALIGN_CENTER)}});this.addAction("alignCellsRight",function(A){if(A.graph.isEnabled()){A.graph.alignCells(mxConstants.ALIGN_RIGHT)}});this.addAction("alignCellsTop",function(A){if(A.graph.isEnabled()){A.graph.alignCells(mxConstants.ALIGN_TOP)}});this.addAction("alignCellsMiddle",function(A){if(A.graph.isEnabled()){A.graph.alignCells(mxConstants.ALIGN_MIDDLE)}});this.addAction("alignCellsBottom",function(A){if(A.graph.isEnabled()){A.graph.alignCells(mxConstants.ALIGN_BOTTOM)}});this.addAction("alignFontLeft",function(A){A.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT)});this.addAction("alignFontCenter",function(A){if(A.graph.isEnabled()){A.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER)}});this.addAction("alignFontRight",function(A){if(A.graph.isEnabled()){A.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT)}});this.addAction("alignFontTop",function(A){if(A.graph.isEnabled()){A.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_TOP)}});this.addAction("alignFontMiddle",function(A){if(A.graph.isEnabled()){A.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)}});this.addAction("alignFontBottom",function(A){if(A.graph.isEnabled()){A.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_BOTTOM)}});this.addAction("zoom",function(C){var B=C.graph.getView().scale*100;var A=parseFloat(mxUtils.prompt(mxResources.get(C.askZoomResource)||C.askZoomResource,B))/100;if(!isNaN(A)){C.graph.getView().setScale(A)}});this.addAction("toggleTasks",function(A){if(A.tasks!=null){A.tasks.setVisible(!A.tasks.isVisible())}else{A.showTasks()}});this.addAction("toggleHelp",function(A){if(A.help!=null){A.help.setVisible(!A.help.isVisible())}else{A.showHelp()}});this.addAction("toggleOutline",function(A){if(A.outline==null){A.showOutline()}else{A.outline.setVisible(!A.outline.isVisible())}});this.addAction("toggleConsole",function(A){mxLog.setVisible(!mxLog.isVisible())})};mxEditor.prototype.configure=function(B){if(B!=null){var A=new mxCodec(B.ownerDocument);A.decode(B,this);this.resetHistory()}};mxEditor.prototype.resetFirstTime=function(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"};mxEditor.prototype.resetHistory=function(){this.lastSnapshot=new Date().getTime();this.undoManager.clear();this.ignoredChanges=0;this.setModified(false)};mxEditor.prototype.addAction=function(A,B){this.actions[A]=B};mxEditor.prototype.execute=function(D,E,C){var A=this.actions[D];if(A!=null){try{var F=arguments;F[0]=this;A.apply(this,F)}catch(B){mxUtils.error("Cannot execute "+D+": "+B.message,280,true);throw B}}else{mxUtils.error("Cannot find action "+D,280,true)}};mxEditor.prototype.addTemplate=function(A,B){this.templates[A]=B};mxEditor.prototype.getTemplate=function(A){return this.templates[A]};mxEditor.prototype.createGraph=function(){var A=new mxGraph(null,null,this.graphRenderHint);A.setTooltips(true);A.setPanning(true);this.installDblClickHandler(A);this.installUndoHandler(A);this.installDrillHandler(A);this.installChangeHandler(A);this.installInsertHandler(A);A.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(D,C,B){return this.createPopupMenu(D,C,B)});A.connectionHandler.factoryMethod=mxUtils.bind(this,function(B,C){return this.createEdge(B,C)});this.createSwimlaneManager(A);this.createLayoutManager(A);return A};mxEditor.prototype.createSwimlaneManager=function(A){var B=new mxSwimlaneManager(A,false);B.isHorizontal=mxUtils.bind(this,function(){return this.horizontalFlow});B.isEnabled=mxUtils.bind(this,function(){return this.maintainSwimlanes});return B};mxEditor.prototype.createLayoutManager=function(B){var C=new mxLayoutManager(B);var A=this;C.getLayout=function(E){var D=null;var F=A.graph.getModel();if(F.getParent(E)!=null){if(A.layoutSwimlanes&&B.isSwimlane(E)){if(A.swimlaneLayout==null){A.swimlaneLayout=A.createSwimlaneLayout()}D=A.swimlaneLayout}else{if(A.layoutDiagram&&(B.isValidRoot(E)||F.getParent(F.getParent(E))==null)){if(A.diagramLayout==null){A.diagramLayout=A.createDiagramLayout()}D=A.diagramLayout}}}return D};return C};mxEditor.prototype.setGraphContainer=function(A){if(this.graph.container==null){this.graph.init(A);this.rubberband=new mxRubberband(this.graph);if(this.disableContextMenu){mxEvent.disableContextMenu(A)}if(mxClient.IS_QUIRKS){new mxDivResizer(A)}}};mxEditor.prototype.installDblClickHandler=function(A){A.addListener(mxEvent.DOUBLE_CLICK,mxUtils.bind(this,function(B,C){var D=C.getProperty("cell");if(D!=null&&A.isEnabled()&&this.dblClickAction!=null){this.execute(this.dblClickAction,D);C.consume()}}))};mxEditor.prototype.installUndoHandler=function(B){var C=mxUtils.bind(this,function(D,E){var F=E.getProperty("edit");this.undoManager.undoableEditHappened(F)});B.getModel().addListener(mxEvent.UNDO,C);B.getView().addListener(mxEvent.UNDO,C);var A=function(D,E){var F=E.getProperty("edit").changes;B.setSelectionCells(B.getSelectionCellsForChanges(F))};this.undoManager.addListener(mxEvent.UNDO,A);this.undoManager.addListener(mxEvent.REDO,A)};mxEditor.prototype.installDrillHandler=function(A){var B=mxUtils.bind(this,function(C){this.fireEvent(new mxEventObject(mxEvent.ROOT))});A.getView().addListener(mxEvent.DOWN,B);A.getView().addListener(mxEvent.UP,B)};mxEditor.prototype.installChangeHandler=function(A){var B=mxUtils.bind(this,function(E,F){this.setModified(true);if(this.validating==true){A.validateGraph()}var G=F.getProperty("edit").changes;for(var D=0;D<G.length;D++){var C=G[D];if(C instanceof mxRootChange||(C instanceof mxValueChange&&C.cell==this.graph.model.root)||(C instanceof mxCellAttributeChange&&C.cell==this.graph.model.root)){this.fireEvent(new mxEventObject(mxEvent.ROOT));break}}});A.getModel().addListener(mxEvent.CHANGE,B)};mxEditor.prototype.installInsertHandler=function(B){var A=this;var C={mouseDown:function(D,E){if(A.insertFunction!=null&&!E.isPopupTrigger()&&(A.forcedInserting||E.getState()==null)){A.graph.clearSelection();A.insertFunction(E.getEvent(),E.getCell());this.isActive=true;E.consume()}},mouseMove:function(D,E){if(this.isActive){E.consume()}},mouseUp:function(D,E){if(this.isActive){this.isActive=false;E.consume()}}};B.addMouseListener(C)};mxEditor.prototype.createDiagramLayout=function(){var B=this.graph.gridSize;var A=new mxStackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*B,2*B);A.isVertexIgnored=function(C){return !A.graph.isSwimlane(C)};return A};mxEditor.prototype.createSwimlaneLayout=function(){return new mxCompactTreeLayout(this.graph,this.horizontalFlow)};mxEditor.prototype.createToolbar=function(){return new mxDefaultToolbar(null,this)};mxEditor.prototype.setToolbarContainer=function(A){this.toolbar.init(A);if(mxClient.IS_QUIRKS){new mxDivResizer(A)}};mxEditor.prototype.setStatusContainer=function(A){if(this.status==null){this.status=A;this.addListener(mxEvent.SAVE,mxUtils.bind(this,function(){var B=new Date().toLocaleString();this.setStatus((mxResources.get(this.lastSavedResource)||this.lastSavedResource)+": "+B)}));this.addListener(mxEvent.OPEN,mxUtils.bind(this,function(){this.setStatus((mxResources.get(this.currentFileResource)||this.currentFileResource)+": "+this.filename)}));if(mxClient.IS_QUIRKS){new mxDivResizer(A)}}};mxEditor.prototype.setStatus=function(A){if(this.status!=null&&A!=null){this.status.innerHTML=A}};mxEditor.prototype.setTitleContainer=function(A){this.addListener(mxEvent.ROOT,mxUtils.bind(this,function(B){A.innerHTML=this.getTitle()}));if(mxClient.IS_QUIRKS){new mxDivResizer(A)}};mxEditor.prototype.treeLayout=function(B,A){if(B!=null){var C=new mxCompactTreeLayout(this.graph,A);C.execute(B)}};mxEditor.prototype.getTitle=function(){var C="";var B=this.graph;var D=B.getCurrentRoot();while(D!=null&&B.getModel().getParent(B.getModel().getParent(D))!=null){if(B.isValidRoot(D)){C=" > "+B.convertValueToString(D)+C}D=B.getModel().getParent(D)}var A=this.getRootTitle();return A+C};mxEditor.prototype.getRootTitle=function(){var A=this.graph.getModel().getRoot();return this.graph.convertValueToString(A)};mxEditor.prototype.undo=function(){this.undoManager.undo()};mxEditor.prototype.redo=function(){this.undoManager.redo()};mxEditor.prototype.groupCells=function(){var A=(this.groupBorderSize!=null)?this.groupBorderSize:this.graph.gridSize;return this.graph.groupCells(this.createGroup(),A)};mxEditor.prototype.createGroup=function(){var A=this.graph.getModel();return A.cloneCell(this.defaultGroup)};mxEditor.prototype.open=function(A){if(A!=null){var B=mxUtils.load(A).getXml();this.readGraphModel(B.documentElement);this.filename=A;this.fireEvent(new mxEventObject(mxEvent.OPEN,"filename",A))}};mxEditor.prototype.readGraphModel=function(B){var A=new mxCodec(B.ownerDocument);A.decode(B,this.graph.getModel());this.resetHistory()};mxEditor.prototype.save=function(B,A){B=B||this.getUrlPost();if(B!=null&&B.length>0){var C=this.writeGraphModel(A);this.postDiagram(B,C);this.setModified(false)}this.fireEvent(new mxEventObject(mxEvent.SAVE,"url",B))};mxEditor.prototype.postDiagram=function(A,B){if(this.escapePostData){B=encodeURIComponent(B)}mxUtils.post(A,this.postParameterName+"="+B,mxUtils.bind(this,function(C){this.fireEvent(new mxEventObject(mxEvent.POST,"request",C,"url",A,"data",B))}))};mxEditor.prototype.writeGraphModel=function(A){A=(A!=null)?A:this.linefeed;var C=new mxCodec();var B=C.encode(this.graph.getModel());return mxUtils.getXml(B,A)};mxEditor.prototype.getUrlPost=function(){return this.urlPost};mxEditor.prototype.getUrlImage=function(){return this.urlImage};mxEditor.prototype.swapStyles=function(C,A){var B=this.graph.getStylesheet().styles[A];this.graph.getView().getStylesheet().putCellStyle(A,this.graph.getStylesheet().styles[C]);this.graph.getStylesheet().putCellStyle(C,B);this.graph.refresh()};mxEditor.prototype.showProperties=function(F){F=F||this.graph.getSelectionCell();if(F==null){F=this.graph.getCurrentRoot();if(F==null){F=this.graph.getModel().getRoot()}}if(F!=null){this.graph.stopEditing(true);var A=mxUtils.getOffset(this.graph.container);var D=A.x+10;var E=A.y;if(this.properties!=null&&!this.movePropertiesDialog){D=this.properties.getX();E=this.properties.getY()}else{var B=this.graph.getCellBounds(F);if(B!=null){D+=B.x+Math.min(200,B.width);E+=B.y}}this.hideProperties();var C=this.createProperties(F);if(C!=null){this.properties=new mxWindow(mxResources.get(this.propertiesResource)||this.propertiesResource,C,D,E,this.propertiesWidth,this.propertiesHeight,false);this.properties.setVisible(true)}}};mxEditor.prototype.isPropertiesVisible=function(){return this.properties!=null};mxEditor.prototype.createProperties=function(H){var C=this.graph.getModel();var P=C.getValue(H);if(mxUtils.isNode(P)){var N=new mxForm("properties");var M=N.addText("ID",H.getId());M.setAttribute("readonly","true");var J=null;var F=null;var O=null;var I=null;var K=null;if(C.isVertex(H)){J=C.getGeometry(H);if(J!=null){F=N.addText("top",J.y);O=N.addText("left",J.x);I=N.addText("width",J.width);K=N.addText("height",J.height)}}var A=C.getStyle(H);var R=N.addText("Style",A||"");var B=P.attributes;var E=[];for(var D=0;D<B.length;D++){var L=B[D].value;E[D]=N.addTextarea(B[D].nodeName,L,(B[D].nodeName=="label")?4:2)}var G=mxUtils.bind(this,function(){this.hideProperties();C.beginUpdate();try{if(J!=null){J=J.clone();J.x=parseFloat(O.value);J.y=parseFloat(F.value);J.width=parseFloat(I.value);J.height=parseFloat(K.value);C.setGeometry(H,J)}if(R.value.length>0){C.setStyle(H,R.value)}else{C.setStyle(H,null)}for(var S=0;S<B.length;S++){var T=new mxCellAttributeChange(H,B[S].nodeName,E[S].value);C.execute(T)}if(this.graph.isAutoSizeCell(H)){this.graph.updateCellSize(H)}}finally{C.endUpdate()}});var Q=mxUtils.bind(this,function(){this.hideProperties()});N.addButtons(G,Q);return N.table}return null};mxEditor.prototype.hideProperties=function(){if(this.properties!=null){this.properties.destroy();this.properties=null}};mxEditor.prototype.showTasks=function(){if(this.tasks==null){var D=document.createElement("div");D.style.padding="4px";D.style.paddingLeft="20px";var C=document.body.clientWidth;var A=new mxWindow(mxResources.get(this.tasksResource)||this.tasksResource,D,C-220,this.tasksTop,200);A.setClosable(true);A.destroyOnClose=false;var B=mxUtils.bind(this,function(E){mxEvent.release(D);D.innerHTML="";this.createTasks(D)});this.graph.getModel().addListener(mxEvent.CHANGE,B);this.graph.getSelectionModel().addListener(mxEvent.CHANGE,B);this.graph.addListener(mxEvent.ROOT,B);if(this.tasksWindowImage!=null){A.setImage(this.tasksWindowImage)}this.tasks=A;this.createTasks(D)}this.tasks.setVisible(true)};mxEditor.prototype.refreshTasks=function(A){if(this.tasks!=null){var A=this.tasks.content;mxEvent.release(A);A.innerHTML="";this.createTasks(A)}};mxEditor.prototype.createTasks=function(A){};mxEditor.prototype.showHelp=function(B){if(this.help==null){var F=document.createElement("iframe");F.setAttribute("src",mxResources.get("urlHelp")||this.urlHelp);F.setAttribute("height","100%");F.setAttribute("width","100%");F.setAttribute("frameBorder","0");F.style.backgroundColor="white";var E=document.body.clientWidth;var A=(document.body.clientHeight||document.documentElement.clientHeight);var C=new mxWindow(mxResources.get(this.helpResource)||this.helpResource,F,(E-this.helpWidth)/2,(A-this.helpHeight)/3,this.helpWidth,this.helpHeight);C.setMaximizable(true);C.setClosable(true);C.destroyOnClose=false;C.setResizable(true);if(this.helpWindowImage!=null){C.setImage(this.helpWindowImage)}if(mxClient.IS_NS){var D=function(H){var G=C.div.offsetHeight;F.setAttribute("height",(G-26)+"px")};C.addListener(mxEvent.RESIZE_END,D);C.addListener(mxEvent.MAXIMIZE,D);C.addListener(mxEvent.NORMALIZE,D);C.addListener(mxEvent.SHOW,D)}this.help=C}this.help.setVisible(true)};mxEditor.prototype.showOutline=function(){var B=this.outline==null;if(B){var C=document.createElement("div");C.style.overflow="hidden";C.style.position="relative";C.style.width="100%";C.style.height="100%";C.style.background="white";C.style.cursor="move";if(document.documentMode==8){C.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=100)"}var A=new mxWindow(mxResources.get(this.outlineResource)||this.outlineResource,C,600,480,200,200,false);var D=new mxOutline(this.graph,C);A.setClosable(true);A.setResizable(true);A.destroyOnClose=false;A.addListener(mxEvent.RESIZE_END,function(){D.update()});this.outline=A;this.outline.outline=D}this.outline.setVisible(true);this.outline.outline.update(true)};mxEditor.prototype.setMode=function(A){if(A=="select"){this.graph.panningHandler.useLeftButtonForPanning=false;this.graph.setConnectable(false)}else{if(A=="connect"){this.graph.panningHandler.useLeftButtonForPanning=false;this.graph.setConnectable(true)}else{if(A=="pan"){this.graph.panningHandler.useLeftButtonForPanning=true;this.graph.setConnectable(false)}}}};mxEditor.prototype.createPopupMenu=function(C,B,A){this.popupHandler.createMenu(this,C,B,A)};mxEditor.prototype.createEdge=function(B,D){var A=null;if(this.defaultEdge!=null){var E=this.graph.getModel();A=E.cloneCell(this.defaultEdge)}else{A=new mxCell("");A.setEdge(true);var F=new mxGeometry();F.relative=true;A.setGeometry(F)}var C=this.getEdgeStyle();if(C!=null){A.setStyle(C)}return A};mxEditor.prototype.getEdgeStyle=function(){return this.defaultEdgeStyle};mxEditor.prototype.consumeCycleAttribute=function(A){return(this.cycleAttributeValues!=null&&this.cycleAttributeValues.length>0&&this.graph.isSwimlane(A))?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null};mxEditor.prototype.cycleAttribute=function(B){if(this.cycleAttributeName!=null){var A=this.consumeCycleAttribute(B);if(A!=null){B.setStyle(B.getStyle()+";"+this.cycleAttributeName+"="+A)}}};mxEditor.prototype.addVertex=function(F,G,I,J){var L=this.graph.getModel();while(F!=null&&!this.graph.isValidDropTarget(F)){F=L.getParent(F)}F=(F!=null)?F:this.graph.getSwimlaneAt(I,J);var C=this.graph.getView().scale;var K=L.getGeometry(G);var B=L.getGeometry(F);if(this.graph.isSwimlane(G)&&!this.graph.swimlaneNesting){F=null}else{if(F==null&&this.swimlaneRequired){return null}else{if(F!=null&&B!=null){var E=this.graph.getView().getState(F);if(E!=null){I-=E.origin.x*C;J-=E.origin.y*C;if(this.graph.isConstrainedMoving){var H=K.width;var A=K.height;var D=E.x+E.width;if(I+H>D){I-=I+H-D}D=E.y+E.height;if(J+A>D){J-=J+A-D}}}else{if(B!=null){I-=B.x*C;J-=B.y*C}}}}}K=K.clone();K.x=this.graph.snap(I/C-this.graph.getView().translate.x-this.graph.gridSize/2);K.y=this.graph.snap(J/C-this.graph.getView().translate.y-this.graph.gridSize/2);G.setGeometry(K);if(F==null){F=this.graph.getDefaultParent()}this.cycleAttribute(G);this.fireEvent(new mxEventObject(mxEvent.BEFORE_ADD_VERTEX,"vertex",G,"parent",F));L.beginUpdate();try{G=this.graph.addCell(G,F);if(G!=null){this.graph.constrainChild(G);this.fireEvent(new mxEventObject(mxEvent.ADD_VERTEX,"vertex",G))}}finally{L.endUpdate()}if(G!=null){this.graph.setSelectionCell(G);this.graph.scrollCellToVisible(G);this.fireEvent(new mxEventObject(mxEvent.AFTER_ADD_VERTEX,"vertex",G))}return G};mxEditor.prototype.destroy=function(){if(!this.destroyed){this.destroyed=true;if(this.tasks!=null){this.tasks.destroy()}if(this.outline!=null){this.outline.destroy()}if(this.properties!=null){this.properties.destroy()}if(this.keyHandler!=null){this.keyHandler.destroy()}if(this.rubberband!=null){this.rubberband.destroy()}if(this.toolbar!=null){this.toolbar.destroy()}if(this.graph!=null){this.graph.destroy()}this.status=null;this.templates=null}};