package com.xinleju.erp.frame.models.extender;

import java.util.ArrayList;
import java.util.List;

import com.xinleju.erp.frame.enums.FiFieldTypeEnum;
import com.xinleju.erp.frame.models.BOFieldInfo;
import com.xinleju.erp.frame.models.helper.BODataHelper;
import com.xinleju.erp.frame.models.helper.BODataTempCache;

public class BODataHelperExtender {
	public static final String _NAME = "_name";
	private BODataTempCache cache;
	
	public BODataHelperExtender(BODataTempCache cache){
		this.cache = cache;
	}
	public String[] getExtenderFields(BODataHelper helper){
		List<BOFieldInfo> fieldinfos = helper.getFieldHelper().getFieldList(FiFieldTypeEnum.TYPE_ENUM);
		List<String> fields = new ArrayList<String>();
		for(BOFieldInfo fieldinfo : fieldinfos){
			fields.add(fieldinfo.getFieldkey()+_NAME);
		}
		return fields.toArray(new String[0]);
	}
	
	public Object getExtenderValue(String key,BODataHelper helper){
		Object value = null;
		if(key.endsWith(_NAME)){
			String refKey = key.substring(0, key.length() - _NAME.length());
			BOFieldInfo fieldInfo = helper.getFieldHelper().getFieldInfoByFieldkey(refKey);
			if(fieldInfo == null)
				return null;
			if(fieldInfo.getVtype().equals(FiFieldTypeEnum.TYPE_ENUM.getKey())){
				value = cache.getBONameByKey(fieldInfo.getDsid(), helper.getAttribute(refKey));
			}
		}
		return  value;
	}
}
