package com.xinleju.erp.ad.service;

import javax.naming.NamingEnumeration;
import javax.naming.NamingException;
import javax.naming.directory.Attribute;
import javax.naming.directory.Attributes;
import javax.naming.directory.SearchControls;
import javax.naming.directory.SearchResult;
import javax.naming.ldap.LdapContext;

import com.xinleju.erp.ad.config.AdConfigUtils;

public class Test {
	public static void main(String[] args) throws NamingException {
		  String userName = ""; // 用户名称  
		  String company = "";
		  AdConfigUtils adConfig= new AdConfigUtils();
		  LdapContext ctx=null;//adConfig.getLdapContextInstance2();
		// 基于baseDN查询
			String baseDN = "dc=xljtest,dc=com";
			String filter = "(objectClass=top)";
			filter = "(&(objectClass=organizationalUnit)" + filter + ")";
			try {
				// 实例化一个搜索器
				SearchControls cons = new SearchControls();
				// 搜索范围： 1、平级检索；2、树形检索
				//cons.setSearchScope(SearchControls.SUBTREE_SCOPE);
				cons.setSearchScope(SearchControls.ONELEVEL_SCOPE);
				//设置为false时返回结果占用内存减少
				cons.setReturningObjFlag(true);
				// 执行查询
				NamingEnumeration<SearchResult> sEnum = ctx.search(baseDN, filter, cons);
				int size = 0;
				while(sEnum.hasMoreElements()){
					SearchResult sr = sEnum.nextElement();
					String DN = sr.getName();
					System.out.println("DN: " + DN);
					Attributes attrs = sr.getAttributes();
					// 取到所有属性
					NamingEnumeration<? extends Attribute> aEnum = attrs.getAll();
					while(aEnum.hasMoreElements()){
						Attribute attr = aEnum.nextElement();
						if(attr==null){
							continue ;
						}
						// 打印属性名和属性值，属性值可以为多个
						System.out.print("id = " + attr.getID() + ", value = ");
						
						for(int i=0;i<attr.size();i++){
							Object obj = attr.get(i);
							System.out.print(obj.toString() + " ");
							//String str= new String(obj.toString().getBytes("iso8859_1"), "GBK");
						}
						System.out.println();
					}
					size ++ ;
					System.out.println("---------------------------------------");
				}
				System.out.println("共返回： " + size);
			} catch (NamingException e) {
				e.printStackTrace();
			}
			// 关闭
			ctx.close();

		
		  } 

}
