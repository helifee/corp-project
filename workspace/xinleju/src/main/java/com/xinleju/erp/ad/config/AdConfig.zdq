package com.xinleju.erp.ad.config;

import java.util.Hashtable;

import javax.naming.Context;
import javax.naming.NamingException;
import javax.naming.ldap.InitialLdapContext;
import javax.naming.ldap.LdapContext;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

@Component
public class AdConfig {
	
	//@Value("#{adProperties['SECURITY_AUTHENTICATION']?:''}")
	private String scurity_authentiction;
	
	//@Value("#{adProperties['SECURITY_PRINCIPAL']?:''}")
	private String scurity_principal;
	
	//@Value("#{adProperties['SECURITY_CREDENTIALS']?:''}")
	private String scurity_credentials;
	
	//@Value("#{adProperties['INITIAL_CONTEXT_FACTORY']?:''}")
	private String initial_context_factory;
	
	//@Value("#{adProperties['PROVIDER_URL']?:''}")
	private String provider_url;
	

	private LdapContext ldapContext;
	
	
	/**
	 * 
	 * 获取java目录服务上下文
	 * @return
	 */
	public LdapContext  getLdapContextInstance(){
		 if(ldapContext==null){
			 synchronized(ldapContext){
				 if(ldapContext==null){
					try {
					    Hashtable hashEnv = new Hashtable();  
					    hashEnv.put(Context.SECURITY_AUTHENTICATION,scurity_authentiction);
					    hashEnv.put(Context.SECURITY_PRINCIPAL,scurity_principal);
					    hashEnv.put(Context.SECURITY_CREDENTIALS,scurity_credentials);
					    hashEnv.put(Context.INITIAL_CONTEXT_FACTORY,initial_context_factory);
					    hashEnv.put(Context.PROVIDER_URL, provider_url);
						ldapContext= new  InitialLdapContext(hashEnv, null);
					} catch (NamingException e) {
						// TODO Auto-generated catch block
						e.printStackTrace();
					}
				 }
			 }
		 }
		return ldapContext;
	}
	
	
	public  LdapContext  getLdapContextInstance2(){

					    Hashtable hashEnv = new Hashtable();  
					    //LDAP访问安全级别
					    hashEnv.put(Context.SECURITY_AUTHENTICATION,"simple");
					    //AD User

					    hashEnv.put(Context.SECURITY_PRINCIPAL,"test01");
					    
					    hashEnv.put(Context.SECURITY_CREDENTIALS,"2wsx#EDC");
					    //LDAP工厂类
					    hashEnv.put(Context.INITIAL_CONTEXT_FACTORY,"com.sun.jndi.ldap.LdapCtxFactory");
					    
					    hashEnv.put(Context.PROVIDER_URL, "ldap://192.168.3.10:389");
					   	try {
							ldapContext= new  InitialLdapContext(hashEnv, null);
						} catch (NamingException e) {
							// TODO Auto-generated catch block
							e.printStackTrace();
						}
		                return ldapContext;
	}

}
