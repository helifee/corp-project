package com.xinleju.erp.frame.dao;

import java.util.ArrayList;
import java.util.List;

import javax.persistence.Table;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import com.xinleju.erp.flow.dao.impl.BaseDAO;
import com.xinleju.erp.frame.models.BOFieldInfo;
import com.xinleju.erp.frame.models.VoucherTemplate;
import com.xinleju.erp.frame.service.extend.dto.FiAggDTO;

@Repository
public class FiVTDao extends BaseDAO {
	@Autowired
    private FiBusinessDao fiBusinessDao;

	/**
	 * 根据模板业务类型id查询出凭证模板信息
	 * @param bmid
	 * @return
	 */
	public FiAggDTO queryFiAggDTO(Long bmid){
		Table bmtb = VoucherTemplate.class.getAnnotation(Table.class);
		Object obj = getDao().getFirstBySQL("SELECT e.id FROM "+ bmtb.name()+" e WHERE e.bmid=?", bmid);
		if(obj == null)
			return null;
		return fiBusinessDao.queryAggById(VoucherTemplate.class, Long.valueOf(obj.toString()));
	}
	
	public List<BOFieldInfo> queryFiedInfo(Long bmid){
		List<BOFieldInfo> list = getDao().findByHQL(BOFieldInfo.class, " FROM BOFieldInfo f  WHERE f.pid in ( SELECT vt.boid FROM VoucherTemplate vt WHERE vt.bmid = ?)", bmid);
		if(list == null)
			list = new ArrayList<BOFieldInfo>();
		return list;
	}
}
