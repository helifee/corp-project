package com.xinleju.erp.frame.service;


import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.xinleju.erp.base.app.bean.Page;
import com.xinleju.erp.base.app.service.impl.BaseService;
import com.xinleju.erp.frame.dao.FuncButtonDao;
import com.xinleju.erp.frame.dao.FuncModuleDao;
import com.xinleju.erp.frame.models.FuncButton;
import com.xinleju.erp.frame.models.FuncModule;


/**
 * 版权：(C) 版权所有 2000-2014 上海天好电子商务有限公司苏州分公司 菜单Service <详细描述>
 * 
 * @author zhengxj
 * @version $Id: FuncModuleService.java 3144 2015-05-16 13:37:36Z zhangxiang $
 * @since
 * @see
 */
@Service
public class FuncModuleService extends BaseService {

    @Autowired
    private FuncModuleDao funcModuleDao;

    @Autowired
    private FuncButtonDao funcButtonDao;

    /**
     * 根据业务模块code获取菜单
     * 
     * @author zhengxj
     * @param systemCode
     * @return
     */
    public Page getFuncModuleList(String systemCode, int start, int limit) {
        Page page = funcModuleDao.getParentFuncModuleList(systemCode, start, limit);
        for (Object object : page.getItems()) {
            FuncModule pfm = (FuncModule)object;
            List<FuncModule> cList = funcModuleDao.getChildFuncModuleList(pfm.getId());
            for (FuncModule cfm : cList) {
                List<FuncButton> fbList = funcButtonDao.getFuncButtonListByFuncId(cfm.getId());
                cfm.setButtonList(fbList);
            }
            pfm.setChildModuleList(cList);
        }
        return page;
    }
    
    /**
     * 获取菜单
     * 
     * @author zx
     * @return
     */
    public Page getAllFuncModuleList(int start, int limit) {
        Page page = funcModuleDao.getAllParentFuncModuleList(start, limit);
        for (Object object : page.getItems()) {
            FuncModule pfm = (FuncModule)object;
            List<FuncModule> cList = funcModuleDao.getChildFuncModuleList(pfm.getId());
            for (FuncModule cfm : cList) {
                List<FuncButton> fbList = funcButtonDao.getFuncButtonListByFuncId(cfm.getId());
                cfm.setButtonList(fbList);
            }
            pfm.setChildModuleList(cList);
        }
        return page;
    }
    
    
    
    /**
     * 获得有权限的功能
     * @param systemCode
     * @param start
     * @param limit
     * @return
     */
    public Page getAuthFuncModuleList(List<Long> roleIds,String systemCode, int start, int limit){
    	Page page = funcModuleDao.getAuthParentFuncModuleList(roleIds,systemCode, start, limit);
        for (Object object : page.getItems()) {
            FuncModule pfm = (FuncModule)object;
            List<FuncModule> cList = funcModuleDao.getAuthChildFuncModuleList(roleIds,pfm.getId());
            for (FuncModule cfm : cList) {
                List<FuncButton> fbList = funcButtonDao.getAuthFuncButtonListByFuncId(roleIds,cfm.getId());
                cfm.setButtonList(fbList);
            }
            pfm.setChildModuleList(cList);
        }
        return page;
    }

}
