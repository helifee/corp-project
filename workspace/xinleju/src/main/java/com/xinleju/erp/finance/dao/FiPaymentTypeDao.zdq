package com.xinleju.erp.finance.dao;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;

import org.springframework.stereotype.Repository;

import com.xinleju.erp.finance.dto.FiPaymentTypeDTO;
import com.xinleju.erp.finance.models.FiPaymentType;
import com.xinleju.erp.flow.dao.impl.BaseDAO;

@Repository
public class FiPaymentTypeDao extends BaseDAO {
	
	/**
	 * 根据账套id获得银行会计科目
	 * 
	 * @param accountSetId
	 * @param status
	 * @return
	 */
	public List<FiPaymentType> getFiPaymentTypeList(Long accountSetId, String status,Long sysId) {
	    List<FiPaymentType> fiBudgetList = new ArrayList<FiPaymentType>();
//		fiBudgetList = getDao().findByHQL(FiPaymentType.class, "from FiPaymentType p where p.createDate = (select max(pp.createDate) from FiPaymentType pp where pp.accountCapCode=p.accountCapCode and pp.accountSetId = ? and pp.sysId = ? and pp.companyId=?) and p.accountSetId = ? and p.sysId = ? and p.companyId = ?  order by p.accountCapCode asc",accountSetId,sysId,companyId,accountSetId,sysId,companyId);
	    fiBudgetList = getDao().findByHQL(FiPaymentType.class, "from FiPaymentType p where p.accountSetId = ? and p.sysId = ?   order by p.accountCapCode asc",accountSetId,sysId);
		return fiBudgetList;
	}
	
	/**
	 * 根据财务编码、款项类型编码、账套id获得款项类型
	 * 
	 * @param accountSetId
	 * @param status
	 * @return
	 */
	public List<FiPaymentType> getFiPaymentTypeListByCapAndTypeCode(String accountCapCode, String typeCode,Long accountSetId,Long sysId) {
		List<FiPaymentType> fiBudgetList = new ArrayList<FiPaymentType>();
	    fiBudgetList = getDao().findByHQL(FiPaymentType.class, "from FiPaymentType p where p.accountSetId = ? and p.accountCapCode = ? and p.typeCode=? and p.sysId = ?  order by p.accountCapCode asc",accountSetId,accountCapCode,typeCode,sysId);
		return fiBudgetList;
	}
	
	/**
	 * 根据银行id获得款项名称
	 * 
	 * @param accountSetId
	 * @param status
	 * @return
	 */
	public List<FiPaymentType> getFiPaymentTypeListByTypeId(Long accountSetId,String bid) {
		List<FiPaymentType> fiBudgetList = new ArrayList<FiPaymentType>();
		fiBudgetList = getDao().findByHQL(FiPaymentType.class, "from FiPaymentType p where p.accountSetId = ? and p.saId = ?  order by p.accountCapCode asc",accountSetId,Long.valueOf(bid));
		return fiBudgetList;
	}

	/**
	 * 将FiBudgetCapDTO列表返回
	 * 
	 * @param accountSetId
	 * @param status
	 * @return
	 */
	public List<FiPaymentTypeDTO> getFiPaymentTypeDTOList(Long accountSetId, String status,Long sysId) {
		List<FiPaymentType> fiBudgetCapList = getFiPaymentTypeList(accountSetId, status,sysId);
		List<FiPaymentTypeDTO> dtoList = new ArrayList<FiPaymentTypeDTO>(fiBudgetCapList.size());
		for (FiPaymentType fiBudgetCap : fiBudgetCapList) {
			FiPaymentTypeDTO subjectDTO = captionToSubjectDTO(fiBudgetCap);
			dtoList.add(subjectDTO);
		}
		return dtoList;
	}

	/**
	 * 将会计科目转换成Dto对象
	 * 
	 * @param accountCaption
	 * @return
	 */
	private FiPaymentTypeDTO captionToSubjectDTO(FiPaymentType fiBudgetCap) {
		FiPaymentTypeDTO dto = new FiPaymentTypeDTO();
		dto.setId(String.valueOf(fiBudgetCap.getId()));
		dto.setTypeCode(fiBudgetCap.getTypeCode());
		dto.setTypeName(fiBudgetCap.getTypeName());
		dto.setAccountsetid(String.valueOf(fiBudgetCap.getAccountSetId()));
		dto.setAccountCapCode(fiBudgetCap.getAccountCapCode());
		dto.setAccountCapName(fiBudgetCap.getAccountCapName());
		dto.setCompanyId(fiBudgetCap.getCompanyId());
		dto.setAccountCapId(fiBudgetCap.getAccountCapId()+"");
		dto.setCoId(fiBudgetCap.getCoId()+"");
		try{
			SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
			if(fiBudgetCap.getCreateDate()!=null){
				dto.setCreateDate(sf.format(fiBudgetCap.getCreateDate()));
			}
		}catch(Exception e){
			e.printStackTrace();
		}
		return dto;
	}

	/**
	 * 将预算科目保存代码
	 * 
	 * @param fiBudgetCap
	 */
	public void saveOrUpdate(FiPaymentType fiBudgetCap) {
		getDao().saveOrUpdate(fiBudgetCap);
	}

}
