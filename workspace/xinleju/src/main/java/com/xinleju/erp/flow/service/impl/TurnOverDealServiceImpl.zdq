package com.xinleju.erp.flow.service.impl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Service;

import com.xinleju.erp.base.app.bean.Page;
import com.xinleju.erp.base.app.service.impl.BaseService;
import com.xinleju.erp.flow.service.TurnOverDealService;
import com.xinleju.erp.flowengine.service.FlowInstanceFiService;

@Service
public class TurnOverDealServiceImpl extends BaseService implements TurnOverDealService{
	@Autowired
	private JdbcTemplate jt;
	@Autowired
	private FlowInstanceFiService flowInstanceFiService;
	@Override
	public Page getFlowInstanceByParticipant(
			String participant, Integer start, Integer limit) {
		// TODO Auto-generated method stub
		String listSql="select f.guid, app.name, so.name as bizTypeName,f.fi_name  ,f.company_name,f.start_user_name,f.create_time,f.status from flow_instance f ,sm_app app , sm_service_object_define so " +
				" where (exists(select 1 from flow_instance_step_work k where k.participants_name like '%"+participant+"%' and k.status=0 and k.fi_id=f.guid)"
              +"or  exists(select 1 from flow_instance_step_work_task t where t.participant_user_name like '%"+participant+"%' and t.status=1 and t.fi_id=f.guid)) and"
              +"  f.biz_type=so.id and f.status=1 and app.code=f.app_code";
		Page page=getDao().findPageBySQL(listSql, new Object[]{}, start, limit);
		return page;
	}
	@Override
	public void replaceFormParticipantToParticipant(String[] ids,
			Long sourceParticipant, Long targetParticipant) {
		// TODO Auto-generated method stub

		try {
			flowInstanceFiService.replaceFormParticipantToParticipant(ids, sourceParticipant, targetParticipant);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	
	

}
