package com.xinleju.erp.frame.dao;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Repository;

import com.xinleju.erp.base.utils.CollectionUtils;
import com.xinleju.erp.flow.dao.impl.BaseDAO;
import com.xinleju.erp.frame.models.ShortCutFunc;

@Repository
public class ShortCutFuncDao extends BaseDAO {
	 /**
     * 是否快捷菜单
     * @param funcId
     * @return
     */
    public boolean isShortCut(Long funcId,String loginName) {
    	String hql = "select count(id) from ShortCutFunc sc where sc.funcModuleId = ? and sc.loginName = ?";
    	Long count = getDao().findLong(hql, funcId,loginName);
    	return count > 0 ? true : false;
    }
    
    /**
     * 是否快捷菜单
     * @param funcId
     * @return
     */
    public boolean isShortCut(Long funcId, Map<Long, ShortCutFunc> maxShortCutsMap) {
        boolean isShortCut = false;
        if (null != maxShortCutsMap){
            isShortCut = maxShortCutsMap.containsKey(funcId);
        }
        return isShortCut;
    }
    
    /**
     * 快捷菜单功能
     * @param funcId
     * @param flag 0表示取消，1表示添加
     */
    public void doShortCut(Long funcId,Integer flag,String loginName){
    	if(flag != null && funcId != null && funcId !=0) {
    		if(flag == 1 && !isShortCut(funcId,loginName)){
    			ShortCutFunc sc = new ShortCutFunc();
    			sc.setFuncModuleId(funcId);
    			sc.setLoginName(loginName);
    			getDao().save(sc);
    		}else if(flag ==0 && isShortCut(funcId,loginName)) {
    			String hql = "delete from ShortCutFunc sc where sc.funcModuleId = ? and sc.loginName = ?";
    			getDao().execute(hql, funcId,loginName);
    		}
    	}
    }
    
    /**
     * 获取收藏数量
     * @return
     */
    public Long getShortCutCount(String loginName) {
    	return getDao().findLong("select count(id) from ShortCutFunc sc where sc.loginName = ?",loginName);
    }
    
    
    /**
     * 获得快捷菜单
     * @return
     */
    public List<ShortCutFunc> getMaxShortCuts(String loginName){
    	return getDao().findAll(ShortCutFunc.class, "loginName = ? ", new Object[]{loginName}, "id asc", ShortCutFunc.maxCount);
    }
    /**
     * 获取快捷菜单map
     * @author zhongjun
     * @param loginName
     * @return
     */
    public Map<Long, ShortCutFunc> getMaxShortCutsMap(String loginName){
        Map<Long, ShortCutFunc> maxShortCutsMap = new HashMap<Long, ShortCutFunc>();
        if (StringUtils.isNotBlank(loginName)){
            List<ShortCutFunc> maxShortCuts = this.getMaxShortCuts(loginName);
            if (null != maxShortCuts && maxShortCuts.size() > 0){
                maxShortCutsMap = CollectionUtils.collectAsMap(maxShortCuts, "funcModuleId");
            }
        }
        return maxShortCutsMap;
    }
    
}
