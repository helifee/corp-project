package com.xinleju.erp.finance.dao;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;

import org.springframework.stereotype.Repository;

import com.xinleju.erp.finance.dto.FiCoCapDTO;
import com.xinleju.erp.finance.models.FiCoCap;
import com.xinleju.erp.finance.models.FiCoCapInput;
import com.xinleju.erp.flow.dao.impl.BaseDAO;

@Repository
public class FiCoCapDao extends BaseDAO {
	
	/**
	 * 根据账套id获得预算科目
	 * 
	 * @param accountSetId
	 * @param status
	 * @return
	 */
	public List<FiCoCap> getFiCoCapList(Long accountSetId, String status,Long sysId,Long companyId) {
	    List<FiCoCap> fiBudgetList = new ArrayList<FiCoCap>();
	    fiBudgetList = getDao().findByHQL(FiCoCap.class, "from FiCoCap p where  p.accountSetId = ? and p.sysId = ? and p.status=1 and p.companyId=?  order by p.code asc",accountSetId,sysId,companyId);
		return fiBudgetList;
	}

	/**
	 * 将FiCoCapDTO列表返回
	 * 
	 * @param accountSetId
	 * @param status
	 * @return
	 */
	public List<FiCoCapDTO> getFiCoCapDTOList(Long accountSetId, String status,Long sysId,Long companyId) {
		List<FiCoCap> fiCoCapList = getFiCoCapList(accountSetId, status,sysId, companyId);
		List<FiCoCapDTO> dtoList = new ArrayList<FiCoCapDTO>(fiCoCapList.size());
		for (FiCoCap fiCoCap : fiCoCapList) {
			FiCoCapDTO subjectDTO = captionToSubjectDTO(fiCoCap);
			dtoList.add(subjectDTO);
		}
		return dtoList;
	}
	
	public List<FiCoCap> getFiCoCapInputListByCapAndCoCode(String accountCapCode,String code,Long accountSetId,Long companyId,Long sysId){
		List<FiCoCap> fiBudgetList = new ArrayList<FiCoCap>();
		fiBudgetList = getDao().findByHQL(FiCoCap.class, "from FiCoCap p where  p.accountSetId = ? and p.sysId = ? and p.status=1 and p.companyId=? and p.accountCapCode=? and p.code=? order by p.code asc",accountSetId,sysId,companyId,accountCapCode,code);
		return fiBudgetList;
	}

	/**
	 * 将会计科目转换成Dto对象
	 * 
	 * @param accountCaption
	 * @return
	 */
	private FiCoCapDTO captionToSubjectDTO(FiCoCap fiCoCap) {
		FiCoCapDTO dto = new FiCoCapDTO();
		dto.setId(String.valueOf(fiCoCap.getId()));
		dto.setPid(fiCoCap.getParentId() == null ? "" : fiCoCap.getParentId().toString());
		dto.setAcPid(fiCoCap.getAccountCapId() == null ? "":fiCoCap.getAccountCapId().toString());
		dto.setSubcode(fiCoCap.getCode());
		dto.setAccountsetid(String.valueOf(fiCoCap.getAccountSetId()));
		dto.setSubname(fiCoCap.getName());
		dto.setAccountcode(fiCoCap.getAccountCapCode());
		dto.setAccountname(fiCoCap.getAccountCapName());
		dto.setCashflowcode(fiCoCap.getCashFlowCode());
		dto.setCashflowname(fiCoCap.getCashFlowName());
		dto.setBid(fiCoCap.getBid());
		dto.setCompanyId(fiCoCap.getCompanyId());
		try{
			SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
			if(fiCoCap.getCreateDate()!=null){
				dto.setCreateDate(sf.format(fiCoCap.getCreateDate()));
			}
		}catch(Exception e){
			e.printStackTrace();
		}
		return dto;
	}

	/**
	 * 将预算科目保存代码
	 * 
	 * @param fiCoCap
	 */
	public void saveOrUpdate(FiCoCap fiCoCap) {
		getDao().saveOrUpdate(fiCoCap);
	}

}
