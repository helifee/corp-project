package com.xinleju.erp.thirdparty.service.impl;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Service;

import com.xinleju.erp.base.app.service.impl.BaseService;
import com.xinleju.erp.thirdparty.dto.DepartmentDTO;
import com.xinleju.erp.thirdparty.service.DepartmentService;

@Service
public class DepartmentServiceImpl extends BaseService implements
		DepartmentService {

	@Autowired
	private JdbcTemplate jt;

	@Override
	public List<DepartmentDTO> getDepartmentList() {
		// TODO Auto-generated method stub
		String sqlStr = "SELECT 8 deptID,'鑫苑中国总部' deptName,null upDeptID FROM DUAL UNION ALL (SELECT e.ref_id deptID, e.NAME deptName,d.ref_id upDeptID FROM sm_party_entity e,sm_party_struct s,sm_party_entity d WHERE e.party_type_id IN ('1', '2', '3') and s.child_entity_id = e.id and d.id = s.parent_entity_id AND e.status != '1' AND (d.status IS NULL || d.status != '1')) ORDER BY upDeptID,deptID";

		List<DepartmentDTO> deptList = jt.query(sqlStr, new DepartmentMapper());
		return deptList;
	}

	public class DepartmentMapper implements RowMapper<DepartmentDTO> {

		@Override
		public DepartmentDTO mapRow(ResultSet arg0, int arg1)
				throws SQLException {
			// TODO Auto-generated method stub
			DepartmentDTO dept = new DepartmentDTO();

			dept.setDeptID(Long.toString(arg0.getLong("deptID")));
			dept.setDeptName(arg0.getString("deptName"));
			dept.setUpDeptID(Long.toString(arg0.getLong("upDeptID")));

			return dept;
		}

	}

}
