package com.xinleju.erp.frame.models.helper;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.xinleju.erp.frame.dto.FiBillDTO;
import com.xinleju.erp.frame.enums.VoucherStateEnum;
import com.xinleju.erp.frame.models.BOData;
import com.xinleju.erp.frame.models.BOFieldData;
import com.xinleju.erp.frame.models.BOFieldInfo;
import com.xinleju.erp.frame.service.extend.dto.FiAggDTO;
public class BODataHelper {
	private BOData boData;
	private Map<String,Object> dataMap;
	private BOFieldHelper fieldHelper = null;
	public BODataHelper(FiAggDTO  dto, List<BOFieldInfo> boFieldInfoList){
		fieldHelper = new BOFieldHelper(boFieldInfoList);
		initDataList(dto);
	}
	
	public BODataHelper(Map<String,Object> dataMap ,BOFieldHelper fieldHelper){
		this.fieldHelper = fieldHelper;
	}

	
	public BODataHelper(FiAggDTO  dto,BOFieldHelper fieldHelper){
		this.fieldHelper = fieldHelper;
		initDataList(dto);
	}
	
	public BODataHelper(FiBillDTO dto,Long bmid,BOFieldHelper fieldHelper){
		this.fieldHelper = fieldHelper;
		initDataList(dto,bmid);
	}
	
	public BODataHelper(FiBillDTO dto,Long bmid, List<BOFieldInfo> boFieldInfoList){
		fieldHelper = new BOFieldHelper(boFieldInfoList);
		initDataList(dto,bmid);
	}
	
	private void initDataList(FiBillDTO dto,Long bmid){
		dataMap =  new HashMap<String,Object>();
		if(dto == null)
			return;
		boData = new BOData();
		boData.setBmid(bmid);
		boData.setVoucherstate(VoucherStateEnum.STATE_TEMP.getKey());
		for(BOFieldInfo fieldInfo: fieldHelper.getAllFieldInfo()){
			String key = fieldInfo.getFieldkey();
			Object value = dto.getAttribute(key);
			dataMap.put(key, value);
		}
	}
	
	private void initDataList(FiAggDTO  dto){
		dataMap =  new HashMap<String,Object>();
		if(dto == null)
			return;
		Object obj = dto.getParent();
		if(obj instanceof BOData){
			 boData = (BOData) obj;
		}
		@SuppressWarnings("unchecked")
		List<BOFieldData> fielddatalist = (List<BOFieldData>) dto.getChildren(BOFieldData.class);
		if(fielddatalist == null)
			return;
		for(BOFieldData fielddata: fielddatalist){
			dataMap.put(fielddata.getFieldkey(), fielddata.getFieldvalue());
		}
	}
	
	public BOData getBoData() {
		return boData;
	}

	public Object getAttribute(String key){
		return  dataMap.get(key);
	}
	
	public BOFieldHelper getFieldHelper() {
		return fieldHelper;
	}
	public Map<String, Object> getDataMap() {
		return dataMap;
	}
}
