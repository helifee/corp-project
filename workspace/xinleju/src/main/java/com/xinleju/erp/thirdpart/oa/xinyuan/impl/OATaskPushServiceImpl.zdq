/*
 * 文件名：OATaskPushServiceImpl.java 版权：Copyright by www.tele-hot.com 描述： 修改人：zhengxj 修改时间：2014-6-10
 * 跟踪单号： 修改单号： 修改内容：
 */
package com.xinleju.erp.thirdpart.oa.xinyuan.impl;
import java.util.Date;


import org.apache.log4j.Logger;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.xinleju.erp.base.utils.DateUtils;
import com.xinleju.erp.thirdpart.oa.xinyuan.api.ISysNotifyTodoWebServiceServiceLocator;
import com.xinleju.erp.thirdpart.oa.xinyuan.api.NotifyTodoAppResult;
import com.xinleju.erp.thirdpart.oa.xinyuan.api.NotifyTodoGetContext;
import com.xinleju.erp.thirdpart.oa.xinyuan.api.NotifyTodoRemoveContext;
import com.xinleju.erp.thirdpart.oa.xinyuan.api.NotifyTodoSendContext;
import com.xinleju.erp.thirdpart.oa.xinyuan.OATaskPushService;

/**
 * 
 * OA任务推送接口实现类
 * 发送待办接口、删除待办接口、设为已办接口、获取待办接口
 * @author zhengxjFlowInstanceApproveAction
 * @version 2014-6-10
 * @see OATaskPushServiceImpl
 */
@Service
@Transactional
public class OATaskPushServiceImpl implements OATaskPushService {
    
    /**
     * 获得日志类
     */
    private static final Logger LOG = Logger.getLogger(OATaskPushServiceImpl.class);
    
    private ISysNotifyTodoWebServiceServiceLocator locator = new ISysNotifyTodoWebServiceServiceLocator(); 

    @Override
    public NotifyTodoAppResult sendTodo(String appName, String modelName, String modelId, String subject, String link, int type, String targets,String param1,String param2) throws Exception {
        NotifyTodoSendContext notifyTodoSendContext = new NotifyTodoSendContext();
        notifyTodoSendContext.setAppName(appName);
        //modelName NULL表示加锁，不能在app审批 .setModelName("NULL");//
        notifyTodoSendContext.setModelName("xinleju");
        notifyTodoSendContext.setModelId(modelId);
        notifyTodoSendContext.setSubject(subject);
        notifyTodoSendContext.setLink(link );
        notifyTodoSendContext.setParam1(param1 );
        notifyTodoSendContext.setParam2(param2 );
        notifyTodoSendContext.setLink(link );
        notifyTodoSendContext.setType(type);
        notifyTodoSendContext.setTargets("{\"LoginName\":\""+targets+"\"}");
        notifyTodoSendContext.setCreateTime(DateUtils.formatDate(new Date(),"yyyy-MM-dd HH:mm:ss"));
        NotifyTodoAppResult notifyTodoAppResult = locator.getISysNotifyTodoWebServicePort().sendTodo(notifyTodoSendContext);
        LOG.error("{\"appName\":\""+appName+"\",\"modelName\":\""+modelName+"\",\"modelId\":\""+modelId+"\",\"subject\":\""+subject+"\",\"url\":\""+notifyTodoSendContext.getLink()+"\",\"targets\":\""+targets+"\",\"returnState\":\""+notifyTodoAppResult.getReturnState()+"\"}");
        return notifyTodoAppResult;
    }

    @Override
    public NotifyTodoAppResult deleteTodo(String appName, String modelName, String modelId, int optType, String targets,String param1,String param2)
        throws Exception {
        NotifyTodoRemoveContext notifyTodoRemoveContext = new NotifyTodoRemoveContext();
        notifyTodoRemoveContext.setAppName(appName);
        notifyTodoRemoveContext.setModelName("xinleju");
        notifyTodoRemoveContext.setModelId(modelId);
        notifyTodoRemoveContext.setParam1(param1 );
        notifyTodoRemoveContext.setParam2(param2 );
        notifyTodoRemoveContext.setOptType(optType + 1);
        notifyTodoRemoveContext.setTargets("{\"LoginName\":\""+targets+"\"}");
        NotifyTodoAppResult notifyTodoAppResult = locator.getISysNotifyTodoWebServicePort().deleteTodo(notifyTodoRemoveContext);
        LOG.error("{\"appName\":\""+appName+"\",\"modelName\":\""+modelName+"\",\"modelId\":\""+modelId+"\",\"optType\":\""+optType+"\",\"targets\":\""+targets+"\",\"returnState\":\""+notifyTodoAppResult.getReturnState()+"\"}");
        return notifyTodoAppResult;
    }

    @Override
    public NotifyTodoAppResult setTodoDone(String appName, String modelName, String modelId, int optType, String targets,String param1,String param2) throws Exception{
        NotifyTodoRemoveContext notifyTodoRemoveContext = new NotifyTodoRemoveContext();
        notifyTodoRemoveContext.setAppName(appName);
        notifyTodoRemoveContext.setModelName("xinleju");
        notifyTodoRemoveContext.setModelId(modelId);
        notifyTodoRemoveContext.setParam1(param1 );
        notifyTodoRemoveContext.setParam2(param2 );
        notifyTodoRemoveContext.setOptType(2);
        notifyTodoRemoveContext.setTargets("{\"LoginName\":\""+targets+"\"}");
        NotifyTodoAppResult notifyTodoAppResult = locator.getISysNotifyTodoWebServicePort().setTodoDone(notifyTodoRemoveContext);
        LOG.error("{\"appName\":\""+appName+"\",\"modelName\":\""+modelName+"\",\"modelId\":\""+modelId+"\",\"optType\":\""+optType+"\",\"targets\":\""+targets+"\",\"returnState\":\""+notifyTodoAppResult.getReturnState()+"\"}");
        return notifyTodoAppResult;
    }

    @Override
    public NotifyTodoAppResult getTodo(String targets, int type, int rowSize, int pageNo,String param1,String param2) throws Exception{
        NotifyTodoGetContext notifyTodoGetContext = new NotifyTodoGetContext();
        notifyTodoGetContext.setTargets("{\"LoginName\":\""+targets+"\"}");
        notifyTodoGetContext.setType(type);
        notifyTodoGetContext.setRowSize(rowSize);
        notifyTodoGetContext.setPageNo(pageNo);
        NotifyTodoAppResult notifyTodoAppResult = locator.getISysNotifyTodoWebServicePort().getTodo(notifyTodoGetContext);
        LOG.error("{\"type\":\""+type+"\",\"rowSize\":\""+rowSize+"\",\"pageNo\":\""+pageNo+"\",\"targets\":\""+targets+"\",\"returnState\":\""+notifyTodoAppResult.getReturnState()+"\"}");        
        return notifyTodoAppResult;
    }
   
}
