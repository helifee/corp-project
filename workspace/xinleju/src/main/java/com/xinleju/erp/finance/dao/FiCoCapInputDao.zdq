package com.xinleju.erp.finance.dao;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;

import org.springframework.stereotype.Repository;

import com.xinleju.erp.finance.dto.FiCoCapInputDTO;
import com.xinleju.erp.finance.models.FiBankCap;
import com.xinleju.erp.finance.models.FiCoCapInput;
import com.xinleju.erp.flow.dao.impl.BaseDAO;

@Repository
public class FiCoCapInputDao extends BaseDAO {
	
	/**
	 * 根据账套id获得预算科目
	 * 
	 * @param accountSetId
	 * @param status
	 * @return
	 */
	public List<FiCoCapInput> getFiCoCapInputList(Long accountSetId, String status,Long sysId,Long companyId) {
	    List<FiCoCapInput> fiBudgetList = new ArrayList<FiCoCapInput>();
		fiBudgetList = getDao().findByHQL(FiCoCapInput.class, "from FiCoCapInput p where  p.accountSetId = ? and p.sysId = ? and p.status=1 and p.companyId=?  order by p.code asc",accountSetId,sysId,companyId);
		return fiBudgetList;
	}

	/**
	 * 将FiCoCapInputDTO列表返回
	 * 
	 * @param accountSetId
	 * @param status
	 * @return
	 */
	public List<FiCoCapInputDTO> getFiCoCapInputDTOList(Long accountSetId, String status,Long sysId,Long companyId) {
		List<FiCoCapInput> fiCoCapInputList = getFiCoCapInputList(accountSetId, status,sysId, companyId);
		List<FiCoCapInputDTO> dtoList = new ArrayList<FiCoCapInputDTO>(fiCoCapInputList.size());
		for (FiCoCapInput fiCoCapInput : fiCoCapInputList) {
			FiCoCapInputDTO subjectDTO = captionToSubjectDTO(fiCoCapInput);
			dtoList.add(subjectDTO);
		}
		return dtoList;
	}
	
	public List<FiCoCapInput> getFiCoCapInputListByCapAndCoCode(String accountCapCode,String code,Long accountSetId,Long companyId,Long sysId){
		List<FiCoCapInput> fiBudgetList = new ArrayList<FiCoCapInput>();
		fiBudgetList = getDao().findByHQL(FiCoCapInput.class, "from FiCoCapInput p where  p.accountSetId = ? and p.sysId = ? and p.status=1 and p.companyId=? and p.accountCapCode=? and p.code=? order by p.code asc",accountSetId,sysId,companyId,accountCapCode,code);
		return fiBudgetList;
	}

	/**
	 * 将会计科目转换成Dto对象
	 * 
	 * @param accountCaption
	 * @return
	 */
	private FiCoCapInputDTO captionToSubjectDTO(FiCoCapInput fiCoCapInput) {
		FiCoCapInputDTO dto = new FiCoCapInputDTO();
		dto.setId(String.valueOf(fiCoCapInput.getId()));
		dto.setPid(fiCoCapInput.getParentId() == null ? "" : fiCoCapInput.getParentId().toString());
		dto.setAcPid(fiCoCapInput.getAccountCapId() == null ? "":fiCoCapInput.getAccountCapId().toString());
		dto.setSubcode(fiCoCapInput.getCode());
		dto.setAccountsetid(String.valueOf(fiCoCapInput.getAccountSetId()));
		dto.setSubname(fiCoCapInput.getName());
		dto.setAccountcode(fiCoCapInput.getAccountCapCode());
		dto.setAccountname(fiCoCapInput.getAccountCapName());
		dto.setCashflowcode(fiCoCapInput.getCashFlowCode());
		dto.setCashflowname(fiCoCapInput.getCashFlowName());
		dto.setBid(fiCoCapInput.getBid());
		dto.setCompanyId(fiCoCapInput.getCompanyId());
		try{
			SimpleDateFormat sf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
			if(fiCoCapInput.getCreateDate()!=null){
				dto.setCreateDate(sf.format(fiCoCapInput.getCreateDate()));
			}
		}catch(Exception e){
			e.printStackTrace();
		}
		return dto;
	}

	/**
	 * 将预算科目保存代码
	 * 
	 * @param fiCoCapInput
	 */
	public void saveOrUpdate(FiCoCapInput fiCoCapInput) {
		getDao().saveOrUpdate(fiCoCapInput);
	}

}
