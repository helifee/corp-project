package com.xinleju.erp.frame.dao;


import java.util.ArrayList;
import java.util.List;

import org.springframework.stereotype.Repository;

import com.xinleju.erp.base.utils.StringHelper;
import com.xinleju.erp.flow.dao.impl.BaseDAO;
import com.xinleju.erp.frame.models.FuncButton;

/**
 * 版权：(C) 版权所有 2000-2014 上海天好电子商务有限公司苏州分公司 按钮Dao <详细描述>
 * 
 * @author zhengxj
 * @version $Id: FuncButtonDao.java 809 2015-03-26 10:31:20Z chenhongbin $
 * @since
 * @see
 */
@Repository
public class FuncButtonDao extends BaseDAO {
	
	 /**
	    * 查询所有FuncButton，缓存使用
	    * @return
	    */
	public List<FuncButton> getAllFuncButton(){    	
 	String hql ="from FuncButton u where 1=1";
 	List<FuncButton> r  = getDao().findByHQL(FuncButton.class,hql);
 	return r;
 }

    /**
     * 根据菜单id获取按钮 〈详细描述〉
     * 
     * @author zhengxj
     * @param funcModuleId 菜单id
     * @return
     */
    public List<FuncButton> getFuncButtonListByFuncId(Long funcModuleId) {
        return getDao().findByHQL(FuncButton.class, "from FuncButton where funcModuleId = ?",
            funcModuleId);
    }
    
    
    /**
     * 获得有权限的操作
     * @param roleIds
     * @param funcModuleId
     * @return
     */
    public List<FuncButton> getAuthFuncButtonListByFuncId(List<Long> roleIds,Long funcModuleId) {
        StringBuffer hqlStringBuffer = new StringBuffer();
        hqlStringBuffer.append("from FuncButton b where exists(").append(
            "select 'X' from  RoleButton rb where rb.funcButtonId = b.id and rb.roleId in("
                + StringHelper.join(roleIds.toArray(), ",") + ")").append(")  ").append(" and b.funcModuleId = ?");
        return getDao().findByHQL(FuncButton.class, hqlStringBuffer.toString(), funcModuleId);
    }

}
