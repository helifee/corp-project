package com.xinleju.erp.frame.models.extender;

import java.util.HashMap;
import java.util.Map;

import com.xinleju.erp.frame.dao.AppDao;
import com.xinleju.erp.frame.models.App;
import com.xinleju.erp.frame.models.CorpMapping;
import com.xinleju.erp.frame.models.EntityExtender;

public class CorpMappingExtender extends EntityExtender {
	@SuppressWarnings("unused")
	private String beusedsysname = "";
	private AppDao appDao ;
	
	private Map<Object,Object> sysMap;
	
	public String getBeusedsysname(CorpMapping exObj) {
		String sysnames = "";
		String beusedsys = exObj.getBeusedsys();
		if(beusedsys != null && beusedsys.length() > 0){
			String[] syses = beusedsys.split(",");
			if(syses!=null && syses.length >0 ){
				StringBuffer buffer = new StringBuffer();
				for(String sys : syses){
					 Object name = getSysMap().get(sys);
					 if(name == null)
						 continue;
					 buffer.append(name.toString() + ",");
				}
				if(buffer.toString().endsWith(","))
					sysnames = buffer.substring(0, buffer.length() - 1);
			}
		}
		return sysnames;
	}

	private Map<Object,Object> getSysMap(){
		appDao = com.xinleju.erp.base.app.config.App.getBean(AppDao.class);
		if(sysMap == null){
				sysMap = new HashMap<Object,Object>();
			Map<String,App> map = appDao.getAppMap();
			if(map == null)
				return sysMap;
			for(App app : map.values())
				sysMap.put(app.getCode(), app.getName());
		}
		return sysMap;
	}
	
	public void setBeusedsysname(String beusedsysname) {
		this.beusedsysname = beusedsysname;
	}
	
}
