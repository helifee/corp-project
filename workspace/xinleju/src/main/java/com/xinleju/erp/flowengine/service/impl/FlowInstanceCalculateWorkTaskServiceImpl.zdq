package com.xinleju.erp.flowengine.service.impl;

import java.util.List;

import org.springframework.stereotype.Service;

import com.xinleju.erp.base.app.service.impl.BaseService;
import com.xinleju.erp.flow.flowutils.utils.WsConstant;
import com.xinleju.erp.flowengine.models.FlowInstanceStepWorkTask;
import com.xinleju.erp.flowengine.service.FlowInstanceCalculateWorkTaskService;

@Service
public class FlowInstanceCalculateWorkTaskServiceImpl extends BaseService implements FlowInstanceCalculateWorkTaskService {

	@Override
	public String getCurrentFlowUsers(String fiId, Integer status) {
		
		List<String> list=(List<String>) getDao().findListBySQL("SELECT\n" +
				"	participant_user_name\n" +
				"FROM\n" +
				"	flow_instance_step_work_task\n" +
				"WHERE\n" +
				"	fi_id = ?\n" +
				"AND status = ?\n" +
				"AND type IN ('" + WsConstant.WiType.ZC.getCode() + "', '" + WsConstant.WiType.CS.getCode() + "', '" + 
								   WsConstant.WiType.CY.getCode() + "', '" + WsConstant.WiType.CB.getCode() + "')", new Object[]{ fiId,status});
		StringBuilder sb=new StringBuilder();
		for(String l:list){
			sb.append(l+",");
		}
		if(sb.toString().endsWith(",")){
			sb.deleteCharAt(sb.toString().length()-1);
		}
		return sb.toString();
	}

	@Override
	public List<FlowInstanceStepWorkTask> getTaskByStepId(String stepId, Integer status) {
		
		return getDao().findAll(FlowInstanceStepWorkTask.class, "stepId = ? and status = ?",new Object[] { stepId,status });
	}
}
