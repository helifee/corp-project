package com.xinleju.erp.frame.models.ref;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import com.xinleju.erp.base.app.bean.Page;
import com.xinleju.erp.frame.dao.AppDao;
import com.xinleju.erp.frame.enums.BeUsedSysEnum;
import com.xinleju.erp.frame.itf.IRefModel;
import com.xinleju.erp.frame.models.App;
import com.xinleju.erp.frame.utils.BeanUtil;

@Component
public class AppRefModel implements IRefModel {
	@Autowired
	AppDao appDao;
	@Override
	public Page getData(int start,int limit,String keywords) {
		Page page = new Page();
		Map<String,App> appMap = appDao.getAppMap();
		List<App> list = new ArrayList<App>();
		Set<Object> set = BeUsedSysEnum.getMap().keySet();
		if(appMap != null && appMap.size() != 0){
			for(App app: appMap.values()){
				if(set.contains(app.getCode()))
						list.add(app);
			}
		}
	
		List<Map<String,Object>> items = transfrom(list);
		page.setItems(items);
		page.setTotal(items.size());
		return page;
	}
	
	private List<Map<String,Object>> transfrom(List<?> list){
		List<Map<String,Object>> transList = new ArrayList<Map<String,Object>>();
		if(list == null)
			return transList;
		for(Object obj : list){
			transList.add(transform(obj));
		}
		return transList;
	}
	
	private Map<String,Object> transform(Object entity){
		Map<String,Object> map = new HashMap<String,Object>();
		map.put(getKeyField(), BeanUtil.getAttribute(getKeyField(),entity));
		map.put(getNameField(), BeanUtil.getAttribute(getNameField(),entity));
		for(String field : getShowFields()){
			Object value =  BeanUtil.getAttribute(field,entity);
			map.put(field, value);
		}
		return map;
	}

	@Override
	public String getKeyField() {
		return "code";
	}

	@Override
	public String getNameField() {
		return "name";
	}

	@Override
	public String[] getShowFields() {
		return new String[]{"code","name"};
	}
	
	@Override
	public String[] getShowNames() {
		return new String[]{"系统编码","系统名称"};
	}

	@Override
	public String getTitle() {
		return "系统";
	}

	@Override
	public Boolean isMutil() {
		return true;
	}

	@Override
	public String getCodeField() {
		return "code";
	}
}
